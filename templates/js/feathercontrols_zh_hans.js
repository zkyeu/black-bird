!function(e,t,r){function o(e){this.config=e||{}}function i(t){e.PaintModuleActionlist.call(this,t)}function n(e){e||(e={}),e.shouldAllowEmptyStrokes&&(this.shouldAllowEmptyStrokes=e.shouldAllowEmptyStrokes)}function s(e){"use strict";n.call(this,e),this.params=e||e||{},this.module=e.module}function l(t){e.PaintModuleActionlist.call(this,t)}function u(e){var t=this.paintWidget.getScaledSize(),r=e.parameters.cropParams,o={},a=r.width,i=r.aspectRatio,n=t.width*a+.5|0,s=n/i+.5|0;if(o.width=n,o.height=s,t.hiresWidth&&t.hiresHeight){var l=t.hiresWidth*a+.5|0,u=l/i+.5|0;o.hiresWidth=l,o.hiresHeight=u}return o}!function(e,t){function r(e){return O.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}function o(e){if(!xt[e]){var t=R.body,r=O("<"+e+">").appendTo(t),o=r.css("display");r.remove(),("none"===o||""===o)&&(mt||(mt=R.createElement("iframe"),mt.frameBorder=mt.width=mt.height=0),t.appendChild(mt),gt&&mt.createElement||(gt=(mt.contentWindow||mt.contentDocument).document,gt.write(("CSS1Compat"===R.compatMode?"<!doctype html>":"")+"<html><body>"),gt.close()),r=gt.createElement(e),gt.body.appendChild(r),o=O.css(r,"display"),t.removeChild(mt)),xt[e]=o}return xt[e]}function a(e,t){var r={};return O.each(bt.concat.apply([],bt.slice(0,t)),function(){r[this]=e}),r}function i(){_t=t}function n(){return setTimeout(i,0),_t=O.now()}function s(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function l(){try{return new e.XMLHttpRequest}catch(t){}}function u(e,r){e.dataFilter&&(r=e.dataFilter(r,e.dataType));var o,a,i,n,s,l,u,c,d=e.dataTypes,p={},h=d.length,f=d[0];for(o=1;h>o;o++){if(1===o)for(a in e.converters)"string"==typeof a&&(p[a.toLowerCase()]=e.converters[a]);if(n=f,f=d[o],"*"===f)f=n;else if("*"!==n&&n!==f){if(s=n+" "+f,l=p[s]||p["* "+f],!l){c=t;for(u in p)if(i=u.split(" "),(i[0]===n||"*"===i[0])&&(c=p[i[1]+" "+f])){u=p[u],u===!0?l=c:c===!0&&(l=u);break}}!l&&!c&&O.error("No conversion from "+s.replace(" "," to ")),l!==!0&&(r=l?l(r):c(u(r)))}}return r}function c(e,r,o){var a,i,n,s,l=e.contents,u=e.dataTypes,c=e.responseFields;for(i in c)i in o&&(r[c[i]]=o[i]);for(;"*"===u[0];)u.shift(),a===t&&(a=e.mimeType||r.getResponseHeader("content-type"));if(a)for(i in l)if(l[i]&&l[i].test(a)){u.unshift(i);break}if(u[0]in o)n=u[0];else{for(i in o){if(!u[0]||e.converters[i+" "+u[0]]){n=i;break}s||(s=i)}n=n||s}return n?(n!==u[0]&&u.unshift(n),o[n]):void 0}function d(e,t,r,o){if(O.isArray(t))O.each(t,function(t,a){r||He.test(e)?o(e,a):d(e+"["+("object"==typeof a||O.isArray(a)?t:"")+"]",a,r,o)});else if(r||null==t||"object"!=typeof t)o(e,t);else for(var a in t)d(e+"["+a+"]",t[a],r,o)}function p(e,r){var o,a,i=O.ajaxSettings.flatOptions||{};for(o in r)r[o]!==t&&((i[o]?e:a||(a={}))[o]=r[o]);a&&O.extend(!0,e,a)}function h(e,r,o,a,i,n){i=i||r.dataTypes[0],n=n||{},n[i]=!0;for(var s,l=e[i],u=0,c=l?l.length:0,d=e===nt;c>u&&(d||!s);u++)s=l[u](r,o,a),"string"==typeof s&&(!d||n[s]?s=t:(r.dataTypes.unshift(s),s=h(e,r,o,a,s,n)));return(d||!s)&&!n["*"]&&(s=h(e,r,o,a,"*",n)),s}function f(e){return function(t,r){if("string"!=typeof t&&(r=t,t="*"),O.isFunction(r))for(var o,a,i,n=t.toLowerCase().split(rt),s=0,l=n.length;l>s;s++)o=n[s],i=/^\+/.test(o),i&&(o=o.substr(1)||"*"),a=e[o]=e[o]||[],a[i?"unshift":"push"](r)}}function m(e,t,r){var o="width"===t?e.offsetWidth:e.offsetHeight,a="width"===t?We:Ge,i=0,n=a.length;if(o>0){if("border"!==r)for(;n>i;i++)r||(o-=parseFloat(O.css(e,"padding"+a[i]))||0),"margin"===r?o+=parseFloat(O.css(e,r+a[i]))||0:o-=parseFloat(O.css(e,"border"+a[i]+"Width"))||0;return o+"px"}if(o=De(e,t,t),(0>o||null==o)&&(o=e.style[t]||0),o=parseFloat(o)||0,r)for(;n>i;i++)o+=parseFloat(O.css(e,"padding"+a[i]))||0,"padding"!==r&&(o+=parseFloat(O.css(e,"border"+a[i]+"Width"))||0),"margin"===r&&(o+=parseFloat(O.css(e,r+a[i]))||0);return o+"px"}function g(e,t){t.src?O.ajax({url:t.src,async:!1,dataType:"script"}):O.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ae,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function v(e){var t=R.createElement("div");return Pe.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function _(e){var t=(e.nodeName||"").toLowerCase();"input"===t?x(e):"script"!==t&&"undefined"!=typeof e.getElementsByTagName&&O.grep(e.getElementsByTagName("input"),x)}function x(e){("checkbox"===e.type||"radio"===e.type)&&(e.defaultChecked=e.checked)}function w(e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName("*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll("*"):[]}function y(e,t){var r;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),r=t.nodeName.toLowerCase(),"object"===r?t.outerHTML=e.outerHTML:"input"!==r||"checkbox"!==e.type&&"radio"!==e.type?"option"===r?t.selected=e.defaultSelected:("input"===r||"textarea"===r)&&(t.defaultValue=e.defaultValue):(e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value)),t.removeAttribute(O.expando))}function b(e,t){if(1===t.nodeType&&O.hasData(e)){var r,o,a,i=O._data(e),n=O._data(t,i),s=i.events;if(s){delete n.handle,n.events={};for(r in s)for(o=0,a=s[r].length;a>o;o++)O.event.add(t,r+(s[r][o].namespace?".":"")+s[r][o].namespace,s[r][o],s[r][o].data)}n.data&&(n.data=O.extend({},n.data))}}function M(e,t){return O.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function C(e){var t=me.split("|"),r=e.createDocumentFragment();if(r.createElement)for(;t.length;)r.createElement(t.pop());return r}function T(e,t,r){if(t=t||0,O.isFunction(t))return O.grep(e,function(e,o){var a=!!t.call(e,o,e);return a===r});if(t.nodeType)return O.grep(e,function(e,o){return e===t===r});if("string"==typeof t){var o=O.grep(e,function(e){return 1===e.nodeType});if(de.test(t))return O.filter(t,o,!r);t=O.filter(t,o)}return O.grep(e,function(e,o){return O.inArray(e,t)>=0===r})}function S(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function A(){return!0}function E(){return!1}function P(e,t,r){var o=t+"defer",a=t+"queue",i=t+"mark",n=O._data(e,o);n&&("queue"===r||!O._data(e,a))&&("mark"===r||!O._data(e,i))&&setTimeout(function(){!O._data(e,a)&&!O._data(e,i)&&(O.removeData(e,o,!0),n.fire())},0)}function D(e){for(var t in e)if(("data"!==t||!O.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function F(e,r,o){if(o===t&&1===e.nodeType){var a="data-"+r.replace(W,"-$1").toLowerCase();if(o=e.getAttribute(a),"string"==typeof o){try{o="true"===o?!0:"false"===o?!1:"null"===o?null:O.isNumeric(o)?parseFloat(o):U.test(o)?O.parseJSON(o):o}catch(i){}O.data(e,r,o)}else o=t}return o}function L(e){var t,r,o=N[e]={};for(e=e.split(/\s+/),t=0,r=e.length;r>t;t++)o[e[t]]=!0;return o}var R=e.document,I=e.navigator,B=e.location,O=function(){function r(){if(!s.isReady){try{R.documentElement.doScroll("left")}catch(e){return void setTimeout(r,1)}s.ready()}}var o,a,i,n,s=function(e,t){return new s.fn.init(e,t,o)},l=e.jQuery,u=e.$,c=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,d=/\S/,p=/^\s+/,h=/\s+$/,f=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,m=/^[\],:{}\s]*$/,g=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,v=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_=/(?:^|:|,)(?:\s*\[)+/g,x=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,y=/(msie) ([\w.]+)/,b=/(mozilla)(?:.*? rv:([\w.]+))?/,M=/-([a-z]|[0-9])/gi,C=/^-ms-/,T=function(e,t){return(t+"").toUpperCase()},S=I.userAgent,A=Object.prototype.toString,E=Object.prototype.hasOwnProperty,P=Array.prototype.push,D=Array.prototype.slice,F=String.prototype.trim,L=Array.prototype.indexOf,B={};return s.fn=s.prototype={constructor:s,init:function(e,r,o){var a,i,n,l;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("body"===e&&!r&&R.body)return this.context=R,this[0]=R.body,this.selector=e,this.length=1,this;if("string"==typeof e){if(a="<"!==e.charAt(0)||">"!==e.charAt(e.length-1)||e.length<3?c.exec(e):[null,e,null],a&&(a[1]||!r)){if(a[1])return r=r instanceof s?r[0]:r,l=r?r.ownerDocument||r:R,n=f.exec(e),n?s.isPlainObject(r)?(e=[R.createElement(n[1])],s.fn.attr.call(e,r,!0)):e=[l.createElement(n[1])]:(n=s.buildFragment([a[1]],[l]),e=(n.cacheable?s.clone(n.fragment):n.fragment).childNodes),s.merge(this,e);if(i=R.getElementById(a[2]),i&&i.parentNode){if(i.id!==a[2])return o.find(e);this.length=1,this[0]=i}return this.context=R,this.selector=e,this}return!r||r.jquery?(r||o).find(e):this.constructor(r).find(e)}return s.isFunction(e)?o.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),s.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return D.call(this,0)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e,t,r){var o=this.constructor();return s.isArray(e)?P.apply(o,e):s.merge(o,e),o.prevObject=this,o.context=this.context,"find"===t?o.selector=this.selector+(this.selector?" ":"")+r:t&&(o.selector=this.selector+"."+t+"("+r+")"),o},each:function(e,t){return s.each(this,e,t)},ready:function(e){return s.bindReady(),i.add(e),this},eq:function(e){return e=+e,-1===e?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(D.apply(this,arguments),"slice",D.call(arguments).join(","))},map:function(e){return this.pushStack(s.map(this,function(t,r){return e.call(t,r,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:P,sort:[].sort,splice:[].splice},s.fn.init.prototype=s.fn,s.extend=s.fn.extend=function(){var e,r,o,a,i,n,l=arguments[0]||{},u=1,c=arguments.length,d=!1;for("boolean"==typeof l&&(d=l,l=arguments[1]||{},u=2),"object"!=typeof l&&!s.isFunction(l)&&(l={}),c===u&&(l=this,--u);c>u;u++)if(null!=(e=arguments[u]))for(r in e)o=l[r],a=e[r],l!==a&&(d&&a&&(s.isPlainObject(a)||(i=s.isArray(a)))?(i?(i=!1,n=o&&s.isArray(o)?o:[]):n=o&&s.isPlainObject(o)?o:{},l[r]=s.extend(d,n,a)):a!==t&&(l[r]=a));return l},s.extend({noConflict:function(t){return e.$===s&&(e.$=u),t&&e.jQuery===s&&(e.jQuery=l),s},isReady:!1,readyWait:1,holdReady:function(e){e?s.readyWait++:s.ready(!0)},ready:function(e){if(e===!0&&!--s.readyWait||e!==!0&&!s.isReady){if(!R.body)return setTimeout(s.ready,1);if(s.isReady=!0,e!==!0&&--s.readyWait>0)return;i.fireWith(R,[s]),s.fn.trigger&&s(R).trigger("ready").off("ready")}},bindReady:function(){if(!i){if(i=s.Callbacks("once memory"),"complete"===R.readyState)return setTimeout(s.ready,1);if(R.addEventListener)R.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",s.ready,!1);else if(R.attachEvent){R.attachEvent("onreadystatechange",n),e.attachEvent("onload",s.ready);var t=!1;try{t=null==e.frameElement}catch(o){}R.documentElement.doScroll&&t&&r()}}},isFunction:function(e){return"function"===s.type(e)},isArray:Array.isArray||function(e){return"array"===s.type(e)},isWindow:function(e){return e&&"object"==typeof e&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):B[A.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==s.type(e)||e.nodeType||s.isWindow(e))return!1;try{if(e.constructor&&!E.call(e,"constructor")&&!E.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}var o;for(o in e);return o===t||E.call(e,o)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){return"string"==typeof t&&t?(t=s.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):m.test(t.replace(g,"@").replace(v,"]").replace(_,""))?new Function("return "+t)():void s.error("Invalid JSON: "+t)):null},parseXML:function(r){var o,a;try{e.DOMParser?(a=new DOMParser,o=a.parseFromString(r,"text/xml")):(o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(r))}catch(i){o=t}return(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)&&s.error("Invalid XML: "+r),o},noop:function(){},globalEval:function(t){t&&d.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(M,T)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,r,o){var a,i=0,n=e.length,l=n===t||s.isFunction(e);if(o)if(l){for(a in e)if(r.apply(e[a],o)===!1)break}else for(;n>i&&r.apply(e[i++],o)!==!1;);else if(l){for(a in e)if(r.call(e[a],a,e[a])===!1)break}else for(;n>i&&r.call(e[i],i,e[i++])!==!1;);return e},trim:F?function(e){return null==e?"":F.call(e)}:function(e){return null==e?"":(e+"").replace(p,"").replace(h,"")},makeArray:function(e,t){var r=t||[];if(null!=e){var o=s.type(e);null==e.length||"string"===o||"function"===o||"regexp"===o||s.isWindow(e)?P.call(r,e):s.merge(r,e)}return r},inArray:function(e,t,r){var o;if(t){if(L)return L.call(t,e,r);for(o=t.length,r=r?0>r?Math.max(0,o+r):r:0;o>r;r++)if(r in t&&t[r]===e)return r}return-1},merge:function(e,r){var o=e.length,a=0;if("number"==typeof r.length)for(var i=r.length;i>a;a++)e[o++]=r[a];else for(;r[a]!==t;)e[o++]=r[a++];return e.length=o,e},grep:function(e,t,r){var o,a=[];r=!!r;for(var i=0,n=e.length;n>i;i++)o=!!t(e[i],i),r!==o&&a.push(e[i]);return a},map:function(e,r,o){var a,i,n=[],l=0,u=e.length,c=e instanceof s||u!==t&&"number"==typeof u&&(u>0&&e[0]&&e[u-1]||0===u||s.isArray(e));if(c)for(;u>l;l++)a=r(e[l],l,o),null!=a&&(n[n.length]=a);else for(i in e)a=r(e[i],i,o),null!=a&&(n[n.length]=a);return n.concat.apply([],n)},guid:1,proxy:function(e,r){if("string"==typeof r){var o=e[r];r=e,e=o}if(!s.isFunction(e))return t;var a=D.call(arguments,2),i=function(){return e.apply(r,a.concat(D.call(arguments)))};return i.guid=e.guid=e.guid||i.guid||s.guid++,i},access:function(e,r,o,a,i,n){var l=e.length;if("object"==typeof r){for(var u in r)s.access(e,u,r[u],a,i,o);return e}if(o!==t){a=!n&&a&&s.isFunction(o);for(var c=0;l>c;c++)i(e[c],r,a?o.call(e[c],c,i(e[c],r)):o,n);return e}return l?i(e[0],r):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=x.exec(e)||w.exec(e)||y.exec(e)||e.indexOf("compatible")<0&&b.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,r){return new e.fn.init(t,r)}s.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,o){return o&&o instanceof s&&!(o instanceof e)&&(o=e(o)),s.fn.init.call(this,r,o,t)},e.fn.init.prototype=e.fn;var t=e(R);return e},browser:{}}),s.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){B["[object "+t+"]"]=t.toLowerCase()}),a=s.uaMatch(S),a.browser&&(s.browser[a.browser]=!0,s.browser.version=a.version),s.browser.webkit&&(s.browser.safari=!0),d.test("\xa0")&&(p=/^[\s\xA0]+/,h=/[\s\xA0]+$/),o=s(R),R.addEventListener?n=function(){R.removeEventListener("DOMContentLoaded",n,!1),s.ready()}:R.attachEvent&&(n=function(){"complete"===R.readyState&&(R.detachEvent("onreadystatechange",n),s.ready())}),s}(),N={};O.Callbacks=function(e){e=e?N[e]||L(e):{};var r,o,a,i,n,s=[],l=[],u=function(t){var r,o,a,i;for(r=0,o=t.length;o>r;r++)a=t[r],i=O.type(a),"array"===i?u(a):"function"===i&&(!e.unique||!d.has(a))&&s.push(a)},c=function(t,u){for(u=u||[],r=!e.memory||[t,u],o=!0,n=a||0,a=0,i=s.length;s&&i>n;n++)if(s[n].apply(t,u)===!1&&e.stopOnFalse){r=!0;break}o=!1,s&&(e.once?r===!0?d.disable():s=[]:l&&l.length&&(r=l.shift(),d.fireWith(r[0],r[1])))},d={add:function(){if(s){var e=s.length;u(arguments),o?i=s.length:r&&r!==!0&&(a=e,c(r[0],r[1]))}return this},remove:function(){if(s)for(var t=arguments,r=0,a=t.length;a>r;r++)for(var l=0;l<s.length&&(t[r]!==s[l]||(o&&i>=l&&(i--,n>=l&&n--),s.splice(l--,1),!e.unique));l++);return this},has:function(e){if(s)for(var t=0,r=s.length;r>t;t++)if(e===s[t])return!0;return!1},empty:function(){return s=[],this},disable:function(){return s=l=r=t,this},disabled:function(){return!s},lock:function(){return l=t,(!r||r===!0)&&d.disable(),this},locked:function(){return!l},fireWith:function(t,a){return l&&(o?e.once||l.push([t,a]):(!e.once||!r)&&c(t,a)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d};var k=[].slice;O.extend({Deferred:function(e){var t,r=O.Callbacks("once memory"),o=O.Callbacks("once memory"),a=O.Callbacks("memory"),i="pending",n={resolve:r,reject:o,notify:a},s={done:r.add,fail:o.add,progress:a.add,state:function(){return i},isResolved:r.fired,isRejected:o.fired,then:function(e,t,r){return l.done(e).fail(t).progress(r),this},always:function(){return l.done.apply(l,arguments).fail.apply(l,arguments),this},pipe:function(e,t,r){return O.Deferred(function(o){O.each({done:[e,"resolve"],fail:[t,"reject"],progress:[r,"notify"]},function(e,t){var r,a=t[0],i=t[1];O.isFunction(a)?l[e](function(){r=a.apply(this,arguments),r&&O.isFunction(r.promise)?r.promise().then(o.resolve,o.reject,o.notify):o[i+"With"](this===l?o:this,[r])}):l[e](o[i])})}).promise()},promise:function(e){if(null==e)e=s;else for(var t in s)e[t]=s[t];return e}},l=s.promise({});for(t in n)l[t]=n[t].fire,l[t+"With"]=n[t].fireWith;return l.done(function(){i="resolved"},o.disable,a.lock).fail(function(){i="rejected"},r.disable,a.lock),e&&e.call(l,l),l},when:function(e){function t(e){return function(t){n[e]=arguments.length>1?k.call(arguments,0):t,l.notifyWith(u,n)}}function r(e){return function(t){o[e]=arguments.length>1?k.call(arguments,0):t,--s||l.resolveWith(l,o)}}var o=k.call(arguments,0),a=0,i=o.length,n=Array(i),s=i,l=1>=i&&e&&O.isFunction(e.promise)?e:O.Deferred(),u=l.promise();if(i>1){for(;i>a;a++)o[a]&&o[a].promise&&O.isFunction(o[a].promise)?o[a].promise().then(r(a),l.reject,t(a)):--s;s||l.resolveWith(l,o)}else l!==e&&l.resolveWith(l,i?[e]:[]);return u}}),O.support=function(){var t,r,o,a,i,n,s,l,u,c,d,p,h=R.createElement("div");if(R.documentElement,h.setAttribute("className","t"),h.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",r=h.getElementsByTagName("*"),o=h.getElementsByTagName("a")[0],!r||!r.length||!o)return{};a=R.createElement("select"),i=a.appendChild(R.createElement("option")),n=h.getElementsByTagName("input")[0],t={leadingWhitespace:3===h.firstChild.nodeType,tbody:!h.getElementsByTagName("tbody").length,htmlSerialize:!!h.getElementsByTagName("link").length,style:/top/.test(o.getAttribute("style")),hrefNormalized:"/a"===o.getAttribute("href"),opacity:/^0.55/.test(o.style.opacity),cssFloat:!!o.style.cssFloat,checkOn:"on"===n.value,optSelected:i.selected,getSetAttribute:"t"!==h.className,enctype:!!R.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==R.createElement("nav").cloneNode(!0).outerHTML,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},n.checked=!0,t.noCloneChecked=n.cloneNode(!0).checked,a.disabled=!0,t.optDisabled=!i.disabled;try{delete h.test}catch(f){t.deleteExpando=!1}if(!h.addEventListener&&h.attachEvent&&h.fireEvent&&(h.attachEvent("onclick",function(){t.noCloneEvent=!1}),h.cloneNode(!0).fireEvent("onclick")),n=R.createElement("input"),n.value="t",n.setAttribute("type","radio"),t.radioValue="t"===n.value,n.setAttribute("checked","checked"),h.appendChild(n),l=R.createDocumentFragment(),l.appendChild(h.lastChild),t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=n.checked,l.removeChild(n),l.appendChild(h),h.innerHTML="",e.getComputedStyle&&(s=R.createElement("div"),s.style.width="0",s.style.marginRight="0",h.style.width="2px",h.appendChild(s),t.reliableMarginRight=0===(parseInt((e.getComputedStyle(s,null)||{marginRight:0}).marginRight,10)||0)),h.attachEvent)for(d in{submit:1,change:1,focusin:1})c="on"+d,p=c in h,p||(h.setAttribute(c,"return;"),p="function"==typeof h[c]),t[d+"Bubbles"]=p;return l.removeChild(h),l=a=i=s=h=n=null,O(function(){var e,r,o,a,i,n,s,l,c,d,f=R.getElementsByTagName("body")[0];!f||(n=1,s="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",l="visibility:hidden;border:0;",c="style='"+s+"border:5px solid #000;padding:0;'",d="<div "+c+"><div></div></div><table "+c+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",e=R.createElement("div"),e.style.cssText=l+"width:0;height:0;position:static;top:0;margin-top:"+n+"px",f.insertBefore(e,f.firstChild),h=R.createElement("div"),e.appendChild(h),h.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",u=h.getElementsByTagName("td"),p=0===u[0].offsetHeight,u[0].style.display="",u[1].style.display="none",t.reliableHiddenOffsets=p&&0===u[0].offsetHeight,h.innerHTML="",h.style.width=h.style.paddingLeft="1px",O.boxModel=t.boxModel=2===h.offsetWidth,"undefined"!=typeof h.style.zoom&&(h.style.display="inline",h.style.zoom=1,t.inlineBlockNeedsLayout=2===h.offsetWidth,h.style.display="",h.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=2!==h.offsetWidth),h.style.cssText=s+l,h.innerHTML=d,r=h.firstChild,o=r.firstChild,a=r.nextSibling.firstChild.firstChild,i={doesNotAddBorder:5!==o.offsetTop,doesAddBorderForTableAndCells:5===a.offsetTop},o.style.position="fixed",o.style.top="20px",i.fixedPosition=20===o.offsetTop||15===o.offsetTop,o.style.position=o.style.top="",r.style.overflow="hidden",r.style.position="relative",i.subtractsBorderForOverflowNotVisible=-5===o.offsetTop,i.doesNotIncludeMarginInBodyOffset=f.offsetTop!==n,f.removeChild(e),h=e=null,O.extend(t,i))}),t}();var U=/^(?:\{.*\}|\[.*\])$/,W=/([A-Z])/g;O.extend({cache:{},uuid:0,expando:"jQuery"+(O.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?O.cache[e[O.expando]]:e[O.expando],!!e&&!D(e)},data:function(e,r,o,a){if(O.acceptData(e)){var i,n,s,l=O.expando,u="string"==typeof r,c=e.nodeType,d=c?O.cache:e,p=c?e[l]:e[l]&&l,h="events"===r;if((!p||!d[p]||!h&&!a&&!d[p].data)&&u&&o===t)return;return p||(c?e[l]=p=++O.uuid:p=l),d[p]||(d[p]={},c||(d[p].toJSON=O.noop)),("object"==typeof r||"function"==typeof r)&&(a?d[p]=O.extend(d[p],r):d[p].data=O.extend(d[p].data,r)),i=n=d[p],a||(n.data||(n.data={}),n=n.data),o!==t&&(n[O.camelCase(r)]=o),h&&!n[r]?i.events:(u?(s=n[r],null==s&&(s=n[O.camelCase(r)])):s=n,s)}},removeData:function(e,t,r){if(O.acceptData(e)){var o,a,i,n=O.expando,s=e.nodeType,l=s?O.cache:e,u=s?e[n]:n;if(!l[u])return;if(t&&(o=r?l[u]:l[u].data)){O.isArray(t)||(t in o?t=[t]:(t=O.camelCase(t),t=t in o?[t]:t.split(" ")));for(a=0,i=t.length;i>a;a++)delete o[t[a]];if(!(r?D:O.isEmptyObject)(o))return}if(!r&&(delete l[u].data,!D(l[u])))return;O.support.deleteExpando||!l.setInterval?delete l[u]:l[u]=null,s&&(O.support.deleteExpando?delete e[n]:e.removeAttribute?e.removeAttribute(n):e[n]=null)}},_data:function(e,t,r){return O.data(e,t,r,!0)},acceptData:function(e){if(e.nodeName){var t=O.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),O.fn.extend({data:function(e,r){var o,a,i,n=null;if("undefined"==typeof e){if(this.length&&(n=O.data(this[0]),1===this[0].nodeType&&!O._data(this[0],"parsedAttrs"))){a=this[0].attributes;for(var s=0,l=a.length;l>s;s++)i=a[s].name,0===i.indexOf("data-")&&(i=O.camelCase(i.substring(5)),F(this[0],i,n[i]));O._data(this[0],"parsedAttrs",!0)}return n}return"object"==typeof e?this.each(function(){O.data(this,e)}):(o=e.split("."),o[1]=o[1]?"."+o[1]:"",r===t?(n=this.triggerHandler("getData"+o[1]+"!",[o[0]]),n===t&&this.length&&(n=O.data(this[0],e),n=F(this[0],e,n)),n===t&&o[1]?this.data(o[0]):n):this.each(function(){var t=O(this),a=[o[0],r];t.triggerHandler("setData"+o[1]+"!",a),O.data(this,e,r),t.triggerHandler("changeData"+o[1]+"!",a)}))},removeData:function(e){return this.each(function(){O.removeData(this,e)})}}),O.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",O._data(e,t,(O._data(e,t)||0)+1))},_unmark:function(e,t,r){if(e!==!0&&(r=t,t=e,e=!1),t){r=r||"fx";var o=r+"mark",a=e?0:(O._data(t,o)||1)-1;a?O._data(t,o,a):(O.removeData(t,o,!0),P(t,r,"mark"))}},queue:function(e,t,r){var o;return e?(t=(t||"fx")+"queue",o=O._data(e,t),r&&(!o||O.isArray(r)?o=O._data(e,t,O.makeArray(r)):o.push(r)),o||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=O.queue(e,t),o=r.shift(),a={};"inprogress"===o&&(o=r.shift()),o&&("fx"===t&&r.unshift("inprogress"),O._data(e,t+".run",a),o.call(e,function(){O.dequeue(e,t)},a)),r.length||(O.removeData(e,t+"queue "+t+".run",!0),P(e,t,"queue"))}}),O.fn.extend({queue:function(e,r){return"string"!=typeof e&&(r=e,e="fx"),r===t?O.queue(this[0],e):this.each(function(){var t=O.queue(this,e,r);"fx"===e&&"inprogress"!==t[0]&&O.dequeue(this,e)})},dequeue:function(e){return this.each(function(){O.dequeue(this,e)})},delay:function(e,t){return e=O.fx?O.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var o=setTimeout(t,e);r.stop=function(){clearTimeout(o)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,r){function o(){--l||i.resolveWith(n,[n])}"string"!=typeof e&&(r=e,e=t),e=e||"fx";for(var a,i=O.Deferred(),n=this,s=n.length,l=1,u=e+"defer",c=e+"queue",d=e+"mark";s--;)(a=O.data(n[s],u,t,!0)||(O.data(n[s],c,t,!0)||O.data(n[s],d,t,!0))&&O.data(n[s],u,O.Callbacks("once memory"),!0))&&(l++,a.add(o));return o(),i.promise()}});var G,j,V,z=/[\n\t\r]/g,H=/\s+/,X=/\r/g,$=/^(?:button|input)$/i,Y=/^(?:button|input|object|select|textarea)$/i,q=/^a(?:rea)?$/i,Z=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,K=O.support.getSetAttribute;O.fn.extend({attr:function(e,t){return O.access(this,e,t,!0,O.attr)},removeAttr:function(e){return this.each(function(){O.removeAttr(this,e)})},prop:function(e,t){return O.access(this,e,t,!0,O.prop)},removeProp:function(e){return e=O.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(r){}})},addClass:function(e){var t,r,o,a,i,n,s;if(O.isFunction(e))return this.each(function(t){O(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(H),r=0,o=this.length;o>r;r++)if(a=this[r],1===a.nodeType)if(a.className||1!==t.length){for(i=" "+a.className+" ",n=0,s=t.length;s>n;n++)~i.indexOf(" "+t[n]+" ")||(i+=t[n]+" ");a.className=O.trim(i)}else a.className=e;return this},removeClass:function(e){var r,o,a,i,n,s,l;if(O.isFunction(e))return this.each(function(t){O(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(r=(e||"").split(H),o=0,a=this.length;a>o;o++)if(i=this[o],1===i.nodeType&&i.className)if(e){for(n=(" "+i.className+" ").replace(z," "),s=0,l=r.length;l>s;s++)n=n.replace(" "+r[s]+" "," ");i.className=O.trim(n)}else i.className="";return this},toggleClass:function(e,t){var r=typeof e,o="boolean"==typeof t;return O.isFunction(e)?this.each(function(r){O(this).toggleClass(e.call(this,r,this.className,t),t)}):this.each(function(){if("string"===r)for(var a,i=0,n=O(this),s=t,l=e.split(H);a=l[i++];)s=o?s:!n.hasClass(a),n[s?"addClass":"removeClass"](a);else("undefined"===r||"boolean"===r)&&(this.className&&O._data(this,"__className__",this.className),this.className=this.className||e===!1?"":O._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",r=0,o=this.length;o>r;r++)if(1===this[r].nodeType&&(" "+this[r].className+" ").replace(z," ").indexOf(t)>-1)return!0;return!1},val:function(e){var r,o,a,i=this[0];return arguments.length?(a=O.isFunction(e),this.each(function(o){var i,n=O(this);1===this.nodeType&&(i=a?e.call(this,o,n.val()):e,null==i?i="":"number"==typeof i?i+="":O.isArray(i)&&(i=O.map(i,function(e){return null==e?"":e+""})),r=O.valHooks[this.nodeName.toLowerCase()]||O.valHooks[this.type],r&&"set"in r&&r.set(this,i,"value")!==t||(this.value=i))})):i?(r=O.valHooks[i.nodeName.toLowerCase()]||O.valHooks[i.type],r&&"get"in r&&(o=r.get(i,"value"))!==t?o:(o=i.value,"string"==typeof o?o.replace(X,""):null==o?"":o)):void 0}}),O.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,r,o,a,i=e.selectedIndex,n=[],s=e.options,l="select-one"===e.type;if(0>i)return null;for(r=l?i:0,o=l?i+1:s.length;o>r;r++)if(a=s[r],a.selected&&(O.support.optDisabled?!a.disabled:null===a.getAttribute("disabled"))&&(!a.parentNode.disabled||!O.nodeName(a.parentNode,"optgroup"))){if(t=O(a).val(),l)return t;n.push(t)}return l&&!n.length&&s.length?O(s[i]).val():n},set:function(e,t){var r=O.makeArray(t);return O(e).find("option").each(function(){this.selected=O.inArray(O(this).val(),r)>=0}),r.length||(e.selectedIndex=-1),r}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,r,o,a){var i,n,s,l=e.nodeType;return e&&3!==l&&8!==l&&2!==l?a&&r in O.attrFn?O(e)[r](o):"undefined"==typeof e.getAttribute?O.prop(e,r,o):(s=1!==l||!O.isXMLDoc(e),s&&(r=r.toLowerCase(),n=O.attrHooks[r]||(Z.test(r)?j:G)),o!==t?null===o?void O.removeAttr(e,r):n&&"set"in n&&s&&(i=n.set(e,o,r))!==t?i:(e.setAttribute(r,""+o),o):n&&"get"in n&&s&&null!==(i=n.get(e,r))?i:(i=e.getAttribute(r),null===i?t:i)):void 0},removeAttr:function(e,t){var r,o,a,i,n=0;if(t&&1===e.nodeType)for(o=t.toLowerCase().split(H),i=o.length;i>n;n++)a=o[n],a&&(r=O.propFix[a]||a,O.attr(e,a,""),e.removeAttribute(K?a:r),Z.test(a)&&r in e&&(e[r]=!1))},attrHooks:{type:{set:function(e,t){if($.test(e.nodeName)&&e.parentNode)O.error("type property can't be changed");else if(!O.support.radioValue&&"radio"===t&&O.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}},value:{get:function(e,t){return G&&O.nodeName(e,"button")?G.get(e,t):t in e?e.value:null},set:function(e,t,r){return G&&O.nodeName(e,"button")?G.set(e,t,r):void(e.value=t)}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,r,o){var a,i,n,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(n=1!==s||!O.isXMLDoc(e),n&&(r=O.propFix[r]||r,i=O.propHooks[r]),o!==t?i&&"set"in i&&(a=i.set(e,o,r))!==t?a:e[r]=o:i&&"get"in i&&null!==(a=i.get(e,r))?a:e[r]):void 0},propHooks:{tabIndex:{get:function(e){var r=e.getAttributeNode("tabindex");return r&&r.specified?parseInt(r.value,10):Y.test(e.nodeName)||q.test(e.nodeName)&&e.href?0:t}}}}),O.attrHooks.tabindex=O.propHooks.tabIndex,j={get:function(e,r){var o,a=O.prop(e,r);return a===!0||"boolean"!=typeof a&&(o=e.getAttributeNode(r))&&o.nodeValue!==!1?r.toLowerCase():t},set:function(e,t,r){var o;return t===!1?O.removeAttr(e,r):(o=O.propFix[r]||r,o in e&&(e[o]=!0),e.setAttribute(r,r.toLowerCase())),r}},K||(V={name:!0,id:!0},G=O.valHooks.button={get:function(e,r){var o;return o=e.getAttributeNode(r),o&&(V[r]?""!==o.nodeValue:o.specified)?o.nodeValue:t},set:function(e,t,r){var o=e.getAttributeNode(r);return o||(o=R.createAttribute(r),e.setAttributeNode(o)),o.nodeValue=t+""}},O.attrHooks.tabindex.set=G.set,O.each(["width","height"],function(e,t){O.attrHooks[t]=O.extend(O.attrHooks[t],{set:function(e,r){return""===r?(e.setAttribute(t,"auto"),r):void 0}})}),O.attrHooks.contenteditable={get:G.get,set:function(e,t,r){""===t&&(t="false"),G.set(e,t,r)}}),O.support.hrefNormalized||O.each(["href","src","width","height"],function(e,r){O.attrHooks[r]=O.extend(O.attrHooks[r],{get:function(e){var o=e.getAttribute(r,2);return null===o?t:o}})}),O.support.style||(O.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),O.support.optSelected||(O.propHooks.selected=O.extend(O.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),O.support.enctype||(O.propFix.enctype="encoding"),O.support.checkOn||O.each(["radio","checkbox"],function(){O.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),O.each(["radio","checkbox"],function(){O.valHooks[this]=O.extend(O.valHooks[this],{
set:function(e,t){return O.isArray(t)?e.checked=O.inArray(O(e).val(),t)>=0:void 0}})});var Q=/^(?:textarea|input|select)$/i,J=/^([^\.]*)?(?:\.(.+))?$/,ee=/\bhover(\.\S+)?\b/,te=/^key/,re=/^(?:mouse|contextmenu)|click/,oe=/^(?:focusinfocus|focusoutblur)$/,ae=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,ie=function(e){var t=ae.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},ne=function(e,t){var r=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(r.id||{}).value===t[2])&&(!t[3]||t[3].test((r["class"]||{}).value))},se=function(e){return O.event.special.hover?e:e.replace(ee,"mouseenter$1 mouseleave$1")};O.event={add:function(e,r,o,a,i){var n,s,l,u,c,d,p,h,f,m,g;if(3!==e.nodeType&&8!==e.nodeType&&r&&o&&(n=O._data(e))){for(o.handler&&(f=o,o=f.handler),o.guid||(o.guid=O.guid++),l=n.events,l||(n.events=l={}),s=n.handle,s||(n.handle=s=function(e){return"undefined"==typeof O||e&&O.event.triggered===e.type?t:O.event.dispatch.apply(s.elem,arguments)},s.elem=e),r=O.trim(se(r)).split(" "),u=0;u<r.length;u++)c=J.exec(r[u])||[],d=c[1],p=(c[2]||"").split(".").sort(),g=O.event.special[d]||{},d=(i?g.delegateType:g.bindType)||d,g=O.event.special[d]||{},h=O.extend({type:d,origType:c[1],data:a,handler:o,guid:o.guid,selector:i,quick:ie(i),namespace:p.join(".")},f),m=l[d],m||(m=l[d]=[],m.delegateCount=0,g.setup&&g.setup.call(e,a,p,s)!==!1||(e.addEventListener?e.addEventListener(d,s,!1):e.attachEvent&&e.attachEvent("on"+d,s))),g.add&&(g.add.call(e,h),h.handler.guid||(h.handler.guid=o.guid)),i?m.splice(m.delegateCount++,0,h):m.push(h),O.event.global[d]=!0;e=null}},global:{},remove:function(e,t,r,o,a){var i,n,s,l,u,c,d,p,h,f,m,g,v=O.hasData(e)&&O._data(e);if(v&&(p=v.events)){for(t=O.trim(se(t||"")).split(" "),i=0;i<t.length;i++)if(n=J.exec(t[i])||[],s=l=n[1],u=n[2],s){for(h=O.event.special[s]||{},s=(o?h.delegateType:h.bindType)||s,m=p[s]||[],c=m.length,u=u?new RegExp("(^|\\.)"+u.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=0;d<m.length;d++)g=m[d],(a||l===g.origType)&&(!r||r.guid===g.guid)&&(!u||u.test(g.namespace))&&(!o||o===g.selector||"**"===o&&g.selector)&&(m.splice(d--,1),g.selector&&m.delegateCount--,h.remove&&h.remove.call(e,g));0===m.length&&c!==m.length&&((!h.teardown||h.teardown.call(e,u)===!1)&&O.removeEvent(e,s,v.handle),delete p[s])}else for(s in p)O.event.remove(e,s+t[i],r,o,!0);O.isEmptyObject(p)&&(f=v.handle,f&&(f.elem=null),O.removeData(e,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(r,o,a,i){if(!a||3!==a.nodeType&&8!==a.nodeType){var n,s,l,u,c,d,p,h,f,m,g=r.type||r,v=[];if(oe.test(g+O.event.triggered))return;if(g.indexOf("!")>=0&&(g=g.slice(0,-1),s=!0),g.indexOf(".")>=0&&(v=g.split("."),g=v.shift(),v.sort()),(!a||O.event.customEvent[g])&&!O.event.global[g])return;if(r="object"==typeof r?r[O.expando]?r:new O.Event(g,r):new O.Event(g),r.type=g,r.isTrigger=!0,r.exclusive=s,r.namespace=v.join("."),r.namespace_re=r.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,d=g.indexOf(":")<0?"on"+g:"",!a){n=O.cache;for(l in n)n[l].events&&n[l].events[g]&&O.event.trigger(r,o,n[l].handle.elem,!0);return}if(r.result=t,r.target||(r.target=a),o=null!=o?O.makeArray(o):[],o.unshift(r),p=O.event.special[g]||{},p.trigger&&p.trigger.apply(a,o)===!1)return;if(f=[[a,p.bindType||g]],!i&&!p.noBubble&&!O.isWindow(a)){for(m=p.delegateType||g,u=oe.test(m+g)?a:a.parentNode,c=null;u;u=u.parentNode)f.push([u,m]),c=u;c&&c===a.ownerDocument&&f.push([c.defaultView||c.parentWindow||e,m])}for(l=0;l<f.length&&!r.isPropagationStopped();l++)u=f[l][0],r.type=f[l][1],h=(O._data(u,"events")||{})[r.type]&&O._data(u,"handle"),h&&h.apply(u,o),h=d&&u[d],h&&O.acceptData(u)&&h.apply(u,o)===!1&&r.preventDefault();return r.type=g,!i&&!r.isDefaultPrevented()&&(!p._default||p._default.apply(a.ownerDocument,o)===!1)&&("click"!==g||!O.nodeName(a,"a"))&&O.acceptData(a)&&d&&a[g]&&("focus"!==g&&"blur"!==g||0!==r.target.offsetWidth)&&!O.isWindow(a)&&(c=a[d],c&&(a[d]=null),O.event.triggered=g,a[g](),O.event.triggered=t,c&&(a[d]=c)),r.result}},dispatch:function(r){r=O.event.fix(r||e.event);var o,a,i,n,s,l,u,c,d,p,h=(O._data(this,"events")||{})[r.type]||[],f=h.delegateCount,m=[].slice.call(arguments,0),g=!r.exclusive&&!r.namespace,v=[];if(m[0]=r,r.delegateTarget=this,f&&!r.target.disabled&&(!r.button||"click"!==r.type))for(n=O(this),n.context=this.ownerDocument||this,i=r.target;i!=this;i=i.parentNode||this){for(l={},c=[],n[0]=i,o=0;f>o;o++)d=h[o],p=d.selector,l[p]===t&&(l[p]=d.quick?ne(i,d.quick):n.is(p)),l[p]&&c.push(d);c.length&&v.push({elem:i,matches:c})}for(h.length>f&&v.push({elem:this,matches:h.slice(f)}),o=0;o<v.length&&!r.isPropagationStopped();o++)for(u=v[o],r.currentTarget=u.elem,a=0;a<u.matches.length&&!r.isImmediatePropagationStopped();a++)d=u.matches[a],(g||!r.namespace&&!d.namespace||r.namespace_re&&r.namespace_re.test(d.namespace))&&(r.data=d.data,r.handleObj=d,s=((O.event.special[d.origType]||{}).handle||d.handler).apply(u.elem,m),s!==t&&(r.result=s,s===!1&&(r.preventDefault(),r.stopPropagation())));return r.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var o,a,i,n=r.button,s=r.fromElement;return null==e.pageX&&null!=r.clientX&&(o=e.target.ownerDocument||R,a=o.documentElement,i=o.body,e.pageX=r.clientX+(a&&a.scrollLeft||i&&i.scrollLeft||0)-(a&&a.clientLeft||i&&i.clientLeft||0),e.pageY=r.clientY+(a&&a.scrollTop||i&&i.scrollTop||0)-(a&&a.clientTop||i&&i.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?r.toElement:s),!e.which&&n!==t&&(e.which=1&n?1:2&n?3:4&n?2:0),e}},fix:function(e){if(e[O.expando])return e;var r,o,a=e,i=O.event.fixHooks[e.type]||{},n=i.props?this.props.concat(i.props):this.props;for(e=O.Event(a),r=n.length;r;)o=n[--r],e[o]=a[o];return e.target||(e.target=a.srcElement||R),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),i.filter?i.filter(e,a):e},special:{ready:{setup:O.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,r){O.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,r,o){var a=O.extend(new O.Event,r,{type:e,isSimulated:!0,originalEvent:{}});o?O.event.trigger(a,null,t):O.event.dispatch.call(t,a),a.isDefaultPrevented()&&r.preventDefault()}},O.event.handle=O.event.dispatch,O.removeEvent=R.removeEventListener?function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)}:function(e,t,r){e.detachEvent&&e.detachEvent("on"+t,r)},O.Event=function(e,t){return this instanceof O.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?A:E):this.type=e,t&&O.extend(this,t),this.timeStamp=e&&e.timeStamp||O.now(),void(this[O.expando]=!0)):new O.Event(e,t)},O.Event.prototype={preventDefault:function(){this.isDefaultPrevented=A;var e=this.originalEvent;!e||(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=A;var e=this.originalEvent;!e||(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=A,this.stopPropagation()},isDefaultPrevented:E,isPropagationStopped:E,isImmediatePropagationStopped:E},O.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){O.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,o=this,a=e.relatedTarget,i=e.handleObj;return i.selector,(!a||a!==o&&!O.contains(o,a))&&(e.type=i.origType,r=i.handler.apply(this,arguments),e.type=t),r}}}),O.support.submitBubbles||(O.event.special.submit={setup:function(){return O.nodeName(this,"form")?!1:void O.event.add(this,"click._submit keypress._submit",function(e){var r=e.target,o=O.nodeName(r,"input")||O.nodeName(r,"button")?r.form:t;o&&!o._submit_attached&&(O.event.add(o,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&O.event.simulate("submit",this.parentNode,e,!0)}),o._submit_attached=!0)})},teardown:function(){return O.nodeName(this,"form")?!1:void O.event.remove(this,"._submit")}}),O.support.changeBubbles||(O.event.special.change={setup:function(){return Q.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(O.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),O.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,O.event.simulate("change",this,e,!0))})),!1):void O.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!t._change_attached&&(O.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&O.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return O.event.remove(this,"._change"),Q.test(this.nodeName)}}),O.support.focusinBubbles||O.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,o=function(e){O.event.simulate(t,e.target,O.event.fix(e),!0)};O.event.special[t]={setup:function(){0===r++&&R.addEventListener(e,o,!0)},teardown:function(){0===--r&&R.removeEventListener(e,o,!0)}}}),O.fn.extend({on:function(e,r,o,a,i){var n,s;if("object"==typeof e){"string"!=typeof r&&(o=r,r=t);for(s in e)this.on(s,r,o,e[s],i);return this}if(null==o&&null==a?(a=r,o=r=t):null==a&&("string"==typeof r?(a=o,o=t):(a=o,o=r,r=t)),a===!1)a=E;else if(!a)return this;return 1===i&&(n=a,a=function(e){return O().off(e),n.apply(this,arguments)},a.guid=n.guid||(n.guid=O.guid++)),this.each(function(){O.event.add(this,e,a,o,r)})},one:function(e,t,r,o){return this.on.call(this,e,t,r,o,1)},off:function(e,r,o){if(e&&e.preventDefault&&e.handleObj){var a=e.handleObj;return O(e.delegateTarget).off(a.namespace?a.type+"."+a.namespace:a.type,a.selector,a.handler),this}if("object"==typeof e){for(var i in e)this.off(i,r,e[i]);return this}return(r===!1||"function"==typeof r)&&(o=r,r=t),o===!1&&(o=E),this.each(function(){O.event.remove(this,e,o,r)})},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,r){return O(this.context).on(e,this.selector,t,r),this},die:function(e,t){return O(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,r,o){return this.on(t,e,r,o)},undelegate:function(e,t,r){return 1==arguments.length?this.off(e,"**"):this.off(t,e,r)},trigger:function(e,t){return this.each(function(){O.event.trigger(e,t,this)})},triggerHandler:function(e,t){return this[0]?O.event.trigger(e,t,this[0],!0):void 0},toggle:function(e){var t=arguments,r=e.guid||O.guid++,o=0,a=function(r){var a=(O._data(this,"lastToggle"+e.guid)||0)%o;return O._data(this,"lastToggle"+e.guid,a+1),r.preventDefault(),t[a].apply(this,arguments)||!1};for(a.guid=r;o<t.length;)t[o++].guid=r;return this.click(a)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),O.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){O.fn[t]=function(e,r){return null==r&&(r=e,e=null),arguments.length>0?this.on(t,null,e,r):this.trigger(t)},O.attrFn&&(O.attrFn[t]=!0),te.test(t)&&(O.event.fixHooks[t]=O.event.keyHooks),re.test(t)&&(O.event.fixHooks[t]=O.event.mouseHooks)}),function(){function e(e,t,r,o,i,n){for(var s=0,l=o.length;l>s;s++){var u=o[s];if(u){var c=!1;for(u=u[e];u;){if(u[a]===r){c=o[u.sizset];break}if(1===u.nodeType)if(n||(u[a]=r,u.sizset=s),"string"!=typeof t){if(u===t){c=!0;break}}else if(p.filter(t,[u]).length>0){c=u;break}u=u[e]}o[s]=c}}}function r(e,t,r,o,i,n){for(var s=0,l=o.length;l>s;s++){var u=o[s];if(u){var c=!1;for(u=u[e];u;){if(u[a]===r){c=o[u.sizset];break}if(1===u.nodeType&&!n&&(u[a]=r,u.sizset=s),u.nodeName.toLowerCase()===t){c=u;break}u=u[e]}o[s]=c}}}var o=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,a="sizcache"+(Math.random()+"").replace(".",""),i=0,n=Object.prototype.toString,s=!1,l=!0,u=/\\/g,c=/\r\n/g,d=/\W/;[0,0].sort(function(){return l=!1,0});var p=function(e,t,r,a){r=r||[],t=t||R;var i=t;if(1!==t.nodeType&&9!==t.nodeType)return[];if(!e||"string"!=typeof e)return r;var s,l,u,c,d,h,g,v,x=!0,w=p.isXML(t),y=[],M=e;do if(o.exec(""),s=o.exec(M),s&&(M=s[3],y.push(s[1]),s[2])){c=s[3];break}while(s);if(y.length>1&&m.exec(e))if(2===y.length&&f.relative[y[0]])l=b(y[0]+y[1],t,a);else for(l=f.relative[y[0]]?[t]:p(y.shift(),t);y.length;)e=y.shift(),f.relative[e]&&(e+=y.shift()),l=b(e,l,a);else if(!a&&y.length>1&&9===t.nodeType&&!w&&f.match.ID.test(y[0])&&!f.match.ID.test(y[y.length-1])&&(d=p.find(y.shift(),t,w),t=d.expr?p.filter(d.expr,d.set)[0]:d.set[0]),t)for(d=a?{expr:y.pop(),set:_(a)}:p.find(y.pop(),1!==y.length||"~"!==y[0]&&"+"!==y[0]||!t.parentNode?t:t.parentNode,w),l=d.expr?p.filter(d.expr,d.set):d.set,y.length>0?u=_(l):x=!1;y.length;)h=y.pop(),g=h,f.relative[h]?g=y.pop():h="",null==g&&(g=t),f.relative[h](u,g,w);else u=y=[];if(u||(u=l),u||p.error(h||e),"[object Array]"===n.call(u))if(x)if(t&&1===t.nodeType)for(v=0;null!=u[v];v++)u[v]&&(u[v]===!0||1===u[v].nodeType&&p.contains(t,u[v]))&&r.push(l[v]);else for(v=0;null!=u[v];v++)u[v]&&1===u[v].nodeType&&r.push(l[v]);else r.push.apply(r,u);else _(u,r);return c&&(p(c,i,r,a),p.uniqueSort(r)),r};p.uniqueSort=function(e){if(w&&(s=l,e.sort(w),s))for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1);return e},p.matches=function(e,t){return p(e,null,null,t)},p.matchesSelector=function(e,t){return p(t,null,null,[e]).length>0},p.find=function(e,t,r){var o,a,i,n,s,l;if(!e)return[];for(a=0,i=f.order.length;i>a;a++)if(s=f.order[a],(n=f.leftMatch[s].exec(e))&&(l=n[1],n.splice(1,1),"\\"!==l.substr(l.length-1)&&(n[1]=(n[1]||"").replace(u,""),o=f.find[s](n,t,r),null!=o))){e=e.replace(f.match[s],"");break}return o||(o="undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName("*"):[]),{set:o,expr:e}},p.filter=function(e,r,o,a){for(var i,n,s,l,u,c,d,h,m,g=e,v=[],_=r,x=r&&r[0]&&p.isXML(r[0]);e&&r.length;){for(s in f.filter)if(null!=(i=f.leftMatch[s].exec(e))&&i[2]){if(c=f.filter[s],d=i[1],n=!1,i.splice(1,1),"\\"===d.substr(d.length-1))continue;if(_===v&&(v=[]),f.preFilter[s])if(i=f.preFilter[s](i,_,o,v,a,x)){if(i===!0)continue}else n=l=!0;if(i)for(h=0;null!=(u=_[h]);h++)u&&(l=c(u,i,h,_),m=a^l,o&&null!=l?m?n=!0:_[h]=!1:m&&(v.push(u),n=!0));if(l!==t){if(o||(_=v),e=e.replace(f.match[s],""),!n)return[];break}}if(e===g){if(null!=n)break;p.error(e)}g=e}return _},p.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var h=p.getText=function(e){var t,r,o=e.nodeType,a="";if(o){if(1===o||9===o){if("string"==typeof e.textContent)return e.textContent;if("string"==typeof e.innerText)return e.innerText.replace(c,"");for(e=e.firstChild;e;e=e.nextSibling)a+=h(e)}else if(3===o||4===o)return e.nodeValue}else for(t=0;r=e[t];t++)8!==r.nodeType&&(a+=h(r));return a},f=p.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var r="string"==typeof t,o=r&&!d.test(t),a=r&&!o;o&&(t=t.toLowerCase());for(var i,n=0,s=e.length;s>n;n++)if(i=e[n]){for(;(i=i.previousSibling)&&1!==i.nodeType;);e[n]=a||i&&i.nodeName.toLowerCase()===t?i||!1:i===t}a&&p.filter(t,e,!0)},">":function(e,t){var r,o="string"==typeof t,a=0,i=e.length;if(o&&!d.test(t)){for(t=t.toLowerCase();i>a;a++)if(r=e[a]){var n=r.parentNode;e[a]=n.nodeName.toLowerCase()===t?n:!1}}else{for(;i>a;a++)r=e[a],r&&(e[a]=o?r.parentNode:r.parentNode===t);o&&p.filter(t,e,!0)}},"":function(t,o,a){var n,s=i++,l=e;"string"==typeof o&&!d.test(o)&&(o=o.toLowerCase(),n=o,l=r),l("parentNode",o,s,t,n,a)},"~":function(t,o,a){var n,s=i++,l=e;"string"==typeof o&&!d.test(o)&&(o=o.toLowerCase(),n=o,l=r),l("previousSibling",o,s,t,n,a)}},find:{ID:function(e,t,r){if("undefined"!=typeof t.getElementById&&!r){var o=t.getElementById(e[1]);return o&&o.parentNode?[o]:[]}},NAME:function(e,t){if("undefined"!=typeof t.getElementsByName){for(var r=[],o=t.getElementsByName(e[1]),a=0,i=o.length;i>a;a++)o[a].getAttribute("name")===e[1]&&r.push(o[a]);return 0===r.length?null:r}},TAG:function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e[1]):void 0}},preFilter:{CLASS:function(e,t,r,o,a,i){if(e=" "+e[1].replace(u,"")+" ",i)return e;for(var n,s=0;null!=(n=t[s]);s++)n&&(a^(n.className&&(" "+n.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?r||o.push(n):r&&(t[s]=!1));return!1},ID:function(e){return e[1].replace(u,"")},TAG:function(e,t){return e[1].replace(u,"").toLowerCase()},CHILD:function(e){if("nth"===e[1]){e[2]||p.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===e[2]&&"2n"||"odd"===e[2]&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&p.error(e[0]);return e[0]=i++,e},ATTR:function(e,t,r,o,a,i){var n=e[1]=e[1].replace(u,"");return!i&&f.attrMap[n]&&(e[1]=f.attrMap[n]),e[4]=(e[4]||e[5]||"").replace(u,""),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,r,a,i){if("not"===e[1]){if(!((o.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var n=p.filter(e[3],t,r,!0^i);return r||a.push.apply(a,n),!1}e[3]=p(e[3],null,null,t)}else if(f.match.POS.test(e[0])||f.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&"hidden"!==e.type},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,r){return!!p(r[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),r=e.type;return"input"===e.nodeName.toLowerCase()&&"text"===r&&(t===r||null===t)},radio:function(e){return"input"===e.nodeName.toLowerCase()&&"radio"===e.type},checkbox:function(e){return"input"===e.nodeName.toLowerCase()&&"checkbox"===e.type},file:function(e){return"input"===e.nodeName.toLowerCase()&&"file"===e.type},password:function(e){return"input"===e.nodeName.toLowerCase()&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"submit"===e.type},image:function(e){return"input"===e.nodeName.toLowerCase()&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,r,o){return t===o.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,r){return t<r[3]-0},gt:function(e,t,r){return t>r[3]-0},nth:function(e,t,r){return r[3]-0===t},eq:function(e,t,r){return r[3]-0===t}},filter:{PSEUDO:function(e,t,r,o){var a=t[1],i=f.filters[a];if(i)return i(e,r,t,o);if("contains"===a)return(e.textContent||e.innerText||h([e])||"").indexOf(t[3])>=0;if("not"===a){for(var n=t[3],s=0,l=n.length;l>s;s++)if(n[s]===e)return!1;return!0}p.error(a)},CHILD:function(e,t){var r,o,i,n,s,l,u=t[1],c=e;switch(u){case"only":case"first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===u)return!0;c=e;case"last":for(;c=c.nextSibling;)if(1===c.nodeType)return!1;return!0;case"nth":if(r=t[2],o=t[3],1===r&&0===o)return!0;if(i=t[0],n=e.parentNode,n&&(n[a]!==i||!e.nodeIndex)){for(s=0,c=n.firstChild;c;c=c.nextSibling)1===c.nodeType&&(c.nodeIndex=++s);n[a]=i}return l=e.nodeIndex-o,0===r?0===l:l%r===0&&l/r>=0}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var r=t[1],o=p.attr?p.attr(e,r):f.attrHandle[r]?f.attrHandle[r](e):null!=e[r]?e[r]:e.getAttribute(r),a=o+"",i=t[2],n=t[4];return null==o?"!="===i:!i&&p.attr?null!=o:"="===i?a===n:"*="===i?a.indexOf(n)>=0:"~="===i?(" "+a+" ").indexOf(n)>=0:n?"!="===i?a!==n:"^="===i?0===a.indexOf(n):"$="===i?a.substr(a.length-n.length)===n:"|="===i?a===n||a.substr(0,n.length+1)===n+"-":!1:a&&o!==!1},POS:function(e,t,r,o){var a=t[2],i=f.setFilters[a];return i?i(e,r,t,o):void 0}}},m=f.match.POS,g=function(e,t){return"\\"+(t-0+1)};for(var v in f.match)f.match[v]=new RegExp(f.match[v].source+/(?![^\[]*\])(?![^\(]*\))/.source),f.leftMatch[v]=new RegExp(/(^(?:.|\r|\n)*?)/.source+f.match[v].source.replace(/\\(\d+)/g,g));var _=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(R.documentElement.childNodes,0)[0].nodeType}catch(x){_=function(e,t){var r=0,o=t||[];if("[object Array]"===n.call(e))Array.prototype.push.apply(o,e);else if("number"==typeof e.length)for(var a=e.length;a>r;r++)o.push(e[r]);else for(;e[r];r++)o.push(e[r]);return o}}var w,y;R.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(s=!0,0):e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:1:e.compareDocumentPosition?-1:1}:(w=function(e,t){if(e===t)return s=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var r,o,a=[],i=[],n=e.parentNode,l=t.parentNode,u=n;if(n===l)return y(e,t);if(!n)return-1;if(!l)return 1;for(;u;)a.unshift(u),u=u.parentNode;for(u=l;u;)i.unshift(u),u=u.parentNode;r=a.length,o=i.length;for(var c=0;r>c&&o>c;c++)if(a[c]!==i[c])return y(a[c],i[c]);return c===r?y(e,i[c],-1):y(a[c],t,1)},y=function(e,t,r){if(e===t)return r;for(var o=e.nextSibling;o;){if(o===t)return-1;o=o.nextSibling}return 1}),function(){var e=R.createElement("div"),r="script"+(new Date).getTime(),o=R.documentElement;e.innerHTML="<a name='"+r+"'/>",o.insertBefore(e,o.firstChild),R.getElementById(r)&&(f.find.ID=function(e,r,o){if("undefined"!=typeof r.getElementById&&!o){var a=r.getElementById(e[1]);return a?a.id===e[1]||"undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id").nodeValue===e[1]?[a]:t:[]}},f.filter.ID=function(e,t){var r="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&r&&r.nodeValue===t}),o.removeChild(e),o=e=null}(),function(){var e=R.createElement("div");e.appendChild(R.createComment("")),e.getElementsByTagName("*").length>0&&(f.find.TAG=function(e,t){var r=t.getElementsByTagName(e[1]);if("*"===e[1]){for(var o=[],a=0;r[a];a++)1===r[a].nodeType&&o.push(r[a]);r=o}return r}),e.innerHTML="<a href='#'></a>",e.firstChild&&"undefined"!=typeof e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(f.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),R.querySelectorAll&&function(){var e=p,t=R.createElement("div"),r="__sizzle__";if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){p=function(t,o,a,i){if(o=o||R,!i&&!p.isXML(o)){var n=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(n&&(1===o.nodeType||9===o.nodeType)){if(n[1])return _(o.getElementsByTagName(t),a);if(n[2]&&f.find.CLASS&&o.getElementsByClassName)return _(o.getElementsByClassName(n[2]),a)}if(9===o.nodeType){if("body"===t&&o.body)return _([o.body],a);if(n&&n[3]){var s=o.getElementById(n[3]);if(!s||!s.parentNode)return _([],a);if(s.id===n[3])return _([s],a)}try{return _(o.querySelectorAll(t),a)}catch(l){}}else if(1===o.nodeType&&"object"!==o.nodeName.toLowerCase()){var u=o,c=o.getAttribute("id"),d=c||r,h=o.parentNode,m=/^\s*[+~]/.test(t);c?d=d.replace(/'/g,"\\$&"):o.setAttribute("id",d),m&&h&&(o=o.parentNode);try{if(!m||h)return _(o.querySelectorAll("[id='"+d+"'] "+t),a)}catch(g){}finally{c||u.removeAttribute("id")}}}return e(t,o,a,i)};for(var o in e)p[o]=e[o];t=null}}(),function(){var e=R.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var r=!t.call(R.createElement("div"),"div"),o=!1;try{t.call(R.documentElement,"[test!='']:sizzle")}catch(a){o=!0}p.matchesSelector=function(e,a){if(a=a.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!p.isXML(e))try{if(o||!f.match.PSEUDO.test(a)&&!/!=/.test(a)){var i=t.call(e,a);if(i||!r||e.document&&11!==e.document.nodeType)return i}}catch(n){}return p(a,null,null,[e]).length>0}}}(),function(){var e=R.createElement("div");if(e.innerHTML="<div class='test e'></div><div class='test'></div>",e.getElementsByClassName&&0!==e.getElementsByClassName("e").length){if(e.lastChild.className="e",1===e.getElementsByClassName("e").length)return;f.order.splice(1,0,"CLASS"),f.find.CLASS=function(e,t,r){return"undefined"==typeof t.getElementsByClassName||r?void 0:t.getElementsByClassName(e[1])},e=null}}(),R.documentElement.contains?p.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:R.documentElement.compareDocumentPosition?p.contains=function(e,t){return!!(16&e.compareDocumentPosition(t))}:p.contains=function(){return!1},p.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?"HTML"!==t.nodeName:!1};var b=function(e,t,r){for(var o,a=[],i="",n=t.nodeType?[t]:t;o=f.match.PSEUDO.exec(e);)i+=o[0],e=e.replace(f.match.PSEUDO,"");e=f.relative[e]?e+"*":e;for(var s=0,l=n.length;l>s;s++)p(e,n[s],a,r);return p.filter(i,a)};p.attr=O.attr,p.selectors.attrMap={},O.find=p,O.expr=p.selectors,O.expr[":"]=O.expr.filters,O.unique=p.uniqueSort,O.text=p.getText,O.isXMLDoc=p.isXML,O.contains=p.contains}();var le=/Until$/,ue=/^(?:parents|prevUntil|prevAll)/,ce=/,/,de=/^.[^:#\[\.,]*$/,pe=Array.prototype.slice,he=O.expr.match.POS,fe={children:!0,contents:!0,next:!0,prev:!0};O.fn.extend({find:function(e){var t,r,o=this;if("string"!=typeof e)return O(e).filter(function(){for(t=0,r=o.length;r>t;t++)if(O.contains(o[t],this))return!0});var a,i,n,s=this.pushStack("","find",e);for(t=0,r=this.length;r>t;t++)if(a=s.length,O.find(e,this[t],s),t>0)for(i=a;i<s.length;i++)for(n=0;a>n;n++)if(s[n]===s[i]){s.splice(i--,1);break}return s},has:function(e){var t=O(e);return this.filter(function(){for(var e=0,r=t.length;r>e;e++)if(O.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(T(this,e,!1),"not",e)},filter:function(e){return this.pushStack(T(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?he.test(e)?O(e,this.context).index(this[0])>=0:O.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var r,o,a=[],i=this[0];if(O.isArray(e)){for(var n=1;i&&i.ownerDocument&&i!==t;){for(r=0;r<e.length;r++)O(i).is(e[r])&&a.push({selector:e[r],elem:i,level:n});i=i.parentNode,n++}return a}var s=he.test(e)||"string"!=typeof e?O(e,t||this.context):0;for(r=0,o=this.length;o>r;r++)for(i=this[r];i;){if(s?s.index(i)>-1:O.find.matchesSelector(i,e)){a.push(i);break}if(i=i.parentNode,!i||!i.ownerDocument||i===t||11===i.nodeType)break}return a=a.length>1?O.unique(a):a,this.pushStack(a,"closest",e)},index:function(e){return e?"string"==typeof e?O.inArray(this[0],O(e)):O.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var r="string"==typeof e?O(e,t):O.makeArray(e&&e.nodeType?[e]:e),o=O.merge(this.get(),r);return this.pushStack(S(r[0])||S(o[0])?o:O.unique(o))},andSelf:function(){return this.add(this.prevObject)}}),O.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return O.dir(e,"parentNode")},parentsUntil:function(e,t,r){return O.dir(e,"parentNode",r)},next:function(e){return O.nth(e,2,"nextSibling")},prev:function(e){return O.nth(e,2,"previousSibling")},nextAll:function(e){return O.dir(e,"nextSibling")},prevAll:function(e){return O.dir(e,"previousSibling")},nextUntil:function(e,t,r){return O.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return O.dir(e,"previousSibling",r)},siblings:function(e){return O.sibling(e.parentNode.firstChild,e)},children:function(e){return O.sibling(e.firstChild)},contents:function(e){return O.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:O.makeArray(e.childNodes)}},function(e,t){O.fn[e]=function(r,o){var a=O.map(this,t,r);return le.test(e)||(o=r),o&&"string"==typeof o&&(a=O.filter(o,a)),a=this.length>1&&!fe[e]?O.unique(a):a,(this.length>1||ce.test(o))&&ue.test(e)&&(a=a.reverse()),this.pushStack(a,e,pe.call(arguments).join(","))}}),O.extend({filter:function(e,t,r){return r&&(e=":not("+e+")"),1===t.length?O.find.matchesSelector(t[0],e)?[t[0]]:[]:O.find.matches(e,t)},dir:function(e,r,o){for(var a=[],i=e[r];i&&9!==i.nodeType&&(o===t||1!==i.nodeType||!O(i).is(o));)1===i.nodeType&&a.push(i),i=i[r];return a},nth:function(e,t,r,o){t=t||1;for(var a=0;e&&(1!==e.nodeType||++a!==t);e=e[r]);return e},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}});var me="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ge=/ jQuery\d+="(?:\d+|null)"/g,ve=/^\s+/,_e=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,xe=/<([\w:]+)/,we=/<tbody/i,ye=/<|&#?\w+;/,be=/<(?:script|style)/i,Me=/<(?:script|object|embed|option|style)/i,Ce=new RegExp("<(?:"+me+")","i"),Te=/checked\s*(?:[^=]|=\s*.checked.)/i,Se=/\/(java|ecma)script/i,Ae=/^\s*<!(?:\[CDATA\[|\-\-)/,Ee={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Pe=C(R);Ee.optgroup=Ee.option,Ee.tbody=Ee.tfoot=Ee.colgroup=Ee.caption=Ee.thead,Ee.th=Ee.td,O.support.htmlSerialize||(Ee._default=[1,"div<div>","</div>"]),O.fn.extend({text:function(e){return O.isFunction(e)?this.each(function(t){var r=O(this);r.text(e.call(this,t,r.text()))}):"object"!=typeof e&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||R).createTextNode(e)):O.text(this)},wrapAll:function(e){if(O.isFunction(e))return this.each(function(t){O(this).wrapAll(e.call(this,t))});if(this[0]){var t=O(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return O.isFunction(e)?this.each(function(t){O(this).wrapInner(e.call(this,t));
}):this.each(function(){var t=O(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=O.isFunction(e);return this.each(function(r){O(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){O.nodeName(this,"body")||O(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1===this.nodeType&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=O.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,O.clean(arguments)),e}},remove:function(e,t){for(var r,o=0;null!=(r=this[o]);o++)(!e||O.filter(e,[r]).length)&&(!t&&1===r.nodeType&&(O.cleanData(r.getElementsByTagName("*")),O.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&O.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return O.clone(this,e,t)})},html:function(e){if(e===t)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(ge,""):null;if("string"!=typeof e||be.test(e)||!O.support.leadingWhitespace&&ve.test(e)||Ee[(xe.exec(e)||["",""])[1].toLowerCase()])O.isFunction(e)?this.each(function(t){var r=O(this);r.html(e.call(this,t,r.html()))}):this.empty().append(e);else{e=e.replace(_e,"<$1></$2>");try{for(var r=0,o=this.length;o>r;r++)1===this[r].nodeType&&(O.cleanData(this[r].getElementsByTagName("*")),this[r].innerHTML=e)}catch(a){this.empty().append(e)}}return this},replaceWith:function(e){return this[0]&&this[0].parentNode?O.isFunction(e)?this.each(function(t){var r=O(this),o=r.html();r.replaceWith(e.call(this,t,o))}):("string"!=typeof e&&(e=O(e).detach()),this.each(function(){var t=this.nextSibling,r=this.parentNode;O(this).remove(),t?O(t).before(e):O(r).append(e)})):this.length?this.pushStack(O(O.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,r,o){var a,i,n,s,l=e[0],u=[];if(!O.support.checkClone&&3===arguments.length&&"string"==typeof l&&Te.test(l))return this.each(function(){O(this).domManip(e,r,o,!0)});if(O.isFunction(l))return this.each(function(a){var i=O(this);e[0]=l.call(this,a,r?i.html():t),i.domManip(e,r,o)});if(this[0]){if(s=l&&l.parentNode,a=O.support.parentNode&&s&&11===s.nodeType&&s.childNodes.length===this.length?{fragment:s}:O.buildFragment(e,this,u),n=a.fragment,i=1===n.childNodes.length?n=n.firstChild:n.firstChild){r=r&&O.nodeName(i,"tr");for(var c=0,d=this.length,p=d-1;d>c;c++)o.call(r?M(this[c],i):this[c],a.cacheable||d>1&&p>c?O.clone(n,!0,!0):n)}u.length&&O.each(u,g)}return this}}),O.buildFragment=function(e,t,r){var o,a,i,n,s=e[0];return t&&t[0]&&(n=t[0].ownerDocument||t[0]),n.createDocumentFragment||(n=R),1===e.length&&"string"==typeof s&&s.length<512&&n===R&&"<"===s.charAt(0)&&!Me.test(s)&&(O.support.checkClone||!Te.test(s))&&(O.support.html5Clone||!Ce.test(s))&&(a=!0,i=O.fragments[s],i&&1!==i&&(o=i)),o||(o=n.createDocumentFragment(),O.clean(e,n,o,r)),a&&(O.fragments[s]=i?o:1),{fragment:o,cacheable:a}},O.fragments={},O.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){O.fn[e]=function(r){var o=[],a=O(r),i=1===this.length&&this[0].parentNode;if(i&&11===i.nodeType&&1===i.childNodes.length&&1===a.length)return a[t](this[0]),this;for(var n=0,s=a.length;s>n;n++){var l=(n>0?this.clone(!0):this).get();O(a[n])[t](l),o=o.concat(l)}return this.pushStack(o,e,a.selector)}}),O.extend({clone:function(e,t,r){var o,a,i,n=O.support.html5Clone||!Ce.test("<"+e.nodeName)?e.cloneNode(!0):v(e);if(!(O.support.noCloneEvent&&O.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||O.isXMLDoc(e)))for(y(e,n),o=w(e),a=w(n),i=0;o[i];++i)a[i]&&y(o[i],a[i]);if(t&&(b(e,n),r))for(o=w(e),a=w(n),i=0;o[i];++i)b(o[i],a[i]);return o=a=null,n},clean:function(e,t,r,o){var a;t=t||R,"undefined"==typeof t.createElement&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||R);for(var i,n,s=[],l=0;null!=(n=e[l]);l++)if("number"==typeof n&&(n+=""),n){if("string"==typeof n)if(ye.test(n)){n=n.replace(_e,"<$1></$2>");var u=(xe.exec(n)||["",""])[1].toLowerCase(),c=Ee[u]||Ee._default,d=c[0],p=t.createElement("div");for(t===R?Pe.appendChild(p):C(t).appendChild(p),p.innerHTML=c[1]+n+c[2];d--;)p=p.lastChild;if(!O.support.tbody){var h=we.test(n),f="table"!==u||h?"<table>"!==c[1]||h?[]:p.childNodes:p.firstChild&&p.firstChild.childNodes;for(i=f.length-1;i>=0;--i)O.nodeName(f[i],"tbody")&&!f[i].childNodes.length&&f[i].parentNode.removeChild(f[i])}!O.support.leadingWhitespace&&ve.test(n)&&p.insertBefore(t.createTextNode(ve.exec(n)[0]),p.firstChild),n=p.childNodes}else n=t.createTextNode(n);var m;if(!O.support.appendChecked)if(n[0]&&"number"==typeof(m=n.length))for(i=0;m>i;i++)_(n[i]);else _(n);n.nodeType?s.push(n):s=O.merge(s,n)}if(r)for(a=function(e){return!e.type||Se.test(e.type)},l=0;s[l];l++)if(!o||!O.nodeName(s[l],"script")||s[l].type&&"text/javascript"!==s[l].type.toLowerCase()){if(1===s[l].nodeType){var g=O.grep(s[l].getElementsByTagName("script"),a);s.splice.apply(s,[l+1,0].concat(g))}r.appendChild(s[l])}else o.push(s[l].parentNode?s[l].parentNode.removeChild(s[l]):s[l]);return s},cleanData:function(e){for(var t,r,o,a=O.cache,i=O.event.special,n=O.support.deleteExpando,s=0;null!=(o=e[s]);s++)if((!o.nodeName||!O.noData[o.nodeName.toLowerCase()])&&(r=o[O.expando])){if(t=a[r],t&&t.events){for(var l in t.events)i[l]?O.event.remove(o,l):O.removeEvent(o,l,t.handle);t.handle&&(t.handle.elem=null)}n?delete o[O.expando]:o.removeAttribute&&o.removeAttribute(O.expando),delete a[r]}}});var De,Fe,Le,Re=/alpha\([^)]*\)/i,Ie=/opacity=([^)]*)/,Be=/([A-Z]|^ms)/g,Oe=/^-?\d+(?:px)?$/i,Ne=/^-?\d/,ke=/^([\-+])=([\-+.\de]+)/,Ue={position:"absolute",visibility:"hidden",display:"block"},We=["Left","Right"],Ge=["Top","Bottom"];O.fn.css=function(e,r){return 2===arguments.length&&r===t?this:O.access(this,e,r,!0,function(e,r,o){return o!==t?O.style(e,r,o):O.css(e,r)})},O.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=De(e,"opacity","opacity");return""===r?"1":r}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":O.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,r,o,a){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,n,s=O.camelCase(r),l=e.style,u=O.cssHooks[s];if(r=O.cssProps[s]||s,o===t)return u&&"get"in u&&(i=u.get(e,!1,a))!==t?i:l[r];if(n=typeof o,"string"===n&&(i=ke.exec(o))&&(o=+(i[1]+1)*+i[2]+parseFloat(O.css(e,r)),n="number"),null==o||"number"===n&&isNaN(o))return;if("number"===n&&!O.cssNumber[s]&&(o+="px"),!(u&&"set"in u&&(o=u.set(e,o))===t))try{l[r]=o}catch(c){}}},css:function(e,r,o){var a,i;return r=O.camelCase(r),i=O.cssHooks[r],r=O.cssProps[r]||r,"cssFloat"===r&&(r="float"),i&&"get"in i&&(a=i.get(e,!0,o))!==t?a:De?De(e,r):void 0},swap:function(e,t,r){var o={};for(var a in t)o[a]=e.style[a],e.style[a]=t[a];r.call(e);for(a in t)e.style[a]=o[a]}}),O.curCSS=O.css,O.each(["height","width"],function(e,t){O.cssHooks[t]={get:function(e,r,o){var a;return r?0!==e.offsetWidth?m(e,t,o):(O.swap(e,Ue,function(){a=m(e,t,o)}),a):void 0},set:function(e,t){return Oe.test(t)?(t=parseFloat(t),t>=0?t+"px":void 0):t}}}),O.support.opacity||(O.cssHooks.opacity={get:function(e,t){return Ie.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var r=e.style,o=e.currentStyle,a=O.isNumeric(t)?"alpha(opacity="+100*t+")":"",i=o&&o.filter||r.filter||"";r.zoom=1,t>=1&&""===O.trim(i.replace(Re,""))&&(r.removeAttribute("filter"),o&&!o.filter)||(r.filter=Re.test(i)?i.replace(Re,a):i+" "+a)}}),O(function(){O.support.reliableMarginRight||(O.cssHooks.marginRight={get:function(e,t){var r;return O.swap(e,{display:"inline-block"},function(){r=t?De(e,"margin-right","marginRight"):e.style.marginRight}),r}})}),R.defaultView&&R.defaultView.getComputedStyle&&(Fe=function(e,t){var r,o,a;return t=t.replace(Be,"-$1").toLowerCase(),(o=e.ownerDocument.defaultView)&&(a=o.getComputedStyle(e,null))&&(r=a.getPropertyValue(t),""===r&&!O.contains(e.ownerDocument.documentElement,e)&&(r=O.style(e,t))),r}),R.documentElement.currentStyle&&(Le=function(e,t){var r,o,a,i=e.currentStyle&&e.currentStyle[t],n=e.style;return null===i&&n&&(a=n[t])&&(i=a),!Oe.test(i)&&Ne.test(i)&&(r=n.left,o=e.runtimeStyle&&e.runtimeStyle.left,o&&(e.runtimeStyle.left=e.currentStyle.left),n.left="fontSize"===t?"1em":i||0,i=n.pixelLeft+"px",n.left=r,o&&(e.runtimeStyle.left=o)),""===i?"auto":i}),De=Fe||Le,O.expr&&O.expr.filters&&(O.expr.filters.hidden=function(e){var t=e.offsetWidth,r=e.offsetHeight;return 0===t&&0===r||!O.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||O.css(e,"display"))},O.expr.filters.visible=function(e){return!O.expr.filters.hidden(e)});var je,Ve,ze=/%20/g,He=/\[\]$/,Xe=/\r?\n/g,$e=/#.*$/,Ye=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,qe=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Ze=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Ke=/^(?:GET|HEAD)$/,Qe=/^\/\//,Je=/\?/,et=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,tt=/^(?:select|textarea)/i,rt=/\s+/,ot=/([?&])_=[^&]*/,at=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,it=O.fn.load,nt={},st={},lt=["*/"]+["*"];try{je=B.href}catch(ut){je=R.createElement("a"),je.href="",je=je.href}Ve=at.exec(je.toLowerCase())||[],O.fn.extend({load:function(e,r,o){if("string"!=typeof e&&it)return it.apply(this,arguments);if(!this.length)return this;var a=e.indexOf(" ");if(a>=0){var i=e.slice(a,e.length);e=e.slice(0,a)}var n="GET";r&&(O.isFunction(r)?(o=r,r=t):"object"==typeof r&&(r=O.param(r,O.ajaxSettings.traditional),n="POST"));var s=this;return O.ajax({url:e,type:n,dataType:"html",data:r,complete:function(e,t,r){r=e.responseText,e.isResolved()&&(e.done(function(e){r=e}),s.html(i?O("<div>").append(r.replace(et,"")).find(i):r)),o&&s.each(o,[r,t,e])}}),this},serialize:function(){return O.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?O.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||tt.test(this.nodeName)||qe.test(this.type))}).map(function(e,t){var r=O(this).val();return null==r?null:O.isArray(r)?O.map(r,function(e,r){return{name:t.name,value:e.replace(Xe,"\r\n")}}):{name:t.name,value:r.replace(Xe,"\r\n")}}).get()}}),O.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){O.fn[t]=function(e){return this.on(t,e)}}),O.each(["get","post"],function(e,r){O[r]=function(e,o,a,i){return O.isFunction(o)&&(i=i||a,a=o,o=t),O.ajax({type:r,url:e,data:o,success:a,dataType:i})}}),O.extend({getScript:function(e,r){return O.get(e,t,r,"script")},getJSON:function(e,t,r){return O.get(e,t,r,"json")},ajaxSetup:function(e,t){return t?p(e,O.ajaxSettings):(t=e,e=O.ajaxSettings),p(e,t),e},ajaxSettings:{url:je,isLocal:Ze.test(Ve[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":lt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":O.parseJSON,"text xml":O.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:f(nt),ajaxTransport:f(st),ajax:function(e,r){function o(e,r,o,n){if(2!==M){M=2,l&&clearTimeout(l),s=t,i=n||"",C.readyState=e>0?4:0;var d,h,f,y,b,T=r,S=o?c(m,C,o):t;if(e>=200&&300>e||304===e)if(m.ifModified&&((y=C.getResponseHeader("Last-Modified"))&&(O.lastModified[a]=y),(b=C.getResponseHeader("Etag"))&&(O.etag[a]=b)),304===e)T="notmodified",d=!0;else try{h=u(m,S),T="success",d=!0}catch(A){T="parsererror",f=A}else f=T,(!T||e)&&(T="error",0>e&&(e=0));C.status=e,C.statusText=""+(r||T),d?_.resolveWith(g,[h,T,C]):_.rejectWith(g,[C,T,f]),C.statusCode(w),w=t,p&&v.trigger("ajax"+(d?"Success":"Error"),[C,m,d?h:f]),x.fireWith(g,[C,T]),p&&(v.trigger("ajaxComplete",[C,m]),--O.active||O.event.trigger("ajaxStop"))}}"object"==typeof e&&(r=e,e=t),r=r||{};var a,i,n,s,l,d,p,f,m=O.ajaxSetup({},r),g=m.context||m,v=g!==m&&(g.nodeType||g instanceof O)?O(g):O.event,_=O.Deferred(),x=O.Callbacks("once memory"),w=m.statusCode||{},y={},b={},M=0,C={readyState:0,setRequestHeader:function(e,t){if(!M){var r=e.toLowerCase();e=b[r]=b[r]||e,y[e]=t}return this},getAllResponseHeaders:function(){return 2===M?i:null},getResponseHeader:function(e){var r;if(2===M){if(!n)for(n={};r=Ye.exec(i);)n[r[1].toLowerCase()]=r[2];r=n[e.toLowerCase()]}return r===t?null:r},overrideMimeType:function(e){return M||(m.mimeType=e),this},abort:function(e){return e=e||"abort",s&&s.abort(e),o(0,e),this}};if(_.promise(C),C.success=C.done,C.error=C.fail,C.complete=x.add,C.statusCode=function(e){if(e){var t;if(2>M)for(t in e)w[t]=[w[t],e[t]];else t=e[C.status],C.then(t,t)}return this},m.url=((e||m.url)+"").replace($e,"").replace(Qe,Ve[1]+"//"),m.dataTypes=O.trim(m.dataType||"*").toLowerCase().split(rt),null==m.crossDomain&&(d=at.exec(m.url.toLowerCase()),m.crossDomain=!(!d||d[1]==Ve[1]&&d[2]==Ve[2]&&(d[3]||("http:"===d[1]?80:443))==(Ve[3]||("http:"===Ve[1]?80:443)))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=O.param(m.data,m.traditional)),h(nt,m,r,C),2===M)return!1;if(p=m.global,m.type=m.type.toUpperCase(),m.hasContent=!Ke.test(m.type),p&&0===O.active++&&O.event.trigger("ajaxStart"),!m.hasContent&&(m.data&&(m.url+=(Je.test(m.url)?"&":"?")+m.data,delete m.data),a=m.url,m.cache===!1)){var T=O.now(),S=m.url.replace(ot,"$1_="+T);m.url=S+(S===m.url?(Je.test(m.url)?"&":"?")+"_="+T:"")}(m.data&&m.hasContent&&m.contentType!==!1||r.contentType)&&C.setRequestHeader("Content-Type",m.contentType),m.ifModified&&(a=a||m.url,O.lastModified[a]&&C.setRequestHeader("If-Modified-Since",O.lastModified[a]),O.etag[a]&&C.setRequestHeader("If-None-Match",O.etag[a])),C.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+lt+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)C.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(g,C,m)===!1||2===M))return C.abort(),!1;for(f in{success:1,error:1,complete:1})C[f](m[f]);if(s=h(st,m,r,C)){C.readyState=1,p&&v.trigger("ajaxSend",[C,m]),m.async&&m.timeout>0&&(l=setTimeout(function(){C.abort("timeout")},m.timeout));try{M=1,s.send(y,o)}catch(A){if(!(2>M))throw A;o(-1,A)}}else o(-1,"No Transport");return C},param:function(e,r){var o=[],a=function(e,t){t=O.isFunction(t)?t():t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(r===t&&(r=O.ajaxSettings.traditional),O.isArray(e)||e.jquery&&!O.isPlainObject(e))O.each(e,function(){a(this.name,this.value)});else for(var i in e)d(i,e[i],r,a);return o.join("&").replace(ze,"+")}}),O.extend({active:0,lastModified:{},etag:{}});var ct=O.now(),dt=/(\=)\?(&|$)|\?\?/i;O.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return O.expando+"_"+ct++}}),O.ajaxPrefilter("json jsonp",function(t,r,o){var a="application/x-www-form-urlencoded"===t.contentType&&"string"==typeof t.data;if("jsonp"===t.dataTypes[0]||t.jsonp!==!1&&(dt.test(t.url)||a&&dt.test(t.data))){var i,n=t.jsonpCallback=O.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s=e[n],l=t.url,u=t.data,c="$1"+n+"$2";return t.jsonp!==!1&&(l=l.replace(dt,c),t.url===l&&(a&&(u=u.replace(dt,c)),t.data===u&&(l+=(/\?/.test(l)?"&":"?")+t.jsonp+"="+n))),t.url=l,t.data=u,e[n]=function(e){i=[e]},o.always(function(){e[n]=s,i&&O.isFunction(s)&&e[n](i[0])}),t.converters["script json"]=function(){return i||O.error(n+" was not called"),i[0]},t.dataTypes[0]="json","script"}}),O.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return O.globalEval(e),e}}}),O.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),O.ajaxTransport("script",function(e){if(e.crossDomain){var r,o=R.head||R.getElementsByTagName("head")[0]||R.documentElement;return{send:function(a,i){r=R.createElement("script"),r.async="async",e.scriptCharset&&(r.charset=e.scriptCharset),r.src=e.url,r.onload=r.onreadystatechange=function(e,a){(a||!r.readyState||/loaded|complete/.test(r.readyState))&&(r.onload=r.onreadystatechange=null,o&&r.parentNode&&o.removeChild(r),r=t,a||i(200,"success"))},o.insertBefore(r,o.firstChild)},abort:function(){r&&r.onload(0,1)}}}});var pt,ht=e.ActiveXObject?function(){for(var e in pt)pt[e](0,1)}:!1,ft=0;O.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&l()||s()}:l,function(e){O.extend(O.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(O.ajaxSettings.xhr()),O.support.ajax&&O.ajaxTransport(function(r){if(!r.crossDomain||O.support.cors){var o;return{send:function(a,i){var n,s,l=r.xhr();if(r.username?l.open(r.type,r.url,r.async,r.username,r.password):l.open(r.type,r.url,r.async),r.xhrFields)for(s in r.xhrFields)l[s]=r.xhrFields[s];r.mimeType&&l.overrideMimeType&&l.overrideMimeType(r.mimeType),!r.crossDomain&&!a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest");try{for(s in a)l.setRequestHeader(s,a[s])}catch(u){}l.send(r.hasContent&&r.data||null),o=function(e,a){var s,u,c,d,p;try{if(o&&(a||4===l.readyState))if(o=t,n&&(l.onreadystatechange=O.noop,ht&&delete pt[n]),a)4!==l.readyState&&l.abort();else{s=l.status,c=l.getAllResponseHeaders(),d={},p=l.responseXML,p&&p.documentElement&&(d.xml=p),d.text=l.responseText;try{u=l.statusText}catch(h){u=""}s||!r.isLocal||r.crossDomain?1223===s&&(s=204):s=d.text?200:404}}catch(f){a||i(-1,f)}d&&i(s,u,d,c)},r.async&&4!==l.readyState?(n=++ft,ht&&(pt||(pt={},O(e).unload(ht)),pt[n]=o),l.onreadystatechange=o):o()},abort:function(){o&&o(0,1)}}}});var mt,gt,vt,_t,xt={},wt=/^(?:toggle|show|hide)$/,yt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,bt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];O.fn.extend({show:function(e,t,r){var i,n;if(e||0===e)return this.animate(a("show",3),e,t,r);for(var s=0,l=this.length;l>s;s++)i=this[s],i.style&&(n=i.style.display,!O._data(i,"olddisplay")&&"none"===n&&(n=i.style.display=""),""===n&&"none"===O.css(i,"display")&&O._data(i,"olddisplay",o(i.nodeName)));for(s=0;l>s;s++)i=this[s],i.style&&(n=i.style.display,(""===n||"none"===n)&&(i.style.display=O._data(i,"olddisplay")||""));return this},hide:function(e,t,r){if(e||0===e)return this.animate(a("hide",3),e,t,r);for(var o,i,n=0,s=this.length;s>n;n++)o=this[n],o.style&&(i=O.css(o,"display"),"none"!==i&&!O._data(o,"olddisplay")&&O._data(o,"olddisplay",i));for(n=0;s>n;n++)this[n].style&&(this[n].style.display="none");return this},_toggle:O.fn.toggle,toggle:function(e,t,r){var o="boolean"==typeof e;return O.isFunction(e)&&O.isFunction(t)?this._toggle.apply(this,arguments):null==e||o?this.each(function(){var t=o?e:O(this).is(":hidden");O(this)[t?"show":"hide"]()}):this.animate(a("toggle",3),e,t,r),this},fadeTo:function(e,t,r,o){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,r,o)},animate:function(e,t,r,a){function i(){n.queue===!1&&O._mark(this);var t,r,a,i,s,l,u,c,d,p=O.extend({},n),h=1===this.nodeType,f=h&&O(this).is(":hidden");p.animatedProperties={};for(a in e){if(t=O.camelCase(a),a!==t&&(e[t]=e[a],delete e[a]),r=e[t],O.isArray(r)?(p.animatedProperties[t]=r[1],r=e[t]=r[0]):p.animatedProperties[t]=p.specialEasing&&p.specialEasing[t]||p.easing||"swing","hide"===r&&f||"show"===r&&!f)return p.complete.call(this);h&&("height"===t||"width"===t)&&(p.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===O.css(this,"display")&&"none"===O.css(this,"float")&&(O.support.inlineBlockNeedsLayout&&"inline"!==o(this.nodeName)?this.style.zoom=1:this.style.display="inline-block"))}null!=p.overflow&&(this.style.overflow="hidden");for(a in e)i=new O.fx(this,p,a),r=e[a],wt.test(r)?(d=O._data(this,"toggle"+a)||("toggle"===r?f?"show":"hide":0),d?(O._data(this,"toggle"+a,"show"===d?"hide":"show"),i[d]()):i[r]()):(s=yt.exec(r),l=i.cur(),s?(u=parseFloat(s[2]),c=s[3]||(O.cssNumber[a]?"":"px"),"px"!==c&&(O.style(this,a,(u||1)+c),l=(u||1)/i.cur()*l,O.style(this,a,l+c)),s[1]&&(u=("-="===s[1]?-1:1)*u+l),i.custom(l,u,c)):i.custom(l,r,""));return!0}var n=O.speed(t,r,a);return O.isEmptyObject(e)?this.each(n.complete,[!1]):(e=O.extend({},e),n.queue===!1?this.each(i):this.queue(n.queue,i))},stop:function(e,r,o){return"string"!=typeof e&&(o=r,r=e,e=t),r&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function t(e,t,r){var a=t[r];O.removeData(e,r,!0),a.stop(o)}var r,a=!1,i=O.timers,n=O._data(this);if(o||O._unmark(!0,this),null==e)for(r in n)n[r]&&n[r].stop&&r.indexOf(".run")===r.length-4&&t(this,n,r);else n[r=e+".run"]&&n[r].stop&&t(this,n,r);for(r=i.length;r--;)i[r].elem===this&&(null==e||i[r].queue===e)&&(o?i[r](!0):i[r].saveState(),a=!0,i.splice(r,1));(!o||!a)&&O.dequeue(this,e)})}}),O.each({slideDown:a("show",1),slideUp:a("hide",1),slideToggle:a("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){O.fn[e]=function(e,r,o){return this.animate(t,e,r,o)}}),O.extend({speed:function(e,t,r){var o=e&&"object"==typeof e?O.extend({},e):{complete:r||!r&&t||O.isFunction(e)&&e,duration:e,easing:r&&t||t&&!O.isFunction(t)&&t};return o.duration=O.fx.off?0:"number"==typeof o.duration?o.duration:o.duration in O.fx.speeds?O.fx.speeds[o.duration]:O.fx.speeds._default,(null==o.queue||o.queue===!0)&&(o.queue="fx"),o.old=o.complete,o.complete=function(e){O.isFunction(o.old)&&o.old.call(this),o.queue?O.dequeue(this,o.queue):e!==!1&&O._unmark(this)},o},easing:{linear:function(e,t,r,o){return r+o*e},swing:function(e,t,r,o){return(-Math.cos(e*Math.PI)/2+.5)*o+r}},timers:[],fx:function(e,t,r){this.options=t,this.elem=e,this.prop=r,t.orig=t.orig||{}}}),O.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(O.fx.step[this.prop]||O.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var e,t=O.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?t&&"auto"!==t?t:0:e},custom:function(e,r,o){function a(e){return i.step(e)}var i=this,s=O.fx;this.startTime=_t||n(),this.end=r,this.now=this.start=e,this.pos=this.state=0,this.unit=o||this.unit||(O.cssNumber[this.prop]?"":"px"),a.queue=this.options.queue,a.elem=this.elem,a.saveState=function(){i.options.hide&&O._data(i.elem,"fxshow"+i.prop)===t&&O._data(i.elem,"fxshow"+i.prop,i.start)},a()&&O.timers.push(a)&&!vt&&(vt=setInterval(s.tick,s.interval))},show:function(){var e=O._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||O.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),O(this.elem).show()},hide:function(){this.options.orig[this.prop]=O._data(this.elem,"fxshow"+this.prop)||O.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,r,o,a=_t||n(),i=!0,s=this.elem,l=this.options;if(e||a>=l.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),l.animatedProperties[this.prop]=!0;for(t in l.animatedProperties)l.animatedProperties[t]!==!0&&(i=!1);if(i){if(null!=l.overflow&&!O.support.shrinkWrapBlocks&&O.each(["","X","Y"],function(e,t){s.style["overflow"+t]=l.overflow[e]}),l.hide&&O(s).hide(),l.hide||l.show)for(t in l.animatedProperties)O.style(s,t,l.orig[t]),O.removeData(s,"fxshow"+t,!0),O.removeData(s,"toggle"+t,!0);o=l.complete,o&&(l.complete=!1,o.call(s))}return!1}return l.duration==1/0?this.now=a:(r=a-this.startTime,this.state=r/l.duration,this.pos=O.easing[l.animatedProperties[this.prop]](this.state,r,0,1,l.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},O.extend(O.fx,{tick:function(){for(var e,t=O.timers,r=0;r<t.length;r++)e=t[r],!e()&&t[r]===e&&t.splice(r--,1);t.length||O.fx.stop()},interval:13,stop:function(){clearInterval(vt),vt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){O.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&null!=e.elem.style[e.prop]?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),O.each(["width","height"],function(e,t){O.fx.step[t]=function(e){O.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),O.expr&&O.expr.filters&&(O.expr.filters.animated=function(e){return O.grep(O.timers,function(t){return e===t.elem}).length});var Mt=/^t(?:able|d|h)$/i,Ct=/^(?:body|html)$/i;"getBoundingClientRect"in R.documentElement?O.fn.offset=function(e){var t,o=this[0];if(e)return this.each(function(t){O.offset.setOffset(this,e,t)});if(!o||!o.ownerDocument)return null;if(o===o.ownerDocument.body)return O.offset.bodyOffset(o);try{t=o.getBoundingClientRect()}catch(a){}var i=o.ownerDocument,n=i.documentElement;if(!t||!O.contains(n,o))return t?{top:t.top,left:t.left}:{top:0,left:0};var s=i.body,l=r(i),u=n.clientTop||s.clientTop||0,c=n.clientLeft||s.clientLeft||0,d=l.pageYOffset||O.support.boxModel&&n.scrollTop||s.scrollTop,p=l.pageXOffset||O.support.boxModel&&n.scrollLeft||s.scrollLeft,h=t.top+d-u,f=t.left+p-c;return{top:h,left:f}}:O.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){O.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return O.offset.bodyOffset(t);for(var r,o=t.offsetParent,a=t,i=t.ownerDocument,n=i.documentElement,s=i.body,l=i.defaultView,u=l?l.getComputedStyle(t,null):t.currentStyle,c=t.offsetTop,d=t.offsetLeft;(t=t.parentNode)&&t!==s&&t!==n&&(!O.support.fixedPosition||"fixed"!==u.position);)r=l?l.getComputedStyle(t,null):t.currentStyle,c-=t.scrollTop,d-=t.scrollLeft,t===o&&(c+=t.offsetTop,d+=t.offsetLeft,O.support.doesNotAddBorder&&(!O.support.doesAddBorderForTableAndCells||!Mt.test(t.nodeName))&&(c+=parseFloat(r.borderTopWidth)||0,d+=parseFloat(r.borderLeftWidth)||0),a=o,o=t.offsetParent),O.support.subtractsBorderForOverflowNotVisible&&"visible"!==r.overflow&&(c+=parseFloat(r.borderTopWidth)||0,d+=parseFloat(r.borderLeftWidth)||0),u=r;return("relative"===u.position||"static"===u.position)&&(c+=s.offsetTop,d+=s.offsetLeft),O.support.fixedPosition&&"fixed"===u.position&&(c+=Math.max(n.scrollTop,s.scrollTop),d+=Math.max(n.scrollLeft,s.scrollLeft)),{top:c,left:d}},O.offset={bodyOffset:function(e){var t=e.offsetTop,r=e.offsetLeft;return O.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(O.css(e,"marginTop"))||0,r+=parseFloat(O.css(e,"marginLeft"))||0),{top:t,left:r}},setOffset:function(e,t,r){var o=O.css(e,"position");"static"===o&&(e.style.position="relative");var a,i,n=O(e),s=n.offset(),l=O.css(e,"top"),u=O.css(e,"left"),c=("absolute"===o||"fixed"===o)&&O.inArray("auto",[l,u])>-1,d={},p={};c?(p=n.position(),a=p.top,i=p.left):(a=parseFloat(l)||0,i=parseFloat(u)||0),O.isFunction(t)&&(t=t.call(e,r,s)),null!=t.top&&(d.top=t.top-s.top+a),null!=t.left&&(d.left=t.left-s.left+i),"using"in t?t.using.call(e,d):n.css(d)}},O.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),r=this.offset(),o=Ct.test(t[0].nodeName)?{top:0,left:0}:t.offset();return r.top-=parseFloat(O.css(e,"marginTop"))||0,r.left-=parseFloat(O.css(e,"marginLeft"))||0,o.top+=parseFloat(O.css(t[0],"borderTopWidth"))||0,o.left+=parseFloat(O.css(t[0],"borderLeftWidth"))||0,{top:r.top-o.top,left:r.left-o.left}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||R.body;e&&!Ct.test(e.nodeName)&&"static"===O.css(e,"position");)e=e.offsetParent;return e})}}),O.each(["Left","Top"],function(e,o){var a="scroll"+o;O.fn[a]=function(o){var i,n;return o===t?(i=this[0])?(n=r(i),n?"pageXOffset"in n?n[e?"pageYOffset":"pageXOffset"]:O.support.boxModel&&n.document.documentElement[a]||n.document.body[a]:i[a]):null:this.each(function(){n=r(this),n?n.scrollTo(e?O(n).scrollLeft():o,e?o:O(n).scrollTop()):this[a]=o})}}),O.each(["Height","Width"],function(e,r){var o=r.toLowerCase();O.fn["inner"+r]=function(){var e=this[0];return e?e.style?parseFloat(O.css(e,o,"padding")):this[o]():null},O.fn["outer"+r]=function(e){var t=this[0];return t?t.style?parseFloat(O.css(t,o,e?"margin":"border")):this[o]():null},O.fn[o]=function(e){var a=this[0];if(!a)return null==e?null:this;if(O.isFunction(e))return this.each(function(t){var r=O(this);r[o](e.call(this,t,r[o]()))});if(O.isWindow(a)){var i=a.document.documentElement["client"+r],n=a.document.body;return"CSS1Compat"===a.document.compatMode&&i||n&&n["client"+r]||i}if(9===a.nodeType)return Math.max(a.documentElement["client"+r],a.body["scroll"+r],a.documentElement["scroll"+r],a.body["offset"+r],a.documentElement["offset"+r]);if(e===t){var s=O.css(a,o),l=parseFloat(s);return O.isNumeric(l)?l:s}return this.css(o,"string"==typeof e?e:e+"px")}}),e.avpw_jQuery=e.avpw$=O,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return O})}(t),function(e){e.miniColors=function(t){var o=this,a=function(t){var r=e('<div style="display: none;" class="miniColors-selector"></div>');return r.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>'),r.find(".miniColors-colors").css("backgroundColor","#"+g({h:t.h,s:100,b:100})),u(r,t),r.bind("selectstart",function(){return!1}),r.data("hsb",t),r},i=function(t){var o,a=!1;e(r).bind("mousedown.miniColors touchstart.miniColors",function(r){a=!0;var i=e(r.target).parents().andSelf();return i.hasClass("miniColors-colors")&&(r.preventDefault(),o="colors",s(t,r)),i.hasClass("miniColors-hues")&&(r.preventDefault(),o="hues",l(t,r)),i.hasClass("miniColors-selector")?void r.preventDefault():void(i.hasClass("miniColors")||t.trigger("clickOutsideBounds"))}),e(r).bind("mouseup.miniColors touchend.miniColors",function(e){e.preventDefault(),a=!1,o=void 0}).bind("mousemove.miniColors touchmove.miniColors",function(e){e.preventDefault(),a&&("colors"===o&&s(t,e),"hues"===o&&l(t,e))})},n=function(){e(r).unbind(".miniColors")},s=function(e,t){var r={x:t.pageX,y:t.pageY},o=e.find(".miniColors-colors").offset();t.originalEvent.changedTouches&&(r.x=t.originalEvent.changedTouches[0].pageX,r.y=t.originalEvent.changedTouches[0].pageY),r.x=r.x-o.left-5,r.y=r.y-o.top-5,r.x<=-5&&(r.x=-5),r.x>=144&&(r.x=144),r.y<=-5&&(r.y=-5),r.y>=144&&(r.y=144);var a=Math.round(.67*(r.x+5));0>a&&(a=0),a>100&&(a=100);var i=100-Math.round(.67*(r.y+5));0>i&&(i=0),i>100&&(i=100);var n=e.data("hsb");n.s=a,n.b=i,c(e,n,!0)},l=function(e,t){var r={y:t.pageY},o=e.find(".miniColors-colors").offset();t.originalEvent.changedTouches&&(r.y=t.originalEvent.changedTouches[0].pageY),r.y=r.y-o.top-1,r.y<=-1&&(r.y=-1),r.y>=149&&(r.y=149);var a=Math.round(2.4*(150-r.y-1));0>a&&(a=0),a>360&&(a=360);var i=e.data("hsb");i.h=a,c(e,i,!0)},u=function(e,t){var r=d(t),o=e.find(".miniColors-colorPicker");o.css("top",r.y+"px").css("left",r.x+"px").show();var a=p(t),i=e.find(".miniColors-huePicker");i.css("top",a.y+"px").show()},c=function(e,t,r){u(e,t),e.data("hsb",t);var o=g(t);r&&e.trigger("updateInput",{
hex:o}),e.find(".miniColors-colors").css("backgroundColor","#"+g({h:t.h,s:100,b:100})),e.trigger("setColor",{hex:o})},d=function(e){var t=Math.ceil(e.s/.67);0>t&&(t=0),t>150&&(t=150);var r=150-Math.ceil(e.b/.67);return 0>r&&(r=0),r>150&&(r=150),{x:t-5,y:r-5}},p=function(e){var t=150-e.h/2.4;return 0>t&&(h=0),t>150&&(h=150),{y:t-1}},f=function(e){var t={},r=Math.round(e.h),o=Math.round(255*e.s/100),a=Math.round(255*e.b/100);if(0===o)t.r=t.g=t.b=a;else{var i=a,n=(255-o)*a/255,s=(i-n)*(r%60)/60;360===r&&(r=0),60>r?(t.r=i,t.b=n,t.g=n+s):120>r?(t.g=i,t.b=n,t.r=i-s):180>r?(t.g=i,t.r=n,t.b=n+s):240>r?(t.b=i,t.r=n,t.g=i-s):300>r?(t.b=i,t.g=n,t.r=n+s):360>r?(t.r=i,t.g=n,t.b=i-s):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},m=function(e){var t,r,o=[e.r.toString(16),e.g.toString(16),e.b.toString(16)],a=o.length;for(t=0;a>t;t++)r=o[t],1===r.length&&(o[t]="0"+r);return o.join("")},g=function(e){return m(f(e))};return o.setSelectorColor=c,o.buildSelector=a,o.bindSelectorEvents=i,o.unBindSelectorEvents=n,o.forceClose=function(){selector&&selector.trigger("clickOutsideBounds")},o}}(avpw_jQuery),!function(t,r,o){function a(e,t){var o,a=r.createElement(e||"div");for(o in t)a[o]=t[o];return a}function i(e){for(var t=1,r=arguments.length;r>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,r,o){var a=["opacity",t,~~(100*e),r,o].join("-"),i=.01+r/o*100,n=Math.max(1-(1-e)/t*(100-i),e),s=p.substring(0,p.indexOf("Animation")).toLowerCase(),l=s&&"-"+s+"-"||"";return f[a]||(m.insertRule("@"+l+"keyframes "+a+"{0%{opacity:"+n+"}"+i+"%{opacity:"+e+"}"+(i+.01)+"%{opacity:1}"+(i+t)%100+"%{opacity:"+e+"}100%{opacity:"+n+"}}",m.cssRules.length),f[a]=1),a}function s(e,t){var r,a,i=e.style;if(i[t]!==o)return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),a=0;a<h.length;a++)if(r=h[a]+t,i[r]!==o)return r}function l(e,t){for(var r in t)e.style[s(e,r)||r]=t[r];return e}function u(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)e[a]===o&&(e[a]=r[a])}return e}function c(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function d(e){return this.spin?void(this.opts=u(e||{},d.defaults,g)):new d(e)}var p,h=["webkit","Moz","ms","O"],f={},m=function(){var e=a("style",{type:"text/css"});return i(r.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),g={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};d.defaults={},u(d.prototype,{spin:function(e){this.stop();var t,r,o=this,i=o.opts,n=o.el=l(a(0,{className:i.className}),{width:0,zIndex:i.zIndex});if(i.radius+i.length+i.width,e&&(e.insertBefore(n,e.firstChild||null),r=c(e),t=c(n)),n.setAttribute("aria-role","progressbar"),o.lines(n,o.opts),!p){var s=0,u=i.fps,d=u/i.speed,h=(1-i.opacity)/(d*i.trail/100),f=d/i.lines;!function m(){s++;for(var e=i.lines;e;e--){var t=Math.max(1-(s+e*f)%d*h,i.opacity);o.opacity(n,i.lines-e,t,i)}o.timeout=o.el&&setTimeout(m,~~(1e3/u))}()}return o},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=o),this},lines:function(e,t){function r(e,r){return l(a(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*s+t.rotate)+"deg) translate("+t.radius+"px,0)",borderRadius:(t.corners*t.width>>1)+"px"})}for(var o,s=0;s<t.lines;s++)o=l(a(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:p&&n(t.opacity,t.trail,s,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&i(o,l(r("#000","0 0 4px #000"),{top:"2px"})),i(e,i(o,r(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,r){t<e.childNodes.length&&(e.childNodes[t].style.opacity=r)}}),function(){function e(e,t){return a("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=l(a("group"),{behavior:"url(#default#VML)"});!s(t,"transform")&&t.adj?(m.addRule(".spin-vml","behavior:url(#default#VML)"),d.prototype.lines=function(t,r){function o(){return l(e("group",{coordsize:u+" "+u,coordorigin:-s+" "+-s}),{width:u,height:u})}function a(t,a,n){i(d,i(l(o(),{rotation:360/r.lines*t+"deg",left:~~a}),i(l(e("roundrect",{arcsize:r.corners}),{width:s,height:r.width,left:r.radius,top:-r.width>>1,filter:n}),e("fill",{color:r.color,opacity:r.opacity}),e("stroke",{opacity:0}))))}var n,s=r.length+r.width,u=2*s,c=2*-(r.width+r.length)+"px",d=l(o(),{position:"absolute",top:c,left:c});if(r.shadow)for(n=1;n<=r.lines;n++)a(n,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(n=1;n<=r.lines;n++)a(n);return i(t,d)},d.prototype.opacity=function(e,t,r,o){var a=e.firstChild;o=o.shadow&&o.lines||0,a&&t+o<a.childNodes.length&&(a=a.childNodes[t+o],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=r))}):p=s(t,"animation")}(),e.Spinner=d}(t,r),"undefined"==typeof e&&(e={}),function(t){var r=t.desktop={};r.saveBlock=function(){return['<div class="avpw_mode_action avpw_mode_action_right">','<a id="avpw_save_button" href="javascript:void(0)" class="avpw_button avpw_primary_button">'+e.getLocalizedString("Save")+"</a>","</div>"].join("")},r.closeButton=function(e){return["<div "+(e.id?'id="'+e.id+'" ':"")+'title="'+e.text+'">',"<div "+(e.id?'id="'+e.id+'_inner" ':"")+'class="avpw_close_button '+(e.className||"")+'">','<div class="avpw_close_inner">',"&times;","</div>","</div>","</div>"].join("")},r.cancelButton=function(t){return['<a href="javascript:void(0)" id="'+t.id+'" class="avpw_button avpw_back_button">',e.getLocalizedString(t.label),"</a>"].join("")},r.contentPagerInner=function(e){return['<div class="avpw_content_packs avpw_tool_scroll">','<a class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div class="avpw_clip">','<div class="avpw_scroll_strip">',"</div>","</div>",'<a class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>",'<div class="avpw_content_items avpw_tool_scroll">','<div class="avpw_back_to_packs"></div>','<a class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div class="avpw_clip">','<div class="avpw_scroll_strip">',"</div>","</div>",'<a class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>"].join("")},r.controls=function(t){return['<div style="display:none;" id="avpw_controls" class="avpw avpw_main_mode">','<div id="avpw_tool_content_header">','<div class="avpw_app_bar">','<div class="avpw_cc_logo"></div>','<div class="avpw_app_title">',e.getLocalizedString("Photo Editor"),"</div>","</div>",'<div class="avpw_breadcrumb_wrap">','<span class="avpw_label" id="avpw_breadcrumb_sep" style="display: none;"> : </span>','<span class="avpw_label" id="avpw_breadcrumb_toolname"></span>',"</div>",'<div id="avpw_history">','<div id="avpw_history_undo" class="avpw_button avpw_history_button avpw_history_button_first avpw_history_disabled">','<span class="avpw_history_icon">',"Undo","</span>","</div>",'<div id="avpw_history_redo" class="avpw_button avpw_history_button avpw_history_button_last avpw_history_disabled">','<span class="avpw_history_icon">',"Redo","</span>","</div>",'<div id="avpw_history_undo_blocker" class="avpw_history_blocker avpw_history_blocker_first"></div>','<div id="avpw_history_redo_blocker" class="avpw_history_blocker avpw_history_blocker_last"></div>',"</div>",r.closeButton({id:"avpw_control_cancel_pane",text:e.getLocalizedString("Cancel"),className:"avpw_main_close"}),"</div>",'<div id="avpw_tool_content_wrapper">','<div id="avpw_tool_main_container" class="avpw_tool_pager">','<a id="avpw_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_control_main_scroll_panel" class="avpw_clip">','<div id="avpw_control_main_scrolling_region" class="avpw_scroll_strip">',"</div>",'<div id="avpw_tools_pager">',"<ul>","</ul>","</div>","</div>",'<a id="avpw_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",t.internalSaveBlock,"</div>",'<div id="avpw_tool_options_container" style="display:none;">','<div id="avpw_tool_container">','<div id="avpw_controlpanel_vignette" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',r.slider({id:"avpw_vignette_slider",divider:!0}),"</div>",'<div id="avpw_controlpanel_adjust" class="avpw_controlpanel_adjustments avpw_controlpanel avpw_tool_fixed avpw_tool_slider">','<div class="avpw_inset_button_group avpw_inset_group">','<div data-mode="brightness" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_brightness"></div>',"</div>",'<div data-mode="contrast" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_contrast"></div>',"</div>",'<div data-mode="shadows" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_shadows"></div>',"</div>",'<div data-mode="highlights" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_highlights"></div>',"</div>",'<div data-mode="saturation" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_saturation"></div>',"</div>",'<div data-mode="warmth" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_warmth"></div>',"</div>",'<div data-mode="tint" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_tint"></div>',"</div>",'<div data-mode="fade" class="avpw_inset_button">','<div class="avpw_adjust_icon_inner avpw_adjust_fade"></div>',"</div>","</div>",r.slider({id:"avpw_adjust_slider",divider:!0}),"</div>",'<div id="avpw_controlpanel_sharpness" class="avpw_controlpanel avpw_tool_fixed avpw_tool_slider">',r.slider({id:"avpw_sharpness_slider",divider:!0}),"</div>",'<div id="avpw_controlpanel_forcecrop" class="avpw_controlpanel avpw_tool_fixed">','<div id="avpw_force_crop_sub_text">Crop your photo to:</div>','<div id="avpw_force_crop_label"></div>',"</div>",'<div id="avpw_controlpanel_orientation" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_orientation">','<div class="avpw_inset_button_group avpw_inset_group">','<div id="avpw_rotate_left" class="avpw_inset_button avpw_inset_button_first">','<div class="avpw_orientation_button_inner"></div>',"</div>",'<div id="avpw_rotate_right" class="avpw_inset_button avpw_inset_button_last">','<div class="avpw_orientation_button_inner"></div>',"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_spacer"></div>','<div class="avpw_inset_button_group avpw_inset_group">','<div id="avpw_flip_h" class="avpw_inset_button avpw_inset_button_first">','<div class="avpw_orientation_button_inner"></div>',"</div>",'<div id="avpw_flip_v" class="avpw_inset_button avpw_inset_button_last">','<div class="avpw_orientation_button_inner"></div>',"</div>","</div>",'<div class="avpw_inset_button_label avpw_inset_button_label_2 avpw_label avpw_inset_group">',e.getLocalizedString("Rotate"),"</div>",'<div class="avpw_inset_group avpw_inset_group_spacer"></div>','<div class="avpw_inset_button_label avpw_inset_button_label_2 avpw_label avpw_inset_group">',e.getLocalizedString("Mirror"),"</div>","</div>","</div>",'<div id="avpw_controlpanel_crop" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_scroll">','<a id="avpw_crop_presets_lftArrow" class="avpw_prev avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>",'<div id="avpw_crop_presets_scroll_window" class="avpw_clip">','<div id="avpw_crop_presets_scroll_region" class="avpw_scroll_strip">',"</div>","</div>",'<a id="avpw_crop_presets_rghtArrow" class="avpw_next avpw_bookend">','<span class="avpw_arrow_icon"></span>',"</a>","</div>","</div>",'<div id="avpw_controlpanel_resize" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_resize">','<div class="avpw_resize_form_block avpw_resize_width">','<input class="avpw_text_input avpw_number_input" id="avpw_resize_width" type="text" value="640" maxlength="5"/>','<div class="avpw_label">',e.getLocalizedString("Width"),"</div>","</div>",'<div class="avpw_resize_form_block avpw_resize_constrain">','<div  class="avpw_inset_group avpw_inset_button_group avpw_checkmark_button">','<div id="avpw_constrain_prop" class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last" title="'+e.getLocalizedString("Maintain proportions")+'">','<div class="avpw_lock_icon">','<div class="avpw_lock_icon_top">','<div class="avpw_lock_icon_top_inner"></div>',"</div>",'<div class="avpw_lock_icon_sep"></div>','<div class="avpw_lock_icon_bottom"></div>',"</div>","</div>","</div>","</div>",'<div class="avpw_resize_form_block avpw_resize_height">','<input class="avpw_text_input avpw_number_input" id="avpw_resize_height" type="text" value="480" maxlength="5"/>','<div class="avpw_label">',e.getLocalizedString("Height"),"</div>","</div>","</div>","</div>",'<div id="avpw_controlpanel_redeye" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>",'<div id="avpw_controlpanel_whiten" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>",'<div id="avpw_controlpanel_blemish" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_spot_tool">',"</div>","</div>",'<div id="avpw_controlpanel_effects" class="avpw_controlpanel avpw_tool_stretch">','<div id="avpw_effects_effects">','<div id="avpw_effects_scroller" class="avpw_content_wrapper">',r.contentPagerInner(),"</div>","</div>",r.intensitySlider(),"</div>",'<div id="avpw_controlpanel_enhance" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_enhance">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first">','<div id="avpw_enhance_icon_hd" class="avpw_enhance_button_inner"></div>',"</div>",'<div class="avpw_inset_button">','<div id="avpw_enhance_icon_scenery" class="avpw_enhance_button_inner"></div>',"</div>",'<div class="avpw_inset_button">','<div id="avpw_enhance_icon_food" class="avpw_enhance_button_inner"></div>',"</div>",'<div class="avpw_inset_button">','<div id="avpw_enhance_icon_portrait" class="avpw_enhance_button_inner"></div>',"</div>",'<div class="avpw_inset_button avpw_inset_button_last">','<div id="avpw_enhance_icon_night" class="avpw_enhance_button_inner"></div>',"</div>","</div>",'<div class="avpw_inset_group">','<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Hi-Def"),"</div>",'<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Scenery"),"</div>",'<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Food"),"</div>",'<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Portrait"),"</div>",'<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Night"),"</div>","</div>","</div>","</div>",'<div id="avpw_controlpanel_drawing" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_centered_drawing">','<div class="avpw_outer-center">','<div class="avpw_inner-center">','<div class="avpw_inset_color_widget avpw_inset_group avpw_inset_button_group">',r.colorPickerIcon(),'<div id="avpw_drawing_colors" class="avpw_inset_color_choices">',"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last avpw_colorsplash_eraser">','<div class="avpw_colorsplash_eraser_icon avpw_colorsplash_inner_icon">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>',r.brushSizesSet({id:"avpw_drawing_brushes",sizes:[2,4,8],hideLabel:!0}),'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_inset_color_widget_label avpw_label">',e.getLocalizedString("Color Picker"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_label avpw_inset_button_last">',e.getLocalizedString("Eraser"),"</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">',e.getLocalizedString("Brush Size"),"</div>","</div>","</div>","</div>","</div>",'<div id="avpw_controlpanel_overlay" class="avpw_controlpanel avpw_tool_stretch">','<div id="avpw_overlay_scroller" class="avpw_content_wrapper">',r.contentPagerInner(),"</div>","</div>",'<div id="avpw_controlpanel_overlays" class="avpw_controlpanel avpw_tool_stretch">','<div id="avpw_overlays_scroller" class="avpw_content_wrapper">',r.contentPagerInner(),"</div>","</div>",'<div id="avpw_controlpanel_frames" class="avpw_controlpanel avpw_tool_stretch">','<div id="avpw_frames_scroller" class="avpw_content_wrapper">',r.contentPagerInner(),"</div>","</div>",'<div id="avpw_controlpanel_meme" class="avpw_controlpanel avpw_tool_stretch avpw_tool_cutout">','<div class="avpw_tool_cutout_inner avpw_inset_background">','<div class="avpw_tool_cutout_centered_meme">','<input id="avpw_text_area_meme" class="avpw_text_input avpw_meme_input" placeholder="'+e.getLocalizedString("Enter top text")+'"/>','<input id="avpw_text_area_meme2" class="avpw_text_input avpw_meme_input" placeholder="'+e.getLocalizedString("Enter bottom text")+'"/>',"</div>","</div>","</div>",'<div id="avpw_controlpanel_textwithfont" class="avpw_controlpanel avpw_tool_stretch">','<div class="avpw_tool_cutout_fixed">','<div class="avpw_outer-center">','<div class="avpw_inner-center">','<div class="avpw_inset_color_widget avpw_inset_group avpw_inset_button_group">',r.colorPickerIcon(),'<div id="avpw_textwithfont_colors" class="avpw_inset_color_choices">',"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div id="avpw_textwithfont_addtext" class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last">','<div class="avpw_plus_icon"></div>',"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div id="avpw_font_browser" class="avpw_font_selection avpw_inset_button_group avpw_inset_group">','<div class="avpw_dropdown_icon">','<div class="avpw_dropdown_icon_inner"></div>',"</div>",'<div id="avpw_font_browser_preview" class="avpw_font_label avpw_label avpw_isa_dropdown_display">',"</div>","</div>",'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_inset_color_widget_label avpw_label">',e.getLocalizedString("Color Picker"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_label avpw_inset_button_last">',e.getLocalizedString("Add Text"),"</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_label avpw_font_selection">',e.getLocalizedString("Font"),"</div>","</div>","</div>","</div>","</div>",'<div id="avpw_controlpanel_colorsplash" class="avpw_controlpanel">','<div class="avpw_outer-center">','<div class="avpw_inner-center avpw_tool_cutout_centered_colorsplash">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_colorsplash_freebrush">','<div class="avpw_colorsplash_freebrush_icon avpw_colorsplash_inner_icon">',e.getLocalizedString("Free Color"),"</div>","</div>",'<div class="avpw_inset_button avpw_inset_button_last avpw_colorsplash_smartbrush avpw_inset_button_down">','<div class="avpw_colorsplash_smartbrush_icon avpw_colorsplash_inner_icon">',e.getLocalizedString("Smart Color"),"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_inset_button_last avpw_colorsplash_eraser">','<div class="avpw_colorsplash_eraser_icon avpw_colorsplash_inner_icon">',e.getLocalizedString("Eraser"),"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>',r.brushSizesSet({id:"avpw_colorsplash_brushes",sizes:[8,13,18,21,25],hideLabel:!0}),'<div class="avpw_inset_group avpw_clear">','<div class="avpw_inset_button_label avpw_label">',e.getLocalizedString("Free Color"),"</div>",'<div class="avpw_inset_button_label avpw_label avpw_label_overflow">',e.getLocalizedString("Smart Color"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_last avpw_label">',e.getLocalizedString("Eraser"),"</div>",'<div class="avpw_inset_group avpw_inset_group_mini_spacer"></div>','<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">',e.getLocalizedString("Brush Size"),"</div>","</div>","</div>","</div>",'<div id="avpw_controlpanel_focus" class="avpw_controlpanel">','<div class="avpw_tool_cutout_centered_tiltshift">','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_first avpw_tiltshift_circle_button">','<div class="avpw_tiltshift_circle_icon avpw_tiltshift_inner_icon">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_spacer"></div>','<div class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_inset_button avpw_inset_button_last avpw_tiltshift_rectangle_button">','<div class="avpw_tiltshift_rectangle_icon avpw_tiltshift_inner_icon">',"</div>","</div>","</div>",'<div class="avpw_inset_group avpw_inset_group">','<div class="avpw_inset_button_label avpw_label avpw_inset_group">',e.getLocalizedString("Circular"),"</div>","</div>",'<div class="avpw_inset_group avpw_inset_group_spacer"></div>','<div class="avpw_inset_group avpw_inset_group">','<div class="avpw_inset_button_label avpw_label avpw_inset_group">',e.getLocalizedString("Linear"),"</div>","</div>","</div>","</div>","</div>",'<div class="avpw_mode_action avpw_mode_action_left">',r.cancelButton({id:"avpw_all_effects",label:"Cancel"}),r.cancelButton({id:"avpw_up_one_level",label:"Back"}),"</div>",'<div class="avpw_mode_action avpw_mode_action_right">','<a href="javascript:void(0)" id="avpw_apply_container" class="avpw_button avpw_primary_button">',e.getLocalizedString("Apply"),"</a>","</div>","</div>","</div>",'<div id="avpw_canvas_embed" class="avpw_canvas_background"></div>','<span id="avpw_size_indicator"></span>','<div id="avpw_messaging" style="display: none;">','<div id="avpw_messaging_inner">',"</div>",'<div id="avpw_messages" style="display: none;">',r.aviaryAppPopups(),"</div>","</div>","</div>"].join("")},r.eggIcon=function(e){return['<div class="avpw_icon avpw_tool_icon" id="avpw_main_'+e.optionName+'" data-header="'+e.capOptionName+'" data-toolname="'+e.optionName+'">','<div class="avpw_icon_image avpw_tool_icon_image">','<div class="avpw_tool_icon_inner"></div>',"</div>",'<div class="avpw_icon_waiter avpw_center_contents">',"</div>",'<span class="avpw_icon_label avpw_label">'+e.capOptionName+"</span>","</div>"].join("")},r.emptyEggIcon=function(){return""},r.genericScrollPanel=function(e){return['<div style="width: '+e.panelWidth+'px;" class="avpw_scroll_page '+e.panelClass+'">\n','<span class="avpw_scroll_page_inner">\n',e.panelHTML,"</span>\n","</div>\n"].join("")},r.aviaryAppPopups=function(){return['<div id="avpw_aviary_beensaved" class="avpw_app_popup">\n','<p class="avpw_message_text">'+e.getLocalizedString("Your work was saved!")+"</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resume_aftersave" class="avpw_button" href="#Resume">'+e.getLocalizedString("Resume")+"</a>\n",'<a id="avpw_close_aftersave" class="avpw_button avpw_primary_button" href="#Close">'+e.getLocalizedString("Close")+"</a>","</div>\n","</div>\n",'<div id="avpw_resize_invalid" class="avpw_app_popup">\n','<p class="avpw_message_text">',e.getLocalizedString("Width and height must be greater than zero and less than the maximum ({max}px)").replace("{max}",'<span id="avpw_resize_invalid_max_size"></span>'),"</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resize_invalid_confirm" class="avpw_button" href="#Confirm">'+e.getLocalizedString("OK")+"</a>\n","</div>\n","</div>\n",'<div id="avpw_resize_unlocked" class="avpw_app_popup">\n','<p class="avpw_message_text">',e.getLocalizedString("Are you sure? This can distort your image."),"</p>",'<div class="avpw_message_buttons">\n','<a id="avpw_resize_unlocked_confirm" class="avpw_button" href="#Confirm">'+e.getLocalizedString("OK")+"</a>\n",'<a id="avpw_resize_unlocked_cancel" class="avpw_button" href="#Confirm">'+e.getLocalizedString("Cancel")+"</a>\n","</div>\n","</div>\n",'<div id="avpw_aviary_quitareyousure" class="avpw_app_popup">','<p class="avpw_message_text">'+e.getLocalizedString("Wait! You didn't save your work. Are you certain that you want to close this editor?")+"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_resume_editing" class="avpw_button" href="#Resume">'+e.getLocalizedString("Resume")+"</a>\n",'<a id="avpw_close_nosave" class="avpw_button" href="#Close">'+e.getLocalizedString("Close")+"</a>\n",'<a id="avpw_close_save" class="avpw_button avpw_primary_button" href="#Save">'+e.getLocalizedString("Save")+"</a>","</div>","</div>",'<div id="avpw_aviary_unsupported" class="avpw_app_popup">','<p class="avpw_message_text">',e.getLocalizedString("Please install {Adobe Flash Player} (version {min} or higher), or use a supported browser: {Chrome}, {Firefox}, {Safari}, {Opera}, or {Internet Explorer} (version 9 or higher).").replace("{Adobe Flash Player}",'<a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash Player</a>').replace("{min}",e.build.MINIMUM_FLASH_PLAYER_VERSION).replace("{Chrome}",'<a href="http://www.google.com/chrome/" target="_blank">Chrome</a>').replace("{Firefox}",'<a href="http://www.mozilla.org/firefox/" target="_blank">Firefox</a>').replace("{Safari}",'<a href="http://www.apple.com/safari/" target="_blank">Safari</a>').replace("{Opera}",'<a href="http://www.opera.com/" target="_blank">Opera</a>').replace("{Internet Explorer}",'<a href="http://www.beautyoftheweb.com/" target="_blank">Internet Explorer</a>'),"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_close_unsupported" class="avpw_button" href="#Close">'+e.getLocalizedString("Close")+"</a>\n","</div>","</div>",'<div id="avpw_aviary_crop_invalid_dimensions" class="avpw_app_popup">','<p class="avpw_message_text">',e.getLocalizedString("Your photo is smaller than the required size. Please choose a new one to proceed."),"</p>",'<div class="avpw_message_buttons avpw_center_contents">\n','<a id="avpw_close_forcecrop_close" class="avpw_button" href="#Close">'+e.getLocalizedString("Close")+"</a>\n","</div>","</div>"].join("")},r.scrollPanelPip=function(e){return'<li class="avpw_page avpw_is_navpip" pagenum="'+e.i+'" id="avpw_navpip_'+e.i+'">&bull;</li>\n'},r.slider=function(e){return['<div class="avpw_slider_container avpw_isa_slider_container">','<div class="avpw_slider_bookend avpw_slider_bookend_left avpw_slider_label"></div>','<div class="avpw_slider_positioned" id="'+e.id+'">','<div class="avpw_slider_positioned_inner">','<div class="avpw_slider_bounds" >','<div class="avpw_slider_goo"></div>',e.divider?'<div class="avpw_slider_divider"></div>':"",'<a class="avpw_slider_handle"></a>',"</div>","</div>","</div>",'<div class="avpw_slider_bookend avpw_slider_bookend_right avpw_slider_label"></div>',"</div>"].join("")},r.zoomModeOverlay=function(){return['<div id="avpw_zoom_mode_overlay">','<div id="avpw_zoom_mode_text">','<h2 class="avpw_mode_warning">',e.getLocalizedString("Zoom Mode"),"</h2>",e.getLocalizedString("Click to release"),"</div>","</div>"].join("")},r.zoomControls=function(){return['<div id="avpw_zoom_container">','<div id="avpw_zoom_button">','<div id="avpw_zoom_icon"></div>',"</div>",'<div class="avpw_zoom_slider_container avpw_isa_slider_container">','<div class="avpw_slider_bookend avpw_slider_bookend_left">-</div>','<div id="avpw_zoom_inner"></div>','<div id="avpw_zoom_slider">','<a id="avpw_zoom_handle"></a>',"</div>",'<div class="avpw_slider_bookend avpw_slider_bookend_right">+</div>',"</div>","</div>"].join("")},r.presetIndicator=function(){return['<div class="avpw_preset_indicator_outer">','<div class="avpw_preset_indicator">',"</div>","</div>"].join("")},r.cropCustomControl=function(t){return['<div class="avpw_crop_custom_control avpw_isa_preset_crop" data-crop="Custom">','<div class="avpw_crop_custom_control_left">','<div class="avpw_crop_preset_visual"></div>','<div class="avpw_preset_label avpw_label">',e.getLocalizedString("Custom"),"</div>","</div>",'<div class="avpw_crop_custom_control_right">','<input id="avpw_crop_custom_width" class="avpw_text_input avpw_number_input" type="text" placeholder="'+e.getLocalizedString("Width")+'" maxlength="5"  />','<input id="avpw_crop_custom_height" class="avpw_text_input avpw_number_input" type="text" placeholder="'+e.getLocalizedString("Height")+'" maxlength="5" />','<div class="avpw_crop_lock_group"><input id="avpw_crop_custom_lock_dims" type="checkbox" /> <span>'+e.getLocalizedString("Lock Dimensions")+"</span> </div>","</div>","</div>"].join("")},r.cropPreset=function(e){var t,o=20,a=-3,i=(e.label.split(":"),30),n=30,s=30,l=e.width,u=e.height;l===u?s=n=i:l>u?(n=i,t=i/l,s=u*t):(s=i,t=i/u,n=l*t);var c="width:"+n+"px;height:"+s+"px;margin-left:"+(-n/2+a)+"px;margin-top:"+-(s-o)/2+"px";return['<div class="avpw_preset_crop_icon avpw_preset_icon avpw_icon avpw_with_indicator avpw_isa_preset_crop" data-crop="'+e.label+'">',e.strict||e.labeled?"":r.cropPresetFlippedIndicator(),'<div class="avpw_crop_preset_visual" style="'+c+'"></div>','<div class="avpw_preset_label avpw_label">',e.label,"</div>",r.presetIndicator(),"</div>"].join("")},r.cropPresetFlippedIndicator=function(e){return['<div class="avpw_crop_preset_flipped_indicator_shadow">','<div class="avpw_crop_preset_flipped_indicator_left"></div>','<div class="avpw_crop_preset_flipped_indicator_right"></div>',"</div>",'<div class="avpw_crop_preset_flipped_indicator">','<div class="avpw_crop_preset_flipped_indicator_left"></div>','<div class="avpw_crop_preset_flipped_indicator_right"></div>',"</div>"].join("")},r.brushIcon=function(e){var t="avpw_inset_button avpw_inset_button_mini avpw_isa_preset_brush";return e.isFirst?t+=" avpw_inset_button_first":e.isLast&&(t+=" avpw_inset_button_last"),['<div class="'+t+'" data-size="'+e.size+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_'+e.size+'">',"</div>","</div>"].join("")},r.brushIconLarge=function(e){return['<div class="avpw_preset_icon avpw_icon avpw_with_indicator avpw_isa_preset_brush" data-size="'+e.size+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_'+e.size+'">',"</div>",r.presetIndicator(),"</div>"].join("")},r.brushColorIcon=function(e){return['<div class="avpw_brush_color_icon avpw_icon avpw_isa_preset_color" data-color="'+e.color+'">','<div class="avpw_preset_color_image" style="background: '+e.color+';">',"</div>",e.extra?e.extra:"","</div>"].join("")},r.brushSizesSet=function(t){t||(t={}),t.sizes||(t.sizes=e.brushWidths);var r="";return t.id&&""!=t.id&&(r='id="'+t.id+'"'),["<div "+r+' class="avpw_inset_button_group avpw_inset_group">','<div class="avpw_isa_preset_brush" data-size="'+t.sizes[0]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_1"></div>',"</div>",'<div class="avpw_isa_preset_brush avpw_collapsible" data-size="'+t.sizes[1]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_2"></div>',"</div>",'<div class="avpw_isa_preset_brush" data-size="'+t.sizes[2]+'">','<div class="avpw_icon_image avpw_brush_size avpw_brush_size_3"></div>',"</div>","</div>",t.hideLabel?"":'<div class="avpw_inset_group avpw_inset_button_label avpw_inset_button_label_mini_5 avpw_label">'+e.getLocalizedString("Brush Size")+"</div>"].join("");
},r.colorPickerIcon=function(e){return['<div class="avpw_inset_color_picker avpw_inset_button avpw_inset_button_first avpw_isa_color_picker" data-color="">','<div class="avpw_preset_color_image avpw_custom_color_image avpw_isa_color_feedback"></div>',"</div>"].join("")},r.colorPickerContainer=function(t){return['<div class="avpw_dropdown_popup avpw_color_picker_dropdown_popup">','<div class="avpw_color_picker_background"></div>','<div class="avpw_dropdown_tail"></div>','<div class="avpw_color_picker_preview avpw_isa_color_feedback">',"</div>",'<a class="avpw_button avpw_color_picker_confirm">',e.getLocalizedString("Set Color"),"</a>","</div>"].join("")},r.brushPreviewOverlay=function(e){return['<div id="avpw_brush_preview_container" class="avpw_brush_preview avpw_selection_overlay_selected">','<canvas height="100" width="100" class="avpw_brush_preview_display"></canvas>',"</div>"].join("")},r.cropLayer=function(e){return['<div class="avpw_crop_layer">','<div class="avpw_crop_outside avpw_crop_outside_n"></div>','<div class="avpw_crop_outside avpw_crop_outside_s"></div>','<div class="avpw_crop_outside avpw_crop_outside_e"></div>','<div class="avpw_crop_outside avpw_crop_outside_w"></div>',r.alignmentGrid({numLines:3,lineWidth:2}),'<div class="avpw_crop_handle avpw_crop_handle_tl"></div>','<div class="avpw_crop_handle avpw_crop_handle_tr"></div>','<div class="avpw_crop_handle avpw_crop_handle_bl"></div>','<div class="avpw_crop_handle avpw_crop_handle_br"></div>',r.cropLayerToolTip(),"</div>"].join("")},r.cropLayerToolTip=function(e){return['<div id="avpw_crop_tooltip">','w: <span id="avpw_crop_tooltip_w">800</span><br/>','h: <span id="avpw_crop_tooltip_h">600</span>',"</div>"].join("")},r.frameThicknessIcon=function(e){var t=e.thickness+"px",r=24-2*e.thickness,o=r+"px";return['<div class="avpw_preset_icon avpw_icon avpw_isa_preset_thickness" data-thickness="'+e.thickness+'">','<div class="avpw_preset_thickness_image" ','style="border-width: '+t+";","width: "+o+";","height: "+o+';"',">","</div>","</div>"].join("")},r.fontGroupPopup=function(e){return['<div id="avpw_font_popup" class="avpw_dropdown_popup" style="display: none;">','<div class="avpw_dropdown_tail"></div>','<div class="avpw_dropdown_popup_inner">','<ul class="avpw_dropdown_popup_list">',"</ul>","</div>","</div>"].join("")},r.fontGroupPopupItem=function(e){var t="";return e.label&&e.label.toLowerCase&&(t="avpw_font_"+e.label.toLowerCase().replace(/\ /g,""),e.custom&&(t+=" avpw_font_custom_image")),['<li class="avpw_preset_font avpw_dropdown_popup_list_item avpw_isa_dropdown_item" data-value="'+e.label+'">','<div class="avpw_font_image '+t+'">',e.label,"</div>","</li>"].join("")},r.fontSizePopup=function(e){return['<div id="avpw_font_size_popup" class="avpw_dropdown_popup" style="display: none;">','<div class="avpw_dropdown_tail"></div>','<div class="avpw_dropdown_popup_inner">','<ul class="avpw_dropdown_popup_list">',"</ul>","</div>","</div>"].join("")},r.fontSizePopupItem=function(e){return['<li class="avpw_preset_font_size avpw_dropdown_popup_list_item avpw_isa_dropdown_item" data-value="'+e.value+'">',e.label,"</li>"].join("")},r.selectionOverlay=function(t){return['<div id="'+(t.id?t.id:"")+'" style="z-index:'+t.zIndex+';" class="avpw_selection_overlay">',t.body?t.body:"",'<div class="avpw_selection_overlay_size_handle"></div>',r.closeButton({className:"avpw_selection_overlay_close_button",text:e.getLocalizedString("Remove")}),"</div>"].join("")},r.imageOverlayBody=function(e){return['<img class="avpw_selection_overlay_image" src="'+(e.src||"")+'"></img>'].join("")},r.textEntryOverlayBody=function(e){return['<canvas class="avpw_textwithfont_writer"></canvas>','<textarea class="avpw_textwithfont_entry" cols="20" rows="1" wrap="soft" spellcheck="false">',"</textarea>"].join("")},r.textEntryOverlayProxy=function(e){return['<pre class="avpw_textwithfont_overlay_proxy">','<span class="avpw_proxy_get_height"> </span>',"</pre>"].join("")},r.textEntryOutlineStyle=function(e){var t=.707,r=.383,o=.924,a=e.size?e.size/2:1;return["-"+a+"px 0 "+e.color+",","-"+o*a+"px -"+r*a+"px "+e.color+",","-"+t*a+"px -"+t*a+"px "+e.color+",","-"+r*a+"px -"+o*a+"px "+e.color+",","0 -"+a+"px "+e.color+",",r*a+"px "+o*a+"px "+e.color+",",t*a+"px -"+t*a+"px "+e.color+",",o*a+"px "+r*a+"px "+e.color+",",a+"px 0 "+e.color+",",o*a+"px "+r*a+"px "+e.color+",",t*a+"px "+t*a+"px "+e.color+",",r*a+"px "+o*a+"px "+e.color+",","0 "+a+"px "+e.color+",","-"+r*a+"px "+o*a+"px "+e.color+",","-"+t*a+"px "+t*a+"px "+e.color+",","-"+o*a+"px "+r*a+"px "+e.color].join("")},r.blankPreset=function(){return['<div class="avpw_preset_icon avpw_icon avpw_preset_icon_disabled">',"</div>"].join("")},r.blankCropPreset=function(){return['<div class="avpw_preset_crop_icon avpw_preset_icon avpw_icon avpw_preset_icon_disabled">',"</div>"].join("")},r.stickerThumbnail=function(e){return['<div class="avpw_icon avpw_overlay_icon avpw_isa_control_selector_overlay" thumburl="'+e.thumburl+'" fullimageurl="'+e.url+'">','<div class="avpw_icon_image avpw_overlay_image avpw_header_inline_center">','<img draggable="false" src="'+e.thumburl+'" fullimageurl="'+e.url+'"></img>',"</div>",'<div class="avpw_icon_waiter avpw_center_contents avpw_isa_overlay_waiter">',"</div>","</div>"].join("")},r.stickerRollInner=function(e){return['<img draggable="false" height="60" width="60" class="avpw_stickerpack_image" ','src="'+e.thumburl+'"></img>','<span class="avpw_icon_label avpw_label">'+e.label+"</span>"].join("")},r.stickerRoll=function(e){return['<div class="avpw_pack_icon avpw_icon avpw_isa_control_selector_filterpack avpw_pack_icon avpw_filterpack_icon avpw_isa_control_selector_stickerpack"  data-pack-index="'+e.packIndex+'">','<div class="avpw_tile_container">','<img draggable="false" height="60" width="60" class="avpw_filterpack_image" src="'+e.thumburl+'" />',"</div>",'<span class="avpw_icon_label avpw_label">'+e.label+"</span>","</div>"].join("")},r.stickerRollDisabled=function(e){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_stickerpack_icon avpw_isa_control_selector_stickerinfo">',r.stickerRollInner(e),'<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")},r.filterThumbnail=function(e){var t=e.thumburl?'<img draggable="false" height="63" width="63" class="avpw_filter_icon_image" src="'+e.thumburl+'"></img>':'<canvas draggable="false" height="63" width="63" class="avpw_filter_icon_image avpw_isa_previewcanvas"></canvas>';return['<div class="avpw_icon avpw_filter_icon avpw_isa_control_selector_filter" data-frame="'+(e.frame||"")+'" data-filtername="'+e.id+'">',r.presetIndicator(),t,'<span class="avpw_icon_label avpw_label">'+e.label+"</span>",'<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")},r.filterCanisterInner=function(e){return['<img draggable="false" class="avpw_filterpack_image" ','src="'+e.thumburl+'"></img>','<span class="avpw_icon_label avpw_label">'+e.label+"</span>"].join("")},r.filterCanister=function(e){return['<div class="avpw_pack_icon avpw_icon avpw_isa_control_selector_filterpack avpw_pack_icon avpw_filterpack_icon"  data-pack-index="'+e.packIndex+'">','<div class="avpw_tile_container">','<img draggable="false" height="60" width="60" class="avpw_filterpack_image" src="'+e.thumburl+'" />',"</div>",'<span class="avpw_icon_label avpw_label">'+e.label+"</span>","</div>"].join("")},r.intensitySlider=function(){return['<div id="avpw_tool_container" class="avpw_intensity_container">',r.slider({id:"avpw_intensity_slider",divider:!1}),'<a class="avpw_button avpw_intensity_back_button">',e.getLocalizedString("Back"),"</a>","</div>"].join("")},r.filterCanisterDisabled=function(e){return['<div class="avpw_icon avpw_pack_icon avpw_pack_icon_selected avpw_filterpack_icon avpw_isa_control_selector_filterinfo">',r.filterCanisterInner(e),'<img draggable="false" height="75" width="54" class="avpw_filterpack_tag_image" src="'+e.tagurl+'"></img>','<div class="avpw_icon_waiter avpw_center_contents"></div>',"</div>"].join("")},r.frameThumbnail=function(t){return['<div class="avpw_filter_icon avpw_icon avpw_isa_control_selector_frame" data-framename="'+(t.frameName?t.frameName:0)+'">',r.presetIndicator(),'<div class="avpw_filter_icon_image">','<canvas height="63" width="63" style="background-image: url('+e.build.feather_baseURL+'images/border_thumb.jpg);"></canvas>','<img draggable="false" width=63 height=63 src="'+t.assetImage+'"></img>',"</div>",'<span class="avpw_icon_label avpw_label">'+t.label+"</span>","</div>"].join("")},r.straightenSlider=function(){return['<div class="avpw_straighten_ui avpw_straighten_ui_animate" id="avpw_straighten_container">','<div class="avpw_straighten_ui_grid avpw_straighten_ui_grid_animate" id="avpw_straighten_grid"></div>','<a id="avpw_straighten_handle">',"</a>","</div>"].join("")},r.alignmentGridBox=function(e){return['<div class="avpw_ui_grid_box '+e.classes+'" style="'+e.styles+'">','<div class="avpw_ui_grid_box_inner avpw_ui_grid_box_inner_n" style="'+e.northStyles+'"></div>','<div class="avpw_ui_grid_box_inner avpw_ui_grid_box_inner_w" style="'+e.westStyles+'"></div>',"</div>"].join("")},r.alignmentGrid=function(e){var t,o,a,i,n,s,l,u,c=e.numLines||3,d=e.lineWidth||1,p=100/c,h='<div style="border-right-width: '+d+"px; border-bottom-width: "+d+'px;" class="avpw_ui_grid">';for(t=0;c>t;t++)for(o=0;c>o;o++)i=100*t/c,a=100*o/c,n=["left: "+a+"%;","top: "+i+"%;","width: "+p+"%;","height: "+p+"%;"].join(""),l=["left: "+d+"px;","height: "+d+"px;"].join(""),u=["width: "+d+"px;"].join(""),s="",t===c/2&&(s+="avpw_ui_middle_grid ",l=["left: 0;","height: "+d+"px;"].join("")),o===c/2&&(s+="avpw_ui_center_grid "),h+=r.alignmentGridBox({classes:s,styles:n,northStyles:l,westStyles:u});return h+="</div>"},r.canvasControls=function(){return['<div class="avpw_canvas_controls" id="avpw_canvas_controls_layer">',"</div>"].join("")},r.flashCanvasBox=function(e){return['<table role="presentation" border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">','<tr><td width="100%" height="100%" valign="middle" align="center">','<div id="'+e.id+'"></div>',"</td></tr>","</table>"].join("")},r.advancedToolsSplitter=function(){return['<div class="avpw_advanced_splitter">','<div class="avpw_advanced_splitter_inner">','<div class="avpw_advanced_splitter_control">','<div class="avpw_advanced_splitter_bottom_shadow"></div>','<div class="avpw_advanced_splitter_bottom"></div>','<div class="avpw_advanced_splitter_middle">','<a class="avpw_advanced_splitter_up_arrow"></a>','<a class="avpw_advanced_splitter_down_arrow"></a>',"</div>","</div>","</div>","</div>"].join("")}}(e.template=e.template||{}),e.Pager=function(r){var o,a=this,i=0,n=0,s=parseInt((r.itemCount-1)/r.itemsPerPage,10)+1,l=0,u=function(){var e,t,o,a="";for(r.firstPageTemplate&&(a+=r.firstPageTemplate.apply(this,[r.firstPageContents])),t=e=0;s>t;t++){var i="";for(o=0;o<r.itemsPerPage&&e<r.itemCount;o++)i+=r.itemBuilder.apply(this,[e]),e++;a+=r.pageTemplate?r.pageTemplate({panelHTML:i,panelWidth:r.pageWidth,panelClass:o===r.itemsPerPage?"avpw_scroll_page_complete":"avpw_scroll_page_incomplete"}):i}r.lastPageTemplate&&(a+=r.lastPageTemplate.apply(this,[r.lastPageContents]));var n,u,c,d,p,h=0,f=0,m=0;if((r.firstPageTemplate||r.lastPageTemplate)&&(r.firstPageTemplate&&(r.firstPageWidth?h+=r.firstPageWidth*(r.itemsPerPage/r.pageWidth):s++),r.lastPageTemplate&&(r.lastPageWidth?h+=r.lastPageWidth*(r.itemsPerPage/r.pageWidth):s++),f=r.itemCount%r.itemsPerPage,h&&(l=r.pageWidth/r.itemsPerPage-r.firstPageWidth%(r.pageWidth/r.itemsPerPage)|0,m=l*(r.itemsPerPage/r.pageWidth),f>0?f+h+m>r.itemsPerPage&&s++:s++)),!r.pageTemplate&&r.fillRemainingSpace&&(c=(r.itemCount+h+m)%r.itemsPerPage))if(n=r.itemsPerPage-c,1===s&&r.centerContents){for(u=n/2|0,d="",p=0;u>p;p++)d+=r.fillRemainingSpace.apply(this);for(a=d+a,p=0;u>p;p++)a+=r.fillRemainingSpace.apply(this)}else for(p=0;n>p;p++)a+=r.fillRemainingSpace.apply(this);return a},c=function(){o.removeClass("avpw_page_selected"),o.filter('[pagenum="'+i+'"]').addClass("avpw_page_selected")},d=function(){0===i?avpw$(r.leftArrow).removeClass("avpw_prev_enabled").addClass("avpw_prev_disabled"):avpw$(r.leftArrow).removeClass("avpw_prev_disabled").addClass("avpw_prev_enabled"),i==s-1?avpw$(r.rightArrow).removeClass("avpw_next_enabled").addClass("avpw_next_disabled"):avpw$(r.rightArrow).removeClass("avpw_next_disabled").addClass("avpw_next_enabled")},p=function(e){e=e||0;var t=e*r.pageWidth;return 0!==e&&(t-=l),t},h=function(t,a){var n,l=r.pageContainer;if(0>i)return void(i=0);if(i>s-1)return void(i=s-1);n=p(i);var u=e.support.getVendorProperty("transform");if(u){var h;h=i>0?"translateX(-"+n+"px)":"translateX(0)",l[0].style[u]=h}else i>0?l[0].style.left="-"+n+"px":l[0].style.left="0";d(),r.onPageChange&&r.onPageChange.apply(this,[i]),o&&c()},f=function(){return n=i,i+=-1,h.call(this),!1},m=function(){return n=i,i+=1,h.call(this),!1},g=function(){var e=r.longPressDuration||200,o=!1,a=null,s=this,l=function(r){a=t.setInterval(function(){o&&r?(n=i,i+=r,h.call(s)):(t.clearInterval(a),a=null)},e)},u=function(){t.clearInterval(a),a=null,f.call(this),o=!0,l.call(this,-1)},c=function(){t.clearInterval(a),a=null,m.call(this),o=!0,l.call(this,1)},d=function(){o=!1};return{bindEvents:function(){avpw$(r.leftArrow).bind("mousedown",u).bind("mouseup",d),avpw$(r.rightArrow).bind("mousedown",c).bind("mouseup",d)},unbindEvents:function(){avpw$(r.leftArrow).unbind("mousedown",u).unbind("mouseup",d),avpw$(r.rightArrow).unbind("mousedown",c).unbind("mouseup",d)}}}(),v=function(t,r,o){var a,i,n,s,l=30,u=60;t.length&&(t=t[0]),t.ontouchstart=function(t){var r=e.util.getTouch(t);r&&(a=r.pageX,n=r.pageY)},t.ontouchmove=function(t){var r=e.util.getTouch(t);return r&&(i=r.pageX,s=r.pageY),!1},t.ontouchend=function(e){var t=i-a,c=s-n;Math.abs(t)>l&&Math.abs(c)<u&&(t>l?r():o()),i=a=void 0}},_=function(e){e.length&&(e=e[0]),e.ontouchstart=e.ontouchmove=e.ontouchend=null},x=function(e){if(r.itemsPerPage&&!r.pageTemplate){var t=e.currentTarget,o=r.pageContainer.offset().left,a=avpw$(t).offset().left-o;a>=p(i+1)?(i++,h()):a<p(i)&&(i--,h())}},w=function(){1!==s&&(r.bindLongPress?g.bindEvents():(avpw$(r.leftArrow).bind("click",function(){return f.call(this)}),avpw$(r.rightArrow).bind("click",function(){return m.call(this)})),v(r.pageContainer,f,m),o&&o.bind("click",function(e){var t=e.currentTarget,r=avpw$(t).attr("pagenum");return n=i,i=parseInt(r),h(),!1}),r.pageContainer.delegate(".avpw_icon","click",x))},y=function(){1!==s&&(r.bindLongPress?g.unbindEvents():(avpw$(r.leftArrow).unbind("click"),avpw$(r.rightArrow).unbind("click")),_(r.pageContainer),o&&o.unbind("click"),r.pageContainer.undelegate(".avpw_icon","click"))},b=function(){r.pageContainer.html(u()),r.onPageBuilt&&r.onPageBuilt.call(this),1===s?(avpw$(r.leftArrow).hide(),avpw$(r.rightArrow).hide(),r.centerContents&&(r.pageContainer.css("width","auto"),r.pageContainer.addClass("avpw_scroll_strip_centered"))):(avpw$(r.leftArrow).show(),avpw$(r.rightArrow).show(),r.pageContainer.removeClass("avpw_scroll_strip_centered")),w()};return a.shutdown=function(){y(),r.pageContainer.html(""),r.pageContainer.attr("style",""),o&&r.pipContainer.html("")},a.changePage=h,a.pageLeft=f,a.pageRight=m,a.setCurrentPage=function(e){n=i,i=e},a.getCurrentPage=function(){return i},a.getLastPage=function(){return s-1},a.getPageCount=function(){return s},a.setPageCount=function(e){s=e},b(),a};var c=e.Events,d=function(t,r){var o=function(e){var t=avpw$(this);t.unbind("mouseup mouseout touchend")},a=function(e){var t=avpw$(this);return t.bind("mouseup touchend",i),t.bind("mouseout",o),e.stopPropagation(),!1},i=function(t){var o=avpw$(this);return o.unbind("mouseup mouseout touchend",i),t.stopPropagation(),r?(e.util.nextFrame(r),!1):!0};t.bind("mousedown touchstart",a),t.click(function(e){e.preventDefault()})};e.colorChoices=["#000000","#ffffff","rgb(255, 0, 0)","rgb(255, 132, 0)","rgb(255,240,0)","rgb(0,255,0)","rgb(0,0,255)","rgb(198,0,255)"],e.brushWidths=[5,15,30,45,70],e.buildBlankPreset=function(){return e.template[e.launchData.layout].blankPreset()},e.buildBlankCropPreset=function(){return e.template[e.launchData.layout].blankCropPreset()},e.toolDefaults={redeye:{presets:e.brushWidths},whiten:{initialvalue:10,presets:e.brushWidths},blemish:{initialvalue:5,presets:e.brushWidths},drawing:{initialColor:e.colorChoices[7],presetsWidth:e.brushWidths,presetsColor:e.colorChoices},text:{presetsColor:e.colorChoices},textwithfont:{presetsColor:e.colorChoices,presetsFont:[{label:"Abril Fatface",value:"Abril Fatface"},{label:"Acme",value:"Acme"},{label:"Anton",value:"Anton"},{label:"Arial Black",value:"Arial Black",system:!0},{label:"Bangers",value:"Bangers"},{label:"Bevan",value:"Bevan"},{label:"Black Ops One",value:"Black Ops One"},{label:"Butterfly Kids",value:"Butterfly Kids"},{label:"Cabin Sketch",value:"Cabin Sketch"},{label:"Cardo",value:"Cardo"},{label:"Chelsea Market",value:"Chelsea Market"},{label:"Chewy",value:"Chewy"},{label:"Covered By Your Grace",value:"Covered By Your Grace"},{label:"Dawning of a New Day",value:"Dawning of a New Day"},{label:"Delius Unicase",value:"Delius Unicase"},{label:"Didact Gothic",value:"Didact Gothic"},{label:"Doppio One",value:"Doppio One"},{label:"Droid Serif",value:"Droid Serif"},{label:"EB Garamond",value:"EB Garamond"},{label:"Economica",value:"Economica",familyStyle:"bolditalic",style:"italic"},{label:"Francois One",value:"Francois One"},{label:"Fredoka One",value:"Fredoka One"},{label:"Georgia",value:"Georgia",system:!0},{label:"Give You Glory",value:"Give You Glory"},{label:"IM Fell English",value:"IM Fell English"},{label:"Italiana",value:"Italiana"},{label:"Kranky",value:"Kranky"},{label:"La Belle Aurore",value:"La Belle Aurore"},{label:"Ledger",value:"Ledger"},{label:"Lobster Two",value:"Lobster Two"},{label:"Luckiest Guy",value:"Luckiest Guy"},{label:"Mr Dafoe",value:"Mr Dafoe"},{label:"Mystery Quest",value:"Mystery Quest"},{label:"Oswald",value:"Oswald",familyStyle:"bold"},{label:"Overlock",value:"Overlock"},{label:"Patua One",value:"Patua One"},{label:"Playball",value:"Playball"},{label:"Princess Sofia",value:"Princess Sofia"},{label:"PT Mono",value:"PT Mono"},{label:"PT Sans Narrow",value:"PT Sans Narrow",familyStyle:"bold"},{label:"PT Serif Caption",value:"PT Serif Caption"},{label:"Quicksand",value:"Quicksand"},{label:"Rochester",value:"Rochester"},{label:"Rokkitt",value:"Rokkitt"},{label:"Sansita One",value:"Sansita One"},{label:"Schoolbell",value:"Schoolbell"},{label:"Shadows Into Light Two",value:"Shadows Into Light Two"},{label:"Shojumaru",value:"Shojumaru"},{label:"Special Elite",value:"Special Elite"},{label:"Stint Ultra Expanded",value:"Stint Ultra Expanded"},{label:"Tahoma",value:"Tahoma",system:!0},{label:"Times New Roman",value:"Times New Roman",system:!0},{label:"Trebuchet MS",value:"Trebuchet MS",system:!0},{label:"Ultra",value:"Ultra"},{label:"Varela Round",value:"Varela Round"},{label:"Verdana",value:"Verdana",system:!0},{label:"Voltaire",value:"Voltaire"},{label:"Zeyada",value:"Zeyada"}]},sharpness:{presets:[-100,-33,33,100]},enhance:{presets:["hidef","scenery","food","portrait","night"]},colorsplash:{presets:e.brushWidths}},e.buildColorPicker=function(t,r,o,a){var i,n=74,s=avpw$(r).data("color"),l=null,u=null,c=function(e){var t={h:0,s:0,b:0},r=Math.min(e.r,e.g,e.b),o=Math.max(e.r,e.g,e.b),a=o-r;return t.b=o,t.s=0!==o?255*a/o:0,0!==t.s?e.r===o?t.h=(e.g-e.b)/a:e.g===o?t.h=2+(e.b-e.r)/a:t.h=4+(e.r-e.g)/a:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},d=function(e){return e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16),{r:e>>16,g:(65280&e)>>8,b:255&e}},p=function(e){var t=c(d(e));return 0===t.s&&(t.h=360),t},h=function(){return avpw$(r).data("color")},f=function(e){avpw$(r).data("color",e)},m=function(e){e=e||h();var t=avpw$(r).find(".avpw_isa_color_feedback");e?t.css("background-color",e).addClass("avpw_custom_color_image_with_preview"):t.removeClass("avpw_custom_color_image_with_preview")},g=function(e){e=e||h(),u.find(".avpw_isa_color_feedback").css("background-color",e)},v=function(){var e=avpw$(r).offset(),t=avpw$("#avpw_controls").offset();e.left+=avpw$(r).width()/2,e.left-=u.width()/2,e.left-=t.left,e.top-=t.top,u.css({left:e.left+"px",top:e.top+n+"px"})},_=function(){u&&(e.miniColors.unBindSelectorEvents(),u.undelegate(".avpw_color_picker_confirm","mousedown touchstart"),l.unbind(),u.hide().remove(),u=l=null)};return e.miniColors?(s=s||t||"#ffffff",i=p(s),l=e.miniColors.buildSelector(i),u=avpw$(".avpw_color_picker_dropdown_popup"),u&&u.length?(u.unbind(),u.detach()):u=avpw$(e.template[e.launchData.layout].colorPickerContainer()),e.miniColors.bindSelectorEvents(l),avpw$("#avpw_controls").append(u.append(l)),u.delegate(".avpw_color_picker_confirm","mousedown touchstart",function(e){e.stopPropagation(),e.preventDefault(),o&&o.apply(this,[s]),f(s),m(s),_()}),l.bind("clickOutsideBounds",function(e){m(""),_(),a&&a.call(this)}).bind("setColor",function(e,t){s="#"+t.hex,g(s),o&&o.apply(this,[s,!0])}).show(),g(s),v(),{hideColorPicker:_}):void 0},e.ControlsWidget.prototype.populateCropPresets=function(t){var r,o,a,i,n,s,l,u,c,d,p=e.launchData.cropPresetsStrict,h=this.imageSizeTracker.isUsingHiResDimensions(e.launchData);e.featherUseFlash||h?(d=this.paintWidget.getScaledSize(),u=d.hiresWidth||d.width,c=d.hiresHeight||d.height):(u=this.paintWidget.width,c=this.paintWidget.height),r=u/c>1;for(var f=[],m=0;m<t.length;m++){var g,v,_,x=t[m]instanceof Array;if(v=x?t[m][1]:t[m],_=x?t[m][0]:t[m],"custom"===_.toLowerCase())x=!0,g={label:_,width:.85*u,height:.75*c,constrain:!1,resize:!1};else if("original"===_.toLowerCase())x=!0,g={label:_,width:u,height:c,constrain:!0,resize:!1};else if(o=v.toLowerCase().indexOf("x"),-1!=o){if(a=v.substr(0,o),i=v.substr(o+1),n=parseInt(a,10),s=parseInt(i,10),n>u||s>c)continue;if(!p&&(s>u||n>c))continue;x||p||!(r&&1>n/s||!r&&n/s>1)||(_=s+(v.charAt(o)||"x")+n,l=n,n=s,s=l),g={label:_,width:n,height:s,constrain:!0,resize:!0}}else{if(o=v.indexOf(":"),-1==o&&""!==avpw$.trim(v))continue;a=v.substr(0,o),i=v.substr(o+1),n=parseInt(a,10),s=parseInt(i,10),x||p||!(r&&1>n/s||!r&&n/s>1)||(_=s+":"+n,l=n,n=s,s=l),g={label:_,width:n,height:s,constrain:!0,resize:!1}}g&&(g.strict=p,g.labeled=x,f.push(g))}return f},e.Dropdown=function(e){var o,a,i=74,n="avpw_dropdown_open",s="avpw_dropdown_popup_list_item_selected",l=e.updateElement,u=e.popupElement,d=e.defaultValue,p=e.preventClose||!1,h=e.disableReposition||!1,f=e.disableClick||!1,m=e.onShow,g=e.onHide,v=function(e,t){e=e||d,a&&a.length&&a.html(e),u&&u.length&&(u.find(".avpw_isa_dropdown_item").removeClass(s),t=t||u.find('[data-value="'+e+'"]'),t&&t.length&&t.addClass(s))},_=function(t){var r=t.currentTarget,o=avpw$(r);value=o.data("value"),v(value,r),p&&(t.stopPropagation(),t.preventDefault()),e.onItemClicked&&!f&&e.onItemClicked.apply(this,[value])},x=function(){e.popupParent&&e.popupParent.length&&e.popupParent.append(u)},w=function(){if(!h){var e=l.offset(),t=avpw$("#avpw_controls").offset();e.left+=l.width()/2,e.left-=u.width()/2,e.left-=t.left,e.top-=t.top,u.css({left:e.left+"px",top:e.top+i+"px"})}},y=function(e,t){if(u){var a,i,n=r.createDocumentFragment();for(a=0;a<e.length;a++)i=avpw$(t(e[a])),n.appendChild(i[0]);o&&o.length?o.html(n):u.html(n)}},b=function(){l.bind("click",A)},M=function(){l.unbind("click",A)},C=function(){u&&u.length&&u.remove()},T=function(){u&&u.length&&(P(),u.slideDown(50),l.addClass(n),m&&m.call(this))},S=function(){u&&u.length&&(l.removeClass(n),u.slideUp(50),D(),g&&g.call(this))},A=function(e){e.preventDefault(),e.stopPropagation(),u&&u.is(":visible")?S():T()},E=function(){o=u.find(".avpw_dropdown_popup_list"),a=l.find(".avpw_isa_dropdown_display"),x(),b(),e.items&&e.itemTemplate&&y(e.items,e.itemTemplate),v()},P=function(){u&&u.delegate(".avpw_isa_dropdown_item","click",_),avpw$(t).bind("click",S),c.on("layout:resize",w)},D=function(){u&&u.undelegate(".avpw_isa_dropdown_item","click"),avpw$(t).unbind("click",S),c.off("layout:resize",w)},F=this;return F.position=w,F.getPopupElement=function(){return u},F.show=T,F.hide=S,F.update=v,F.shutdown=function(){D(),M(),C(),o=void 0,a=void 0,d=void 0,l=void 0,u=void 0},E(),F},e.ContentBrowser=function(r){r||(r={});var o,a,i=r.container||null,n=r.packsInOrder||[],s=r.packsById||{},l=r.buildPackUI,u=r.buildItem,d=(r.itemWidth,r.arrowWidth||62,{}),p=i.find(".avpw_content_packs"),h=i.find(".avpw_content_items");i.delegate(".avpw_pack_icon","click",function(e){if(e.stopPropagation(),e.preventDefault(),!avpw$(this).hasClass("avpw_selected_pack")){var t=avpw$(this).data("packIndex");d.openPackItemsByIndex(t)}}),avpw$("#avpw_tool_options_container").delegate("#avpw_up_one_level","click",function(e){e.stopPropagation(),e.preventDefault(),w()});var f,m,g;d.build=function(){g=avpw$("#avpw_breadcrumb_toolname").html();var t=p.find(".avpw_scroll_strip"),a=e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"getDims"),i=r.packWidth||90,u=a.INNER_BROWSER_WIDTH/i|0,c=i*u;t.css({width:n.length*i+"px",paddingRight:c+"px"}),o=new e.Pager({leftArrow:p.find(".avpw_prev"),rightArrow:p.find(".avpw_next"),itemCount:n.length,itemsPerPage:u,pageWidth:c,pageContainer:t,itemBuilder:function(e){return l(s[n[e].identifier],e)}}),w(!1,null,!0)};var v,_=function(){f&&f.removeClass("avpw_selected_pack")},x=300,w=function(e,i,n){t.clearTimeout(v),n||avpw$("#avpw_controls").addClass("avpw_content_transition"),v=t.setTimeout(function(){n||avpw$("#avpw_controls").removeClass("avpw_content_transition"),e?(a.changePage(),avpw$("#avpw_tool_options_container").find("#avpw_all_effects").hide(),avpw$("#avpw_tool_options_container").find("#avpw_up_one_level").show(),avpw$("#avpw_controls").addClass("avpw_content_items_mode")):(r&&r.onBackButtonClicked&&r.onBackButtonClicked.call(this),avpw$("#avpw_breadcrumb_toolname").html(g),o.changePage(),avpw$("#avpw_controls").removeClass("avpw_content_items_mode"),avpw$("#avpw_tool_options_container").find("#avpw_all_effects").show(),avpw$("#avpw_tool_options_container").find("#avpw_up_one_level").hide(),_()),i&&i.call(this)},n?0:x)},y=function(o){if(m=o){var i=m.title||m.displayName;avpw$("#avpw_breadcrumb_toolname").html(i)}var n=r.itemWidth||81,s=r.itemsPerPage,l=n*s,c=o.items.length,d=h.find(".avpw_scroll_strip");d.css({width:c*n+"px",paddingRight:l+"px"}),d.removeClass("avpw_page_mode_built"),a=new e.Pager({leftArrow:h.find(".avpw_prev"),rightArrow:h.find(".avpw_next"),itemCount:c,itemsPerPage:s,pageWidth:l,pageContainer:d,itemBuilder:function(t){var r=o.items[t];return u(r,t,e.util.getSafeAssetBaseURL(o.assetsBaseURL))},onPageBuilt:function(){r.onItemsOpen&&r.onItemsOpen.call(this),t.setTimeout(function(){d.addClass("avpw_page_mode_built")},x)}})};return d.openPackItemsByIndex=function(e){_(),f=p.find(".avpw_scroll_strip").children().eq(e);var t=s[n[e].identifier];y(t),f.addClass("avpw_selected_pack"),f.css({left:0}),w(!0)},d.getCurrentPackId=function(){return"undefined"!=typeof m?m.identifier:null},d.destroy=function(){a&&a.shutdown(),o&&o.shutdown(),avpw$("#avpw_tool_options_container").find("#avpw_all_effects").show(),avpw$("#avpw_tool_options_container").find("#avpw_up_one_level").hide(),m=null,i.undelegate(".avpw_pack_icon","click"),i.undelegate(".avpw_selected_pack","click"),c.off("layout:resize",d.build),avpw$("#avpw_tool_options_container").undelegate("#avpw_up_one_level","click")},c.on("layout:resize",d.build),d},e.PacksAndItems=function(r){var o=r.browser,a=r.packBrowser,i=r.pager,n=r.packPager,s=r.buildPacksHTML,l=r.buildPackItemsHTML,u=r.currentPack,c=e.support.getVendorProperty("transition"),d=this,p=function(e,r){var o="avpw_back_button_hidden",a=100,i=avpw$("#avpw_all_effects"),n=avpw$("#avpw_up_one_level"),s=function(s){e?(n.text(e),r&&n.bind("click",r),i.hide(),s?n.show():(n.addClass(o),n.show(),t.setTimeout(function(){n.removeClass(o)},a))):(n.unbind("click"),n.hide(),s?i.show():(i.addClass(o),i.show(),t.setTimeout(function(){i.removeClass(o)},a)))};i.is(":visible")?(i.addClass(o),t.setTimeout(function(){s(),i.removeClass("hidden")},a)):n.is(":visible")?(n.addClass(o),t.setTimeout(function(){s(),n.removeClass(o)},a)):s(!0)},h=function(e){u!==e&&(u=e||u)},f=function(r){if(a.find(".avpw_pack_icon_selected").removeClass("avpw_pack_icon_selected"),avpw$(r).addClass("avpw_pack_icon_selected"),c){var i=e.support.getVendorProperty("transform"),s=e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"getDims"),u=s.INNER_BROWSER_WIDTH+"px";o[0].style[i]="translateX("+u+")",o.addClass("avpw_transition_to_pack_contents"),o.show(),t.setTimeout(function(){var i=e.support.getVendorProperty("transform");r.style[i]="translateX("+u+")",avpw$(r).removeClass("avpw_pack_icon_selected"),t.setTimeout(function(){a.hide(),n&&(n.shutdown(),n=null),l&&l(),t.setTimeout(function(){o.removeClass("avpw_transition_to_pack_contents")},200)},600)},100)}else a.hide(),n&&(n.shutdown(),n=null),l&&l(),o.show()},m=function(){if(c){var r=e.support.getVendorProperty("transform"),n=e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"getDims"),l=n.INNER_BROWSER_WIDTH+"px";o[0].style[r]="translateX("+l+")",t.setTimeout(function(){i&&(i.shutdown(),i=null),p(),s&&s(),a.show()},400)}else i&&(i.shutdown(),i=null),p(),s&&s(),a.show()},g=function(e){return d.onBackButtonClicked(),m(),!1};return d.onPackClicked=function(t){var r=t.currentTarget,o=avpw$(r).data("pack");return h(o),p(e.getLocalizedString("Back"),g),f(r),!1},d.onPackInfoClicked=function(t){var r=t.currentTarget;_packOfInterest=r;var o=avpw$(r).data("pack");return e.controlsWidgetInstance.assetManager.showAssetPurchaseView(o,d.onPurchaseButtonClicked),!1},d.onBackButtonClicked=function(){},d.onPurchaseButtonClicked=function(e){},d.getCurrentPack=function(){return u},d.setCurrentPack=function(e){h(e)},d.getPackOfInterest=function(){return _packOfInterest},d.updateCancelButton=p,d},function(o){o.fn.slider=function(a){a=e.util.extend({max:100,min:0,value:50},a);var i,n=0,s=n,l=0,u=null,c=null,d=!1,p=null,h=this,f=null,m=0,g=null,v=function(e){var t=l!==n?(e-n)/(l-n):0;return t},_=function(e){var t=n+e*(l-n);return parseFloat(t.toFixed(5))},x=function(e){var t;e?(i=i||h.outerWidth()||1,t=e-h.offset().left,t/=i,t=t>1?1:t,t=0>t?0:t,s=_(t)):t=v(s),c.length&&(d?t>.5?c.css({left:"50%",width:100*(t-.5)+"%"}):c.css({left:100*t+"%",width:100*(.5-t)+"%"}):c.css({left:"0",width:100*t+"%"})),u.css("left",100*t+"%")},w=function(e,t){switch(e){case"value":if(arguments.length<1)return s;s=t,x();break;case"destroy":D()}},y=function(e){h.trigger("slidestart",[e]),m&&(g=null,f=t.setInterval(function(){g&&(h.trigger("slide",[g]),g=null)},m))},b=function(e){h.trigger("slidechange",[e]),m&&t.clearInterval(f)},M=function(e){return o(r).bind("mousemove",C).bind("mouseup blur",T),y({value:s}),!1},C=function(t){var r=e.util.getTouch(t);x(r?r.pageX:t.pageX);var o={value:s};m?g=o:h.trigger("slide",[o])},T=function(e){return o(r).unbind("mousemove",C).unbind("mouseup blur",T),b({value:s}),!1},S=function(e){return u.parent().bind("touchmove",C).bind("touchend",A),y({value:s}),!1},A=function(e){return u.parent().unbind("touchmove",C).unbind("touchend",A),b({value:s}),!1},E=function(t){var r=e.util.getTouch(t);x(r?r.pageX:t.pageX);var o={value:s};h.trigger("slidechange",[o])},P=function(){s=a.value,n=a.min,l=a.max,c=h.find(".avpw_slider_goo").eq(0),d=!!h.find(".avpw_slider_divider").length,u=h.find("a").eq(0),p=h.parents(".avpw_isa_slider_container"),a.delay&&(m=a.delay),p.length&&(p.bind("mousedown",M),m?p.bind("mousedown",E):p.bind("click",E),o.support.touch&&(p.bind("touchstart",S),m&&p.bind("touchstart",E))),o.support.touch&&u.bind("touchstart",S),u.bind("mousedown",M)},D=function(){u.unbind("mousedown mouseup blur touchstart"),p.length&&(p.unbind("mousedown",E).unbind("mousedown",M).unbind("touchstart",E).unbind("touchstart",S).unbind("click",E),p=null),c=null,u=null,t.clearInterval(f),f=null,m=0,g=null};return P(),h.slider=w,h}}(avpw_jQuery),function(e,t){e.fn.pressed=function(t){var r=function(r){
var a=e(this);return a.addClass(t),a.bind("mouseup mouseout touchend",o),!0},o=function(r){var a=e(this);return a.removeClass(t),a.unbind("mouseup mouseout touchend",o),!0};return this.bind("mousedown touchstart",r),this}}(avpw_jQuery,t),function(e,r){var o,a;!function(){for(var e=0,r=["webkit","moz"],i=0;i<r.length&&!o;++i)o=t[r[i]+"RequestAnimationFrame"],a=t[r[i]+"CancelAnimationFrame"]||t[r[i]+"CancelRequestAnimationFrame"];o||(o=function(r,o){var a=(new Date).getTime(),i=Math.max(0,16-(a-e)),n=t.setTimeout(function(){r(a+i)},i);return e=a+i,n}),a||(a=function(e){clearTimeout(e)})}(o,a)}(avpw_jQuery,t),e.ControlsWidget.prototype.layout.aviary=function(){var o,a,i,n,s,l,u,d,p,h,f="fullscreen",m=!1,g={TITLE_HEIGHT:30,HEADER_HEIGHT:108,FOOTER_HEIGHT:35,MINIMUM_WIDGET_HEIGHT:396,MODE_ACTION_WIDTH:119,BOOKEND_WIDTH:48,INNER_BOOKEND_WIDTH:40,CANVAS_MARGIN:0,CANVAS_PADDING:10,MINIMUM_WIDGET_WIDTH:712,TOOL_ICON_WIDTH:70,PRESET_ICON_WIDTH:54,PRESET_CROP_ICON_WIDTH:82,GENERIC_LEAD_IN_WIDTH:10,BORDER_ICON_WIDTH:85,STICKER_ICON_WIDTH:80,STICKER_ROLL_WIDTH:80,FILTER_IMAGE_WIDTH:81,FILTER_CANISTER_WIDTH:63,FILTER_LEAD_IN_WIDTH:93,TEXT_ADD_TEXT_BUTTON_WIDTH:121,CANVAS_HEIGHT:void 0,CANVAS_WIDTH:void 0,TOOLS_BROWSER_WIDTH:void 0,INNER_BROWSER_WIDTH:void 0,TOOL_CONTAINER_WIDTH:void 0},v={},_=function(){var e=avpw$("#avpw_controls"),t=e.width(),r=e.height();(!t||t<g.MINIMUM_WIDGET_WIDTH)&&(t=g.MINIMUM_WIDGET_WIDTH),(!r||r<g.MINIMUM_WIDGET_HEIGHT)&&(r=g.MINIMUM_WIDGET_HEIGHT),g.CANVAS_HEIGHT=r-(g.TITLE_HEIGHT+g.HEADER_HEIGHT+g.FOOTER_HEIGHT),g.CANVAS_WIDTH=t-2*g.CANVAS_MARGIN,g.TOOL_CONTAINER_WIDTH=t-2*g.MODE_ACTION_WIDTH,g.TOOLS_BROWSER_WIDTH=t-(2*g.BOOKEND_WIDTH+g.MODE_ACTION_WIDTH),g.INNER_BROWSER_WIDTH=g.TOOL_CONTAINER_WIDTH-(2*g.INNER_BOOKEND_WIDTH+2+g.GENERIC_LEAD_IN_WIDTH)},x=function(){var t=v.getEmbedElement(),r=e.support.getVendorProperty("transform");r&&(a=avpw$(e.template[e.launchData.layout].zoomControls()),t.append(a),a.delegate("#avpw_zoom_button","mousedown",function(){return a.hasClass("avpw_zoom_open")?v.disableZoomMode():v.enableZoomMode(),!1}),i=avpw$(e.template[e.launchData.layout].zoomModeOverlay()),avpw$("#avpw_tool_content_wrapper").append(i).bind("click",v.disableZoomMode),i.bind("click",v.disableZoomMode),v.showZoomButton()),t.append(e.template[e.launchData.layout].canvasControls())},w=function(t){var r;t?(r=e.util.getUserFriendlyToolName(t),r=e.getLocalizedString(r),avpw$("#avpw_breadcrumb_header").hide(),avpw$("#avpw_breadcrumb_toolname").html(r),e.controlsWidgetInstance&&e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"updateUndoRedo",[!1,!1]),m=!0):(avpw$("#avpw_breadcrumb_header").show(),avpw$("#avpw_breadcrumb_toolname").html(""),m=!1,e.controlsWidgetInstance&&e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"updateUndoRedo",[e.paintWidgetInstance.actions.canUndo(),e.paintWidgetInstance.actions.canRedo()]))},y=function(e){e&&v.getCanvasControlsElement().css({top:e.y0+g.CANVAS_PADDING+"px",left:e.x0+g.CANVAS_PADDING+"px",width:e.w+"px",height:e.h+"px"})};return v.getDims=function(){return g},v.onClose=function(t){var r=e.launchData.closeDelay;"fullscreen"===f&&(t||0===r?avpw$("#avpw_fullscreen_bg").hide():avpw$("#avpw_fullscreen_bg").fadeOut(r)),e.launchData.noCloseButton||(t||0===r?avpw$("#avpw_control_cancel_pane").hide():avpw$("#avpw_control_cancel_pane").fadeOut(r))},v.onShutdown=function(){c.off("layout:resize",_),c.off("layout:resize",v.scaleCanvas),c.off("layout:scaleCanvas",v.scaleCanvas),c.off("tool:open",w),c.off("tool:close",w),o&&(o.shutdown(),o=null),a&&(a.undelegate().detach().remove(),a=null),i&&(i.unbind().detach().remove(),i=null),avpw$("#avpw_tool_content_wrapper").unbind("click",v.disableZoomMode);var e=v.getEmbedElement();avpw$(e).children().remove(),avpw$(e).hide(),l=u=void 0,d=p=void 0,h=void 0},v.getToolsPerPage=function(){return g.TOOLS_BROWSER_WIDTH/g.TOOL_ICON_WIDTH|0},v.getPresetsPerPage=function(){return g.INNER_BROWSER_WIDTH/g.PRESET_ICON_WIDTH|0},v.getCropPresetsPerPage=function(){return g.INNER_BROWSER_WIDTH/g.PRESET_CROP_ICON_WIDTH|0},v.getBordersPerPage=function(){return g.INNER_BROWSER_WIDTH/g.BORDER_ICON_WIDTH|0},v.getStickersPerPage=function(){return g.INNER_BROWSER_WIDTH/g.STICKER_ICON_WIDTH|0},v.getStickerPacksPerPage=function(){return g.INNER_BROWSER_WIDTH/g.STICKER_ROLL_WIDTH|0},v.getFiltersPerPage=function(){return g.INNER_BROWSER_WIDTH/g.FILTER_IMAGE_WIDTH|0},v.getFilterPacksPerPage=function(){return g.INNER_BROWSER_WIDTH/g.FILTER_CANISTER_WIDTH|0},v.getEmbedElement=function(e){return avpw$("#avpw_canvas_embed")},v.getCanvasControlsElement=function(){return h=h||avpw$("#avpw_canvas_controls_layer")},v.getMaxDims=function(){return{width:g.CANVAS_WIDTH-2*g.CANVAS_PADDING,height:g.CANVAS_HEIGHT-2*g.CANVAS_PADDING}},v.getScaledImageDims=function(t){var r,o,a,i=v.getMaxDims();return t&&(r=e.util.getScaledDims(t.width,t.height,i.width,i.height),o=r.width,a=r.height,avpw$(t).css({width:o+"px",height:a+"px",marginLeft:"-"+(o/2|0)+"px",marginTop:"-"+(a/2|0)+"px"})),r||i},v.placeControls=function(t){var r=e.launchData.closeDelay;f=t?"embed":"fullscreen";var o=avpw$("#avpw_holder");o.addClass("avpw_is_"+f),"embed"===f?(o.detach(),t=e.util.getImageElem(t),o.appendTo(t)):0===r?avpw$("#avpw_fullscreen_bg").show():avpw$("#avpw_fullscreen_bg").fadeIn(r),_(),e.launchData.noCloseButton||(0===r?avpw$("#avpw_control_cancel_pane").show():avpw$("#avpw_control_cancel_pane").fadeIn(r)),avpw$("#avpw_up_one_level").hide(),x()},v.showCanvasControlsElement=function(){v.getCanvasControlsElement().addClass("avpw_canvas_controls_ready")},v.hideCanvasControlsElement=function(){v.getCanvasControlsElement().removeClass("avpw_canvas_controls_ready")},v.disableControls=function(r){var o=avpw$("#avpw_messaging");r?o.show():t.setTimeout(function(){o.show()},400),e.util.nextFrame(function(){o.addClass("avpw_messaging_confirmation"),avpw$("#avpw_tool_content_wrapper").addClass("avpw_disabled_outer_container")})},v.enableControls=function(e){var r=avpw$("#avpw_messaging");r.removeClass("avpw_messaging_confirmation"),avpw$("#avpw_tool_content_wrapper").removeClass("avpw_disabled_outer_container"),t.setTimeout(function(){r.hide()},400)},v.scaleCanvas=function(t,r){var o=v.getMaxDims();t=t||o.width,r=r||o.height,e.controlsWidgetInstance.canvasUI&&e.controlsWidgetInstance.canvasUI.viewport.fitLayout(t,r),v.setZoom()},v.updateImageScaledIndicator=function(){var t;e.paintWidgetInstance?e.controlsWidgetInstance.imageSizeTracker.isDisplayingImageSize(e.launchData)&&(t=e.paintWidgetInstance.getScaledSize(),avpw$("#avpw_size_indicator").html((t.hiresWidth||t.width)+" x "+(t.hiresHeight||t.height))):avpw$("#avpw_size_indicator").html("")},v.setZoom=function(){var t,a=e.support.getVendorProperty("transform");a&&(t=e.controlsWidgetInstance.canvasUI?1/e.controlsWidgetInstance.canvasUI.viewport.getRatio():1,o&&(o.shutdown(),o=null),o=new e.controlsWidgetInstance.Slider({element:r.getElementById("avpw_zoom_slider"),min:t,max:1.5,defaultValue:t,onslide:function(t,r){e.controlsWidgetInstance.canvasUI.viewport.zoomByRatio(r.value)},onchange:function(t,r){e.controlsWidgetInstance.canvasUI.viewport.zoomByRatio(r.value)}}),o.reset(),o.addListeners())},v.enableZoomMode=function(){var t=e.controlsWidgetInstance;if(a){a.addClass("avpw_zoom_open"),t.canvasUI&&t.canvasUI.enablePan();var r=t.toolManager.notify(t.toolManager.getActiveTool(),"onEnableZoomMode");r||i.addClass("avpw_zoom_open")}},v.disableZoomMode=function(t){var r=e.controlsWidgetInstance;a&&(a.removeClass("avpw_zoom_open"),r.toolManager.notify(r.toolManager.getActiveTool(),"onDisableZoomMode"),i.removeClass("avpw_zoom_open"))},v.showZoomButton=function(){a&&(s&&(t.clearTimeout(s),s=null),a.show(),n=t.setTimeout(function(){a.addClass("avpw_zoom_visible")},100))},v.hideZoomButton=function(){a&&(n&&(t.clearTimeout(n),n=null),a.removeClass("avpw_zoom_visible"),s=t.setTimeout(function(){a.hide()},200))},v.updateUndoRedo=function(e,t){m||(l=l||avpw$("#avpw_history_undo"),u=u||avpw$("#avpw_history_redo"),d=d||avpw$("#avpw_history_undo_blocker"),p=p||avpw$("#avpw_history_redo_blocker"),e?(l.removeClass("avpw_history_disabled"),d.hide()):(l.addClass("avpw_history_disabled"),d.show()),t?(u.removeClass("avpw_history_disabled"),p.hide()):(u.addClass("avpw_history_disabled"),p.show()))},v.showView=function(e,t){var r;return function(o,a){var i=200,n=t.getElementById("avpw_tool_main_container"),s=t.getElementById("avpw_tool_options_container"),l=avpw$("#avpw_controls");switch(r&&(e.clearTimeout(r),r=void 0),o){case"editpanel":l.removeClass("avpw_main_mode"),r=e.setTimeout(function(){n.style.display="none",s.style.display="block",l.addClass("avpw_editpanel_mode")},i);break;case"main":l.removeClass("avpw_editpanel_mode"),r=e.setTimeout(function(){s.style.display="none",n.style.display="block",l.addClass("avpw_main_mode")},i)}}}(t,r),v.bindEvents=function(){c.on("layout:resize",_),c.on("layout:resize",v.scaleCanvas),c.on("layout:scaleCanvas",v.scaleCanvas),c.on("canvas:resize",y),c.on("tool:open",w),c.on("tool:close",w)},v.bindEvents(),v}(),e.ControlsWidget.prototype.bindControls=function(){var r=this;avpw$(t).bind("resize",this.windowResized),avpw$("#avpw_controls").bind("mousedown",function(e){var t=e.target.tagName.toLowerCase();"input"!=t&&"textarea"!=t&&"object"!=t&&e.preventDefault()}),avpw$(".avpw_button").pressed("avpw_button_down"),avpw$(".avpw_tool_icon").pressed("avpw_tool_icon_down"),avpw$(".avpw_checkmark_button .avpw_inset_button").pressed("avpw_inset_button_down"),d(avpw$("#avpw_save_button","#avpw_tool_main_container"),this.onSaveButtonClicked.AV_bindInst(this)),avpw$("#avpw_control_cancel_pane_inner").click(this.cancel.AV_bindInst(this)),avpw$("#avpw_control_main_scrolling_region").delegate(".avpw_tool_icon","click",function(){return c.trigger("tool:open",avpw$(this).data("toolname"),this),!1}),avpw$("#avpw_resume_editing").click(function(){return r.messager.hide("avpw_aviary_quitareyousure"),!1}),avpw$("#avpw_close_feedbackok").click(function(){return c.trigger("modal:hide","avpw_aviary_aviaryfeedback"),!1}),avpw$("#avpw_resume_aftersave").click(function(){return r.messager.hide("avpw_aviary_beensaved"),!1}),avpw$("#avpw_close_aftersave").click(function(){return r.cancel.AV_bindInst(r)(),r.messager.hide("avpw_aviary_beensaved"),!1});var o=function(){return r.toolsPager.changePage(!0),c.trigger("tool:close"),!1};d(avpw$("#avpw_all_effects","#avpw_tool_options_container"),function(){return r.paintWidget.actions.truncate(),c.trigger("tool:cancel"),o()}),c.on("tool:commitDone",o),d(avpw$("#avpw_apply_container"),function(){return e.util.nextFrame(function(){c.trigger("tool:commit")}),!1}),avpw$("#avpw_close_save").click(function(){return r.messager.hide("avpw_aviary_quitareyousure",r.onSaveButtonClicked.AV_bindInst(r)),!1}),avpw$("#avpw_close_nosave").click(function(){return e.paintWidgetCloser(),!1}),avpw$("#avpw_close_unsupported").click(function(){return e.paintWidgetCloser(),!1}),avpw$("#avpw_close_forcecrop_close").click(function(){return e.paintWidgetCloser(),!1}),avpw$("#avpw_history_undo").click(function(){c.trigger("tool:undo")}),avpw$("#avpw_history_redo").click(function(){c.trigger("tool:redo")}),avpw$(".avpw_prev").bind("mousedown",function(){avpw$(this).addClass("avpw_prev_down")}).bind("mouseup mouseout",function(){avpw$(this).removeClass("avpw_prev_down")}),avpw$(".avpw_next").bind("mousedown",function(){avpw$(this).addClass("avpw_next_down")}).bind("mouseup mouseout",function(){avpw$(this).removeClass("avpw_next_down")}),c.on("showWaitThrobber",this.showWaitThrobber.AV_bindInst(this))},e.ControlsWidget.prototype.unbindControls=function(){c.off("showWaitThrobber",this.showWaitThrobber.AV_bindInst(this)),avpw$(t).unbind("resize",this.windowResized),avpw$("#avpw_controls").unbind("mousedown"),avpw$(".avpw_button").unbind("mousedown"),avpw$(".avpw_tool_icon").unbind("mousedown"),avpw$(".avpw_checkmark_button .avpw_inset_button").unbind("mousedown"),avpw$("#avpw_save_button").unbind("click"),avpw$("#avpw_control_cancel_pane_inner").unbind("click"),avpw$("#avpw_control_main_scrolling_region").undelegate(".avpw_tool_icon","click"),avpw$("#avpw_resume_editing").unbind(),avpw$("#avpw_tool_options_container").undelegate("#avpw_all_effects","click"),c.off("tool:commitDone"),avpw$("#avpw_changes_resume").unbind("click"),avpw$("#avpw_changes_discard").unbind("click"),avpw$("#avpw_close_nosave").unbind(),avpw$("#avpw_close_save").unbind(),avpw$("#avpw_close_unsupported").unbind(),avpw$("#avpw_close_forcecrop_close").unbind(),avpw$("#avpw_resume_aftersave").unbind("click"),avpw$("#avpw_close_aftersave").unbind("click"),avpw$("#avpw_history_undo").unbind("click"),avpw$("#avpw_history_redo").unbind("click"),avpw$(".avpw_prev").unbind("mousedown").unbind("mouseup"),avpw$(".avpw_next").unbind("mousedown").unbind("mouseup"),this.brushPreview&&this.brushPreview.destroy()},e.ControlsWidget.prototype.brushPreview=function(t){var r,o,a,i,n=100,s=1e3,l=400,u={},c=function(){r=avpw$(e.template[e.launchData.layout].brushPreviewOverlay()),o=r.find(".avpw_brush_preview_display"),avpw$("#avpw_controls").append(r)};return u.show=function(u,d){r&&r.length||c(),d?e.controlsWidgetInstance._drawUICircle(o,u,d,d):e.controlsWidgetInstance._drawUICircle(o,u,"#fff"),r.removeClass("avpw_brush_preview_visible"),r.removeClass("avpw_brush_preview_fadeout"),r.show(),t.clearTimeout(a),t.clearTimeout(i),e.util.nextFrame(function(){r.addClass("avpw_brush_preview_visible"),a=t.setTimeout(function(){r.removeClass("avpw_brush_preview_visible"),r.addClass("avpw_brush_preview_fadeout")},n+s),i=t.setTimeout(function(){r.hide()},n+s+l)})},u.destroy=function(){t.clearTimeout(a),t.clearTimeout(i),r&&r.length&&r.remove(),r=null,o=null,a=i=null},u}(t),o.prototype.init=function(e){this.controls=e},o.prototype.panelWillOpen=function(){this.settings=e.util.extend({},this.config.defaultSettings),this.currentMode=Object.keys(this.config.defaultSettings)[0],this.$container=avpw$(this.config.containerID),this.paintModule=this.controls.paintWidget.module[this.config.paintWidgetModuleName];var t={element:this.$container.find(this.config.sliderID),min:-100,max:100,defaultValue:0,onchange:this.onSliderChange.AV_bindInst(this)};e.featherGLEnabled&&(t.onslide=this.onSliderChange.AV_bindInst(this)),this.slider=new this.controls.Slider(t),this.slider.setValue(this.settings[this.currentMode]),this.addListeners(),this.$container.find(".avpw_inset_button_down").removeClass("avpw_inset_button_down"),this.$container.find(".avpw_inset_button").first().addClass("avpw_inset_button_down")},o.prototype.addListeners=function(){avpw$(".avpw_inset_button",this.$container).on("click",this.onModeChange.AV_bindInst(this)),this.slider&&this.slider.addListeners()},o.prototype.removeListeners=function(){avpw$(".avpw_inset_button",this.$container).off("click"),this.slider&&this.slider.removeListeners()},o.prototype.panelDidOpen=function(){},o.prototype.panelWillClose=function(){this.removeListeners()},o.prototype.shutdown=function(){this.removeListeners()},o.prototype.onSliderChange=function(e,t){this.settings[this.currentMode]=t.value,this.applyPreview()},o.prototype.onModeChange=function(t){var r=avpw$(t.currentTarget);this.$container.find(".avpw_inset_button_down").removeClass("avpw_inset_button_down"),r.addClass("avpw_inset_button_down"),this.currentMode=r.data("mode");var o=e.getLocalizedString("Adjust")+" - "+(this.currentMode.substring(0,1).toUpperCase()+this.currentMode.substring(1));avpw$("#avpw_breadcrumb_toolname").html(o),"undefined"==typeof this.settings[this.currentMode],this.slider.setValue(this.settings[this.currentMode])},o.prototype.commit=function(){this.paintModule.commit()};var p=new o({paintWidgetModuleName:"adjust",containerID:"#avpw_controlpanel_adjust",sliderID:"#avpw_adjust_slider",defaultSettings:{brightness:0,exposure:0,contrast:0,shadows:0,highlights:0,saturation:0,vibrance:0,warmth:0,tint:0,fade:0}});p.applyPreview=function(){var e=!1;for(var t in this.settings)if(0!==this.settings[t]){e=!0;break}return e?void this.paintModule.applyPreview(this.settings.brightness,this.settings.exposure,this.settings.contrast,this.settings.shadows,this.settings.highlights,this.settings.saturation,this.settings.vibrance,this.settings.warmth,this.settings.tint,this.settings.fade):!1},e.ControlsWidget.prototype.tool.adjust=p,e.ControlsWidget.prototype.tool.colorsplash=function(){"use strict";var t,o,a,i,n,s,l,u,d,p=(e.toolDefaults.colorsplash.presets,{}),h=18,f=3,m=h,g=h*f,v="free",_=0,x=7,w=g+2*x,y={smart:{IS_FREE_HAND:!1,SIGMA_COLOR:10,REVERSE:0},free:{IS_FREE_HAND:!0,SIGMA_COLOR:99999999,REVERSE:0},erase:{IS_FREE_HAND:!0,SIGMA_COLOR:99999999,REVERSE:1}},b=function(){u=r.createElement("div"),u.className="avpw_colorsplash_brush",d=r.createElement("canvas"),w=g+2*x,d.width=150,d.height=150,u.appendChild(d),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").append(u),avpw$(d).css({marginTop:-(w/2)+"px",marginLeft:-(w/2)+"px"})},M=function(){if(!e.featherGLEnabled){var r=t.paintWidget.canvas,o=avpw$(r).clone(),a=r.getContext("2d").getImageData(0,0,r.width,r.height);o[0].getContext("2d").putImageData(a,0,0),o.css({"z-index":1,position:"absolute"}),avpw$(r).after(o),avpw$(o).fadeOut(800,function(){avpw$(this).remove()})}},C=function(){avpw$(u).fadeOut(function(){avpw$(this).remove()})},T=function(e){if(d){d.width=d.width;var t=d.getContext("2d"),r=Math.round(g/2);t.shadowColor="white",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=1,t.lineWidth=5,t.strokeStyle="rgba("+e[0]+","+e[1]+","+e[2]+",1)",t.beginPath(),t.arc(r+x,r+x,r-2,Math.PI,0,!1),t.stroke(),t.lineWidth=2,t.strokeStyle="white",t.beginPath(),t.arc(r+x,r+x,r+2,0,2*Math.PI,!1),t.stroke(),t.lineWidth=2,t.strokeStyle="white",t.beginPath(),t.arc(r+x,r+x,r-5,0,2*Math.PI,!1),t.stroke();var a=o?.35:.7;t.shadowBlur=0,t.lineWidth=2,t.strokeStyle="rgba(0,0,0,"+a+")",t.beginPath(),t.arc(r+x,r+x,r-4,0,2*Math.PI,!1),t.stroke(),t.lineWidth=2,t.strokeStyle="rgba(0,0,0,"+a+")",t.beginPath(),t.arc(r+x,r+x,r+1,0,2*Math.PI,!1),t.stroke()}},S=function(){avpw$(this).addClass("avpw_preset_icon_active").siblings().removeClass("avpw_preset_icon_active");var e=avpw$(this).data("size");g=e*f,m=e,_=h>m?5:0,avpw$(d).css({marginTop:-((g+2*x)/2)+"px",marginLeft:-((g+2*x)/2)+"px"}),w=g+2*x,t.brushPreview.show(1.3*m),T([0,0,0,0])},A=function(){avpw$(".avpw_colorsplash_freebrush,.avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser").not(this).removeClass("avpw_inset_button_down"),avpw$(this).addClass("avpw_inset_button_down");var e;avpw$(this).hasClass("avpw_colorsplash_freebrush")?(v="free",c.trigger("usage:interact","colorsplash","FreeBrushClicked")):avpw$(this).hasClass("avpw_colorsplash_smartbrush")?(v="smart",c.trigger("usage:interact","colorsplash","SmartBrushClicked")):avpw$(this).hasClass("avpw_colorsplash_eraser")&&(v="erase",c.trigger("usage:interact","colorsplash","EraserBrushClicked")),e=E(v),n=e.IS_FREE_HAND,s=e.SIGMA_COLOR,l=e.REVERSE};p.init=function(e){t=e;var r=avpw$("#avpw_controlpanel_colorsplash");r.delegate(".avpw_isa_preset_brush","mousedown",S),r.delegate(".avpw_colorsplash_freebrush,.avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser","mousedown",A)},p.cancel=function(){t.paintWidget.module.colorsplash.reset()},p.panelWillOpen=function(){t.canvasUI&&(t.canvasUI.subscribe(p),t.canvasUI.setMouseCursor("none"),avpw$(".avpw_canvas_background").css("cursor","none")),o=!1},p.panelDidOpen=function(){avpw$(".avpw_colorsplash_smartbrush,.avpw_colorsplash_eraser").removeClass("avpw_inset_button_down"),avpw$(".avpw_colorsplash_freebrush").addClass("avpw_inset_button_down");var r;v="free",r=E(v),n=r.IS_FREE_HAND,s=r.SIGMA_COLOR,l=r.REVERSE,avpw$("#avpw_zoom_container").css("cursor","default"),t.layoutNotify(e.launchData.openType,"showCanvasControlsElement"),b(),M(),t.paintWidget.module.colorsplash.preview(),avpw$(u).hide().fadeIn(),avpw$("#avpw_controlpanel_colorsplash").find(".avpw_isa_preset_brush").eq(2).trigger("mousedown")},p.panelWillClose=function(){t.canvasUI&&t.canvasUI.unsubscribe(p),C(),avpw$(".avpw_canvas_background").css("cursor","default"),t.layoutNotify(e.launchData.openType,"hideCanvasControlsElement")},p.mouseDownEvent=function(r,n,s){if(s){o=!0;var l=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),u=r.canvasControlsX*l+.5|0,c=r.canvasControlsY*l+.5|0,d=m*l;if(a=u,i=c,!(0>u||u>t.paintWidget.width-1||0>c||c>t.paintWidget.height-1||0>a||a>t.paintWidget.width-1||0>i||i>t.paintWidget.height-1))return t.paintWidget.module.colorsplash.createStroke(d,v),t.paintWidget.module.colorsplash.addPoints(u,c),t.paintWidget.module.colorsplash.preview(),!1}},p.mouseMoveEvent=function(r,s){var l=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),c=r.canvasControlsX*l+.5|0,d=r.canvasControlsY*l+.5|0;u&&(avpw$(u).css({top:r.canvasControlsY+"px",left:r.canvasControlsX+"px"}),o&&(n&&(a=c,i=d),t.paintWidget.module.colorsplash.addPoints(c,d),t.paintWidget.module.colorsplash.preview())),(n||!o)&&T(t.paintWidget.module.colorsplash.getColorAtPosition(c,d))},p.mouseUpEvent=function(r,a){var i=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),n=r.canvasControlsX*i,s=r.canvasControlsY*i;return T(t.paintWidget.module.colorsplash.getColorAtPosition(n,s)),o&&(t.paintWidget.module.colorsplash.finishStroke(),o=!1),T(t.paintWidget.module.colorsplash.getColorAtPosition(n,s)),!1},p.mouseOutEvent=function(e,t,r){return!1},p.onEnableZoomMode=function(){return t.canvasUI&&(t.canvasUI.unsubscribe(p),avpw$(u).fadeOut(),avpw$(".avpw_canvas_background").css("cursor","default")),!1},p.onDisableZoomMode=function(){t.canvasUI&&(t.canvasUI.subscribe(p),avpw$(u).fadeIn(),avpw$(".avpw_canvas_background").css("cursor","none"))},p.commit=function(){t.paintWidget.module.colorsplash.commitDrawState()},p.shutdown=function(){avpw$("#avpw_controlpanel_colorsplash").undelegate(),C(),t=null},p.onUndoComplete=function(e){},p.onRedoComplete=function(e){};var E=function(e){return y[e]};return p}(),e.ControlsWidget.prototype.tool.crop=function(){var t,r,o,a,i,n,s,l=null,u=!1,d={},p=!1,h=function(t){var o=r[t];return o?"Custom"===o.label?(p=!0,""):(o.label=e.getLocalizedString(o.label),e.template[e.launchData.layout].cropPreset(o)):""},f=function(e){return e.hasClass("avpw_preset_icon_active")},m=function(e){e.siblings().removeClass("avpw_preset_icon_active avpw_crop_preset_flipped"),e.addClass("avpw_preset_icon_active")},g=function(){var e=t.paintWidget.getScaledSize();t.paintWidget.module.crop.initialDims=e;var r=s.getCropSettings();l?t.paintWidget.module.crop.applyCropAndResize(r.topLeft,r.normWidth,r.aspectRatio,[l.width,l.height]):t.paintWidget.module.crop.applyPreview(r.topLeft,r.normWidth,r.aspectRatio),t.paintWidget.module.crop.commit()},v=function(e){avpw$("#avpw_crop_presets_scroll_region").toggleClass("avpw_crop_all_flipped"),e.parent().children().not(".avpw_preset_icon_disabled").each(function(e,t){if(!avpw$(t).hasClass(".avpw_crop_custom_control")){var o=r[e];if(o){var a,i,n,s,l,u=o.label,c=o.labeled,d=avpw$(t).find(".avpw_label"),p=d.html(),h=o.resize?"x":":";c||(p===u?(a=u.toLowerCase().indexOf(h),-1!=a&&(i=u.substr(0,a),n=u.substr(a+1),s=parseInt(i,10),l=parseInt(n,10),p=l+(u.charAt(a)||h)+s)):p=u,d.html(p),o.flipped=!o.flipped)}}})},_=!1,x=function(o){var a,i,u,c=avpw$(this),d=e.util.findItemByKeyValueFromArray("label",c.data("crop"),r);return c.hasClass("avpw_crop_custom_control")?void y.enableMode(!0):(y.enableMode(!1),e.util.nextFrame(function(){l=null,d&&(d.labeled||d.strict||!f(c)||v(c),d.flipped?(c.addClass("avpw_crop_preset_flipped"),i=d.height,u=d.width):(c.removeClass("avpw_crop_preset_flipped"),i=d.width,u=d.height),d.resize?(l={width:i,height:u},a=t.paintWidget.a2c(i,u,!0),y.enableTooltip(!0),s.setInitialSelectionTo(a.width,a.height),y.enableTooltip(!1)):i&&u&&(y.enableTooltip(!0),s.setInitialSelectionByRatio(i/u)),s.forceAspect(d.constrain),_=d.constrain,n=d.label),m(c)}),!1)},w=function(){i&&i.shutdown(),r=t.populateCropPresets(o);var a=t.layoutNotify(e.launchData.openType,"getDims"),n=a.PRESET_CROP_ICON_WIDTH,s=t.layoutNotify(e.launchData.openType,"getCropPresetsPerPage"),l=n*s,u=r.length+1,c=avpw$("#avpw_crop_presets_scroll_region");c.css({width:(u+s)*n+"px"}),i=new e.Pager({leftArrow:avpw$("#avpw_crop_presets_lftArrow"),rightArrow:avpw$("#avpw_crop_presets_rghtArrow"),itemCount:u,itemsPerPage:s,pageWidth:l,itemBuilder:h,pageContainer:c}),i.changePage(),p&&y.init(c)},y=function(){var r,o,a,i,n,l,u,d,p,h,f={},g=!1,v=!1,x=!1,w=function(t){return e.util.keyDownHandlerNumber.apply(this,[t,function(t){e.util.nextFrame(function(){if(""===t.currentTarget.value)return"width"===t.data.currentProp?r=a.width:o=a.height,b(!0),void S(r,o);p=!0;var e=parseInt(t.currentTarget.value);"width"===t.data.currentProp?e>a.width||1>e?p=!1:r=e:e>a.height||1>e?p=!1:o=e,p?(g&&c.on("tool:crop:change",S),b(!0),g&&c.off("tool:crop:change",S),avpw$(t.currentTarget).removeClass("avpw_invalid_input")):avpw$(t.currentTarget).addClass("avpw_invalid_input")})}])},y=!1,b=function(e,i){e&&(y=!0);var n,l=r||a.width,u=o||a.height;n=i?{width:l,height:u}:t.paintWidget.a2c(l,u,!0),s.setInitialSelectionTo(n.width,n.height),s.forceAspect(g),_=g,y=!1,e||c.trigger("tool:crop:change",r,o,e),h&&(h={width:l,height:u})};f.resetInputs=function(){},f.triggerValidation=function(e){(!p||e)&&(n.trigger("keydown"),l.trigger("keydown"))};var M=function(t){i=avpw$(e.template[e.launchData.layout].cropCustomControl({})),t.prepend(i),n=t.find("#avpw_crop_custom_width"),l=t.find("#avpw_crop_custom_height"),u=t.find("#avpw_crop_custom_lock_dims"),d=t.find(".avpw_crop_lock_group").find("span"),g=!1,n.bind("keydown",{currentProp:"width"},w).bind("focus",function(){return f.enableMode(!0),!1}).bind("blur",function(){f.resetInputs(),f.triggerValidation()}),l.bind("keydown",{currentProp:"height"},w).bind("focus",function(){return f.enableMode(!0),!1}).bind("blur",function(){f.resetInputs(),f.triggerValidation()}),u.change(function(){C(avpw$(this).is(":checked"))}),d.bind("click",function(){u.click()})},C=function(e){g=e,g?(c.off("tool:crop:change",T),c.off("tool:crop:change",S),r||o?n.hasClass("avpw_invalid_input")||l.hasClass("avpw_invalid_input")||(h={width:r,height:o}):h={width:a.hiresWidth||a.width,height:a.hiresHeight||a.height},b(!0,!1)):(c.on("tool:crop:change",T),c.on("tool:crop:change",S),b(!0,!1),h=null)};f.getFixedSize=function(){if(!v)return null;if(h)return h;var e=r,a=o;if(x){var i=t.paintWidget.a2c(e,a,!0);e=i.hiresWidth,a=i.hiresHeight}return{width:e,height:a}};var y,T=function(e,a,i){if(!y){if(x){var s=t.paintWidget.c2a(e,a,!0);e=s.hiresWidth,a=s.hiresHeight}n.val(e),r=e,l.val(a),o=a,p||f.triggerValidation()}},S=function(a,i){if(x)if(v)e.util.nextFrame(function(){s.setToolTipValues(r,o)});else{var n=t.paintWidget.c2a(a,i,!1);s.setToolTipValues(Math.floor(n.hiresWidth),Math.floor(n.hiresHeight))}else s.setToolTipValues(a,i)};return f.init=function(e){M(e),c.on("tool:crop:change",S),h=null,r=o=void 0},f.enableMode=function(e){e!==v&&(v=e,a=t.paintWidget.getScaledSize(),a.hiresWidth&&a.hiresHeight?(x=!0,a.width=a.hiresWidth,a.height=a.hiresHeight):x=!1,v?(m(i),b(!0),g||c.on("tool:crop:change",T),f.triggerValidation(!0)):(c.off("tool:crop:change",T),c.off("tool:crop:change",S),c.on("tool:crop:change",S),n&&l&&(n.blur(),l.blur()),h=null))},f.enableTooltip=function(e){c.off("tool:crop:change",S),e&&c.on("tool:crop:change",S)},f.focusIn=function(){n.focus()},f.unbindEvents=function(){n&&l&&(n.unbind(),l.unbind())},f.shutdown=function(){f.enableMode(!1),c.off("tool:crop:change",T),c.off("tool:crop:change",S)},f}(),b=function(){w(),s.setInitialSelection()};d.resetUI=function(){t.layoutNotify(e.launchData.openType,"scaleCanvas"),e.util.nextFrame(function(){var e;e=a?avpw$("#avpw_crop_presets_scroll_region").find('.avpw_isa_preset_crop[data-crop="'+a+'"]'):avpw$("#avpw_crop_presets_scroll_region").find('.avpw_isa_preset_crop[data-crop="Custom"]'),e.length?e.trigger("click"):avpw$("#avpw_crop_presets_scroll_region").find(".avpw_isa_preset_crop").eq(0).trigger("click")})},d.init=function(r){t=r,o=e.launchData.cropPresets,"string"==typeof presetsFromConfig&&(o=o.split(",")),a=e.launchData.cropPresetDefault,s=new e.CropController(r,r.paintWidget,!0)},d.shutdown=function(){C(),avpw$("#avpw_controls").removeClass("avpw_crop_mode"),y.enableMode(!1),i&&(i.shutdown(),i=null),l=null,t=null,s=null},d.onRedoComplete=function(){d.resetUI()},d.onUndoComplete=function(){d.resetUI()},d.panelWillOpen=function(){p=!1,l=null,u=!1,t.canvasUI&&t.canvasUI.subscribe(d),t.layoutNotify(e.launchData.openType,"hideZoomButton"),c.on("layout:resize",b),n=void 0,t.canvasUI&&t.canvasUI.viewport.setPadding(25)},d.panelDidOpen=function(){w(),i&&(i.setCurrentPage(0),i.changePage()),s.activate(c),d.resetUI(),avpw$("#avpw_controls").addClass("avpw_crop_mode"),M()};var M=function(){avpw$("#avpw_crop_presets_scroll_region").delegate(".avpw_isa_preset_crop,.avpw_crop_custom_control","click",x),avpw$("#avpw_controls").delegate("#avpw_crop_flip_button","click",function(){v(avpw$("#avpw_crop_presets_scroll_region").find("#avpw_preset_crop_icon").first()),s.flipIt(),s.forceAspect(_)})},C=function(){y.unbindEvents(),avpw$("#avpw_crop_presets_scroll_region").undelegate(".avpw_isa_preset_crop,.avpw_crop_custom_control","click"),avpw$("#avpw_controls").undelegate("#avpw_crop_flip_button","click")};return d.panelWillClose=function(){C(),t.canvasUI&&t.canvasUI.viewport.setPadding(0),c.trigger("layout:resize"),c.off("layout:resize",b),avpw$("#avpw_controls").removeClass("avpw_crop_mode"),y.enableMode(!1),y.shutdown(),t.canvasUI&&t.canvasUI.unsubscribe(d),s&&s.deactivate(),avpw$("#avpw_crop_presets_scroll_region").undelegate(".avpw_isa_preset_crop","click"),i&&(i.shutdown(),i=null),t.layoutNotify(e.launchData.openType,"showZoomButton"),c.off("layout:resize",b)},d.mouseDownEvent=function(e){var t=s.updateUIDown(e.canvasX,e.canvasY);return t&&(u=!0),!1},d.mouseMoveEvent=function(e){return u?(s.updateUIMove(e.canvasX,e.canvasY),!1):void 0},d.mouseUpEvent=function(e){return u?(t.canvasUI.setMouseCursor(),s.apply(e.canvasX,e.canvasY),u=!1,!1):void 0},d.commit=function(){return s.isValidCrop()?(l=y.getFixedSize()||l||null,y.enableMode(!1),g(),n):(y.triggerValidation(!0),y.enableMode(!0),c.trigger("tool:crop:change"),!1)},d.onEnableZoomMode=function(){return t.canvasUI&&t.canvasUI.unsubscribe(d),!1},d.onDisableZoomMode=function(){t.canvasUI&&t.canvasUI.subscribe(d)},d}(),e.ControlsWidget.prototype.tool.drawing=function(){var t,r,o,a,i=e.toolDefaults.drawing.presetsColor,n=!1,s={},l=!1,u="#ffffff",d=function(){var r=1;t.canvasUI&&(r=t.canvasUI.viewport.getRatio());var r=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),a=t.paintWidget.module.drawing.getRadius();if(t.brushPreview){var i="#"+v(o);t.brushPreview.show(a,l?null:i)}},p=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active")},h=function(){l=!1,avpw$(".avpw_colorsplash_eraser").removeClass("avpw_preset_icon_active")},f=function(e){p(),h(),e.addClass("avpw_preset_icon_active")},m=function(e){e.preventDefault();var t=avpw$(this);avpw$("#avpw_drawing_brushes .avpw_preset_icon_active").removeClass("avpw_preset_icon_active"),t.addClass("avpw_preset_icon_active");var r=t.data("size");a=r,g(r),d()},g=function(e){var e=e;t.paintWidget.module.drawing.setRadius(e),c.trigger("canvas:setBrushSize",e)},v=function(e){var t,r,o=[e.r.toString(16),e.g.toString(16),e.b.toString(16)],a=o.length;for(t=0;a>t;t++)r=o[t],1===r.length&&(o[t]="0"+r);return o.join("")},_=function(e){return e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16),{r:e>>16,g:(65280&e)>>8,b:255&e,a:255}},x=function(e){if(h(),e&&e.indexOf&&0===e.indexOf("#"))o=_(e);else{var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");o={r:parseInt(t[0]),g:parseInt(t[1]),b:parseInt(t[2]),a:255}}},w=function(e){e.preventDefault();var t=avpw$(this);x(t.data("color")),p(),t.addClass("avpw_preset_icon_active"),d()},y=function(a){a.preventDefault(),a.stopPropagation();var i=a.currentTarget;
p(),avpw$(".avpw_color_picker_dropdown_popup").length&&r.hideColorPicker(),t.layoutNotify(e.launchData.openType,"hideZoomButton"),A(!1),r=e.buildColorPicker(v(o),i,function(e,t){x(e),t||d()},function(){t.canvasUI&&t.canvasUI.subscribe(s),A(!0),t.layoutNotify(e.launchData.openType,"showZoomButton")}),t.canvasUI&&t.canvasUI.unsubscribe(s)},b=function(e){e.preventDefault(),f(avpw$(this)),l=!0,d()},M=function(){avpw$(".avpw_isa_preset_brush","#avpw_drawing_brushes").on("mousedown touchstart",m),avpw$(".avpw_isa_preset_color","#avpw_drawing_colors").on("mousedown touchstart",w),avpw$(".avpw_colorsplash_eraser","#avpw_controlpanel_drawing").on("mousedown touchstart",b),avpw$(".avpw_isa_color_picker","#avpw_controlpanel_drawing").on("click",y)},C=function(){c.off("canvas:resize",S),avpw$(".avpw_isa_preset_brush","#avpw_drawing_brushes").off("mousedown touchstart",m),avpw$(".avpw_isa_preset_color","#avpw_drawing_colors").off("mousedown touchstart",w),avpw$(".avpw_colorsplash_eraser","#avpw_controlpanel_drawing").off("mousedown touchstart",b),avpw$(".avpw_isa_color_picker","#avpw_controlpanel_drawing").off("mousedown touchstart",y)},T=function(){var t,r,o=i.length,a="";for(t=0;o>t;t++)r={color:i[t]},a+=e.template[e.launchData.layout].brushColorIcon(r);avpw$("#avpw_drawing_colors").html(a)};s.init=function(e){t=e};var S=function(){g(a)};s.panelWillOpen=function(){c.on("canvas:resize",S),o=_(u),l=!1,A(!0),n=!1,T(),M(),t.canvasUI&&(t.canvasUI.subscribe(s),t.canvasUI.setMouseCursor("none")),avpw$.miniColors&&(e.miniColors=new avpw$.miniColors)},s.panelDidOpen=function(){e.util.nextFrame(function(){avpw$("#avpw_drawing_brushes").find(".avpw_isa_preset_brush").eq(0).trigger("mousedown"),avpw$("#avpw_drawing_brushes").find(".avpw_isa_preset_brush").eq(0).trigger("touchdown"),avpw$("#avpw_drawing_colors").find(".avpw_isa_preset_color").eq(2).trigger("mousedown"),avpw$("#avpw_drawing_colors").find(".avpw_isa_preset_color").eq(2).trigger("touchdown")})};var A=function(e){e?avpw$("#avpw_canvas_controls_layer").addClass("avpw_legacy_draw_mode"):avpw$("#avpw_canvas_controls_layer").removeClass("avpw_legacy_draw_mode")};s.panelWillClose=function(){A(!1),C(),t.canvasUI&&(t.canvasUI.unsubscribe(s),t.canvasUI.setMouseCursor()),r&&r.hideColorPicker(),r=null,e.miniColors=null},s.shutdown=function(){C(),t=null,c.trigger("canvas:shutdownBrushCursor")},s.commit=function(){t.paintWidget.module.drawing.commitDrawState()},s.cancel=function(){s.reset()},s.reset=function(){t.paintWidget.module.drawing.reset(),c.trigger("canvas:hideBrushCursor")};var E=!1,P=function(){E?(e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"showCanvasControlsElement"),c.trigger("canvas:showBrushCursor"),E=!1):(e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"hideCanvasControlsElement"),c.trigger("canvas:hideBrushCursor"))};return s.mouseDownEvent=function(r,a,i){if(!n&&i){n=!0;var s=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),u=t.paintWidget.module.drawing.getRadius()*s,c=r.canvasX,d=r.canvasY;return t.paintWidget.module.drawing.createStroke(u,o,l?"erase":"free",1),t.paintWidget.module.drawing.addPoints(c,d),t.paintWidget.module.drawing.preview(),!1}},s.mouseMoveEvent=function(r){var o=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),a=(t.paintWidget.module.drawing.getRadius()*o,r.canvasX),i=r.canvasY;return c.trigger("canvas:setBrushPosition",a,i),E=!0,P(),n&&(t.paintWidget.module.drawing.addPoints(a,i),t.paintWidget.module.drawing.preview()),!1},s.mouseUpEvent=function(e){n&&(n=!1,t.paintWidget.module.drawing.finishStroke(),t.paintWidget.module.drawing.preview())},s.onEnableZoomMode=function(){return t.canvasUI&&(t.canvasUI.unsubscribe(s),t.canvasUI.setMouseCursor(),c.trigger("canvas:hideBrushCursor"),A(!1)),!1},s.onDisableZoomMode=function(){t.canvasUI&&(t.canvasUI.subscribe(s),t.canvasUI.setMouseCursor(),c.trigger("canvas:showBrushCursor"),A(!0))},s}(),e.ControlsWidget.prototype.tool.effects=function(){"use strict";var t,o,a,i,n,s,l,u,c,d,p="avpw_isa_control_selector_filter",h="avpw_preset_icon_active",f=(Math.floor(4294967295*Math.random()),1),m={},g=function(e){avpw$("."+p).removeClass(h),e&&e.length&&e.addClass(h)},v=function(){t.showWaitThrobber(!e.featherGLEnabled);var r;if(n){r=n.data("filtername");var o=t.paintWidget.filterManager.getEffectById(r),a={pack:o.packIdentifier,item:o.identifier};t.paintWidget.resourceProvider.saveResource(a.pack,a.item,o.processors),e.util.nextFrame(function(){t.paintWidget.module.effects.applyPreview(a,f),t.showWaitThrobber(!1)})}},_=function(){if(e.featherGLEnabled){var r=e.util.moaLite.copyProcessor;o.find(".avpw_isa_previewcanvas").each(function(e,o){var a=r.copy(u),i=avpw$(o).parent().data("filtername");t.paintWidget.module.effects.makeThumb(i,o,a)})}else o.find(".avpw_isa_previewcanvas").each(function(e,r){var o=avpw$(r).parent().data("filtername");t.paintWidget.module.effects.makeThumb(o,r,c)})},x=function(e){f=1;var t=avpw$(e.currentTarget),r=t.data("filtername");if("original"===r)m.cancel(),g();else{var o=!1;t&&n&&t[0]===n[0]&&(w(t.find(".avpw_label").html()),o=!0),n=t,g(t),o||v()}return!1},w=function(e){d=avpw$("#avpw_breadcrumb_toolname").html(),avpw$("#avpw_breadcrumb_toolname").html(e),f=1,l.setValue(f),s.fadeIn(100)},y=function(t){var r=t.displayName,o=t.identifier,a=e.featherUseFlash?e.build.feather_baseURL+"images/filters/original.jpg":"";return e.template[e.launchData.layout].filterThumbnail({label:r,id:o,thumburl:a})},b=function(t,r){var o=t.identifier,a=t.displayName,i=t.purchased||!t.needsPurchase,n=e.template[e.launchData.layout][i?"filterCanister":"filterCanisterDisabled"];return n({label:a,id:o,packIndex:r,thumburl:e.util.getSafeAssetBaseURL(t.assetsBaseURL)+t.iconImage})},M=function(){},C=function(){var r=t.layoutNotify(e.launchData.openType,"getDims"),n=r.FILTER_IMAGE_WIDTH,s=i,l=t.paintWidget.filterManager.getPacksById();a=e.ContentBrowser({container:o,packsInOrder:s,packsById:l,buildPackUI:b,buildItem:y,itemWidth:n,onItemsOpen:_,itemsPerPage:t.layoutNotify(e.launchData.openType,"getFiltersPerPage")}),a.build(),o.fadeIn(200)};m.resetUI=function(){},m.init=function(e){t=e,o=avpw$("#avpw_effects_scroller"),o.delegate("."+p,"click",x)},m.panelWillOpen=function(){M(),o&&o.hide(),n=null,s=avpw$("#avpw_controlpanel_effects").find(".avpw_intensity_container"),s.hide(),f=1;var r={element:s.find("#avpw_intensity_slider"),min:0,max:1,defaultValue:1,onchange:function(e,t){f=t.value,v()}};e.featherGLEnabled&&(r.onslide=function(e,t){f=t.value,v()}),l=new t.Slider(r),l.addListeners();var a=avpw$(".avpw_intensity_back_button","#avpw_controlpanel_effects");a.pressed("avpw_button_down").bind("click",T)};var T=function(){avpw$("#avpw_breadcrumb_toolname").html(d),s.fadeOut(100)};return m.panelDidOpen=function(){c=r.createElement("canvas"),c.width=63,c.height=63,t.paintWidget.makeThumbFlat(c);var o=c.getContext("2d");e.featherGLEnabled&&(u=o.getImageData(0,0,c.width,c.height)),t.assetManager.getAssets("EFFECT",function(e){i=e,C()})},m.panelWillClose=function(){a.destroy(),u=null,c=null,avpw$(".avpw_intensity_back_button","#avpw_controlpanel_effects").unbind("click"),l.removeListeners(),l=null,s.hide()},m.panelDidClose=function(){},m.cancel=function(){m.resetUI()},m.commit=function(){return t.paintWidget.module.effects.commit&&t.paintWidget.module.effects.commit(),n&&n.length?n.data("filtername"):void 0},m.onUndo=function(e){e||m.resetUI()},m.onRedo=function(e){e||n&&n.length&&g(n)},m.shutdown=function(){M(),o&&o.length&&o.undelegate("."+p,"click"),t=null,o=null},m}(),e.ControlsWidget.prototype.tool.enhance=function(){var t,r,o=e.toolDefaults.enhance.presets,a={},i=function(e){e.siblings().removeClass("avpw_inset_button_down"),e.addClass("avpw_inset_button_down")},n=function(e){var n,s;return s=avpw$(this),s.hasClass("avpw_inset_button_down")?(s.removeClass("avpw_inset_button_down"),a.cancel()):(i(s),n=o[s.index()],t.showWaitThrobber(!0,function(){t.paintWidget.module.enhance.applyPreview(n,!0),t.showWaitThrobber(!1)}),r=s),!1},s=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").bind("mousedown touchstart",n)},l=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").unbind("mousedown touchstart").removeClass("avpw_inset_button_down")};return a.resetUI=function(){avpw$("#avpw_controlpanel_enhance").find(".avpw_inset_button").removeClass("avpw_inset_button_down"),c.trigger("actions:clear_uncommited_changes")},a.init=function(e){t=e},a.panelWillOpen=function(){r=null},a.panelDidOpen=function(){s()},a.panelWillClose=function(){l()},a.cancel=function(){a.resetUI()},a.commit=function(){return t.paintWidget.module.enhance.commit&&t.paintWidget.module.enhance.commit(),r&&r.length?o[r.index()]:void 0},a.onUndo=function(e){e||a.resetUI()},a.onRedo=function(e){!e&&r&&r.length&&i(r)},a.shutdown=function(){t=null},a}(),e.ControlsWidget.prototype.tool.forcecrop=function(){var t,r,o,a,i,n,s,l=null,u=!1,d={},p=function(){var e=t.paintWidget.getScaledSize();t.paintWidget.module.crop.initialDims=e;var r=s.getCropSettings();l?t.paintWidget.module.crop.applyCropAndResize(r.topLeft,r.normWidth,r.aspectRatio,[l.width,l.height]):t.paintWidget.module.crop.applyPreview(r.topLeft,r.normWidth,r.aspectRatio),t.paintWidget.module.crop.commit(),t.paintWidget.actions.setPreventUndoCheckpoint()},f=!1,m=function(e){l=null,e&&(w=e.width,h=e.height,e.resize?(l={width:w,height:h},_(w,h),c.off("tool:crop:change",_),canvasDims=t.paintWidget.a2c(w,h,!0),s.setInitialSelectionTo(canvasDims.width,canvasDims.height)):(c.on("tool:crop:change",_),w&&h&&s.setInitialSelectionByRatio(w/h)),s.forceAspect(e.constrain),f=e.constrain,n=e.label)},g=function(){x()};d.resetUI=function(){t.layoutNotify(e.launchData.openType,"scaleCanvas")},d.init=function(r){t=r,o=e.launchData.cropPresets,"string"==typeof presetsFromConfig&&(o=o.split(",")),a=e.launchData.cropPresetDefault,s=new e.CropController(r,r.paintWidget)},d.shutdown=function(){i&&(i.shutdown(),i=null),c.off("layout:resize",g),avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_force_crop_mode"),l=null,t=null,s=null},d.onRedoComplete=function(){d.resetUI()},d.onUndoComplete=function(){d.resetUI()},d.panelWillOpen=function(){l=null,u=!1,t.paintWidget.module.crop.activate(t.paintWidget),t.canvasUI&&t.canvasUI.subscribe(d),s.activate(c),t.layoutNotify(e.launchData.openType,"hideZoomButton"),c.on("layout:resize",g),avpw$("#avpw_controls").addClass("avpw_crop_mode avpw_force_crop_mode"),n=void 0};var v;d.panelDidOpen=function(){if(d.resetUI(),r=t.populateCropPresets(e.launchData.forceCropPreset),v=r[0],!v)return void t.messager.show("avpw_aviary_crop_invalid_dimensions",!0);var o=e.launchData.forceCropMessage||e.getLocalizedString("Please crop your photo to");avpw$("#avpw_force_crop_sub_text").html(o),avpw$("#avpw_force_crop_label").html(r[0].label),c.on("tool:crop:change",_),x()};var _=function(e,t){s.setToolTipValues(e,t)},x=function(){m(v)};return d.panelWillClose=function(){c.off("tool:crop:change",_),avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_force_crop_mode"),t.canvasUI&&t.canvasUI.unsubscribe(d),s&&s.deactivate(),t.layoutNotify(e.launchData.openType,"showZoomButton"),c.off("layout:resize",g)},d.mouseDownEvent=function(e){var t=s.updateUIDown(e.canvasX,e.canvasY);return t&&(u=!0),!1},d.mouseMoveEvent=function(e){return u?(s.updateUIMove(e.canvasX,e.canvasY),!1):void 0},d.mouseUpEvent=function(e){return u?(t.canvasUI.setMouseCursor(),s.apply(e.canvasX,e.canvasY),u=!1,!1):void 0},d.commit=function(){return p(),n},d.onEnableZoomMode=function(){return t.canvasUI&&t.canvasUI.unsubscribe(d),!1},d.onDisableZoomMode=function(){t.canvasUI&&t.canvasUI.subscribe(d)},d}(),e.ControlsWidget.prototype.tool.frames=function(){"use strict";var t,r,o,a,i,n,s="avpw_isa_control_selector_frame",l="avpw_preset_icon_active",u=null,d={},p={},h=function(){if(i){var r=i.data("framename"),o=t.paintWidget.imageBorderManager.getEffectById(r),a={pack:o.packIdentifier,item:o.identifier},s=o.images.width;p[a.pack+a.item]&&(s=p[a.pack+a.item]),t.paintWidget.resourceProvider.doesResourceExist(a.pack,a.item)?t.paintWidget.module.frames.applyPreview(a,s):(n=!0,t.paintWidget.imageBorderManager.loadFrameResources(r,function(r){if(p[a.pack+a.item])s=p[a.pack+a.item];else{var o={width:t.paintWidget.width,height:t.paintWidget.height},i={left:{width:r.l.width,height:r.l.height},right:{width:r.r.width,height:r.r.height},top:{width:r.t.width,height:r.t.height},bottom:{width:r.b.width,height:r.b.height}};s=e.util.moaLite.MoaFrame.getOptimalWidth(o,i,s),p[a.pack+a.item]=s}t.paintWidget.resourceProvider.saveResource(a.pack,a.item,r),t.paintWidget.module.frames.applyPreview(a,s),n=!1},!1))}},f=function(e){avpw$("."+s).removeClass(l),e&&0!==e.length&&e.addClass(l)},m=function(e){e.preventDefault();var t=e.currentTarget;avpw$(t).attr("data-framename"),i&&t===i[0]?(i=null,d.cancel()):(i=avpw$(t),f(i),h())},g=function(t,r){var o=t.identifier,a=t.displayName,i=t.purchased||!t.needsPurchase,n=e.template[e.launchData.layout][i?"filterCanister":"filterCanisterDisabled"];return n({label:a,id:o,packIndex:r,thumburl:e.util.getSafeAssetBaseURL(t.assetsBaseURL)+t.iconImage})},v=function(t,r,o){o=e.util.getSafeAssetBaseURL(o);var a=t.displayName,i=t.identifier;return e.template[e.launchData.layout].frameThumbnail({label:a,frameName:i,assetImage:o+t.images.iconImage})},_=function(){e.util.nextFrame(function(){d.resetUI()})},x=function(){u&&(u.shutdown(),u=null),r&&r.length&&r.hide()},w=function(){var i=t.layoutNotify(e.launchData.openType,"getDims"),n=i.BORDER_ICON_WIDTH,i=t.layoutNotify(e.launchData.openType,"getDims"),n=i.FILTER_IMAGE_WIDTH,s=a,l=t.paintWidget.imageBorderManager.getPacksById();o=e.ContentBrowser({container:r,packsInOrder:s,packsById:l,buildPackUI:g,buildItem:v,itemWidth:n,itemsPerPage:t.layoutNotify(e.launchData.openType,"getFiltersPerPage"),backMessageText:e.getLocalizedString("More Frames")}),o.build(),r.fadeIn(200)};return d.init=function(e){t=e},d.panelWillOpen=function(){i=null,n=!1,c.on("layout:resize",_),r=avpw$("#avpw_frames_scroller"),r.hide(),r.delegate("."+s,"mouseup",m),t.layoutNotify(e.launchData.openType,"hideZoomButton")},d.panelDidOpen=function(){t.assetManager.getAssets("IMAGEBORDER",function(e){a=e,r.show(),w(),u&&u.changePage(!0)})},d.panelDidClose=function(){t.layoutNotify(e.launchData.openType,"showZoomButton"),c.off("layout:resize",_),r&&r.length&&r.undelegate()},d.resetUI=function(){f(),t.layoutNotify(e.launchData.openType,"scaleCanvas")},d.cancel=function(){d.resetUI(),c.trigger("actions:clear_uncommited_changes")},d.commit=function(){return n?!1:(t.paintWidget.module.frames.commit(),i&&i.length?i.data("framename"):void 0)},d.onUndo=function(e){e||d.resetUI()},d.onRedo=function(e){e||i&&i.length&&f(i)},d.shutdown=function(){x(),r&&r.length&&r.undelegate(),t=null,r=null},d}(),e.ControlsWidget.prototype.tool.meme=function(){var t,r,o,a={},i=!1;a.init=function(e){t=e};var n,s=function(){i&&(clearTimeout(n),n=setTimeout(function(){var e=r.val(),a=o.val();e=e.toUpperCase(),a=a.toUpperCase();var i={r:0,g:0,b:0,a:255},n={r:255,g:255,b:255,a:255};t.paintWidget.module.meme.applyPreview(e,a,n,i)},e.featherGLEnabled?0:40))};return a.panelWillOpen=function(){t.showWaitThrobber(!0),t.paintWidget.resourceProvider.utils.TextProvider.loadFont({label:"LeagueGothic-Regular",value:"LeagueGothic-Regular",custom:!0,url:"https://dme0ih8comzn4.cloudfront.net/fonts/league-gothic-webfont/stylesheet.css"},{active:function(){t.showWaitThrobber(!1),i=!0}}),r=avpw$("#avpw_text_area_meme"),o=avpw$("#avpw_text_area_meme2"),r.val(""),o.val("")},a.panelDidOpen=function(){r.bind("keydown",s),o.bind("keydown",s)},a.panelWillClose=function(){r.unbind("keydown"),o.unbind("keydown")},a.cancel=function(){t.paintWidget.module.meme.reset()},a.commit=function(){t.paintWidget.module.meme.commit()},a}(),e.ControlsWidget.prototype.tool.orientation=function(){var r,o,a,i,n,s,l,u,d,p=10,h=240,f=45,m=null,g=null,v=null,_=null,x=!1,w=!1,y=0,b=!1,M=!1,C=0,T={},S=function(){return r&&(x||w)&&!(x&&w)},A=function(){var o=a.layoutNotify(e.launchData.openType,"getMaxDims"),i=o.height<o.width?o.height:o.width;i-=p,i=i<e.launchData.maxSize?i:e.launchData.maxSize,a.canvasUI&&(a.canvasUI.viewport.resize(i,i),r?t.setTimeout(a.canvasUI.resetOffset,h):a.canvasUI.resetOffset())},E=function(){a.layoutNotify(e.launchData.openType,"scaleCanvas")},P=function(){A(),R(),l&&(s.setValue(l),O(null,{value:l}))},D=function(e,t,r){r&&0!==r&&(r%90!==0?n.addClass("avpw_shadow_overlay"):n.removeClass("avpw_shadow_overlay")),a.canvasUI&&a.canvasUI.viewport.rotate(e,t,r)},F=function(){D(0,0,0)},L=function(t){avpw$("#avpw_straighten_grid").html(avpw$(e.template[e.launchData.layout].alignmentGrid({numLines:t})))},R=function(){if(a.canvasUI&&o){var e=a.canvasUI.viewport.getRatio(),t=u/e,r=d/e;if(a.canvasUI.viewport.rotateBoundsBy90(y)){var i=t;t=r,r=i}s&&(s.shutdown(),s=void 0),s=new a.Slider({element:n,min:-.5,max:.5,defaultValue:0,onstart:I,onchange:B,onslide:O}),s.addListeners(),avpw$("#avpw_straighten_handle").css({left:"50%"}),v=null,_=null,m=t,g=r,L(8),n.addClass("avpw_straighten_ui_ready")}},I=function(e,t){a.canvasUI&&a.canvasUI.addCanvasClass("avpw_ready_for_straighten"),avpw$("#avpw_straighten_grid").addClass("avpw_straighten_ui_grid_ready"),a.paintWidget.setMode("orientation"),a.paintWidget.module.orientation.set(v,u,d)},B=function(t,r){a.canvasUI&&a.canvasUI.removeCanvasClass("avpw_ready_for_straighten"),avpw$("#avpw_straighten_grid").removeClass("avpw_straighten_ui_grid_ready"),a.layoutNotify(e.launchData.openType,"updateUndoRedo",[!0,!1])},O=function(t,i){var n,s,c,p,h=i.value;l=h,o&&(n=e.math.sign(h),_=(1-Math.cos(h*Math.PI))*f*n,v=_*Math.PI/180,_=x?-_:_,_=w?-_:_,_+=y,r?(c=w?180:0,p=x?180:0,D(c,p,_)):D(_),s=a.paintWidget.module.orientation.set(v,u,d),a.canvasUI&&m&&g&&a.canvasUI.viewport.resizeFake(m*s,g*s))},N=function(a,i){if(r&&!e.featherUseFlash){a&&a.call(this),n.removeClass("avpw_straighten_ui_animate"),n.removeClass("avpw_straighten_ui_ready"),t.setTimeout(function(){P(),n.addClass("avpw_straighten_ui_animate")},h);var s=w?180:0,l=x?180:0;D(s,l,y)}else o&&!e.featherUseFlash?(n.removeClass("avpw_straighten_ui_ready"),F(),i&&i.call(this),P()):i&&i.call(this)},k=function(){M=b=!1,C=0},U=function(){w=x=!1,y=0,v=null,_=null,k()},W=function(){a.canvasUI&&r&&!e.featherUseFlash?(a.canvasUI.removeCanvasClass("avpw_ready_for_orient"),n.removeClass("avpw_straighten_ui_animate"),n.removeClass("avpw_straighten_ui_ready"),t.setTimeout(function(){a.canvasUI.addCanvasClass("avpw_ready_for_orient"),n.addClass("avpw_straighten_ui_animate"),P()},h)):(n.removeClass("avpw_straighten_ui_ready"),P())},G=function(a){var i=0,n=0,s=0;r&&!e.featherUseFlash?((C||M||b)&&(i=M?180:0,n=b?180:0,s=C),D(i,n,s),t.setTimeout(function(){F(),a&&a.call(this)},h)):o&&!e.featherUseFlash?(F(),a&&a.call(this)):a&&a.call(this)},j=function(e){var t=avpw$(e.currentTarget);e.stopPropagation(),e.preventDefault(),G(function(){t.unbind("click").trigger("click")})},V=function(){avpw$("#avpw_flip_h").bind("click",function(){l=null,N(function(){x=!x},function(){a.paintWidget.setMode("flip"),a.paintWidget.module.flip.flip(!0,!1,!0)}),a.layoutNotify(e.launchData.openType,"updateUndoRedo",[!0,!1])}),avpw$("#avpw_flip_v").bind("click",function(){l=null,e.featherUseFlash?(a.paintWidget.setMode("flip"),a.paintWidget.module.flip.flip(!1,!0)):N(function(){w=!w},function(){a.paintWidget.setMode("flip"),a.paintWidget.module.flip.flip(!1,!0,!0)}),a.layoutNotify(e.launchData.openType,"updateUndoRedo",[!0,!1])}),avpw$("#avpw_rotate_left").bind("click",function(){var t=d;d=u,u=t,l=null;var r=S()?90:-90;N(function(){y+=r},function(){}),a.layoutNotify(e.launchData.openType,"updateUndoRedo",[!0,!1])}),avpw$("#avpw_rotate_right").bind("click",function(){var t=d;d=u,u=t,l=null;var r=S()?-90:90;N(function(){y+=r},function(){}),a.layoutNotify(e.launchData.openType,"updateUndoRedo",[!0,!1])}),avpw$("#avpw_controlpanel_orientation").find(".avpw_inset_button").pressed("avpw_inset_button_down"),avpw$("#avpw_all_effects").bind("click",j)},z=function(){avpw$("#avpw_controlpanel_orientation").find(".avpw_inset_button").unbind(),avpw$("#avpw_all_effects").unbind("click",j)},H=function(){var e=(v||0)*(180/Math.PI);if(y>0)y%=360;else for(;0>y;)y+=360;a.paintWidget.module.orientation.applyPreview(w,x,y,e),a.paintWidget.module.orientation.commit(),F(),A()};return T.init=function(t){a=t,r=!e.featherUseFlash&&e.support.getVendorProperty("transformStyle"),o=e.support.getVendorProperty("transform"),n=avpw$(e.template[e.launchData.layout].straightenSlider()),i=!0},T.panelWillOpen=function(){u=a.paintWidget.width,d=a.paintWidget.height,a.paintWidget.module.orientation&&a.paintWidget.module.orientation.activate(a.paintWidget),U(),V(),a.canvasUI&&a.canvasUI.disablePan(),c.on("layout:resize",P);var t=a.layoutNotify(e.launchData.openType,"getCanvasControlsElement");t.append(n),a.layoutNotify(e.launchData.openType,"hideZoomButton"),a.layoutNotify(e.launchData.openType,"showCanvasControlsElement")},T.panelDidOpen=function(){a.canvasUI&&r&&(a.canvasUI.addCanvasClass("avpw_ready_for_orient"),n.addClass("avpw_straighten_ui_animate")),P()},T.panelWillClose=function(){z(),a.canvasUI&&a.canvasUI.enablePan(),s&&(s.shutdown(),s=void 0),E(),c.off("layout:resize",P),a.canvasUI&&r?(a.canvasUI.removeCanvasClass("avpw_ready_for_orient"),n.removeClass("avpw_straighten_ui_animate"),n.removeClass("avpw_straighten_ui_ready")):o&&n.removeClass("avpw_straighten_ui_ready"),n.detach(),a.layoutNotify(e.launchData.openType,"showZoomButton"),a.layoutNotify(e.launchData.openType,"hideCanvasControlsElement"),F(),l=null},T.commit=function(){H()},T.shutdown=function(){z(),a=null,s=void 0,n=null},T.onUndo=function(e){var t=!!(y%360)||x||w||v&&0!==v;t&&(H(),U()),W()},T.onRedo=function(e){W()},T}(),e.ControlsWidget.prototype.tool.overlays=function(){function t(){var t=r.layoutNotify(e.launchData.openType,"getDims"),o=t.STICKER_ROLL_WIDTH;n=e.ContentBrowser({container:s,packsInOrder:i,packsById:h,buildPackUI:x,buildItem:_,itemWidth:o,itemsPerPage:r.layoutNotify(e.launchData.openType,"getStickerPacksPerPage"),backMessageText:e.getLocalizedString("More Stickers")}),n.build(),s.fadeIn(200)}var r,o,a,i,n,s,l,u,d=null,p=!1,h={},f={},m=function(){r.showWaitThrobber(!0);var t=a.getCropSettings(),o=l.attr("src");return r.paintWidget.overlayRegistry.getElement(o,function(a){var i=r.paintWidget.overlayRegistry.getAsset(o),n={pack:i.packIdentifier,item:i.identifier};a.currentTarget&&r.paintWidget.resourceProvider.saveResource(n.pack,n.item,a.currentTarget),r.paintWidget.module.overlays.applyPreview(n,t.topLeft,t.normWidth,t.aspectRatio),r.paintWidget.module.overlays.commit(),r.showWaitThrobber(!1),e.util.nextFrame(function(){e.Events.trigger("tool:commitDone")})}),!1},g=function(e){var t,r;d=null,e&&(t=e.width,r=e.height,c.on("tool:crop:change",y),t&&r&&a.setInitialSelectionByRatio(t/r),a.forceAspect(e.constrain))},v=function(){b()};f.resetUI=function(){r.layoutNotify(e.launchData.openType,"scaleCanvas")},f.init=function(t){r=t,a=new e.CropController(t,t.paintWidget,!1)},f.shutdown=function(){c.off("layout:resize",v),avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_force_crop_mode"),d=null,r=null,a=null},f.onRedoComplete=function(){f.resetUI()},f.onUndoComplete=function(){f.resetUI()};var _=function(t,o,a){a=e.util.getSafeAssetBaseURL(a);var i,s=a+t.images.overlay["path-1024"],l=a+t.images.barPreview["path-100"];return i=t.images.overlay["path-1024"]?a+t.images.overlay["path-1024"]:a+t.images.overlay.path,t.packIdentifier=n.getCurrentPackId(),r.paintWidget.overlayRegistry.add(s,i,t),e.template[e.launchData.layout].stickerThumbnail({url:s,thumburl:l})},x=function(t,r){var o,a=t.identifier,i=t.displayName||"Original",n=(t.purchased||!t.needsPurchase,h[a]),s=e.template[e.launchData.layout].stickerRoll;return n&&n.iconAssetsV2.url&&(o=e.util.getSafeAssetBaseURL(t.assetsBaseURL)+n.iconAssetsV2.url),s({label:i,id:a,packIndex:r,thumburl:o})};f.panelWillOpen=function(){d=null,p=!1,r.paintWidget.module.crop.activate(r.paintWidget),r.canvasUI&&r.canvasUI.subscribe(f),r.layoutNotify(e.launchData.openType,"hideZoomButton"),c.on("layout:resize",v),avpw$("#avpw_controls").addClass("avpw_crop_mode avpw_overlays_mode"),s=avpw$("#avpw_overlays_scroller"),u=!1,r.assetManager.gatherContentAssetsHelper("OVERLAYS",function(e,r){h=e,i=r,t()}),s.delegate(".avpw_isa_control_selector_overlay","click",w)};var w=function(e){var t=e.currentTarget,r=avpw$(t).attr("fullimageurl");u||a.activate(c),u=!0,l.attr("src",r),l.remove(),avpw$(".avpw_crop_layer").addClass("avpw_crop_with_reticle").prepend(l),b()};f.panelDidOpen=function(){f.resetUI(),o={constrain:!0,height:1,label:"Square",labeled:!0,resize:!1,strict:!1,width:1},c.on("tool:crop:change",y);var t=new Image;e.util.doesSupportImageCORS()&&(t.crossOrigin="Anonymous"),l=avpw$(t),l.css({position:"absolute",width:"100%",height:"100%",top:0,left:0})};var y=function(e,t){a.setToolTipValues(e,t)},b=function(){g(o)};return f.panelWillClose=function(){c.off("tool:crop:change",y),avpw$("#avpw_controls").removeClass("avpw_crop_mode avpw_overlays_mode"),r.canvasUI&&r.canvasUI.unsubscribe(f),a&&u&&a.deactivate(),n&&n.destroy(),r.layoutNotify(e.launchData.openType,"showZoomButton"),c.off("layout:resize",v)},f.mouseDownEvent=function(e){if(u){var t=a.updateUIDown(e.canvasX,e.canvasY);return t&&(p=!0),!1}},f.mouseMoveEvent=function(e){return p?(a.updateUIMove(e.canvasX,e.canvasY),!1):void 0},f.mouseUpEvent=function(e){return u&&p?(r.canvasUI.setMouseCursor(),a.apply(e.canvasX,e.canvasY),p=!1,!1):void 0},f.commit=function(){return u?m():void 0},f.onEnableZoomMode=function(){return r.canvasUI&&r.canvasUI.unsubscribe(f),!1},f.onDisableZoomMode=function(){r.canvasUI&&r.canvasUI.subscribe(f)},f}(),e.ControlsWidget.prototype.tool.resize=function(){var t,r,o,a,i,n,s,l,u,c=!1,d=!1,p="avpw_inset_button_active",h={},f=function(e){if(e===!0||e===!1)n=e;else{if(n&&!d)return t.messager.show("avpw_resize_unlocked",!0),!1;n=!n}n?(a.addClass(p),w()):a.removeClass(p)},m=function(){var e,a,i;c?(i=t.paintWidget.getScaledSize(),e=i.hiresWidth||i.width,a=i.hiresHeight||i.height):(e=t.paintWidget.width,a=t.paintWidget.height),r.val(e),o.val(a),s=e,l=a},g=function(){var e=r.val(),a=o.val(),i=t.paintWidget.width,n=t.paintWidget.height;return e!==i||a!==n},v=function(){var e=parseInt(r.val()),t=parseInt(o.val());!isNaN(e)&&e>0&&u>=e&&!isNaN(t)&&t>0&&u>=t&&(s=e,l=t)},_=function(){var e=parseInt(r.val()),a=parseInt(o.val());return e===s&&a===l?(x(e,a),!0):(t.messager.show("avpw_resize_invalid",!0),!1)},x=function(e,r){isNaN(e)||isNaN(r)||(t.paintWidget.width,t.paintWidget.height,t.paintWidget.module.resize.applyPreview([e,r]),t.paintWidget.module.resize.commit())},w=function(){var a,s,l;e.util.nextFrame(function(){n&&("width"===i?(s=parseInt(r.val()),(!s||isNaN(s))&&(s=t.paintWidget.width),a=s/t.paintWidget.width,l=t.paintWidget.height*a|0,1>l&&(l=1),o.val(l)):(l=parseInt(o.val()),(!l||isNaN(l))&&(l=t.paintWidget.height),a=l/t.paintWidget.height,s=t.paintWidget.width*a|0,1>s&&(s=1),r.val(s))),v()})},y=function(e){avpw$(this).addClass("avpw_text_input_focused").select()},b=function(e){avpw$(this).removeClass("avpw_text_input_focused")},M=function(t){return e.util.keyDownHandlerNumber.apply(this,[t,function(e){i=e.data.currentProp,w()}])};return h.init=function(i){t=i,c=t.imageSizeTracker.isUsingHiResDimensions(e.launchData),u=c?e.launchData.hiresMaxSize:e.launchData.maxSize,r=r||avpw$("#avpw_resize_width"),r.bind("keydown",{currentProp:"width"},M).bind("focus",y).bind("blur",b),o=o||avpw$("#avpw_resize_height"),o.bind("keydown",{currentProp:"height"},M).bind("focus",y).bind("blur",b),a=a||avpw$("#avpw_constrain_prop"),a.click(f),avpw$("#avpw_constrain_prop_label").click(function(){a.trigger("click")}),avpw$("#avpw_resize_invalid_confirm").click(function(){return t.messager.hide("avpw_resize_invalid"),r.val(s),o.val(l),!1}),avpw$("#avpw_resize_unlocked_confirm").click(function(){return d=!0,t.messager.hide("avpw_resize_unlocked"),f(),!1}),avpw$("#avpw_resize_unlocked_cancel").click(function(){return d=!0,t.messager.hide("avpw_resize_unlocked"),!1}),avpw$("#avpw_resize_invalid_max_size").html(u)},h.panelWillOpen=function(){m(),f(!0),d=!1,t.layoutNotify(e.launchData.openType,"hideZoomButton")},h.panelDidOpen=function(){r.trigger("focus"),t.layoutNotify(e.launchData.openType,"scaleCanvas")},h.panelWillClose=function(){t.layoutNotify(e.launchData.openType,"showZoomButton")},h.onRedoComplete=function(){m()},h.onUndoComplete=function(){m()},h.commit=function(){var e=!0;return g()&&(e=_()),e&&(e=s+","+l),e},h.shutdown=function(){r&&r.unbind(),o&&o.unbind(),a&&a.unbind(),avpw$("avpw_constrain_prop_label").unbind("click"),avpw$("#avpw_resize_invalid_confirm").unbind("click"),avpw$("#avpw_resize_unlocked_confirm").unbind("click"),avpw$("#avpw_resize_unlocked_cancel").unbind("click"),t=null},h}(),e.ControlsWidget.prototype.tool.sharpness=function(){var t,o,a,i,n=e.toolDefaults.sharpness.presets,s=!1,l={},u=function(r,o){i=o.value,e.featherGLEnabled||t.showWaitThrobber(!0),setTimeout(function(){t.paintWidget.module.sharpness.applyPreview(i+.5|0,1,"normal"),t.showWaitThrobber(!1)},30)};return l.init=function(i){a=0,t=i;var s={element:r.getElementById("avpw_sharpness_slider"),min:n[0],max:n[3],defaultValue:a};e.featherGLEnabled&&(s.onslide=u),s.onchange=u,o=new t.Slider(s)},l.cancel=function(){s=!1},l.panelWillOpen=function(){i=a},l.panelDidOpen=function(){o.addListeners()},l.panelWillClose=function(){o.removeListeners()},l.panelDidClose=function(){s&&(l.resetUI(),s=!1)},l.onUndo=function(e){e||l.resetUI(),t.paintWidget.module.sharpness.resetBacking()},l.onRedo=function(e){!e&&o&&o.setValue(i)},l.commit=function(){t.paintWidget.module.sharpness.commit()},l.resetUI=function(){o.reset()},l.shutdown=function(){o&&(o.shutdown(),o=void 0),i=a=void 0,t=null},l}(),e.ControlsWidget.SpotTool=function(t){var r,o,a,i=(e.toolDefaults[t].presets,{}),n=!1,s=function(){var e=1;r.canvasUI&&(e=r.canvasUI.viewport.getRatio());var o=r.paintWidget.module[t].getRadius();r.brushPreview&&r.brushPreview.show(o)},l=function(){n?(c.trigger("canvas:showBrushCursor"),n=!1):c.trigger("canvas:hideBrushCursor")},u=function(e){e.siblings().removeClass("avpw_preset_icon_active"),e.addClass("avpw_preset_icon_active")},d=function(e){e.preventDefault();var t=avpw$(this);u(t);var r=t.data("size")/2;a=r,p(r),s()},p=function(e){var e=e;r.paintWidget.module[t].setRadius(e),c.trigger("canvas:setBrushSize",e)},h=function(){avpw$("#avpw_controlpanel_"+t).on("mousedown touchstart",".avpw_isa_preset_brush",d),r.canvasUI&&r.canvasUI.subscribe(i)},f=function(){avpw$("#avpw_controlpanel_"+t).off(".avpw_isa_preset_brush","mousedown touchstart"),r.canvasUI&&r.canvasUI.unsubscribe(i)},m=function(){avpw$("#avpw_controlpanel_"+t+" .avpw_tool_cutout_centered_spot_tool").html(e.template[e.launchData.layout].brushSizesSet({sizes:[8,13,18,21,25],hideLabel:!0}))};i.init=function(e){r=e},i.commit=function(){r.paintWidget.module[t].commitDrawState()};var g=function(){p(a)};i.panelWillOpen=function(){c.on("canvas:resize",g),m(),h(),r.canvasUI&&r.canvasUI.setMouseCursor("none")},i.panelDidOpen=function(){avpw$("#avpw_controlpanel_"+t).find(".avpw_isa_preset_brush").eq(2).trigger("mousedown"),n=!1,r.layoutNotify(e.launchData.openType,"showCanvasControlsElement"),v()},i.panelWillClose=function(){f(),c.off("canvas:resize",g),_(),c.trigger("canvas:shutdownBrushCursor")};var v=function(){avpw$(".avpw_canvas_background").css("cursor","none"),avpw$("#avpw_zoom_container").css("cursor","default")},_=function(){avpw$(".avpw_canvas_background").css("cursor","default"),avpw$("#avpw_zoom_container").css("cursor","default")};i.shutdown=function(){r=null},i.mouseDownEvent=function(a,i,n){if(!o&&n){o=!0;var s=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),l=r.paintWidget.module[t].getRadius()*s,u=a.canvasX,c=a.canvasY;return r.paintWidget.module[t].createStroke(l),r.paintWidget.module[t].addPoints(u,c),
r.paintWidget.module[t].preview(),!1}};var x;return i.mouseMoveEvent=function(a){var i=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),s=(r.paintWidget.module[t].getRadius()*i,a.canvasX),u=a.canvasY;return c.trigger("canvas:setBrushPosition",s,u),n=!0,l(),o&&(r.paintWidget.module[t].addPoints(s,u),x=setTimeout(function(){r.paintWidget.module[t].preview()},e.featherGLEnabled?0:50)),!1},i.mouseUpEvent=function(e){o&&(o=!1,r.paintWidget.module[t].finishStroke())},i.mouseOutEvent=function(){},i.onEnableZoomMode=function(){return r.canvasUI&&(r.canvasUI.unsubscribe(i),r.canvasUI.setMouseCursor()),_(),c.trigger("canvas:hideBrushCursor"),!1},i.onDisableZoomMode=function(){r.canvasUI&&(r.canvasUI.subscribe(i),r.canvasUI.setMouseCursor("none")),l(),v()},i.onUndoComplete=function(e){return e&&e.global?(r.paintWidget.module[t].reset(),!1):void 0},i.onRedoComplete=function(e){return e&&e.global?(r.paintWidget.module[t].reset(),!1):void 0},i.cancel=function(){r.paintWidget.module[t].reset()},i},e.ControlsWidget.prototype.tool.blemish=new e.ControlsWidget.SpotTool("blemish"),e.ControlsWidget.prototype.tool.whiten=new e.ControlsWidget.SpotTool("whiten"),e.ControlsWidget.prototype.tool.redeye=new e.ControlsWidget.SpotTool("redeye"),e.ControlsWidget.prototype.tool.overlay=function(){var r,o,a,i,n,s,l,u,d,p,h,f=140,m=10,g=.375,v=5,_={OFF_STATE:0,DRAG_STATE:1},w=null,b=null,M={},C=function(e){return r.paintWidget.overlayRegistry.getAsset(e).identifier},T=function(t,r){var a=e.paintWidgetInstance.overlayRegistry.getElement(t,function(e){o=!1,r&&r.call(this)});return a?!0:(o=!0,!1)},S=function(t,o,a,i,n){var s,l,u,c,p,h,g=Math.floor(4294967295*Math.random()).toString(16),v="text_overlay-"+g,_=avpw$(e.template[e.launchData.layout].selectionOverlay({id:v,body:e.template[e.launchData.layout].imageOverlayBody({src:t})}));u=1,r.canvasUI&&(u=r.canvasUI.viewport.getRatio()),c=f+2*m,s=o/u-c/2,l=a/u-c/2,p={left:(s+.5|0)+"px",top:(l+.5|0)+"px",width:f+"px",height:f+"px"},_.css(p),h={id:v,url:t,initialCoordsX:0,initialCoordsY:0,element:_},d.newOverlay(h)},A=function(t){var o,a,i,n;if(t.url){o=t.id,a=t.url,n=e.controlsWidgetInstance.canvasUI?e.controlsWidgetInstance.canvasUI.viewport.getRatio():1,i=(t.rotation||0)*(180/Math.PI),i>0?i%=360:i=-(Math.abs(i)%360);var s=r.paintWidget.overlayRegistry.getAsset(a),l={pack:s.packIdentifier,item:s.identifier},u=r.paintWidget.width,c=r.paintWidget.height,d=t.width,p=(t.centerX-d/2)*n,h=(t.centerY-d/2)*n,f=[p/u,h/c,d*n/u,d*n/c];r.paintWidget.resourceProvider.saveResource(l.pack,l.item,r.paintWidget.overlayRegistry.getElement(a));var m=r.paintWidget.module.overlay.generateAction(l,f,1,i,!1);return m}},E=function(t,o,a,i){if(e.featherUseFlash)return void r.paintWidget.module.overlay.addOverlay("",t);var n=T(t,function(){S(t,a,i,g,g),n||r.onEggWaitThrobber.stop()});if(!n&&o){var s=avpw$(o).children(".avpw_isa_overlay_waiter");r.onEggWaitThrobber.spin(s[0])}c.trigger("usage:tool","overlay","stickerclicked",C(t))},P=function(){p=null,w=null,o=!1,h&&h.length&&h.detach().remove()},D=function(t){if(h&&h.length){var r=e.util.getTouch(t);r?(x=r.pageX,y=r.pageY):(x=t.originalEvent.pageX,y=t.originalEvent.pageY),h.css({left:x+"px",top:y+"px"})}},F=function(r){var o,a,i,n;P(),n=avpw$(r.currentTarget),p=n.attr("fullimageurl"),e.featherUseFlash||(i=e.util.getTouch(r),i?(o=i.pageX,a=i.pageY):(o=r.originalEvent.pageX,a=r.originalEvent.pageY),w={x:o,y:a},avpw$(t).bind("mousemove",L).bind("touchmove",L).bind("mouseup",R).bind("touchend",R),h=n.clone())},L=function(r){var o,a,i=0,n=0;w&&(i=w.x,n=w.y);var s=e.util.getTouch(r);s?(o=s.pageX,a=s.pageY,avpw$(e.paintWidgetInstance.canvas).trigger("touchstart")):(o=r.originalEvent.pageX,a=r.originalEvent.pageY),(i-o>v||o-i>v||n-a>v||a-n>v)&&(avpw$(t).unbind("mousemove",L).unbind("touchmove",L).bind("mousemove",D).bind("touchmove",D),D(r),h.addClass("avpw_overlay_icon_dropped"),avpw$("body").append(h),T(p))},R=function(a){avpw$(t).unbind("mousemove",L).unbind("touchmove",L).unbind("mousemove",D).unbind("touchmove",D).unbind("mouseup",R).unbind("touchend",R);var i=r.canvasUI.getCoordinatesFromEventWithinCanvasBounds(a);if(i)if(o)var n=t.setInterval(function(){o||(i&&E(p,a.currentTarget,i.canvasX,i.canvasY),t.clearInterval(n),n=null,P())},100);else E(p,a.currentTarget,i.canvasX,i.canvasY),P();else h&&h.length&&(h.addClass("avpw_overlay_icon_return_ready"),e.util.nextFrame(function(){h.addClass("avpw_overlay_icon_returned"),w&&h.css({top:w.y+"px",left:w.x+"px"}),t.setTimeout(function(){P()},400)}))},I=function(e){var a,i,n,s=e.currentTarget,l=avpw$(s).attr("fullimageurl");if(l&&l===p)if(r&&r.canvasUI&&(a=r.canvasUI.getViewportCenter(),a&&(i=a.canvasX,n=a.canvasY)),o)var u=t.setInterval(function(){o||(E(l,s,i,n),t.clearInterval(u),u=null)},100);else E(l,s,i,n);w=null,p=null,avpw$(t).unbind("mousemove",L).unbind("touchmove",L).unbind("mousemove",D).unbind("touchmove",D)},B=function(t,o,a){a=e.util.getSafeAssetBaseURL(a);var i=a+t.images.preview,s=a+t.images.iconImage,l=a+t.images.sticker;return t.packIdentifier=n.getCurrentPackId(),r.paintWidget.overlayRegistry.add(i,l,t),e.template[e.launchData.layout].stickerThumbnail({url:i,thumburl:s})},O=function(t,r){var o,a=t.identifier,i=t.displayName||"Original",n=t.purchased||!t.needsPurchase,s=u[a],l=e.template[e.launchData.layout][n?"stickerRoll":"stickerRollDisabled"];return s&&s.iconImage&&(o=e.util.getSafeAssetBaseURL(t.assetsBaseURL)+t.iconImage),l({label:i,id:a,packIndex:r,thumburl:o})},N=function(){U(),b=null,p=null,h=null},k=function(){var t=r.layoutNotify(e.launchData.openType,"getDims"),o=t.STICKER_ROLL_WIDTH;n=e.ContentBrowser({container:a,packsInOrder:l,packsById:u,buildPackUI:O,buildItem:B,itemWidth:o,itemsPerPage:r.layoutNotify(e.launchData.openType,"getStickerPacksPerPage"),backMessageText:e.getLocalizedString("More Stickers")}),n.build(),a.fadeIn(200)};M.init=function(t){r=t,u||(u={}),e.OverlayController&&(d=new e.OverlayController(t,t.paintWidget,{modes:_,handlePosition:e.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT,aspectRatio:1}))},M.panelWillOpen=function(){a=avpw$("#avpw_overlay_scroller"),a.hide(),r.canvasUI&&r.canvasUI.subscribe(M),N(),r.assetManager.gatherContentAssetsHelper("STICKER",function(e,t){u=e,l=t,k()}),a.delegate(".avpw_isa_control_selector_overlay","mousedown touchstart",F).delegate(".avpw_isa_control_selector_overlay","mouseup",I),d&&d.activate()},M.panelWillClose=function(){r.canvasUI&&r.canvasUI.unsubscribe(M),n&&n.destroy(),P(),U(),d&&d.deactivate()};var U=function(){a&&a.undelegate(".avpw_isa_control_selector_overlay","mousedown touchstart",F).undelegate(".avpw_isa_control_selector_overlay","mouseup",I)};return M.shutdown=function(){N(),P(),n&&n.destroy(),r=null,i=null,a=null,s=null},M.mouseDownEvent=function(e,t){return d.updateUIDown(e,t,null,null,function(e){e&&e.url&&c.trigger("usage:tool","overlay","stickerdeleted",C(e.url))})},M.mouseMoveEvent=function(e){return d.updateUIMove(e),!1},M.mouseUpEvent=function(e,t){d.apply(e,t)},M.onEnableZoomMode=function(){return r.canvasUI&&r.canvasUI.unsubscribe(M),!1},M.onDisableZoomMode=function(){r.canvasUI&&r.canvasUI.subscribe(M)},M.commit=function(){var e=[];d&&(d.commit(function(t){var r=A(t);r&&e.push(r)}),e&&e.length&&(r.paintWidget.module.overlay.applyMultiple(e,"sticker"),r.paintWidget.module.overlay.commit()))},M}(),e.ControlsWidget.prototype.tool.text=function(){var t,r,o,a,i=e.toolDefaults.text.presetsColor,n=!1,s=!1,l={},u=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active")},d=function(e){u(),e.addClass("avpw_preset_icon_active")},p=function(t){var a,i;a=t&&e.util.color_is_light(t)?"#000":"#fff",i=e.util.color_is_light(t)?"#969696":"#fff",r=t,o=a},h=function(e){e.preventDefault();var t=avpw$(this);p(t.data("color")),d(t),n=!1},f=function(o){o.preventDefault(),o.stopPropagation();var a=o.currentTarget;e.buildColorPicker(r,a,function(e){p(e),t.canvasUI&&t.canvasUI.subscribe(l),d(avpw$(a))},function(){t.canvasUI&&t.canvasUI.subscribe(l)}),t.canvasUI&&t.canvasUI.unsubscribe(l)},m=function(e,a){if(!n){var i,s,l,u,c=avpw$("#avpw_text_font_size").val(),d=r,p=o,h=avpw$("#avpw_text_font").val(),f=avpw$("#avpw_text_area").val(),m=60;t.canvasUI&&(i=t.canvasUI.getViewportCenter(),i&&(s=i.canvasX,l=i.canvasY)),""==c&&(c=avpw$("#avpw_text_font_size").attr("value")),""==c&&(c="60"),""==h&&(h=avpw$("#avpw_text_font").attr("value")),""==h&&(h="sans-serif"),"sans-serif"==h&&(h='"Arial", sans-serif'),u=parseFloat(c)/m,t.paintWidget.module.text.newText(f,h,m,d,p,s,l,u,u,0),n=!0,avpw$("#avpw_text_area").trigger("blur")}return!1},g=function(e){e[0].value="",a=!1,e.addClass("avpw_text_input_focused")},v=function(t){t[0].value=e.getLocalizedString("Enter text here"),a=!0,t.removeClass("avpw_text_input_focused")},_=function(e){a&&g(avpw$(this)),n=!1},x=function(e){return 13==e.which?(avpw$("#avpw_add_text").trigger("click"),!1):void 0},w=function(){avpw$("#avpw_controlpanel_text").delegate(".avpw_isa_preset_color","click",h).delegate(".avpw_isa_color_picker","click",f),avpw$("#avpw_text_area").bind("focus",_).bind("keydown",x),avpw$("#avpw_add_text").click(m)},y=function(){avpw$("#avpw_controlpanel_text").undelegate(".avpw_isa_preset_color","click").undelegate(".avpw_isa_color_picker","click"),avpw$("#avpw_text_area").unbind(),avpw$("#avpw_add_text").unbind("click")},b=function(){var r,o,a=i.length,n="";for(r=0;a>r;r++)o={color:i[r]},n+=e.template[e.launchData.layout].brushColorIcon(o);avpw$("#avpw_text_colors").html(n);var s=t.layoutNotify(e.launchData.openType,"getDims");avpw$("#avpw_text_area").css("width",s.INNER_BROWSER_WIDTH-s.TEXT_ADD_TEXT_BUTTON_WIDTH-80+"px")};return l.init=function(e){t=e,b()},l.panelWillOpen=function(){s=!1,n=!1,v(avpw$("#avpw_text_area")),w(),t.canvasUI&&t.canvasUI.subscribe(l),avpw$.miniColors&&(e.miniColors=new avpw$.miniColors),c.on("layout:resize",b)},l.panelDidOpen=function(){_addListeners()},l.panelWillClose=function(){_removeListeners(),t.paintWidget.module.effects.deactivate()},l.panelDidOpen=function(){avpw$("#avpw_text_colors").find(".avpw_isa_preset_color").eq(0).trigger("click")},l.panelWillClose=function(){y(),t.canvasUI&&t.canvasUI.unsubscribe(l),avpw$("#avpw_text_area").trigger("blur"),e.miniColors=null,c.off("layout:resize",b)},l.shutdown=function(){t=null},l.mouseDownEvent=function(e){if(!s){var r=t.paintWidget.module.text.updateUIDown(e.canvasX,e.canvasY);return r!==!1&&(s=!0,"rotate"===r?t.canvasUI.setMouseCursor("pointer"):"translate"===r&&t.canvasUI.setMouseCursor("move")),!1}},l.mouseMoveEvent=function(e){return s?(t.paintWidget.module.text.updateUIMove(e.canvasX,e.canvasY),!1):void 0},l.mouseUpEvent=function(e){s&&(n=!1,t.canvasUI.setMouseCursor(),t.paintWidget.module.text.apply(e.canvasX,e.canvasY),s=!1)},l.onEnableZoomMode=function(){return t.canvasUI&&t.canvasUI.unsubscribe(l),!1},l.onDisableZoomMode=function(){t.canvasUI&&t.canvasUI.subscribe(l)},l}(),e.ControlsWidget.prototype.tool.textwithfont=function(){var t,r,o,a,i,n,s,l,u=1.17,d=e.getLocalizedString("Enter text here"),p={label:"Arial Black",value:"'Arial Black','Arial-BoldMT','ArialMT','Arial','Lucida Grande','Arial Unicode MS',sans-serif"},h=24,f="avpw_textwithfont_overlay_helptext",m="avpw_selection_overlay_disable_user_select",g="avpw_inset_button_active",v=60,_=10,x=1/12,w=e.toolDefaults.textwithfont.presetsColor,y=e.toolDefaults.textwithfont.presetsFont,b=null,M={OFF_STATE:0,DRAG_STATE:1,EDIT_STATE:2},C=18,T=4*(C+2*h),S=!1,A=!1,E=p,P=h,D=w[0],F=1,L=!1,R={},I=function(e){e=e||p,E=e,$(e),c.trigger("usage:interact","textwithfont","fontchanged",e.label);var t=r.currentOverlay();t&&(K(t,e),Q(e),ne(t),r.saveDimensions(),B())},B=function(t){t=t||r.currentOverlay();var a,i,n,s;if(t&&(a=t.element.find(".avpw_textwithfont_writer"),n=t.textSize,s=n/2+.5|0,i=a[0],i&&t.text)){var l=e.util.color_to_array(t.textColor),c={r:l[0],g:l[1],b:l[2],a:255},d={text:t.text,fontName:t.textFont.label,style:t.textFont.style||"normal",color:c,alignment:"center",fontSize:n},p=(t.text.split("\n"),o.getStringDimensions(t.text,0,n,d,!0)),d=avpw$.extend(d,p),h=o.drawString(d,i,!0);a.css({"margin-top":"-"+h.yOffset+"px"}),t.element.find(".avpw_textwithfont_entry").css({"line-height":n*u+"px"})}},O=function(t,a){r.hideCurrentOverlay(),avpw$("#avpw_font_browser_preview").hide();var i=b[t];o.loadFont(i,{loading:function(){e.controlsWidgetInstance&&e.controlsWidgetInstance.showWaitThrobber(!0)},inactive:function(){e.controlsWidgetInstance&&e.controlsWidgetInstance.showWaitThrobber(!1),e.errorNotify("UNSUPPORTED_FONT",[t])},active:function(){return e.controlsWidgetInstance&&e.controlsWidgetInstance.showWaitThrobber(!1),a?void avpw$("#avpw_font_browser_preview").show():(i=avpw$.extend(i,{value:i.value+(","+p.value)}),I(i),avpw$("#avpw_font_browser_preview").show(),void e.util.nextFrame(r.showCurrentOverlay))}})},N=function(){ue();var o,i,n,s,l=Math.floor(4294967295*Math.random()).toString(16),u="text_overlay-"+l,c=avpw$(e.template[e.launchData.layout].selectionOverlay({id:u,body:e.template[e.launchData.layout].textEntryOverlayBody()}));o=1,t.canvasUI&&(o=t.canvasUI.viewport.getRatio()),i=v+2*_,n={left:(t.paintWidget.width/o-i)/2+"px",top:a+"px",width:v+"px"},c.css(n),s={id:u,helpTextShown:!1,initialCoordsX:0,initialCoordsY:0,element:c},K(s,E),Q(E),J(s,P||h),ee(P||h),te(s,D||w[0]),oe(s,F||1),r.newOverlay(s),ue(),xe(!0)},k=function(){n=avpw$(e.template[e.launchData.layout].textEntryOverlayProxy()),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").append(n)},U=function(){n&&n.length&&n.remove()},W=function(a){ne(a,!0),r.saveDimensions(a);var i,n,s,l,u,c,p,h,f,m;if(f=a.text,f&&f!==d){m=e.controlsWidgetInstance.canvasUI?e.controlsWidgetInstance.canvasUI.viewport.getRatio():1,s=a.textSize*m+.5|0,u=a.textColor;var g=e.util.color_to_array(u);a.textOutline&&(c=e.util.color_is_light(a.textColor)?"#000000":"#ffffff"),p=a.textOpacity,h=a.textFont,i=a.centerX*m,n=a.centerY*m;var v=parseInt(a.element.find(".avpw_textwithfont_writer").css("margin-top"))/4;n+=v,ee(a.textSize),Q(a.textFont),B(a),l=(a.rotation||0)*(180/Math.PI),l>0?l%=360:l=-(Math.abs(l)%360);var u={r:g[0],g:g[1],b:g[2],a:255},_=t.paintWidget.width,x=t.paintWidget.height,w=(o.getStringDimensions(f,0,s,{fontName:a.textFont.label,color:u,alignment:"left",fontSize:s},!0),[i/_,n/x]),y=t.paintWidget.module.textwithfont.generateAction(f,{fontSize:s/_,fontName:a.textFont.label,color:u,alignment:"center"},1,w,l);return y}},G=function(){avpw$(".avpw_inset_color_widget .avpw_preset_icon_active").removeClass("avpw_preset_icon_active")},j=function(e){G(),e.addClass("avpw_preset_icon_active")},V=function(t){var o,a;o=t&&e.util.color_is_light(t)?"#000":"#fff",a=e.util.color_is_light(t)?"#969696":"#fff",D=t,te(r.currentOverlay(),t)},z=function(e){e.preventDefault();var t=avpw$(this),r=t.data("color");V(r),j(t),c.trigger("usage:interact","textwithfont","colorchanged",r)},H=function(r){r.preventDefault(),r.stopPropagation();var o=r.currentTarget;l=e.buildColorPicker(D,o,function(e){V(e),t.canvasUI&&t.canvasUI.subscribe(R),G()},function(){t.canvasUI&&t.canvasUI.subscribe(R)}),t.canvasUI&&t.canvasUI.unsubscribe(R)},X=function(e){var t=avpw$("#avpw_textwithfont_outline_toggle");e?t.addClass(g):t.removeClass(g),re(),L=e},$=function(e){e=e||p,avpw$("#avpw_font_browser_preview").css({"font-family":e.value,"font-style":e.style||"normal"}),i&&i.update(e.label)},Y=function(e){var t=avpw$("#avpw_textwithfont_colors").find(".avpw_isa_preset_color").filter('[data-color="'+e+'"]').eq(0);V(e),t&&t.length?j(t):(t=avpw$("#avpw_controlpanel_textwithfont").find(".avpw_isa_color_picker"),j(t))},q=function(e){e.preventDefault();var t=r.currentOverlay();t&&t.element&&t.element.find(".avpw_textwithfont_entry").trigger("blur"),N(),c.trigger("usage:interact","textwithfont","textadded")},Z=function(e){e&&e.element&&e.element.find(".avpw_textwithfont_entry").css({"font-family":e.textFont.value,"font-size":e.textSize+"px","font-style":e.textFont.style||"normal"})},K=function(e,t){e=e||r.currentOverlay(),e&&(e.textFont=t,B(),Z(e))},Q=function(e){e=e||p,n&&n.length&&n.css({"font-family":e.value,"font-style":e.style||"normal"})},J=function(e,t){e=e||r.currentOverlay(),e&&(e.textSize=t,Z(e),B(),re(e))},ee=function(e){var t;n&&n.length&&(t=e/2+.5|0||0,n.css({"font-size":e,padding:"0 "+t+"px"}))},te=function(e,t){e=e||r.currentOverlay(),e&&(e.textColor=t,B(e),e.mode===M.EDIT_STATE&&(re(e,t),e.element.find(".avpw_textwithfont_entry").css("color",t)))},re=function(t,o){if(t=t||r.currentOverlay()){o=o||t.textColor;var a="";L?(t.textOutline=!0,a=o&&e.util.color_is_light(o)?e.template[e.launchData.layout].textEntryOutlineStyle({size:x*t.textSize,color:"#000"}):e.template[e.launchData.layout].textEntryOutlineStyle({size:x*t.textSize,color:"#fff"})):t.textOutline=!1,B(),t.mode===M.EDIT_STATE&&(t.element.find(".avpw_textwithfont_entry")[0].style.textShadow=a)}},oe=function(e,t){e=e||r.currentOverlay(),e&&(e.textOpacity=t)},ae=function(e){var t,o=r.currentOverlay();o&&s&&(t=s*e|0,J(o,t),ee(t))},ie=function(e){n&&n.length&&(e=e.replace(/>/g,"&gt;").replace(/</g,"&lt;"),n.find(".avpw_proxy_get_height").html(" "+e+" "))},ne=function(e,t){var r,o,a,i,s,l;e&&e.element&&n&&n.length&&(dims=se(e,t),i=dims.width||0,s=dims.height||0,r=e.topLeftX,o=e.width,l=(o-i)/2+.5|0,a=r+l,e.element.css({width:i+"px",left:a+"px",height:s+"px"}))},se=function(e,t){if(r){e=e||r.currentOverlay();var a=e.text||"",i=e.textSize,s={text:a,fontName:e.textFont.label,style:e.textFont.style||"normal",color:{r:0,g:0,b:0,a:255},alignment:"center",fontSize:i},l=(a.split("\n"),o.getStringDimensions(a,0,i,s,!0)),u=.1,c=n.outerWidth();return c+=2*(u*s.maxLineWidth,s.fontSize),{width:c,height:l.totalHeight}}},le=function(){var e,t=r.currentOverlay();t&&(e=t.element.find(".avpw_textwithfont_entry"),e&&e.length&&(e.val(""),ie(""),ne(t),t.helpTextShown=!1,t.element.removeClass(f)))},ue=function(){var e,t=r.currentOverlay();t&&(e=t.element.find(".avpw_textwithfont_entry"),e&&e.length&&(e.val()||(e.val(d),ie(d),ne(t),t.text=d,t.helpTextShown=!0,t.element.addClass(f),B())))},ce=function(){var e=r.currentOverlay();te(e,D||w[0]),oe(e,F||1)},de=function(){var e=r.currentOverlay();e&&e.element.find(".avpw_textwithfont_entry").css({color:"transparent","text-shadow":""})},pe=function(e){var t=r.currentOverlay();t&&t.mode===M.EDIT_STATE?t.helpTextShown&&le():e.target&&avpw$(e.target).trigger("blur")},he=function(e){var t,o=r.currentOverlay();if(o){if(o.helpTextShown&&le(),t=o.element.find(".avpw_textwithfont_entry").eq(0).val(),o.text=t,ie(t),S||A)return;ne(o),r.saveDimensions()}},fe=function(){var e=r.currentOverlay();e&&ne(e)},me=function(){avpw$("#avpw_controlpanel_textwithfont").delegate(".avpw_isa_preset_color","click",z).delegate(".avpw_isa_color_picker","click",H),avpw$("#avpw_textwithfont_addtext").bind("click",q),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").delegate(".avpw_selection_overlay","keydown",pe).delegate(".avpw_selection_overlay","keyup",he),avpw$("#avpw_controlpanel_textwithfont").find(".avpw_inset_button").pressed("avpw_inset_button_down")},ge=function(){avpw$("#avpw_controlpanel_textwithfont").undelegate(".avpw_isa_preset_color","click").undelegate(".avpw_isa_color_picker","click"),avpw$("#avpw_textwithfont_addtext").unbind("click",q),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").undelegate(".avpw_selection_overlay","keydown").undelegate(".avpw_selection_overlay","keyup"),avpw$("#avpw_controlpanel_textwithfont").find(".avpw_inset_button").unbind()},ve=function(){var e,t,r;if(b={},y)for(t=y.length,e=0;t>e;e++)r=y[e],b[y[e].label]=r},_e=function(){var t,r,o=w.length,a="";for(t=0;o>t;t++)r={color:w[t]},a+=e.template[e.launchData.layout].brushColorIcon(r);avpw$("#avpw_textwithfont_colors").html(a)},xe=function(e){var t=2*P+C;e?a+=t:a-=t,(a>T||0>a)&&(a=C)};R.init=function(o){t=o,e.launchData.textColorPresets&&(w=e.launchData.textColorPresets),_e(),ve(),i=new e.Dropdown({defaultValue:p.label,updateElement:avpw$("#avpw_font_browser"),popupElement:avpw$(e.template[e.launchData.layout].fontGroupPopup()),popupParent:avpw$("#avpw_controls"),items:y,itemTemplate:e.template[e.launchData.layout].fontGroupPopupItem,onItemClicked:O}),t.layoutNotify(e.launchData.openType,"subscribeToResize",["buildTextWithFontPresets",function(){_e(),i&&i.position()}]),r=new e.OverlayController(o,o.paintWidget,{modes:M,onModeChange:function(e,t){e.text||ue(),de(),t===M.DRAG_STATE?(B(),e.element.find(".avpw_textwithfont_entry").trigger("blur")):t===M.EDIT_STATE&&(e.element.find(".avpw_textwithfont_entry").removeClass(m),ce())},handlePosition:e.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT})},R.panelWillOpen=function(){o=t.paintWidget.resourceProvider.utils.TextProvider,ue(),S=!1,A=!1,E=p,P=h,D=w[0],$(E),X(L),t.canvasUI&&t.canvasUI.subscribe(R),me(),avpw$.miniColors&&(e.miniColors=new avpw$.miniColors),k(),t.layoutNotify(e.launchData.openType,"hideZoomButton"),t.layoutNotify(e.launchData.openType,"showCanvasControlsElement"),t.layoutNotify(e.launchData.openType,"scaleCanvas"),r.activate(),a=C},R.panelDidOpen=function(){N(),Y(D),i&&(i.position(),i.update()),c.on("layout:resize",we)};var we=function(){i&&i.position()};return R.panelWillClose=function(){U(),ge(),t.canvasUI&&t.canvasUI.unsubscribe(R),l&&(l.hideColorPicker(),l=null),e.miniColors=null,i&&i.hide(),t.layoutNotify(e.launchData.openType,"showZoomButton"),t.layoutNotify(e.launchData.openType,"hideCanvasControlsElement"),r.deactivate(),c.off("layout:resize",we)},R.shutdown=function(){t&&t.layoutNotify(e.launchData.openType,"unsubscribeToResize",["buildTextWithFontPresets"]),i&&(i.shutdown(),i=void 0),t=null,b=null},R.mouseDownEvent=function(e,t){return r.updateUIDown(e,t,function(e,t){t&&e.element.find(".avpw_textwithfont_entry").removeClass(m),ue()},function(e){s=e.textSize},function(e){c.trigger("usage:interact","textwithfont","textremoved",e.text),r.isLastOverlayAdded(e)&&xe()})},R.mouseMoveEvent=function(e,t){return r.updateUIMove(e,t,function(e){e.mode!==M.EDIT_STATE&&e.element.find(".avpw_textwithfont_entry").addClass(m),e.wasMoved&&e.element.find(".avpw_textwithfont_entry").trigger("blur")},function(e,t){t=t||1,ae(t),B()}),!1},R.mouseUpEvent=function(e,t){r.apply(e,t,function(e,t,o){t?(Y(e.textColor),ee(e.textSize),X(e.textOutline),$(e.textFont),Q(e.textFont),e.text?ie(e.text):ue(),fe(),o||e.wasMoved||!r.isLastOverlayAdded(e)||(e.wasMoved=!0,xe())):e&&e.element.find(".avpw_textwithfont_entry").trigger("blur"),o&&c.trigger("usage:interact","textwithfont","sizechanged",e?e.textSize:"")})},R.onEnableZoomMode=function(){return t.canvasUI&&t.canvasUI.unsubscribe(R),!1},R.onDisableZoomMode=function(){t.canvasUI&&t.canvasUI.subscribe(R)},R.commit=function(){var e=[];r.commit(function(t){var r=W(t);r&&e.push(r)}),e&&e.length&&(t.paintWidget.module.textwithfont.applyMultiple(e,"text"),t.paintWidget.module.textwithfont.commit())},R}(),e.ControlsWidget.prototype.tool.focus=function(){var r,o,a,i,n=150,s=10,l={OFF_STATE:0,DRAG_STATE:1},u={},d="radial",p=30,h=-1,f=-1,m=80,g=function(){a.element.stop().animate({opacity:1},100)},v=function(){a.element.stop().animate({opacity:0},300)},_=function(){avpw$(".avpw_tiltshift_rectangle_button").removeClass("avpw_preset_icon_active"),avpw$(".avpw_tiltshift_circle_button").addClass("avpw_preset_icon_active"),i.removeClass("avpw_tiltshift_rectangle").addClass("avpw_tiltshift_circle"),d="radial",o.setHandlePosition(e.OverlayController.HANDLE_POSITION.BOTTOM_CENTER),w(5.49778714),C(),c.trigger("usage:interact","focus","CircleClicked")},x=function(){avpw$(".avpw_tiltshift_circle_button").removeClass("avpw_preset_icon_active"),avpw$(".avpw_tiltshift_rectangle_button").addClass("avpw_preset_icon_active"),i.removeClass("avpw_tiltshift_circle").addClass("avpw_tiltshift_rectangle"),d="linear",o.setHandlePosition(e.OverlayController.HANDLE_POSITION.BOTTOM_CENTER),w(0),C(),c.trigger("usage:interact","focus","RectangleClicked")},w=function(t){var i=e.controlsWidgetInstance.canvasUI.viewport.getRatio();a.element.css({width:n,height:n,top:r.paintWidget.height/2/i-n/2,left:r.paintWidget.width/2/i-n/2}),o.setRotation(a,t),o.saveDimensions(a)},y=function(t,l,u,c){var d,p,h,f,m,g,v=Math.floor(4294967295*Math.random()).toString(16),_="avpw_tiltshift_overlay-"+v;g="minimum"===e.launchData.theme&&"Microsoft Internet Explorer"==navigator.appName?'<div class="avpw_tiltshift_shape"><img class="avpw_ie_img_event_bubble"/></div>':'<div class="avpw_tiltshift_shape"></div>',i=avpw$(e.template[e.launchData.layout].selectionOverlay({id:_,body:g})).addClass("avpw_tiltshift_overlay"),h=1,r.canvasUI&&(h=r.canvasUI.viewport.getRatio()),f=n+2*s,d=t/h-f/2,p=l/h-f/2,m={left:d+"px",top:p+"px",width:n+"px",height:n+"px"},i.css(m),a={id:_,initialCoordsX:0,initialCoordsY:0,element:i},o.newOverlay(a)},b=function(){};u.init=function(t){r=t,avpw$.support.touch&&(g=v=function(){}),p=.1*r.paintWidget.width<r.paintWidget.height?r.paintWidget.width:r.paintWidget.height,e.OverlayController&&(o=new e.OverlayController(t,t.paintWidget,{modes:l,aspectRatio:1,handlePosition:e.OverlayController.HANDLE_POSITION.BOTTOM_CENTER,forceDragMode:!0,minimumOverlaySize:40,maximumOverlaySize:p}))},u.panelDidOpen=function(){_(),c.trigger("usage:interact","focus","Opened"),c.on("canvas:resize",T)},u.panelWillOpen=function(){if(e.featherGLEnabled&&(m=0),r.canvasUI&&r.canvasUI.subscribe(u),avpw$("#avpw_controlpanel_focus").delegate(".avpw_tiltshift_circle_button","mousedown",_).delegate(".avpw_tiltshift_rectangle_button","mousedown",x),o){o.activate();var t=Math.min(r.paintWidget.width,r.paintWidget.height);n>t&&(n=.9*t,40>n&&(n=40)),y(r.paintWidget.width/2,r.paintWidget.height/2,100,100)}},u.panelWillClose=function(){r.canvasUI&&r.canvasUI.unsubscribe(u),avpw$("#avpw_controlpanel_focus").undelegate(),o&&o.deactivate(),c.trigger("usage:interact","focus","Closed"),c.off("canvas:resize",T)},u.shutdown=function(){b(),r=null,c.off("canvas:resize",M)};var M=function(){for(var t=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),o=(a.element.position(),a.element[0]),i=o?parseInt(o.style.width,10):0,n=o?avpw$(o).height():0,s=o?parseInt(o.style.left,10):0,l=o?parseInt(o.style.top,10):0,u=r.paintWidget.width,c=r.paintWidget.height,p=(s+i/2)*t/u,h=(l+n/2)*t/c,f=(i/2*t-3)/u,m=180-(a.rotation||0)*(180/Math.PI);0>m;)m+=180;r.paintWidget.module.focus.applyPreview(d,[p,h],f,m)},C=function(){e.msie||(t.clearTimeout(f),f=t.setTimeout(M,m))},T=function(){t.clearTimeout(f),f=t.setTimeout(M,5)};return u.mouseDownEvent=function(e,t){return g(),o.updateUIDown(e,t,function(){},null,function(e){},function(){v()})},u.mouseMoveEvent=function(e,r,i){return a&&(g(),t.clearTimeout(h),h=t.setTimeout(v,900),o.updateUIMove(e,null,null,C,C)),!1},u.mouseUpEvent=function(t,r){e.msie&&M(),o.apply(t,r)},u.onEnableZoomMode=function(){return r.canvasUI&&(r.canvasUI.unsubscribe(u),v()),!1},u.onDisableZoomMode=function(){r.canvasUI&&(r.canvasUI.subscribe(u),g())},u.cancel=function(){c.off("canvas:resize",T),c.trigger("usage:interact","focus","Canceled")},u.commit=function(){r.paintWidget.module.focus.commit(),c.trigger("usage:interact","focus","Applied",d)},u.onUndoComplete=function(e){return e&&e.global?(r.paintWidget.module.focus.resetImageData(),!1):void 0},u.onRedoComplete=function(e){return e&&e.global?(r.paintWidget.module.focus.resetImageData(),!1):void 0},u}(),e.ControlsWidget.prototype.tool.vignette=function(){var o,a,i,n,s,l,u,d,p=150,h=10,f={OFF_STATE:0,DRAG_STATE:1},m={},g="circle",v=100,_=40,x=function(t,r,s,l){var u,c,d,f,m,g,v=(Math.floor(4294967295*Math.random()).toString(16),"");g="minimum"===e.launchData.theme&&"Microsoft Internet Explorer"==navigator.appName?'<div class="avpw_tiltshift_shape"><img class="avpw_ie_img_event_bubble"/></div>':'<div class="avpw_tiltshift_shape"></div>',n=avpw$(e.template[e.launchData.layout].selectionOverlay({id:v,body:g})).addClass("avpw_shape_overlay avpw_vignette_overlay"),n.append('<div class="avpw_skew_vertical avpw_crop_handle"></div>').append('<div class="avpw_skew_horizontal avpw_crop_handle"></div>'),d=1,o.canvasUI&&(d=o.canvasUI.viewport.getRatio()),f=p+2*h,u=t/d-f/2,c=r/d-f/2,m={left:u+"px",top:c+"px",width:p+"px",height:p+"px"},n.css(m),i={id:v,initialCoordsX:0,initialCoordsY:0,element:n},a.newOverlay(i),e.util.nextFrame(function(){n.css("opacity",1).show().stop().animate({opacity:0},1e3,function(){avpw$(this).css("opacity","")})})},w=function(){};m.init=function(t){o=t,s=.1*o.paintWidget.width<o.paintWidget.height?o.paintWidget.width:o.paintWidget.height,e.OverlayController&&(a=new e.OverlayController(t,t.paintWidget,{modes:f,aspectRatio:1,handlePosition:e.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT,forceDragMode:!0,minimumOverlaySize:10,maximumOverlaySize:999999,enableFreeAspectRatioMode:!0,disableRotation:!0})),u=new o.Slider({element:r.getElementById("avpw_vignette_slider"),min:-100,max:100,defaultValue:v,onslide:y,onchange:y})};var y=function(e,t){v=t.value,l=0>v?"white":"black",M()};m.panelDidOpen=function(){c.trigger("usage:interact","vignette","Opened"),c.on("canvas:resize",C)},m.panelWillOpen=function(){if(e.featherGLEnabled&&(_=0),o.canvasUI&&o.canvasUI.subscribe(m),a){a.activate();var t=e.controlsWidgetInstance.canvasUI.viewport.getRatio();p=o.paintWidget.height/t*.8;var r=Math.min(o.paintWidget.width,o.paintWidget.height);p>r&&(p=.9*r,40>p&&(p=40)),x(o.paintWidget.width/2,o.paintWidget.height/2,100,100)}l="black",v=100,u.reset(),u.addListeners(),M()},m.panelWillClose=function(){o.canvasUI&&o.canvasUI.unsubscribe(m),a&&a.deactivate(),c.trigger("usage:interact","vignette","Closed"),c.off("canvas:resize",C)},m.shutdown=function(){w(),o=null,c.off("canvas:resize",b)};var b=function(){var t=e.controlsWidgetInstance.canvasUI.viewport.getRatio(),r=i.element[0],a=r?parseInt(r.style.width,10):0,n=r?avpw$(r).height():0,s=r?parseInt(r.style.left,10):0,l=r?parseInt(r.style.top,10):0,u=v>0?"black":"white",c=o.paintWidget.width,d=o.paintWidget.height,p=[s*t/c,l*t/d,a*t/c,n*t/d];o.paintWidget.module.vignette.applyPreview(u,p,Math.abs(v)/100,.75)},M=function(){e.msie||(t.clearTimeout(d),d=t.setTimeout(b,_))},C=function(){t.clearTimeout(d),d=t.setTimeout(b,5)},T=!1;return m.mouseDownEvent=function(e,t){return T=!0,n.addClass("avpw_overlay_prevent_fade"),a.updateUIDown(e,t,function(){},null,function(e){},function(){})},m.mouseOutEvent=function(){n.removeClass("avpw_overlay_prevent_fade")},m.mouseMoveEvent=function(e,t,r){return i&&a.updateUIMove(e,null,null,function(){n.addClass("avpw_overlay_show_indicator"),M()},M),!1},m.mouseUpEvent=function(t,r){e.msie&&b(),a.apply(t,r),T=!1,n.removeClass("avpw_overlay_show_indicator"),n.removeClass("avpw_overlay_prevent_fade")},m.onEnableZoomMode=function(){return o.canvasUI&&o.canvasUI.unsubscribe(m),!1},m.onDisableZoomMode=function(){o.canvasUI&&o.canvasUI.subscribe(m)},m.cancel=function(){c.off("canvas:resize",C),c.trigger("usage:interact","vignette","Canceled")},m.commit=function(){o.paintWidget.module.vignette.commit(),c.trigger("usage:interact","vignette","Applied",g)},m.onUndoComplete=function(e){return e&&e.global?!1:void 0},m.onRedoComplete=function(e){return e&&e.global?!1:void 0},m}(),e.languageStrings={"Enter text here":"\u5728\u6b64\u8f93\u5165\u6587\u672c",Save:"\u4fdd\u5b58","Photo Editor":"\u7167\u7247\u7f16\u8f91\u5668",Cancel:"\u53d6\u6d88",Rotate:"\u65cb\u8f6c",Mirror:"\u955c\u50cf",Width:"\u5bbd\u5ea6","Maintain proportions":"\u4fdd\u6301\u6bd4\u4f8b",Height:"\u9ad8\u5ea6",Frame:"\u76f8\u6846",Enhance:"\u589e\u5f3a",Night:"\u591c\u665a",Balance:"\u5e73\u8861","Hi-Def":"\u9ad8\u6e05",Illuminate:"\u53d1\u5149","Color Fix":"\u8272\u5f69\u4fee\u6b63","Color Picker":"\u62fe\u8272\u5668",Eraser:"\u6a61\u76ae\u64e6","Brush Size":"\u753b\u7b14\u5927\u5c0f","Add Text":"\u6dfb\u52a0\u6587\u672c","Free Color":"\u968f\u610f\u6d82\u8272","Smart Color":"\u667a\u80fd\u4e0a\u8272",Shape:"\u5f62\u72b6",Apply:"\u5e94\u7528","Your work was saved!":"\u60a8\u7684\u4f5c\u54c1\u5df2\u4fdd\u5b58\uff01",Resume:"\u7ee7\u7eed",Close:"\u5173\u95ed","Get this editor":"\u83b7\u53d6\u8fd9\u6b3e\u7f16\u8f91\u5668",
"Width and height must be greater than zero and less than the maximum ({max}px)":"\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u5fc5\u987b\u5927\u4e8e\u96f6\u4e14\u5c0f\u4e8e\u6700\u5927\u503c\n\uff08{max} \u50cf\u7d20\uff09",OK:"\u786e\u5b9a","Are you sure? This can distort your image":"\u662f\u5426\u786e\u5b9a\uff1f\u8fd9\u6837\u505a\u4f1a\u626d\u66f2\u60a8\u7684\u56fe\u50cf","Wait! You didn't save your work. Are you certain that you want to close this editor?":"\u8bf7\u7a0d\u7b49\uff01\u60a8\u8fd8\u6ca1\u6709\u4fdd\u5b58\u60a8\u7684\u4f5c\u54c1\u3002\u662f\u5426\u786e\u5b9a\u8981\u5173\u95ed\u7f16\u8f91\u5668\uff1f","Help / Support":"\u5e2e\u52a9 / \u652f\u6301","Have a suggestion to improve this photo editor? Let us know.":"\u5982\u679c\u60a8\u6709\u4efb\u4f55\u6709\u5173\u6539\u8fdb\u8be5\u7167\u7247\u7f16\u8f91\u5668\u7684\u5b9d\u8d35\u5efa\u8bae\uff0c\u8bf7\u544a\u8bc9\u6211\u4eec\u3002","Send Feedback":"\u53d1\u9001\u53cd\u9988\u610f\u89c1","About this editor":"\u5173\u4e8e\u6b64\u7f16\u8f91\u5668","Aviary is the world's leading photo editing platform. Developers: learn how to add it to your app in minutes.":"Aviary \u662f\u4e16\u754c\u9886\u5148\u7684\u56fe\u7247\u7f16\u8f91\u5e73\u53f0\u3002\u5f00\u53d1\u5546\uff1a\u5b66\u4e60\u5982\u4f55\u5feb\u6377\u5730\u5c06\u5176\u6dfb\u52a0\u5230\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002","Visit Aviary.com":"\u8bbf\u95ee Aviary.com","Please install {Adobe Flash Player} (version {min} or higher), or use a supported browser: {Chrome}, {Firefox}, {Safari}, {Opera}, or {Internet Explorer} (version 9 or higher).":"\u8bf7\u5b89\u88c5 {Adobe Flash Player}\uff08{min} \u6216\u66f4\u9ad8\u7248\u672c\uff09\uff0c\u6216\u4f7f\u7528\u652f\u6301\u7684\u6d4f\u89c8\u5668\uff1a{Chrome}\u3001{Firefox}\u3001{Safari}\u3001{Opera} \u6216 {Internet Explorer}\uff089 \u6216\u66f4\u9ad8\u7248\u672c\uff09\u3002","Your photo is smaller than the required size. Please choose a new one to proceed.":"\u60a8\u7684\u7167\u7247\u5c0f\u4e8e\u6240\u9700\u7684\u5c3a\u5bf8\u3002\u8bf7\u9009\u62e9\u65b0\u7684\u7167\u7247\u518d\u7ee7\u7eed\u3002","Zoom Mode":"\u7f29\u653e\u6a21\u5f0f","Click to release":"\u5355\u51fb\u4ee5\u91ca\u653e",Effects:"\u6548\u679c",Frames:"\u76f8\u6846",Stickers:"\u8d34\u7eb8",Focus:"\u7126\u70b9",Orientation:"\u65b9\u5411",Brightness:"\u4eae\u5ea6",Contrast:"\u5bf9\u6bd4\u5ea6",Saturation:"\u9971\u548c\u5ea6",Warmth:"\u8272\u6e29",Sharpness:"\u9510\u5ea6",Splash:"\u7b14\u5237",Draw:"\u7ed8\u5236",Text:"\u6587\u672c",Redeye:"\u7ea2\u773c",Whiten:"\u589e\u767d",Blemish:"\u7455\u75b5","Powered by":"\u6280\u672f\u652f\u6301\uff1a",Crop:"\u88c1\u5207","Please crop your photo to":"\u8bf7\u5c06\u7167\u7247\u88c1\u526a\u4e3a",Remove:"\u79fb\u53bb","Set Color":"\u8bbe\u7f6e\u989c\u8272","Lock Dimensions":"\u9501\u5b9a\u5c3a\u5bf8",Custom:"\u81ea\u5b9a\u4e49",Resize:"\u8c03\u6574\u5927\u5c0f",Scenery:"\u573a\u666f",Food:"\u98df\u7269",Portrait:"\u4eba\u50cf",Overlays:"\u5c42\u53e0",Lighting:"\u5149\u6548",Highlights:"\u9ad8\u5149",Shadows:"\u9634\u5f71",Color:"\u989c\u8272",Tint:"\u8272\u8c03",Fade:"\u892a\u8272",Vignette:"\u6655\u5f71",Meme:"Meme","Enter top text":"\u8f93\u5165\u9876\u90e8\u6587\u672c","Enter bottom text":"\u8f93\u5165\u5e95\u90e8\u6587\u672c"},!function v(e,t,r){function o(i,n){if(!t[i]){if(!e[i]){var s="function"==typeof require&&require;if(!n&&s)return s(i,!0);if(a)return a(i,!0);var l=new Error("Cannot find module '"+i+"'");throw l.code="MODULE_NOT_FOUND",l}var u=t[i]={exports:{}};e[i][0].call(u.exports,function(t){var r=e[i][1][t];return o(r?r:t)},u,u.exports,v,e,t,r)}return t[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,r){!function(){function r(){this.glBuffers={},this.glBuffers={},this.glPrograms={},this.glRenderingObjects={},this.glImageData={},this.renderingMode=m.DEFAULT,this.freeTextures=[],this.currentVertices=[],this.currentTexCoords=[],this.currentIndeces=[],this.currentBlendMode=g.NONE,this.freeTextures=[],this.stateOK=!0,this.gl}var o={MoaTransformImageVertexShader:["precision highp float;","attribute highp vec4 a_position;","attribute highp vec2 a_texCoord;","uniform highp mat4 u_transform;","varying highp vec2 v_texCoord;","","void main(void) {","v_texCoord = (vec4(a_texCoord.x, a_texCoord.y, 0.0, 1.0) * u_transform).xy;","gl_Position = a_position;","}"].join("\n"),MoaTransformImageFragmentShader:["precision highp float;","uniform highp sampler2D u_sampler;","uniform highp float u_factor;","varying highp vec2 v_texCoord;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","","}"].join("\n"),MoaTransformOverlayVertexShader:["precision highp float;","attribute highp vec4 a_position;","attribute highp vec2 a_texCoord;","uniform highp mat4 u_transform;","varying highp vec2 v_texCoord;","","void main(void) {","v_texCoord = a_texCoord;","gl_Position = (vec4(a_position.x, a_position.y, 0.0, 1.0) * u_transform);","}"].join("\n"),MoaTransformOverlayFragmentShader:["precision highp float;","uniform highp sampler2D u_sampler;","uniform highp sampler2D u_overlaySampler;","uniform highp float u_alpha;","uniform highp float u_factor;","varying highp vec2 v_texCoord;","void main(void) {","//                                                            vec4 color = texture2D(u_overlaySampler, v_texCoord);","//                                                            color.a = color.a * u_alpha;","//                                                            gl_FragColor = color;","gl_FragColor = texture2D(u_overlaySampler, v_texCoord) * u_alpha;","","}"].join("\n"),MoaDotMatrixVertexShader:["attribute highp vec2 a_position;","uniform float u_pointSize;","","void main()","{","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","gl_PointSize = u_pointSize;","}"].join("\n"),MoaDotMatrixFragmentShader:["precision highp float;","","uniform sampler2D u_dotSampler;","","void main()","{","gl_FragColor = texture2D(u_dotSampler, gl_PointCoord);","}"].join("\n"),MoaBasicDotsVertexShader:["attribute highp vec2 a_position;","attribute highp float a_pointSize;","","void main()","{","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","gl_PointSize = a_pointSize;","}"].join("\n"),MoaBlurModesPixelateFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 newCoords = (floor(v_texCoord / pixelDims) + 0.5) * pixelDims;","","newCoords = (floor(newCoords * dims) / dims);","","gl_FragColor = texture2D(u_sampler, newCoords);","","}"].join("\n"),MoaBlurModesTrianglesFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","numPixels.x = 2.0 * numPixels.x;","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(mod(pixelNum.x, 2.0) == mod(pixelNum.y, 2.0)){","if(coordsDiff.y <= coordsDiff.x){","newCoords.x = pixelNum.x * pixelDims.x;","}else{","newCoords.x = (pixelNum.x + 1.0) * pixelDims.x;","}","}else{","if(coordsDiff.y <= -coordsDiff.x){","newCoords.x = (pixelNum.x + 1.0) * pixelDims.x;","}else{","newCoords.x = pixelNum.x * pixelDims.x;","}","","}","","newCoords = (floor(newCoords * dims) / dims);","","gl_FragColor = texture2D(u_sampler, newCoords);","","}"].join("\n"),MoaBlurModesCirclesFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = u_minDimPixels * vec2(u_width, u_height) / u_minDim;","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 newCoords2 = newCoords;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","newCoords2.x = coordsDiff.x > 0.0 ? pixelNum.x * pixelDims.x : (pixelNum.x + 1.0) * pixelDims.x;","newCoords2.y = coordsDiff.y > 0.0 ? pixelNum.y * pixelDims.y : (pixelNum.y + 1.0) * pixelDims.y;","","float radius = length(coordsDiff);","","float alpha = clamp(10.0 * radius - 4.75, 0.0, 1.0);","","gl_FragColor = mix(texture2D(u_sampler, newCoords), texture2D(u_sampler, newCoords2), alpha);","","}"].join("\n"),MoaBlurModesDiamondsFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","numPixels.x = 1.5 * numPixels.x;","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(mod(pixelNum.x, 2.0) == mod(pixelNum.y, 2.0)){","if(coordsDiff.y <= coordsDiff.x){","newCoords.x = pixelNum.x * pixelDims.x;","newCoords.y = (pixelNum.y + 1.0) * pixelDims.y;","}else{","newCoords.x = (pixelNum.x + 1.0) * pixelDims.x;","newCoords.y = pixelNum.y * pixelDims.y;","}","}else{","if(coordsDiff.y <= -coordsDiff.x){","newCoords = (pixelNum + 1.0) * pixelDims;","}else{","newCoords = pixelNum * pixelDims;","}","}","","","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesHoundstoothFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","float diagDist = abs(coordsDiff.y - coordsDiff.x);","","if(coordsDiff.x < 0.0 && coordsDiff.y < 0.0){","newCoords = (pixelNum + 0.75) * pixelDims;","}else if(coordsDiff.x >= 0.0 && coordsDiff.y >= 0.0){","newCoords = (pixelNum + 0.25) * pixelDims;","}else if(coordsDiff.x < 0.0 && coordsDiff.y >= 0.0){","if(diagDist < 0.25){","newCoords = (pixelNum + 0.75) * pixelDims;","}else if(diagDist < 0.5){","newCoords = (pixelNum + 0.25) * pixelDims;","}else if(diagDist < 0.75){","newCoords.y = (pixelNum.y - 0.25) * pixelDims.y;","newCoords.x = (pixelNum.x + 0.75) * pixelDims.x;","}else{","newCoords.y = (pixelNum.y + 0.25) * pixelDims.y;","newCoords.x = (pixelNum.x + 1.25) * pixelDims.x;","}","}else{","if(diagDist < 0.25){","newCoords = (pixelNum + 0.75) * pixelDims;","}else if(diagDist < 0.5){","newCoords = (pixelNum + 0.25) * pixelDims;","}else if(diagDist < 0.75){","newCoords.y = (pixelNum.y + 0.75) * pixelDims.y;","newCoords.x = (pixelNum.x - 0.25) * pixelDims.x;","}else{","newCoords.y = (pixelNum.y + 1.25) * pixelDims.y;","newCoords.x = (pixelNum.x + 0.25) * pixelDims.x;","}","}","","","","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesChevronsFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(coordsDiff.x + coordsDiff.y < -0.5 || coordsDiff.x - coordsDiff.y > 0.5){","newCoords.y = (pixelNum.y + 1.25) * pixelDims.y;","}else if(coordsDiff.y < coordsDiff.x || coordsDiff.y < -coordsDiff.x){","newCoords.y = (pixelNum.y + 0.75) * pixelDims.y;","}else{","newCoords.y = (pixelNum.y + 0.25) * pixelDims.y;","}","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesSinesFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims)","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(coordsDiff.y >= 0.25 * cos(2.0 * 3.14159265358979323846264338327950288 * coordsDiff.x) + 0.25){","newCoords.x = newCoords.x - 0.5 * step(0.0, coordsDiff.x) * pixelDims.x + 0.5 * step(coordsDiff.x,0.0) * pixelDims.x;","newCoords.y = newCoords.y - 0.5 * pixelDims.y;","}else if(coordsDiff.y <= -0.25 * cos(2.0 * 3.14159265358979323846264338327950288 * coordsDiff.x) - 0.25){","newCoords.x = newCoords.x - 0.5 * step(0.0, coordsDiff.x) * pixelDims.x + 0.5 * step(coordsDiff.x,0.0) * pixelDims.x;","newCoords.y = newCoords.y + 0.5 * pixelDims.y;","}","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesScalesFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","numPixels = floor(numPixels);","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (floor(v_texCoord / pixelDims) + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","vec2 tempDiff1 = coordsDiff + 0.5;","vec2 tempDiff2 = vec2(coordsDiff.x - 0.5, coordsDiff.y + 0.5);","","if(length(coordsDiff) >= 0.5 && coordsDiff.y > 0.0){","newCoords.x = (step(0.0, coordsDiff.x) * pixelNum.x + step(coordsDiff.x, 0.0) * (pixelNum.x + 1.0)) * pixelDims.x;","newCoords.y = pixelNum.y * pixelDims.y;","}else if(length(tempDiff1) <= 0.5 || length(tempDiff2) <= 0.5){","newCoords.x = (step(0.0, coordsDiff.x) * pixelNum.x + step(coordsDiff.x, 0.0) * (pixelNum.x + 1.0)) * pixelDims.x;","newCoords.y = (pixelNum.y + 1.0) * pixelDims.y;","}","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesBricksFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","numPixels = floor(numPixels);","","numPixels.y = 1.25 * numPixels.y;","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","newCoords.y = newCoords.y + 0.25 * pixelDims.y;","","if(coordsDiff.y > 0.0){","if(coordsDiff.x > 0.0){","newCoords.x = pixelNum.x * pixelDims.x;","}else{","newCoords.x = (pixelNum.x + 1.0) * pixelDims.x;","}","newCoords.y = (pixelNum.y + 0.25) * pixelDims.y;","}","","gl_FragColor = texture2D(u_sampler, newCoords);","}"].join("\n"),MoaBlurModesHeartsFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = u_minDimPixels * vec2(u_width, u_height) / u_minDim;","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","vec2 newCoords2 = newCoords;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(coordsDiff.x > 0.0){","newCoords2.x = pixelNum.x * pixelDims.x;","}else{","newCoords2.x = (pixelNum.x + 1.0) * pixelDims.x;","}","","if(coordsDiff.y > 0.2){","newCoords2.y = pixelNum.y * pixelDims.y;","}else{","newCoords2.y = (pixelNum.y + 1.0) * pixelDims.y;","}","","float metric = step(coordsDiff.y, 0.2) * (0.29 * sin(1.25 * 3.14159265358979323846264338327950288 * (coordsDiff.y + 0.2)) + 0.29 - abs(coordsDiff.x)) + step(0.2, coordsDiff.y) * ((0.33 - length(vec2(abs(coordsDiff.x) - 0.23, coordsDiff.y - 0.18))));","","float alpha = clamp(12.5 * metric, 0.0, 1.0);","","gl_FragColor = mix(texture2D(u_sampler, newCoords2), texture2D(u_sampler, newCoords), alpha);","","}"].join("\n"),MoaBlurModesHexagonsFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_minDim;","uniform float u_minDimPixels;","","void main(){","vec2 dims = vec2(u_width, u_height);","","float pixelSize = u_minDim / u_minDimPixels;","","vec2 numPixels = vec2(u_width / pixelSize, u_height / pixelSize);","","numPixels = floor(numPixels);","","//There seems to be a rounding error causing the above to give the wrong number of pixels on low res images.","if(u_width < u_height){","numPixels.x = u_minDimPixels;","}else{","numPixels.y = u_minDimPixels;","}","","numPixels.x = 0.5 * numPixels.x;","","vec2 pixelDims = 1.0 / numPixels;","","vec2 pixelNum = floor(v_texCoord / pixelDims);","","vec2 newCoords = (pixelNum + 0.5) * pixelDims;","","vec2 coordsDiff = (newCoords - v_texCoord) / pixelDims;","","if(coordsDiff.y > 0.0){","if(coordsDiff.y > -3.0 * coordsDiff.x + 1.0){","newCoords = pixelNum * pixelDims;","}else if(coordsDiff.y > 3.0 * coordsDiff.x + 1.0){","newCoords.x = (pixelNum.x + 1.0) * pixelDims.x;","newCoords.y = pixelNum.y * pixelDims.y;","}","}else{","if(coordsDiff.y < 3.0 * coordsDiff.x - 1.0){","newCoords.x = pixelNum.x * pixelDims.x;","newCoords.y = (pixelNum.y + 1.0) * pixelDims.y;","}else if(coordsDiff.y < -3.0 * coordsDiff.x - 1.0){","newCoords = (pixelNum + 1.0) * pixelDims;","}","}","","gl_FragColor = texture2D(u_sampler, newCoords);","","}"].join("\n"),MoaAirbrushFragmentShader:["precision highp float;","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_samplerLF;","uniform lowp sampler2D u_samplerLLF;","","varying highp vec2 v_texCoord;","","void main() {","vec4 img = texture2D(u_sampler, v_texCoord);","vec4 imgLF = texture2D(u_samplerLF, v_texCoord);","vec4 imgLLF = texture2D(u_samplerLLF, v_texCoord);","","// MF = imgLF - imgLLF","// HF = img - imgLF","// img = imgLLF + MF + HF","// img = imgLLF + img - imgLF + imgLF - imgLLF","","// want result = imgLLF + HF = imgLLF + img - imgLF","","float alpha = 1.0;","","vec4 blendColor = imgLLF + img - imgLF;// + 0.4*(imgLF - imgLLF);","","vec4 result = mix(img, blendColor, alpha);","","gl_FragColor = vec4(result.rgb,img.a);","}"].join("\n"),MoaMascaraFragmentShader:["precision highp float;","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_samplerLF;","uniform lowp sampler2D u_samplerLLF;","","varying highp vec2 v_texCoord;","","void main() {","vec4 img = texture2D(u_sampler, v_texCoord);","vec4 imgLF = texture2D(u_samplerLF, v_texCoord);","vec4 imgLLF = texture2D(u_samplerLLF, v_texCoord);","","// MF = imgLF - imgLLF","// HF = img - imgLF","// img = imgLLF + MF + HF","// img = imgLLF + img - imgLF + imgLF - imgLLF","","// want result = imgLLF + HF = imgLLF + img - imgLF","","vec4 blendColor = imgLF;","","float diff = 0.2*imgLF.r + 0.7*imgLF.g + 0.1*imgLF.b - (0.2*img.r + 0.7*img.g + 0.1*img.b);","","if(diff > 0.0) {","blendColor = img;// * (1.0 - abs(diff));","}","","gl_FragColor = vec4(blendColor.rgb,img.a);","}"].join("\n"),MoaBlemishFragmentShader:["precision highp float;","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_samplerLF;","uniform lowp sampler2D u_samplerOffset;","uniform lowp sampler2D u_samplerOffsetLF;","","uniform vec2 u_center;","uniform vec2 u_offset;","uniform vec4 u_avgColor;","uniform float u_aspectI;","uniform float u_radius;","","varying highp vec2 v_texCoord;","void main() {","vec4 img = texture2D(u_sampler, v_texCoord);","vec4 imgLF = texture2D(u_samplerLF, v_texCoord);","vec4 imgOffset = texture2D(u_samplerOffset, v_texCoord);","vec4 imgOffsetLF = texture2D(u_samplerOffsetLF, v_texCoord);","","//      float r = length(vec2(v_texCoord.x, u_aspectI * v_texCoord.y) - u_center);","float r = length(v_texCoord - u_center);","","float r2 = r*r;","float raidus2 = 0.5*0.5;","","float alpha = 1.15651764275 * exp(-2.0 * r2/raidus2) - 0.13533528323;","alpha = clamp(alpha, 0.0, 1.0);","","float alphaLF = 1.01865736036 * exp(-4.0 * r2/raidus2) - 0.01831563888;","alphaLF = clamp(alphaLF, 0.0, 1.0);","","vec4 highFreqColor = (imgOffset - imgOffsetLF);","float highFreqOffset = 1.25 * (0.1 * highFreqColor.r + 0.7 * highFreqColor.g + 0.2 * highFreqColor.b);","","vec4 blendColor = mix(imgLF, u_avgColor, alphaLF);","blendColor = blendColor + highFreqOffset;","vec4 result = mix(img, blendColor, alpha);","","gl_FragColor = vec4(result.rgb,img.a);","}"].join("\n"),MoaWhitenFragmentShader:["precision highp float;","","uniform highp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","// RGB to LAB","float R = color.r * 255.0;","float G = color.g * 255.0;","float B = color.b * 255.0;","","float l1;","float a1;","float b1;","float r;","float g;","float b;","float x;","float y;","float z;","","if(R/255.0 <= 0.04045){r = 100.0 *R/255.0/12.92;} else{ r = 100.0*pow((R/255.0+0.055)/1.055,2.40);}","if(G/255.0 <= 0.04045){g = 100.0 *G/255.0/12.92;} else{ g = 100.0*pow((G/255.0+0.055)/1.055,2.40);}","if(B/255.0 <= 0.04045){b = 100.0 *B/255.0/12.92;} else{ b = 100.0*pow((B/255.0+0.055)/1.055,2.40);}","","x = 0.00433891*r  + 0.00376234915*g + 0.0018990604648*b;","y = 0.002126*r    + 0.007152*g      + 0.000722*b;","z = 0.000177255*r + 0.00109475308*g + 0.0087295537*b;","","if(x > 0.008856){x = pow(x,1.0/3.0);}else{x = 7.787*x+16.0/116.0;}","if(y > 0.008856){y = pow(y,1.0/3.0);}else{y = 7.787*y+16.0/116.0;}","if(z > 0.008856){z = pow(z,1.0/3.0);}else{z = 7.787*z+16.0/116.0;}","","l1 = 116.0*y-16.0;","a1 = 500.0*(x-y);","b1 = 200.0*(y-z);","","color.r = l1 * 2.55; color.g = (a1+127.0); color.b = (b1+127.0);","","// Adjust LAB","float dColor = (color.g - 132.0)*(color.g - 132.0);","","if(color.b < 127.0){","dColor += (color.b - 127.0)*(color.b - 127.0);","}","","float factor = 0.65*exp(-dColor/98.0);","","color.r = 255.0*pow(color.r/255.0,1.0/(0.5*factor+1.0));","color.b = (1.0-factor)*(color.b-127.0)+127.0;","","// LAB to RGB","float lab0 = color.r;","float lab1 = color.g;","float lab2 = color.b;","","float Y = ( lab0/2.55 + 16.0) / 116.0;","float X = (lab1-127.0) / 500.0 + Y;","float Z = Y - (lab2-127.0) / 200.0;","","float Y3 = Y*Y*Y;","float X3 = X*X*X;","float Z3 = Z*Z*Z;","","if ( Y3 > 0.008856 ){ Y = Y3;}else{Y = ( Y - 16.0 / 116.0 ) / 7.787;}","","if ( X3 > 0.008856 ){ X = X3;}else{X = ( X - 16.0 / 116.0 ) / 7.787;}","","if ( Z3 > 0.008856 ){ Z = Z3;}else{Z = ( Z - 16.0 / 116.0 ) / 7.787;}","","X = .95047  * X;","Y = 1.00000 * Y;","Z = 1.08883 * Z;","","R = X *  3.2406 + Y * -1.5372 + Z * -0.4986;","G = X * -0.9689 + Y *  1.8758 + Z *  0.0415;","B = X *  0.0557 + Y * -0.2040 + Z *  1.0570;","","if ( R > 0.0031308 ) {R = 1.055 * ( pow(R , ( 0.41666666666667 )) ) - 0.055;}else{ R = 12.92 * R;}","if ( G > 0.0031308 ) {G = 1.055 * ( pow(G , ( 0.41666666666667 )) ) - 0.055;}else{ G = 12.92 * G;}","if ( B > 0.0031308 ) {B = 1.055 * ( pow(B , ( 0.41666666666667 )) ) - 0.055;}else{ B = 12.92 * B;}","","color.r = R; color.g = G; color.b = B;","color.a = 1.0;","","gl_FragColor = color;","}"].join("\n"),MoaRedeyeOriginalFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","if(color.r >= color.g + color.b){","color.r = (color.g + color.b) / 2.0;","}","","gl_FragColor = color;","}"].join("\n"),MoaRedeye2013FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 c = texture2D(u_sampler, v_texCoord);","","float chroma = max(max(c.r,c.g),c.b)-min(min(c.r,c.g),c.b);","","float srcI = 0.2*c.r+0.7*c.g+0.1*c.b;","","float cFactor = exp(-(chroma-175.0/255.0)*(chroma-175.0/255.0)/(2.0*75.0*75.0/255.0/255.0));","if(chroma > 175.0/255.0){","cFactor = 1.0;","}","","float gFactor = c.b - c.g;","if(gFactor < 0.0){","gFactor = exp(-gFactor*gFactor/(2.0*20.0*20.0/255.0/255.0));","}else{","gFactor = 1.0;","}","","float redFactor = c.r - srcI;","if(redFactor < 0.0){","redFactor = 0.0;","}else{","redFactor = 1.0 - exp(-redFactor*redFactor/(2.0*0.1*0.1));","}","","float alpha = cFactor*redFactor*gFactor;","clamp(alpha,0.0,1.0);","","","c.r = alpha*(c.g+c.b)/2.0+(1.0-alpha)*c.r;","","gl_FragColor = c;","}"].join("\n"),MoaEyeColorFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 c = texture2D(u_sampler, v_texCoord);","","float chroma = max(max(c.r,c.g),c.b)-min(min(c.r,c.g),c.b);","float srcI = 0.2*c.r+0.7*c.g+0.1*c.b;","","//eye brightness between 40-100","//float bFactor = exp(-(srcI-75.0/255.0)*(srcI-75.0/255.0)/(2.0*27.0*27.0/255.0/255.0));","//exclude very bright","float tooBright = 137.0/255.0;","float tooDark = 10.0/255.0;","float bFactor = 1.0-exp(-(srcI-tooBright)*(srcI-tooBright)/(2.0*27.0*27.0/255.0/255.0));","bFactor *= 1.0-exp(-(srcI-tooDark)*(srcI-tooDark)/(2.0*17.0*17.0/255.0/255.0));","if(srcI > tooBright || srcI < tooDark){","bFactor = 0.0;","}","","","float chromaGoal = 38.0/255.0;","float cFactor = 1.0-exp(-(chroma-chromaGoal)*(chroma-chromaGoal)/(2.0*15.0*15.0/255.0/255.0));","","if(chroma > chromaGoal){","cFactor = 0.0;","}","","//float cFactor = 1.0-4.0*chroma;","","float alpha = bFactor*cFactor;","alpha = 0.75*clamp(alpha,0.0,1.0);","","float alphaI = 1.0-alpha;","","//vec4 eyeColor = vec4(1.0,0.0,0.0,1.0);","//vec4 eyeColor = vec4(0.0,114.0/255.0,152.0/255.0,1.0);","vec4 eyeColor = vec4(136.0/255.0,0.0/255.0,152.0/255.0,1.0);","","vec4 b = eyeColor;","vec4 a = c;","","vec4 blendColor = 2.0*a*b + a*a - 2.0*a*a*b;","gl_FragColor = mix(c, blendColor, alpha);","}"].join("\n"),MoaEyeBrightFragmentShader:["","// precision highp float;","//","// uniform lowp sampler2D u_sampler;","// varying highp vec2 v_texCoord;","// #define PI 3.14159265359","//","// void main(void) {","//     lowp vec4 c = texture2D(u_sampler, v_texCoord);","//","//     float chroma = max(max(c.r,c.g),c.b)-min(min(c.r,c.g),c.b);","//     float srcI = 0.2*c.r+0.7*c.g+0.1*c.b;","//","//     //eye brightness between 40-100","//     float bFactor = exp(-(srcI-75.0/255.0)*(srcI-75.0/255.0)/(2.0*27.0*27.0/255.0/255.0));","//     float cFactor = 1.0-3.0*chroma;","//","//     float alpha = 3.0*cFactor*cFactor;","//     alpha = clamp(alpha,0.0,1.0);","//","//     float alphaI = 1.0-alpha;","//","//     //Brighten","//     vec4 blendColor = vec4(c.rgb + 50.0/255.0*sin(c.rgb*PI)*sin(c.rgb*PI/2.0),c.a);","//","//     gl_FragColor = mix(c, blendColor, alpha);","// }","","precision highp float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_map;","uniform lowp sampler2D u_colorMapSampler;","","varying highp vec2 v_texCoord;","#define PI 3.14159265359","","void main(void) {","vec4 img = texture2D(u_sampler, v_texCoord);","","vec4 result = img;","","vec4 c = img;","","float alpha = 1.0;","","float max = max(max(c.r,c.g),c.b);","float min = min(min(c.r,c.g),c.b);","float chroma = max-min;","float srcI = 0.2*c.r+0.7*c.g+0.1*c.b;","","//eye brightness between 40-100","float bFactor = exp(-(srcI-75.0/255.0)*(srcI-75.0/255.0)/(2.0*27.0*27.0/255.0/255.0));","float cFactor = 1.0-3.0*chroma;","","float redFactor = (c.r - srcI);","if(redFactor < 0.0){","redFactor = 0.0;","}else{","redFactor = (1.0 - exp(-redFactor*redFactor/(2.0*0.1*0.1)));","}","","alpha *= cFactor;","alpha = clamp(alpha,0.0,1.0);","","// alpha *= 10.0;//0.5;","float alphaI = 1.0-alpha;","","float hue;","float s;","float l;","","l = (max + min)/2.0;","","if(chroma == 0.0){","hue = 0.0;","}else{","if(max == c.r){","hue = mod((c.g - c.b)/chroma, 6.0);","}else if(max == c.g){","hue = (c.b - c.r)/chroma + 2.0;","}else{","hue = (c.r - c.g)/chroma + 4.0;","}","","hue *= 60.0;","if(hue < 0.0){hue += 360.0;}","if(hue >= 360.0){hue -= 360.0;}","}","","if(chroma == 0.0){","s = 0.0;","}else{","s = chroma/(1.0 - abs(2.0 * l - 1.0));","}","","","// Dodge Mapping","l = texture2D(u_colorMapSampler, vec2(0,l)).r * (1.0-redFactor) + l *redFactor;","s = texture2D(u_colorMapSampler, vec2(0,s)).r * (1.0-redFactor) + s *redFactor;","","// l = dodge[Math.floor(l*255)]/255 * (1 - redFactor) + l * redFactor;","// s = dodge[Math.floor(s*255)]/255 * (1-redFactor) + s * redFactor;","","//        l = 1.2*l * (1.0 - redFactor) + l * redFactor;","//        s = 1.2*s * (1.0 - redFactor) + s * redFactor;","","","float hPrime = hue/60.0;","float C;","","if(l > 0.5) {","C = 2.0 * s * (1.0-l);","} else {","C = 2.0 * s * l;","}","","float X = C * (1.0 - abs(mod(hPrime,2.0) - 1.0));","","vec4 blendColor;","if(hPrime < 1.0){","blendColor.r = C; blendColor.g = X; blendColor.b = 0.0;","}else if(hPrime < 2.0){","blendColor.r = X; blendColor.g = C; blendColor.b = 0.0;","}else if(hPrime < 3.0){","blendColor.r = 0.0; blendColor.g = C; blendColor.b = X;","}else if(hPrime < 4.0){","blendColor.r = 0.0; blendColor.g = X; blendColor.b = C;","}else if(hPrime < 5.0){","blendColor.r = X; blendColor.g = 0.0; blendColor.b = C;","}else if(hPrime < 6.0){","blendColor.r = C; blendColor.g = 0.0; blendColor.b = X;","}","","float m = l - 0.5*C;","","blendColor.r = blendColor.r + m;","blendColor.g = blendColor.g + m;","blendColor.b = blendColor.b + m;","","","// vec4 blendColor = vec4(c.rgb + 50.0/255.0*sin(c.rgb*PI)*sin(c.rgb*PI/2.0),c.a);","","// result = 2.0*img;","result = mix(img, blendColor, alpha);","","gl_FragColor = vec4(result.rgb,img.a);","}"].join("\n"),
MoaEyeGlareFragmentShader:["precision highp float;","uniform lowp sampler2D u_sampler;","","uniform float u_angle;","uniform float u_aspectI;","uniform vec2 u_center;","uniform float u_radius;","","","varying highp vec2 v_texCoord;","","void main() {","vec4 img = texture2D(u_sampler, v_texCoord);","","vec2 coordnorm = v_texCoord / u_center;","","// float angle = (180.0-15.0) * PI/180.0;","float ca = cos(u_angle);","float sa = sin(u_angle);","","float d2 = 0.7*u_radius;","","vec2 center2 = vec2(d2*ca,d2*sa);","","float rr1 = 0.3*u_radius;","float rr2 = 0.95*u_radius;","","float r_2 = 0.6*u_radius;","","float r = length(vec2(v_texCoord.x,u_aspectI*v_texCoord.y)-u_center);","float dr2 = length(vec2(v_texCoord.x,u_aspectI*v_texCoord.y)-center2-u_center);","","float alphaSpots = 3.0*(1.0-dr2/r_2);","alphaSpots = clamp(alphaSpots,0.0,1.0);","","float alphaOuter = 3.0*(1.0-pow(r/rr2,2.0*0.75));","alphaOuter = clamp(alphaOuter,0.0,1.0);","","float alphaInner = 3.0*(pow(r/rr1,2.0*0.75)-1.0);","alphaInner = clamp(alphaInner,0.0,1.0);","","vec4 result = img;","vec4 c = img;","","float alpha = 3.0*(1.0-(r/u_radius));","alpha = clamp(alpha,0.0,1.0);","","alpha *= alphaSpots * alphaOuter * alphaInner;","","//alpha = 1.0;","","float powExp = 0.3;","","vec4 blendColor = pow(img,vec4(powExp));//vec4(1.0,0.0,0.0,1.0);//","","result = mix(img, blendColor, alpha);","","gl_FragColor = vec4(result.rgb,img.a);","}"].join("\n"),MoaEyeShadowFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp vec4 u_eyeShadowColor;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","float intensity = 0.2 * color.r + 0.7 * color.g + 0.1 * color.b;","","//                                                   float redFactor = 3.0 * (3.0 * color.r - 1.5 * color.g - 1.5 * color.b);","","//                                                   redFactor = clamp(redFactor, 0.0, 0.5);","","vec4 newColor = u_eyeShadowColor + 0.85 * (intensity - 0.588);","","gl_FragColor = mix(color, newColor, 0.3);","}"].join("\n"),MoaConvolutionHorizontalBoxBlur3VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus1.x = a_texCoord.x - u_texelStride;","v_texCoordPlus1.x = a_texCoord.x + u_texelStride;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionVerticalBoxBlur3VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus1.y = a_texCoord.y - u_texelStride;","v_texCoordPlus1.y = a_texCoord.y + u_texelStride;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionBoxBlur3FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","","void main(void) {","highp vec4 resultColor = texture2D(u_sampler, v_texCoord);","resultColor += texture2D(u_sampler, v_texCoordPlus1);","resultColor += texture2D(u_sampler, v_texCoordMinus1);","gl_FragColor = resultColor / 3.0;","}"].join("\n"),MoaConvolutionHorizontalBoxBlur5VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus1.x = a_texCoord.x - u_texelStride;","v_texCoordPlus1.x = a_texCoord.x + u_texelStride;","v_texCoordMinus2.x = a_texCoord.x - u_texelStride * 2.0;","v_texCoordPlus2.x = a_texCoord.x + u_texelStride * 2.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionVerticalBoxBlur5VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus1.y = a_texCoord.y - u_texelStride;","v_texCoordPlus1.y = a_texCoord.y + u_texelStride;","v_texCoordMinus2.y = a_texCoord.y - u_texelStride * 2.0;","v_texCoordPlus2.y = a_texCoord.y + u_texelStride * 2.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionBoxBlur5FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","","void main(void) {","highp vec4 resultColor = texture2D(u_sampler, v_texCoord);","resultColor += texture2D(u_sampler, v_texCoordPlus1);","resultColor += texture2D(u_sampler, v_texCoordMinus1);","resultColor += texture2D(u_sampler, v_texCoordPlus2);","resultColor += texture2D(u_sampler, v_texCoordMinus2);","gl_FragColor = resultColor / 5.0;","}"].join("\n"),MoaConvolutionHorizontalBoxBlur7VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus3 = a_texCoord;","v_texCoordPlus3 = a_texCoord;","v_texCoordMinus1.x = a_texCoord.x - u_texelStride;","v_texCoordPlus1.x = a_texCoord.x + u_texelStride;","v_texCoordMinus2.x = a_texCoord.x - u_texelStride * 2.0;","v_texCoordPlus2.x = a_texCoord.x + u_texelStride * 2.0;","v_texCoordMinus3.x = a_texCoord.x - u_texelStride * 3.0;","v_texCoordPlus3.x = a_texCoord.x + u_texelStride * 3.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionVerticalBoxBlur7VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus3 = a_texCoord;","v_texCoordPlus3 = a_texCoord;","v_texCoordMinus1.y = a_texCoord.y - u_texelStride;","v_texCoordPlus1.y = a_texCoord.y + u_texelStride;","v_texCoordMinus2.y = a_texCoord.y - u_texelStride * 2.0;","v_texCoordPlus2.y = a_texCoord.y + u_texelStride * 2.0;","v_texCoordMinus3.y = a_texCoord.y - u_texelStride * 3.0;","v_texCoordPlus3.y = a_texCoord.y + u_texelStride * 3.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionBoxBlur7FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","","void main(void) {","highp vec4 resultColor = texture2D(u_sampler, v_texCoord);","resultColor += texture2D(u_sampler, v_texCoordPlus1);","resultColor += texture2D(u_sampler, v_texCoordMinus1);","resultColor += texture2D(u_sampler, v_texCoordPlus2);","resultColor += texture2D(u_sampler, v_texCoordMinus2);","resultColor += texture2D(u_sampler, v_texCoordPlus3);","resultColor += texture2D(u_sampler, v_texCoordMinus3);","gl_FragColor = resultColor / 7.0;","}"].join("\n"),MoaConvolutionHorizontalGaussian9VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","","varying highp vec2 v_texCoord;","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","varying highp vec2 v_texCoordMinus4;","varying highp vec2 v_texCoordPlus4;","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus3 = a_texCoord;","v_texCoordPlus3 = a_texCoord;","v_texCoordMinus4 = a_texCoord;","v_texCoordPlus4 = a_texCoord;","","v_texCoordMinus1.x = a_texCoord.x - u_texelStride;","v_texCoordPlus1.x = a_texCoord.x + u_texelStride;","v_texCoordMinus2.x = a_texCoord.x - u_texelStride * 2.0;","v_texCoordPlus2.x = a_texCoord.x + u_texelStride * 2.0;","v_texCoordMinus3.x = a_texCoord.x - u_texelStride * 3.0;","v_texCoordPlus3.x = a_texCoord.x + u_texelStride * 3.0;","v_texCoordMinus4.x = a_texCoord.x - u_texelStride * 4.0;","v_texCoordPlus4.x = a_texCoord.x + u_texelStride * 4.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionVerticalGaussian9VertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","varying highp vec2 v_texCoordMinus4;","varying highp vec2 v_texCoordPlus4;","","uniform highp float u_texelStride;","","void main(void) {","v_texCoord = a_texCoord;","v_texCoordMinus1 = a_texCoord;","v_texCoordPlus1 = a_texCoord;","v_texCoordMinus2 = a_texCoord;","v_texCoordPlus2 = a_texCoord;","v_texCoordMinus3 = a_texCoord;","v_texCoordPlus3 = a_texCoord;","v_texCoordMinus4 = a_texCoord;","v_texCoordPlus4 = a_texCoord;","","v_texCoordMinus1.y = a_texCoord.y - u_texelStride;","v_texCoordPlus1.y = a_texCoord.y + u_texelStride;","v_texCoordMinus2.y = a_texCoord.y - u_texelStride * 2.0;","v_texCoordPlus2.y = a_texCoord.y + u_texelStride * 2.0;","v_texCoordMinus3.y = a_texCoord.y - u_texelStride * 3.0;","v_texCoordPlus3.y = a_texCoord.y + u_texelStride * 3.0;","v_texCoordMinus4.y = a_texCoord.y - u_texelStride * 4.0;","v_texCoordPlus4.y = a_texCoord.y + u_texelStride * 4.0;","","gl_Position = a_position;","}"].join("\n"),MoaConvolutionGaussian9FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","varying highp vec2 v_texCoordMinus1;","varying highp vec2 v_texCoordPlus1;","varying highp vec2 v_texCoordMinus2;","varying highp vec2 v_texCoordPlus2;","varying highp vec2 v_texCoordMinus3;","varying highp vec2 v_texCoordPlus3;","varying highp vec2 v_texCoordMinus4;","varying highp vec2 v_texCoordPlus4;","","uniform highp float u_weight0;","uniform highp float u_weight1;","uniform highp float u_weight2;","uniform highp float u_weight3;","uniform highp float u_weight4;","","void main(void) {","highp vec4 resultColor = texture2D(u_sampler, v_texCoord) * u_weight0;","resultColor += texture2D(u_sampler, v_texCoordPlus1) * u_weight1;","resultColor += texture2D(u_sampler, v_texCoordMinus1) * u_weight1;","resultColor += texture2D(u_sampler, v_texCoordPlus2) * u_weight2;","resultColor += texture2D(u_sampler, v_texCoordMinus2) * u_weight2;","resultColor += texture2D(u_sampler, v_texCoordPlus3) * u_weight3;","resultColor += texture2D(u_sampler, v_texCoordMinus3) * u_weight3;","resultColor += texture2D(u_sampler, v_texCoordPlus4) * u_weight4;","resultColor += texture2D(u_sampler, v_texCoordMinus4) * u_weight4;","","gl_FragColor = resultColor / (u_weight0 + 2.0 * (u_weight1 + u_weight2 + u_weight3 + u_weight4));","","}"].join("\n"),MoaVertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","","varying highp vec2 v_texCoord;","","void main(void) {","v_texCoord = a_texCoord;","gl_Position = a_position;","}"].join("\n"),MoaColorMapFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform lowp sampler2D u_colorMapSampler;","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","lowp vec2 redVec = vec2(0,color.r);","lowp vec2 greenVec = vec2(0,color.g);","lowp vec2 blueVec = vec2(0,color.b);","","lowp vec4 rColor = texture2D(u_colorMapSampler, redVec);","lowp vec4 gColor = texture2D(u_colorMapSampler, greenVec);","lowp vec4 bColor = texture2D(u_colorMapSampler, blueVec);","","color.r = rColor.r;","color.g = gColor.g;","color.b = bColor.b;","","gl_FragColor = color;","}"].join("\n"),MoaIntensityMapOverlayFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform lowp sampler2D u_colorMapSampler;","uniform float u_intensity;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 src;","","float intensity = 0.212671*dst.r + 0.71516*dst.g + 0.072169*dst.b;","","lowp vec2 intensityVec = vec2(0,intensity);","","src = texture2D(u_colorMapSampler, intensityVec);","","float factor = u_intensity;","float factorI = 1.0 - factor;","","vec4 mult = 2.0 * dst * src;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - src);","vec4 transition = dst * dst * (2.0 - 4.0 * src) + dst * (4.0 * src - 1.0) + (1.0 - 2.0 * src) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","dst = factorI * dst + factor * blendColor;","","dst.a = 1.0;","","gl_FragColor = dst;","}"].join("\n"),MoaIntensityMapMultiplyFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform lowp sampler2D u_colorMapSampler;","uniform float u_intensity;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 src;","","float intensity = 0.212671*dst.r + 0.71516*dst.g + 0.072169*dst.b;","","lowp vec2 intensityVec = vec2(0,intensity);","","src = texture2D(u_colorMapSampler, intensityVec);","","// Could use a blend mode here, but we've already gone to the trouble of sampling the source","float factor = u_intensity;","float factorI = 1.0 - factor;","","dst.rgb = factorI * dst.rgb + factor * (src.rgb * dst.rgb);","","dst.a = 1.0;","","gl_FragColor = dst;","}"].join("\n"),MoaIntensityMapFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform lowp sampler2D u_colorMapSampler;","uniform float u_intensity;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 src;","","float intensity = 0.212671*dst.r + 0.71516*dst.g + 0.072169*dst.b;","","lowp vec2 intensityVec = vec2(0,intensity);","","src = texture2D(u_colorMapSampler, intensityVec);","dst = mix(dst, src, u_intensity);","","dst.a = 1.0;","gl_FragColor = dst;","}"].join("\n"),MoaBrightnessContrastSaturationWarmthShader:["precision mediump float;","uniform sampler2D u_sampler;","uniform lowp sampler2D u_cMap;","","varying vec2 v_texCoord;","","uniform float u_brightness;","uniform float u_contrast;","uniform float u_contrastExp;","uniform float u_contrastLessThanZero;","uniform mat3  u_contrastSatAdjust;","uniform mat3  u_saturationMatrix;","","uniform vec3  u_warmthDelta;","","uniform float u_warmth;","uniform float u_saturation;","","","const float PI = 3.14159265358;","","void main() {","vec4 img = texture2D(u_sampler, v_texCoord);","","vec3 result = img.rgb;","float v;","","// **** BRIGHTNESS **** //","if(u_brightness != 0.0){","result.r = texture2D(u_cMap,vec2(0,result.r)).r;","result.g = texture2D(u_cMap,vec2(0,result.g)).r;","result.b = texture2D(u_cMap,vec2(0,result.b)).r;","","clamp(result, 0.0, 1.0);","}","// **** END **** //","","// **** CONTRAST **** //","if(u_contrast != 0.0){","vec3 d;","d.r = - result.r + result.g + result.b;","d.g = + result.r - result.g + result.b;","d.b = + result.r + result.g - result.b;","","result.r = texture2D(u_cMap, vec2(0,result.r)).g;","result.g = texture2D(u_cMap, vec2(0,result.g)).g;","result.b = texture2D(u_cMap, vec2(0,result.b)).g;","","vec3 dNew;","dNew.r = - result.r + result.g + result.b;","dNew.g = + result.r - result.g + result.b;","dNew.b = + result.r + result.g - result.b;","","result += 0.2 * (dNew - d);","","if (u_contrast < 0.0) {","result = u_contrastSatAdjust * result;","}","","clamp(result, 0.0, 1.0);","}","// **** END **** //","","// **** WARMTH **** //","if(u_warmth != 0.0){","result = result + u_warmthDelta*sin(PI*result);","clamp(result, 0.0, 1.0);","}","// **** END **** //","","","// **** SATURATION **** //","if(u_saturation != 0.0){","result = u_saturationMatrix * result;","clamp(result, 0.0, 1.0);","}","// **** END **** //","","gl_FragColor = vec4(result.rgb,img.a);","}"].join("\n"),MoaGradientFlareFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","uniform int u_shape;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float noise = 0.0;","","if(u_shape == 1){","noise = 0.5 + 0.5*coords.x;","}else if(u_shape == 2){","noise = length(coords);","}else if(u_shape == 3){","noise = exp(u_params[0][0] * ((coords.y - u_params[0][2])*(coords.y - u_params[0][2]) + (coords.x - u_params[0][3])*(coords.x - u_params[0][3])) + u_params[0][1] * (coords.y - u_params[1][0])*(coords.y - u_params[1][0]) * (coords.x - u_params[1][1])*(coords.x - u_params[1][1]));","}else if(u_shape == 4){","noise = max(abs(coords.x), abs(coords.y));","}else if(u_shape == 5){","if(u_params[0][0] == 0.0){","noise = max(abs(coords.x), abs(coords.y));","}else{","noise = pow(pow(abs(coords.x), u_params[0][0]) + pow(abs(coords.y),u_params[0][0]), 1.0 / u_params[0][0]);","}","}else if(u_shape == 9){","//                                                            float theta = coords.x * coords.x + coords.y * coords.y;","float r = length(coords);//sqrt(theta);","float sa = -coords.y / r;//Math.sin(a);","float ca = coords.x / r;//Math.cos(a);","//                                                            float caAbs = abs(ca);","float rH = (2.0 - 2.0 * sa + u_params[0][0] * sa * sqrt(abs(ca)) / (sa + u_params[0][1]));","noise = r - rH;","}else if(u_shape == 11){","float r0 = 1.0;","float r1 = u_params[0][1];","float dx = u_params[0][0] * (r0 + r1);","float r = length(coords);","float rdx = distance(coords, vec2(dx, 0.0));","float fA = 1.0 - r / r0;","float fB = rdx / r1 - 1.0;","float branch = step(r1, rdx) * step(r, r0);","noise = branch * (1.0 - min(fA, fB)) + (1.0 - branch);","}else{","noise = 0.0;","}","","","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","","}"].join("\n"),MoaGradientFlareStardomFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float numLobes = floor(u_params[0][0]);","","float theta = coords.x * coords.x + coords.y * coords.y;","","float a = atan(coords.y, coords.x);","","float noise = theta * theta * (sin(numLobes * a / 2.0));","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareLobesFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float numLobes = floor(u_params[0][0]);","","float theta = coords.x * coords.x + coords.y * coords.y;","","float a = atan(coords.y, coords.x);","","float noise = 1.0 - exp(-theta) * 0.5 * (1.0 + sin(a * numLobes));","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareRingLobesFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float numLobes = floor(u_params[0][0]);","float numLobes2 = u_params[0][1];","float numLobes3 = u_params[0][2];","","float theta = coords.x * coords.x + coords.y * coords.y;","","float a = atan(coords.y, coords.x);","","float noise = 1.0 - (1.0 - sin(numLobes2 * theta + 3.14159265358979323846264338327950288 / 2.0) * sin(numLobes3 * theta + 3.14159265358979323846264338327950288 / 2.0) * sin(numLobes * a / 2.0 + 3.14159265358979323846264338327950288 / 2.0));","","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareStarFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float b = 0.0;","float numLobes = max(1.0, floor(u_params[0][0]));","float r = length(coords);","float aInterval = 3.14159265358979323846264338327950288 / numLobes;","float a = 1.5 * 3.14159265358979323846264338327950288 - atan(coords.y, coords.x);","float maxVal = 1.0;","float minVal = u_params[0][2];","float fractVal = fract(a / aInterval);","fractVal = mod(floor(a / aInterval), 2.0) == 0.0 ? fractVal : 1.0 - fractVal;","float beta = aInterval / 2.0;","float gamma = 3.14159265358979323846264338327950288 - fractVal - beta;","b =  maxVal * sin(beta) / sin(gamma);","","float rS = minVal + (maxVal - minVal) * ((1.0 - u_params[0][1]) * b + u_params[0][1] * (1.0 - fractVal));","","float noise = r - rS;","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareSquigglyFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float noise = 0.5 + 0.5 * sin(coords.x + 2.0 * u_params[0][0] * sin(coords.y));","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareZigZagFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float a = 2.0 * (coords.x - floor(u_params[0][0] + coords.x));","","a = a < 0.0 ? (-a / u_params[0][0]): (a) / (1.0 - u_params[0][0]);","","float noise = coords.y - a;","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaGradientFlareSpiralFragmentShader:["","precision highp float;","","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_aspectMode;","","uniform int u_invert;","uniform int u_wrapMode;","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","uniform float u_alphaBlend;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","void main(){","","vec2 texCoordsTmp = v_texCoord;","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","vec2 coords = (transformed.xy);","","float period = floor(u_params[0][1] + 0.5);","float rad = coords.x * coords.x + coords.y * coords.y;","float angle = atan(coords.y,coords.x);","float noise = pow(rad, u_params[0][0]) + angle * period / 2.0 / 3.14159265358979323846264338327950288;","","if(u_wrapMode == 1) {","noise = fract(noise);","} else if(u_wrapMode == 2) {","","if(mod(floor(noise), 2.0) != 0.0) {","noise = fract(noise);","noise = 1.0 - noise;","} else {","noise = fract(noise);","}","","}","","noise = clamp(noise,0.0,1.0);","","if(u_invert == 1){","noise = 1.0 - noise;","}","","vec4 dst = texture2D(u_gradientMap, vec2(0,noise));","","dst.a *= u_alphaBlend;","","gl_FragColor = dst;","}"].join("\n"),MoaColorTransformFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform mat3 u_colorMat;","uniform vec3 u_colorTrans;","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","color.rgb = u_colorMat * color.rgb + u_colorTrans;","","gl_FragColor = color;","}"].join("\n"),MoaColorTransformAndOverlayWithOriginalFragmentShader:["","precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","uniform mat3 u_colorMat;","uniform vec3 u_colorTrans;","uniform float u_overlayAmount;","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","lowp vec4 originalColor = color;","","color.rgb = u_colorMat * color.rgb + u_colorTrans;","","float factor = clamp(u_overlayAmount, 0.0, 1.0);","float factorI = 1.0-factor;","","vec4 mult = 2.0 * color * originalColor;","vec4 screen = 1.0 - 2.0 * (1.0 - color) * (1.0 - originalColor);","color = factorI * originalColor + factor * mix(mult, screen, step(0.5, originalColor));","color.a = 1.0;","","gl_FragColor = color;","}"].join("\n"),MoaOverlayVertexShader:["attribute vec4 a_position;","attribute vec2 a_texCoord;","uniform mat4 u_transform;","varying highp vec2 v_texCoord;","","void main(void) {","v_texCoord = (vec4(a_texCoord.x, a_texCoord.y, 0.0, 1.0) * u_transform).xy;","gl_Position = a_position;","}"].join("\n"),MoaOverlayFragmentShader:["precision mediump float;","uniform lowp sampler2D u_overlaySampler;","uniform lowp sampler2D u_sampler;","uniform float u_factor;","varying highp vec2 v_texCoord;","void main(void) {","gl_FragColor = texture2D(u_overlaySampler, v_texCoord);","}"].join("\n"),MoaBitmapIdentityFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("\n"),MoaBitmapBlendFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_srcSampler;","uniform float u_dstAmount;","uniform float u_srcAmount;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 color = texture2D(u_srcSampler, v_texCoord);","vec4 originalColor = texture2D(u_sampler, v_texCoord);","gl_FragColor = color * u_srcAmount + originalColor * u_dstAmount;","gl_FragColor.a = 1.0;","}"].join("\n"),MoaBitmapBlendOverlayFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_srcSampler;","uniform float u_factor;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 src = texture2D(u_srcSampler, v_texCoord);","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","","lowp vec4 color = vec4(0,0,0,0);","","float factorI = 1.0 - u_factor;","","vec4 mult = 2.0 * dst * src;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - src);","color = factorI * dst + u_factor * mix(mult, screen, step(0.5, dst));","","color.a = 1.0;","gl_FragColor = color;","","}"].join("\n"),
MoaBitmapBlendOverlayReverseFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_srcSampler;","uniform float u_factor;","varying highp vec2 v_texCoord;","","void main(void) {","lowp vec4 dst = texture2D(u_srcSampler, v_texCoord);","lowp vec4 src = texture2D(u_sampler, v_texCoord);","","lowp vec4 color = vec4(0,0,0,0);","","float factorI = 1.0 - u_factor;","","vec4 mult = 2.0 * dst * src;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - src);","color = factorI * dst + u_factor * mix(mult, screen, step(0.5, dst));","","color.a = 1.0;","gl_FragColor = color;","","}"].join("\n"),MoaBitmapDrawWithMaskFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_maskSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 maskAmount = texture2D(u_maskSampler, v_texCoord);","vec4 originalColor = texture2D(u_sampler, v_texCoord);","originalColor.a = 1.0 - maskAmount.a;","gl_FragColor = originalColor;","}"].join("\n"),MoaBitmapRedrawWithMaskFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_maskSampler;","uniform lowp sampler2D u_sourceSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 maskAmount = texture2D(u_maskSampler, v_texCoord);","vec4 originalColor = texture2D(u_sampler, v_texCoord);","vec4 sourceColor = texture2D(u_sourceSampler, v_texCoord);","gl_FragColor = mix(originalColor, sourceColor, maskAmount.a);","}"].join("\n"),MoaBitmapBlendTexturesUsingMaskFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_maskSampler;","uniform lowp sampler2D u_baseSampler;","uniform lowp sampler2D u_blendSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 maskAmount = texture2D(u_maskSampler, v_texCoord);","vec4 baseColor = texture2D(u_baseSampler, v_texCoord);","vec4 blendColor = texture2D(u_blendSampler, v_texCoord);","","gl_FragColor = mix(baseColor, blendColor, maskAmount.a);","}"].join("\n"),MoaBitmapColorBlendColorFragmentShader:["precision highp float;","","uniform highp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform highp vec3 u_blendColor;","uniform highp float u_blendAmount;","uniform highp float u_blendColorAlpha;","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","// RBG -> HSL","float r = color.r;","float g = color.g;","float b = color.b;","float h = u_blendColor.x;","float s = u_blendColor.y;","float l = u_blendColor.z;","","// Blend","s *= u_blendColorAlpha; //Hack hack hack","l  = (0.212671*r + 0.71516*g + 0.072169*b);","","// End Blend","","// HSL -> RGB","float hPrime;","float C;","float X;","float m;","float hPrimeMod2;","","hPrime = h * 6.0;","C = l > 0.5 ? 2.0 * s * (1.0 - l) : 2.0 * s * l;","hPrimeMod2 = hPrime;","","hPrimeMod2 = mod(hPrimeMod2, 2.0);","","X = C * (1.0 - abs(hPrimeMod2 - 1.0));","","m = l - 0.5*C;","","if(hPrime < 1.0){","r = C; g = X; b = 0.0;","}else if(hPrime < 2.0){","r = X; g = C; b = 0.0;","}else if(hPrime < 3.0){","r = 0.0; g = C; b = X;","}else if(hPrime < 4.0){","r = 0.0; g = X; b = C;","}else if(hPrime < 5.0){","r = X; g = 0.0; b = C;","}else if(hPrime < 6.0){","r = C; g = 0.0; b = X;","}","// End HSL -> RGB","","vec4 blendedColor = vec4(r+m,g+m,b+m,1.0);","color = mix(color, blendedColor, u_blendAmount);","color.a = 1.0; //Just to make sure","","gl_FragColor = color;","}"].join("\n"),MoaBitmapBlendDarkestFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_sourceSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 dstColor = texture2D(u_sampler, v_texCoord);","vec4 srcColor = texture2D(u_sourceSampler, v_texCoord);","","if(dot(vec3(0.2, 0.7, 0.1), dstColor.rgb) > dot(vec3(0.2, 0.7, 0.1), srcColor.rgb)){","gl_FragColor = srcColor;","}else{","//                                                                 gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);","gl_FragColor = dstColor;","}","}"].join("\n"),MoaBitmapBlendBitmapColorModeFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_blendSampler;","uniform float u_alpha;","","varying highp vec2 v_texCoord;","","void main(void) {","// a (base color) and b (blend color)","vec4 bRGBA = texture2D(u_blendSampler, v_texCoord); //Blend Color","vec4 aRGBA = texture2D(u_sampler, v_texCoord); //Base Color","","vec3 a = aRGBA.rgb;","vec3 b = bRGBA.rgb;","","float alpha = u_alpha * bRGBA.a;","vec3 blendColor = a;","","","float h;","float s;","float l;","","// RBG -> HSL","float maxChan = max(b.r, max(b.g, b.b));","float minChan = min(b.r, min(b.g, b.b));","","float chroma = maxChan - minChan;","l = (maxChan + minChan)/2.0;","","if(chroma == 0.0){","h = 0.0;","s = 0.0;","} else{","s = l > 0.5 ? chroma / (2.0 - maxChan - minChan) : chroma / (maxChan + minChan);","","if(b.r == maxChan){","h = (b.g - b.b) / chroma + (b.g < b.b ? 6.0 : 0.0);","}else if(b.g == maxChan){","h = (b.b - b.r) / chroma + 2.0;","}else if(b.b == maxChan){","h = (b.r - b.g) / chroma + 4.0;","}","","h *= 60.0;","","if(h < 0.0){h += 360.0;}","if(h >= 360.0){h -= 360.0;}","}","","","// Blend","l  = (0.212671*a.r + 0.71516*a.g + 0.072169*a.b);","s *= alpha;","","float hPrime = h / 60.0;","float C = l > 0.5 ? 2.0 * s * (1.0 - l) : 2.0 * s * l;","float X = C * (1.0 - abs(mod(hPrime, 2.0) - 1.0));","","if(hPrime < 1.0){","blendColor.r = C; blendColor.g = X; blendColor.b = 0.0;","}else if(hPrime < 2.0){","blendColor.r = X; blendColor.g = C; blendColor.b = 0.0;","}else if(hPrime < 3.0){","blendColor.r = 0.0; blendColor.g = C; blendColor.b = X;","}else if(hPrime < 4.0){","blendColor.r = 0.0; blendColor.g = X; blendColor.b = C;","}else if(hPrime < 5.0){","blendColor.r = X; blendColor.g = 0.0; blendColor.b = C;","}else if(hPrime < 6.0){","blendColor.r = C; blendColor.g = 0.0; blendColor.b = X;","}","","float m = l - 0.5 * C;","","blendColor.r = blendColor.r + m;","blendColor.g = blendColor.g + m;","blendColor.b = blendColor.b + m;","","","","gl_FragColor = vec4(mix(a, blendColor, alpha),1.0);","","}"].join("\n"),MoaBitmapBlendBitmapFragmentShader1:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_blendSampler;","uniform float u_alpha;","uniform int u_blendMode;","","varying highp vec2 v_texCoord;","","void main(void) {","vec4 bRGBA = texture2D(u_blendSampler, v_texCoord); //Blend Color","vec4 aRGBA = texture2D(u_sampler, v_texCoord); //Base Color","","vec3 a = aRGBA.rgb;","vec3 b = bRGBA.rgb;","","float alpha = u_alpha * bRGBA.a;","vec3 blendColor = a;","","if(u_blendMode == 0){","blendColor = b;","}else if(u_blendMode == 6){","blendColor = 2.0*a*b + a*a - 2.0*a*a*b;","}else if(u_blendMode == 5){","blendColor = b*a;","}else if(u_blendMode == 3){","blendColor = a + b - a*b;","}else if(u_blendMode == 4){","blendColor = min(a,b);","}else if(u_blendMode == 7){","blendColor = max(a,b);","}else if(u_blendMode == 8){","blendColor = abs(a-b);","}else if(u_blendMode == 9){","blendColor = 1.0 - abs(1.0-a-b);","}else if(u_blendMode == 10){","blendColor = a + b - 2.0*a*b;","}else if(u_blendMode == 1){","vec3 mult = 2.0 * a * b;","vec3 screen = 1.0 - 2.0 * (1.0 - a) * (1.0 - b);","vec3 transition = a * a * (2.0 - 4.0 * b) + a * (4.0 * b - 1.0) + (1.0 - 2.0 * b) / 8.0;","blendColor = (1.0 - step(0.25, a)) * mult + (step(0.25, a) - step(0.75, a)) * transition + step(0.75, a) * screen;","}else if(u_blendMode == 11){","blendColor = (2.0*a*b)*(1.0-step(0.5,b)) + (1.0-2.0*(1.0-a)*(1.0-b))*step(0.5,b);","}","","blendColor = clamp(blendColor, 0.0, 1.0);","","gl_FragColor = vec4(mix(a, blendColor, alpha),1.0);","}"].join("\n"),MoaBitmapBlendBitmapFragmentShader2:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_blendSampler;","uniform float u_alpha;","uniform int u_blendMode;","","varying highp vec2 v_texCoord;","","void main(void) {","vec4 bRGBA = texture2D(u_blendSampler, v_texCoord); //Blend Color","vec4 aRGBA = texture2D(u_sampler, v_texCoord); //Base Color","","vec3 a = aRGBA.rgb;","vec3 b = bRGBA.rgb;","","float alpha = u_alpha * bRGBA.a;","vec3 blendColor = a;","","if(u_blendMode == 0){","blendColor = b;","}else if(u_blendMode == 12){","blendColor.r = b.r;","}else if(u_blendMode == 13){","blendColor.g = b.g;","}else if(u_blendMode == 14){","blendColor.b = b.b;","}else if(u_blendMode == 15){","blendColor = 0.5 - 0.25*cos(3.141592654*a) - 0.25*cos(3.141592654*b);","}else if(u_blendMode == 16){","blendColor = a / (1.0001 - b);","}else if(u_blendMode == 17){","blendColor = b / (1.0001 - a);","}else if(u_blendMode == 18){","blendColor = 0.5*a/(1.00001-b) * (1.0-step(1.0,a+b)) + (1.0-0.5*(1.0-b)/(0.00001+a)) * step(1.0,a+b);","}else if(u_blendMode == 19){","blendColor = step(0.00001, b) * (1.0 - (1.0 - a) / (0.0001 + b));","}else if(u_blendMode == 20){","blendColor = step(0.00001, a) * (1.0 - (1.0 - b) / (0.0001 + a));","}else if(u_blendMode == 21){","blendColor = 0.5*(b/(1.0001-a)) * (1.0-step(1.0001,a+b)) + (1.0-0.5*(1.0-a)/(0.00001+b)) * step(1.0001,a+b);","}else if(u_blendMode == 22){","blendColor = a+b;","}else if(u_blendMode == 23){","blendColor = a+b-1.0;","}else if(u_blendMode == 24){","blendColor = a+2.0*b-1.0;","}","// else if(u_blendMode == 25){","//     blendColor = a*a/(1.0001-b);","// }else if(u_blendMode == 26){","//     blendColor = b*b/(1.0001-a);","// }else if(u_blendMode == 27){","//     blendColor = step(0.0001,b)*(1.0 - (1.0-a)*(1.0-a) / (0.0001+b));","// }else if(u_blendMode == 28){","//     blendColor = step(0.0001,a)*(1.0 - (1.0-b)*(1.0-b) / (0.0001+a));","// }","","blendColor = clamp(blendColor, 0.0, 1.0);","","gl_FragColor = vec4(mix(a, blendColor, alpha),1.0);","}"].join("\n"),MoaBitmapLaplaceDiffFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_sourceSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 dstColor = texture2D(u_sampler, v_texCoord);","vec4 srcColor = texture2D(u_sourceSampler, v_texCoord);","","gl_FragColor = vec4(0.5+0.5*(dstColor.rgb-srcColor.rgb),1.0);","}"].join("\n"),MoaBitmapLaplaceAddFragmentShader:["precision mediump float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_sourceSampler;","varying highp vec2 v_texCoord;","","void main(void) {","vec4 dstColor = texture2D(u_sampler, v_texCoord);","vec4 srcColor = texture2D(u_sourceSampler, v_texCoord);","","gl_FragColor = vec4(dstColor.rgb-2.0*srcColor.rgb + 1.0,1.0);","}"].join("\n"),MoaMaskRadialFragmentShader:["precision highp float;","","varying highp vec2 v_texCoord;","","uniform vec2 u_centerPoint;","uniform float u_sigmaR2;","uniform float u_width;","uniform float u_height;","","void main(void) {","float xComp = u_width * v_texCoord.x - u_centerPoint.x;","float yComp = u_height * v_texCoord.y - u_centerPoint.y;","","float dr2 = xComp * xComp + yComp * yComp;","//                                                          float dr2 = 1.21 * xComp * xComp + yComp * yComp; // Selfie shader","","//                                                          dr2 -= u_sigmaR2/2.0; //Selfie shader","","//                                                          if(dr2 < 0.0){","//                                                              dr2 = 0.0;","//                                                          }","","//                                                          float factor = sqrt(4.0 * dr2/u_sigmaR2);","","float factor = 1.0 - exp(-1.0 * dr2 / (2.0 * u_sigmaR2));","//                                                          float factor = (1.0 - exp(-10.0 * dr2 / (2.0 * u_sigmaR2)));","","//                                                          factor = factor > 1.0 ? 1.0 : (factor < 0.0 ? 0.0 : factor);","","gl_FragColor = vec4(factor, factor, factor, factor);","}"].join("\n"),MoaMaskElipticalFragmentShader:["precision highp float;","","varying highp vec2 v_texCoord;","","uniform vec2 u_centerPoint;","uniform float u_sigmaX;","uniform float u_sigmaY;","uniform float u_width;","uniform float u_height;","","void main(void) {","float xComp = u_width * v_texCoord.x - u_centerPoint.x;","float yComp = u_height * v_texCoord.y - u_centerPoint.y;","","float dr2 = xComp * xComp + yComp * yComp;","","float factor = 1.0 - exp(-1.0 * dr2 / (2.0 * u_sigmaX));","","gl_FragColor = vec4(factor, factor, factor, factor);","}"].join("\n"),MoaMaskLinearFragmentShader:["","precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform vec2 u_centerPoint;","uniform float u_sigmaR2;","uniform float u_normX;","uniform float u_normY;","uniform float u_width;","uniform float u_height;","","void main(void) {","float proj = abs(u_normX * (u_centerPoint.x - u_width * v_texCoord.x) + u_normY * (u_height * v_texCoord.y - u_centerPoint.y));","","float factor = 1.0 - exp(-1.0 * proj * proj / (2.0 * u_sigmaR2));","","gl_FragColor = vec4(factor, factor, factor, factor); // change","","}"].join("\n"),MoaMaskDotsVertexShader:["attribute highp vec4 a_position;","attribute highp vec2 a_texCoord;","attribute highp vec2 a_centerTexCoord;","","varying highp vec2 v_texCoord;","varying highp vec2 v_centerTexCoord;","","void main()","{","v_texCoord = a_texCoord;","v_centerTexCoord = a_centerTexCoord;","gl_Position = a_position;","}"].join("\n"),MoaMaskDotFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","varying highp vec2 v_centerTexCoord;","","uniform mediump float u_radius;","","uniform float u_width;","uniform float u_height;","uniform float u_alpha;","uniform float u_dEdge;","uniform int   u_erase;","","void main(void) {","vec2 distComponents = (v_texCoord - v_centerTexCoord) * vec2(u_width, u_height);","float dr2 = distComponents.x * distComponents.x + distComponents.y * distComponents.y;","","float factor;","float tmpDouble = 1.0 - (sqrt(dr2) - u_radius)/u_dEdge;","tmpDouble = clamp(tmpDouble, 0.0, 1.0);","factor = tmpDouble*tmpDouble;","","factor *= u_alpha;","","gl_FragColor = vec4(factor,factor,factor,factor);","}"].join("\n"),MoaMaskDotColorFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","varying highp vec2 v_centerTexCoord;","","uniform mediump float u_radius;","uniform float u_width;","uniform float u_height;","uniform float u_pointSize;","uniform float u_alpha;","uniform float u_dEdge;","uniform vec4 u_color;","","void main(void) {","vec2 distComponents = (v_texCoord - v_centerTexCoord) * vec2(u_width, u_height);","float dr2 = distComponents.x * distComponents.x + distComponents.y * distComponents.y;","","float factor;","float tmpDouble = 1.0 - (sqrt(dr2) - u_radius)/u_dEdge;","tmpDouble = clamp(tmpDouble, 0.0, 1.0);","factor = tmpDouble*tmpDouble;","","gl_FragColor = (factor * u_alpha) * u_color;","}"].join("\n"),MoaColorSplashAutoFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","varying highp vec2 v_centerTexCoord;","","uniform mediump float u_radius;","uniform float u_width;","uniform float u_height;","uniform float u_pointSize;","uniform float u_alpha;","uniform float u_dEdge;","uniform float u_l;","uniform float u_a;","uniform float u_b;","uniform float u_sigmaC;","","void main(void) {","vec2 distComponents = (v_texCoord - v_centerTexCoord) * vec2(u_width, u_height);","float dr2 = distComponents.x * distComponents.x + distComponents.y * distComponents.y;","","float factorR;","float tmpDouble = 1.0 - (sqrt(dr2) - u_radius)/u_dEdge;","tmpDouble = clamp(tmpDouble, 0.0, 1.0);","factorR = tmpDouble*tmpDouble;","","// Convert to LAB","vec4 color = texture2D(u_sampler, v_texCoord);","","float R = color.r * 255.0;","float G = color.g * 255.0;","float B = color.b * 255.0;","","float l1;","float a1;","float b1;","float r;","float g;","float b;","float x;","float y;","float z;","","if(R/255.0 <= 0.04045){r = 100.0 *R/255.0/12.92;} else{ r = 100.0*pow((R/255.0+0.055)/1.055,2.40);}","if(G/255.0 <= 0.04045){g = 100.0 *G/255.0/12.92;} else{ g = 100.0*pow((G/255.0+0.055)/1.055,2.40);}","if(B/255.0 <= 0.04045){b = 100.0 *B/255.0/12.92;} else{ b = 100.0*pow((B/255.0+0.055)/1.055,2.40);}","","x = 0.00433891*r  + 0.00376234915*g + 0.0018990604648*b;","y = 0.002126*r    + 0.007152*g      + 0.000722*b;","z = 0.000177255*r + 0.00109475308*g + 0.0087295537*b;","","if(x > 0.008856){x = pow(x,1.0/3.0);}else{x = 7.787*x+16.0/116.0;}","if(y > 0.008856){y = pow(y,1.0/3.0);}else{y = 7.787*y+16.0/116.0;}","if(z > 0.008856){z = pow(z,1.0/3.0);}else{z = 7.787*z+16.0/116.0;}","","l1 = 116.0*y-16.0;","a1 = 500.0*(x-y);","b1 = 200.0*(y-z);","","l1 *= 2.55; a1 += 127.0; b1 += 127.0;","","// Use those values to determine color factor","float dColor = (u_a - a1) * (u_a - a1) + (u_b - b1) * (u_b - b1);","float factorC = exp(-1.0 * dColor/(2.0 * u_sigmaC * u_sigmaC));","factorC = clamp(factorC, 0.0, 1.0);","","// Get overall color","float factor = u_alpha * factorR * factorC;","gl_FragColor = vec4(factor,factor,factor,factor);","","}"].join("\n"),MoaCloneSpotFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform vec2 u_center;","uniform vec2 u_offset;","uniform float u_aspectI;","uniform float u_radius;","","void main(void) {","vec4 img = texture2D(u_sampler, v_texCoord);","","float r = length(vec2(v_texCoord.x, u_aspectI * v_texCoord.y) - u_center);","","vec4 result = img;","","if(r < u_radius){","float alpha = clamp(3.0 * (1.0 - (r / u_radius)), 0.0, 1.0);","","result = texture2D(u_sampler, v_texCoord + u_offset);","result = mix(img, result, alpha);","}","","gl_FragColor = vec4(result.rgb, img.a);","}"].join("\n"),MoaAdjustmentsFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform lowp sampler2D u_colorShadowsHighlightsSampler;","uniform lowp sampler2D u_threeChannelColorMapSampler;","uniform lowp mat4 u_colorMatrix;","","varying highp vec2 v_texCoord;","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","color.r = texture2D(u_colorShadowsHighlightsSampler, vec2(0.0, color.r)).r;","color.g = texture2D(u_colorShadowsHighlightsSampler, vec2(0.0, color.g)).r;","color.b = texture2D(u_colorShadowsHighlightsSampler, vec2(0.0, color.b)).r;","","float intensity = 0.3 * color.r + 0.59 * color.g + 0.11 * color.b;","","float shDiff = texture2D(u_colorShadowsHighlightsSampler, vec2(0.0, intensity)).g - intensity;","","color.rgb += shDiff;","","color.rgb = clamp(color.rgb, 0.0, 1.0);","","vec4 colorMatrixRGB = vec4(color.rgb, 1.0);","","colorMatrixRGB = colorMatrixRGB * u_colorMatrix;","","colorMatrixRGB = clamp(colorMatrixRGB, 0.0, 1.0);","","colorMatrixRGB.r = texture2D(u_threeChannelColorMapSampler, vec2(0.0, colorMatrixRGB.r)).r;","colorMatrixRGB.g = texture2D(u_threeChannelColorMapSampler, vec2(0.0, colorMatrixRGB.g)).g;","colorMatrixRGB.b = texture2D(u_threeChannelColorMapSampler, vec2(0.0, colorMatrixRGB.b)).b;","","gl_FragColor = vec4(colorMatrixRGB.rgb, color.a);","}"].join("\n"),MoaNoiseFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_randomSeed;","uniform float u_intensity;","","float rand(in vec2 n)","{","//                                                n *= u_randomSeed;","return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);","}","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","float v = u_intensity * (2.0 * rand(v_texCoord) - 1.0);","","color.rgb += v;","","gl_FragColor = color;","","}"].join("\n"),MoaGradientMapFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform int u_invertMap;","uniform int u_gradVar;","uniform int u_blendMode;","uniform float u_alphaBlend;","uniform lowp sampler2D u_gradientMap;","","void main(void) {","","float factor = 0.0;","float alphaBlend = u_alphaBlend;","lowp vec4 gradientColor;","lowp vec3 srcColor = texture2D(u_sampler, v_texCoord).rgb;","float iSrc = 0.0;","","if(u_gradVar == 0){","iSrc = 0.2 * srcColor.r + 0.7 * srcColor.g + 0.1 * srcColor.b;","} else if(u_gradVar == 1){","iSrc = max(srcColor.r, max(srcColor.g, srcColor.b)) - min(srcColor.r, min(srcColor.g, srcColor.b));","} else if(u_gradVar == 2){","iSrc = srcColor.r;","} else if(u_gradVar == 3){","iSrc = srcColor.g;","} else if(u_gradVar == 4){","iSrc = srcColor.b;","} else if(u_gradVar == 5){","iSrc = max(srcColor.r, max(srcColor.g, srcColor.b));","} else if(u_gradVar == 6){","iSrc = min(srcColor.r, min(srcColor.g, srcColor.b));","}","","if(u_invertMap == 1){","iSrc = 1.0 - iSrc;","}","","gradientColor = texture2D(u_gradientMap, vec2(0.0,iSrc));","","vec3 blendColor = (1.0 - gradientColor.a) * srcColor + gradientColor.a * gradientColor.rgb;","","if(u_blendMode == 0){","gl_FragColor.rgb = (1.0 - alphaBlend) * srcColor + alphaBlend * blendColor;","} else if(u_blendMode == 6){","gl_FragColor.rgb = (1.0 - alphaBlend) * srcColor + alphaBlend * (2.0 * srcColor * blendColor + srcColor * srcColor - 2.0 * srcColor * srcColor * blendColor);","} else if(u_blendMode == 5){","gl_FragColor.rgb = (1.0 - alphaBlend) * srcColor + alphaBlend * srcColor * blendColor;","} else if(u_blendMode == 3){","gl_FragColor.rgb = (1.0 - alphaBlend) * srcColor + alphaBlend * (srcColor + blendColor - srcColor * blendColor);","} else if(u_blendMode == 1){","float factorI = 1.0 - alphaBlend;","","vec3 mult = 2.0 * srcColor * blendColor;","vec3 screen = 1.0 - 2.0 * (1.0 - srcColor) * (1.0 - blendColor);","vec3 transition = srcColor * srcColor * (2.0 - 4.0 * blendColor) + srcColor * (4.0 * blendColor - 1.0) + (1.0 - 2.0 * blendColor) / 8.0;","vec3 mixingColor = (1.0 - step(0.25, srcColor)) * mult + (step(0.25, srcColor) - step(0.75, srcColor)) * transition + step(0.75, srcColor) * screen;","","gl_FragColor.rgb = factorI * srcColor + alphaBlend * mixingColor;","} else if(u_blendMode == 4){","if(srcColor.r > blendColor.r){","gl_FragColor.r = (1.0 - alphaBlend) * srcColor.r + alphaBlend * blendColor.r;","}else{","gl_FragColor.r = srcColor.r;","}","","if(srcColor.g > blendColor.g){","gl_FragColor.g = (1.0 - alphaBlend) * srcColor.g + alphaBlend * blendColor.g;","}else{","gl_FragColor.g = srcColor.g;","}","","if(srcColor.b > blendColor.b){","gl_FragColor.b = (1.0 - alphaBlend) * srcColor.b + alphaBlend * blendColor.b;","}else{","gl_FragColor.b = srcColor.b;","}","}","","gl_FragColor.a = 1.0;","}"].join("\n"),MoaFlareFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform int u_blendMode;","uniform int u_flareType;","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","uniform float u_alphaBlend;","","void setFactorAndExpvForType(out float factor)","{","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","if(u_flareType == 14){","xF -= 1.0;","yF -= 1.0;","}","","if(u_flareType == 0){","theta = 80.0 * (xF * xF + yF * yF);","if (theta == 0.0) { factor = 1.0; } else {","factor = 1.0 - u_aF * 0.4 * (sin(theta) / sqrt(theta));","}","}else if(u_flareType == 1){","expV   = (-(xF * xF + yF * yF) * 2.0 - 16.0 * (yF + 0.5) * (yF + 0.5) * (xF + 0.5) * (xF + 0.5));","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 2){","expV   = (-(xF * xF + yF * yF) * 2.0 - 16.0 * (yF + 1.0) * (yF + 1.0) * (xF - 0.5) * (xF - 0.5));","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 3){","theta  = xF * xF + yF * yF;","expV   = -theta * 2.0 - 1.0 * (yF + 1.7) * (yF + 1.7) * (xF - 0.6) * (xF - 0.6);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 4){","// theta  = xF * xF + yF * yF;","expV   = -0.5 * (yF - 1.7) * (yF - 1.7) * (xF + 0.6) * (xF + 0.6) - 0.5 * (yF + 1.7) * (yF + 1.7) * (xF - 0.6) * (xF - 0.6);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 5){","expV   = -(xF * xF + yF * yF) * 2.0 - 5.0 * (xF + 0.2) * (yF + 0.2) * xF * xF;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - 0.5 * u_aF) : (1.0 - 0.5 * u_aF * exp(expV));","}else if(u_flareType ==  6){","theta = xF * xF + yF * yF;","a = atan(yF, xF);","factor = 1.0 - u_aF * 0.2 * (1.0 - theta * theta * (sin(10.0 * a)));","}else if(u_flareType == 7){","theta = xF * xF + yF * yF;","a = atan(yF, xF);","factor = 1.0 - u_aF * 0.5 * exp(-theta * 2.0) * (0.5 + 0.5 * sin(4.0 * a + 1.0));","}else if(u_flareType == 8){","// Unimplemented","}else if(u_flareType == 9){","expV = (-(xF * xF) - yF * yF / 64.0);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 10){","expV = (-(yF * yF) - xF * xF / 64.0);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 11){","theta  = xF * xF + yF * yF;","factor = 1.0 - u_aF *exp(-(theta * theta) *2.0 + (-8.0) *(yF + 0.5) *(yF - 0.5) *(xF + 0.5) *(xF - 0.5));","}else if(u_flareType == 12){","theta = xF * xF + yF * yF;","expV  = -(theta / 180.0) * 2.0 - 16.0 * (yF + 0.5) * (yF + 0.5) * (xF + 0.5) * (xF + 0.5);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 13){","theta = xF * xF + yF * yF;","factor = 1.0 - u_aF *exp(-(theta / 180.0) *2.0) * (exp((-8.0) * (yF + 1.0) * (yF - 1.0) * (xF + 1.0) * (xF - 1.0)));","}else if(u_flareType == 14){","theta = (xF + 1.0) * xF + yF * yF;","factor = u_aF * exp(yF / xF + (-theta) * exp(exp(yF) * xF));","factor = 1.0 - u_alphaBlend * (1.0-factor);","}else if(u_flareType == 15){","theta = xF * xF + yF * yF;","factor = 1.0 - u_aF *exp(-pow(theta, 2.0) + -0.9 *(yF - 1.7) *(yF + 0.5) *(xF - 1.5) *(xF + 0.5));","}else if(u_flareType == 16){","theta = xF * xF + yF * yF;","a = atan(yF, xF);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * 0.2 * (1.0 - sin(theta) * sin(10.0 * theta) * (sin(10.0 * a))));","}else if(u_flareType == 17){","expV = (-((yF * yF + xF * xF) * (yF * yF + xF * xF) * (yF * yF + xF * xF) * (yF * yF + xF * xF))) * 100.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}else if(u_flareType == 18){","float xF2plusyF2 = yF * yF + xF * xF;","","expV = (-1.0 * (xF2plusyF2) * (xF2plusyF2))*10.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","}","}","","void blend(inout vec4 dst, float factor)","{","vec4 color = vec4(0,0,0,0);","float factorI = 1.0 - factor;","","if(u_blendMode == 0){","color = u_flareColor * factor + dst * factorI;","}else if(u_blendMode==1){","vec4 mult = 2.0 * dst * u_flareColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_flareColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_flareColor) + dst * (4.0 * u_flareColor - 1.0) + (1.0 - 2.0 * u_flareColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = mix(blendColor, dst, factorI);","}else if (u_blendMode==3){","color = factorI * dst + factor * (1.0 - (1.0 - dst) * (1.0 - u_flareColor));","}else if (u_blendMode==4){","color = factorI * dst + factor * mix(dst, u_flareColor, step(u_flareColor, dst));","}else if (u_blendMode==5){","color = factorI * dst + factor * dst * u_flareColor;","}","","color.a = 1.0;","dst = color;","}","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","float factor = 0.0;","","setFactorAndExpvForType(factor);","","factor = 1.0-factor;","factor = clamp(factor,0.0,1.0);","","blend(color, factor);","","color.a = 1.0;","gl_FragColor = color;","}"].join("\n"),MoaFlareBlobFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","expV = (-((xF2plusyF2) * (xF2plusyF2) * (xF2plusyF2) * (xF2plusyF2))) * 100.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factor = 1.0 - factor;","","color.a = factor;","gl_FragColor = color;","}"].join("\n"),MoaFlareBlobOverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform highp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 color = vec4(0,0,0,0);","","float factor = 0.0;","float factorI = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","expV = (-((xF2plusyF2) * (xF2plusyF2) * (xF2plusyF2) * (xF2plusyF2))) * 100.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factorI = clamp(factor, 0.0, 1.0);","factor = 1.0-factorI;","","vec4 mult = 2.0 * dst * u_flareColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_flareColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_flareColor) + dst * (4.0 * u_flareColor - 1.0) + (1.0 - 2.0 * u_flareColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = mix(blendColor, dst, factorI);","","color.a = 1.0;","gl_FragColor = color;","}"].join("\n"),MoaFlareAngleGaussianFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","expV   = -(xF * xF + yF * yF) * 2.0 - 5.0 * (xF + 0.2) * (yF + 0.2) * xF * xF;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - 0.5 * u_aF) : (1.0 - 0.5 * u_aF * exp(expV));","factor = 1.0 - factor;","","","color.a = factor;","gl_FragColor = color;","}"].join("\n"),MoaFlareGaussianThingFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","expV = (-(xF * xF + yF * yF) * 2.0 - 16.0 * (yF + 0.5) * (yF + 0.5) * (xF + 0.5) * (xF + 0.5));","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","","factor = 1.0-factor;","","color.a = factor;","gl_FragColor = color;","}"].join("\n"),
MoaFlareGaussianThing2FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","expV = (-(xF * xF + yF * yF) * 2.0 - 16.0 * (yF + 1.0) * (yF + 1.0) * (xF - 0.5) * (xF - 0.5));","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factor = 1.0-factor;","color.a = factor;","","gl_FragColor = color;","}"].join("\n"),MoaFlareBlob2FragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","expV = (-1.0 * (xF2plusyF2) * (xF2plusyF2))*10.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factor = 1.0-factor;","color.a = factor;","","gl_FragColor = color;","}"].join("\n"),MoaFlareBlob2OverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 color = vec4(0,0,0,0);","","float factor = 0.0;","float factorI = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","expV = (-1.0 * (xF2plusyF2) * (xF2plusyF2))*10.0;","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factorI = clamp(factor, 0.0, 1.0);","factor = 1.0-factorI;","","vec4 mult = 2.0 * dst * u_flareColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_flareColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_flareColor) + dst * (4.0 * u_flareColor - 1.0) + (1.0 - 2.0 * u_flareColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = mix(blendColor, dst, factorI);","","color.a = 1.0;","gl_FragColor = color;","}"].join("\n"),MoaFlareCornerflaresFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 color = u_flareColor;","","float factor = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","theta = xF * xF + yF * yF;","factor = 1.0 - u_aF *exp(-(theta / 180.0) *2.0) * (exp((-8.0) * (yF + 1.0) * (yF - 1.0) * (xF + 1.0) * (xF - 1.0)));","","factor = 1.0-factor;","color.a = factor;","","gl_FragColor = color;","}"].join("\n"),MoaFlareCornerflaresOverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 color = vec4(0,0,0,0);","","float factor = 0.0;","float factorI = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","theta = xF * xF + yF * yF;","factor = 1.0 - u_aF *exp(-(theta / 180.0) *2.0) * (exp((-8.0) * (yF + 1.0) * (yF - 1.0) * (xF + 1.0) * (xF - 1.0)));","","factorI = clamp(factor, 0.0, 1.0);","factor = 1.0 - factorI;","","vec4 mult = 2.0 * dst * u_flareColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_flareColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_flareColor) + dst * (4.0 * u_flareColor - 1.0) + (1.0 - 2.0 * u_flareColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = mix(blendColor, dst, factorI);","","color.a = 1.0;","gl_FragColor = color;","}"].join("\n"),MoaFlareGaussianThing3OverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","uniform highp float u_flareAmount;","varying highp vec2 v_texCoord;","","uniform float u_scaleDiffx;","uniform float u_scaleDiffy;","uniform vec2 u_onePlusDxTimesCenterCoord;","uniform lowp vec4 u_flareColor;","uniform float u_minEXP;","uniform float u_maxEXP;","uniform float u_aF;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","lowp vec4 color = vec4(0,0,0,0);","","float factor = 0.0;","float factorI = 0.0;","","float theta;","float a;","float expV = 0.0;","","float xF = u_scaleDiffx * (v_texCoord.x - u_onePlusDxTimesCenterCoord.x);","float yF = u_scaleDiffy * (v_texCoord.y - u_onePlusDxTimesCenterCoord.y);","","float xF2plusyF2 = yF * yF + xF * xF;","","theta  = xF * xF + yF * yF;","expV   = -theta * 2.0 - 1.0 * (yF + 1.7) * (yF + 1.7) * (xF - 0.6) * (xF - 0.6);","factor = expV < u_minEXP ? 1.0 : expV > u_maxEXP ? (1.0 - u_aF) : (1.0 - u_aF * exp(expV));","","factorI = clamp(factor, 0.0, 1.0);","factor = 1.0-factorI;","","vec4 mult = 2.0 * dst * u_flareColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_flareColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_flareColor) + dst * (4.0 * u_flareColor - 1.0) + (1.0 - 2.0 * u_flareColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = mix(blendColor, dst, factorI);","","color.a = 1.0;","gl_FragColor = color;","}"].join("\n"),MoaRingFlareFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_dr22;","uniform float u_dr12;","uniform float u_daa;","uniform float u_avgD;","uniform float u_bA;","uniform float u_height;","uniform float u_width;","uniform float u_yCenter;","uniform float u_xCenter;","uniform vec4 u_color;","","void main(void) {","lowp vec4 color = u_color;","","float y = u_height * v_texCoord.y ;","float x = u_width * v_texCoord.x ;","float yF = (y - u_yCenter) / u_avgD;","float xF = (x - u_xCenter) / u_avgD;","float theta = (xF * xF + yF * yF);","float factor;","if(theta > u_dr22+u_daa){","factor = 0.0;","}else if(theta > u_dr22){","factor = (u_dr22+u_daa-theta)/u_daa;","}else if(theta > u_dr12){","factor = 1.0;","}else if(theta > u_dr12-u_daa){","factor = 1.0-(u_dr12-theta)/u_daa;","}else{","factor = 0.0;","}","","factor = factor * factor * u_bA;","","color.a = factor;","","gl_FragColor = color;","}"].join("\n"),MoaDrawingVertexShader:["attribute highp vec2 a_position;","varying highp vec2 v_position;","","void main()","{","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","}","",""].join("\n"),MoaDrawingFragmentShader:["precision highp float;","","uniform vec4 u_color;","","void main()","{","vec4 color = u_color;","gl_FragColor = color;","}"].join("\n"),MoaMultiColorDrawingVertexShader:["attribute highp vec4 a_color;","attribute highp vec2 a_position;","","varying vec4 v_color;","","void main()","{","v_color = a_color;","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","}"].join("\n"),MoaMultiColorDrawingFragmentShader:["precision highp float;","","varying vec4 v_color;","","void main()","{","gl_FragColor = v_color;","}"].join("\n"),MoaDrawingLightenBlendModeVertexShader:["attribute highp vec4 a_strokeGrayLevel;","attribute highp vec2 a_position;","attribute highp vec4 a_shade;","","varying vec2 v_texCoord;","varying vec4 v_strokeGrayLevel;","varying vec4 v_shade;","","void main()","{","v_strokeGrayLevel = a_strokeGrayLevel;","v_shade = a_shade;","v_texCoord = 0.5 * a_position + 0.5;","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","}"].join("\n"),MoaDrawingLightenBlendModeFragmentShader:["precision highp float;","","uniform sampler2D u_sampler;","uniform vec4 u_canvasColor;","uniform vec4 u_strokeColor;","","varying highp vec2 v_texCoord;","varying highp vec4 v_strokeGrayLevel;","varying highp vec4 v_shade;","","","void main()","{","vec4 v = v_strokeGrayLevel;","vec4 shadeDraw = v_shade;","vec4 canvasColor = u_canvasColor;","vec4 strokeColor = u_strokeColor;","vec4 imageColor = texture2D(u_sampler, v_texCoord);","lowp vec4 color;","","if (shadeDraw.r >= imageColor.r){","gl_FragColor = v;","}","else{","gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);","}","","}"].join("\n"),MoaLineVertexShader:["attribute highp vec2 a_position;","attribute highp vec2 a_imagePos;","varying highp vec2 v_imagePos;","","void main()","{","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","v_imagePos = a_imagePos;","}"].join("\n"),MoaLineFragmentShader:["precision highp float;","","uniform float u_nHatx;","uniform float u_nHaty;","uniform float u_x1;","uniform float u_y1;","uniform float u_x2;","uniform float u_y2;","uniform float u_r;","uniform float u_r2;","uniform float u_dAA;","uniform float u_bA;","uniform float u_r2AA;","uniform vec4 u_color;","uniform float u_vLength2;","","varying highp vec2 v_imagePos;","","void main()","{","float x = v_imagePos.x;","float y = v_imagePos.y;","float dMax;","float dMin;","float factor;","","//vector math stuff","float proj = abs(u_nHatx * (x - u_x1) + u_nHaty * (y - u_y1));","float d1   = (x - u_x1) * (x - u_x1) + (y - u_y1) * (y - u_y1);","float d2   = (x - u_x2) * (x - u_x2) + (y - u_y2) * (y - u_y2);","if (d1 < d2) {","dMax = d2;","dMin = d1;","} else {","dMax = d1;","dMin = d2;","}","","if (proj > u_r + u_dAA) {	//Is not colinear","factor = 1.0;","} else if (dMin + u_vLength2 < dMax) { //is colinear but not in between points","if (d1 < u_r2 || d2 < u_r2) { //is within circle of one point","factor = 1.0 - u_bA;","} else if (d1 < u_r2AA || d2 < u_r2AA) { //is within anti-aliasing","factor = 1.0 - u_bA + u_bA * (sqrt(dMin) - u_r) / u_dAA;","} else { //outside","factor = 1.0;","}","} else { //Is colinear and in between points","if (proj > u_r) {	//within anti-aliasing","factor = 1.0 - u_bA + u_bA * (proj - u_r) / u_dAA;","} else { //in line","factor = 1.0 - u_bA;","}","}","","vec4 color = u_color;","if (factor < 0.995) {","color.a = (1.0 - factor);","}else{","color.a = 0.0;","}","gl_FragColor = color;","","}"].join("\n"),MoaBordersVignetteFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_vignetteScale;","uniform vec4 u_vignetteColor;","uniform int u_shouldStretch;","uniform int u_shapeMode;","uniform float u_dx_2;","uniform float u_dy_2;","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","vec4 color = u_vignetteColor;","","float xDist = u_width * (v_texCoord.x - 0.5 - u_dx_2);","float yDist = u_height * (v_texCoord.y - 0.5 - u_dy_2);","","float denomI = cutoff / (u_vignetteScale * u_vignetteScale);","","float theta = 0.0;","","if(u_shouldStretch == 0){","theta = (xDist * xDist + yDist * yDist) * denomI;","}else{","xDist = xDist / u_width;","yDist = yDist / u_height;","theta = (xDist * xDist + yDist * yDist) * denomI;","}","","if(u_shapeMode == 1){theta *= theta;}","else if(u_shapeMode == 3){theta *= theta; theta *= theta;}","else if(u_shapeMode == 2){theta = pow(theta,1.5);}","","if(theta < 0.04){","color.a = 0.0;","}else if(theta <= cutoff){","float t2 = theta * theta;","float t4 = t2 * t2;","float t6 = t4 * t2;","float t8 = t6 * t2;","float factor = 1.0 - 2.0 * t2 + c4 * t4 - c6 * t6 + c8 * t8 - c10 * t8 * t2;","","color.a *= 1.0 - factor;","}","","gl_FragColor = color;","}"].join("\n"),MoaBordersVignetteMultiplyFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_vignetteScale;","uniform vec4 u_vignetteColor;","uniform int u_shouldStretch;","uniform int u_shapeMode;","uniform float u_dx_2;","uniform float u_dy_2;","","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","vec4 dst = texture2D(u_sampler, v_texCoord);","vec4 color = vec4(0,0,0,0);","","float xDist = u_width * (v_texCoord.x - 0.5 - u_dx_2);","float yDist = u_height * (v_texCoord.y - 0.5 - u_dy_2);","","float denomI = cutoff / (u_vignetteScale * u_vignetteScale);","","float theta = 0.0;","","if(u_shouldStretch == 0){","theta = (xDist * xDist + yDist * yDist) * denomI;","}else{","xDist = xDist / u_width;","yDist = yDist / u_height;","theta = (xDist * xDist + yDist * yDist) * denomI;","}","","if(u_shapeMode == 1){theta *= theta;}","else if(u_shapeMode == 3){theta *= theta; theta *= theta;}","else if(u_shapeMode == 2){theta = pow(theta,1.5);}","","float factor = u_vignetteColor.a;","float factorI = 0.0;","","if(theta < 0.04){","factor = 0.0;","}else if(theta <= cutoff){","float t2 = theta * theta;","float t4 = t2 * t2;","float t6 = t4 * t2;","float t8 = t6 * t2;","float tFactor = 1.0 - 2.0 * t2 + c4 * t4 - c6 * t6 + c8 * t8 - c10 * t8 * t2;","","factor = u_vignetteColor.a * (1.0 - tFactor);","}","","factor = clamp(factor,0.0,1.0);","factorI = 1.0 - factor;","","dst.rgb = factorI * dst.rgb + factor * (u_vignetteColor.rgb * dst.rgb);","dst.a = 1.0;","","gl_FragColor = dst;","}"].join("\n"),MoaBordersVignetteOverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_vignetteScale;","uniform vec4 u_vignetteColor;","uniform int u_shouldStretch;","uniform int u_shapeMode;","uniform float u_dx_2;","uniform float u_dy_2;","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","vec4 dst = texture2D(u_sampler, v_texCoord);","vec4 color = vec4(0,0,0,0);","","float xDist = u_width * (v_texCoord.x - 0.5 - u_dx_2);","float yDist = u_height * (v_texCoord.y - 0.5 - u_dy_2);","","float denomI = cutoff / (u_vignetteScale * u_vignetteScale);","","float theta = 0.0;","","if(u_shouldStretch == 0){","theta = (xDist * xDist + yDist * yDist) * denomI;","}else{","xDist = xDist / u_width;","yDist = yDist / u_height;","theta = (xDist * xDist + yDist * yDist) * denomI;","}","","if(u_shapeMode == 1){theta *= theta;}","else if(u_shapeMode == 3){theta *= theta; theta *= theta;}","else if(u_shapeMode == 2){theta = pow(theta,1.5);}","","float factor = u_vignetteColor.a;","float factorI = 0.0;","","if(theta < 0.04){","factor = 0.0;","}else if(theta <= cutoff){","float t2 = theta * theta;","float t4 = t2 * t2;","float t6 = t4 * t2;","float t8 = t6 * t2;","float tFactor = 1.0 - 2.0 * t2 + c4 * t4 - c6 * t6 + c8 * t8 - c10 * t8 * t2;","","factor = u_vignetteColor.a * (1.0 - tFactor);","}","","factor = clamp(factor,0.0,1.0);","factorI = 1.0 - factor;","","vec4 mult = 2.0 * dst * u_vignetteColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - u_vignetteColor);","vec4 transition = dst * dst * (2.0 - 4.0 * u_vignetteColor) + dst * (4.0 * u_vignetteColor - 1.0) + (1.0 - 2.0 * u_vignetteColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","color = factorI * dst + factor * blendColor;","","color.a = 1.0;","","gl_FragColor = color;","}","","",""].join("\n"),MoaBordersThetaFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_dw;","uniform float u_rFactor;","uniform float u_width;","uniform float u_height;","uniform int u_borderStyle;","uniform vec4 u_borderColor;","uniform float u_linesScale;","","uniform float u_dotScale;","uniform float u_offsetL;","uniform float u_offsetR;","uniform float u_offsetT;","uniform float u_offsetB;","","uniform float u_offsetX;","uniform float u_offsetY;","","float rand(vec2 n)","{","return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);","}","","void main(void) {","vec4 color = u_borderColor;","","float xComp = (v_texCoord.x < 0.5) ? v_texCoord.x * u_width - u_offsetL : u_width - 1.0 - v_texCoord.x * u_width - u_offsetR;","float yComp = (v_texCoord.y < 0.5) ? v_texCoord.y * u_height - u_offsetT : u_height - 1.0 - v_texCoord.y * u_height - u_offsetB;","","float theta = 0.0;","float factor = 0.0;","float dots = 0.0;","float xCompS = 0.0;","float yCompS = 0.0;","","if (yComp < 1.41421356237309504880168872420969808 * u_dw * u_rFactor && xComp < 1.41421356237309504880168872420969808 * u_dw * u_rFactor) {","theta = 1.41421356237309504880168872420969808*u_dw*u_rFactor - sqrt((yComp - 1.41421356237309504880168872420969808 * u_dw * u_rFactor) * (yComp - 1.41421356237309504880168872420969808 * u_dw * u_rFactor) + (xComp - 1.41421356237309504880168872420969808 * u_dw * u_rFactor) * (xComp - 1.41421356237309504880168872420969808 * u_dw * u_rFactor));","} else {","if (yComp < xComp) { theta = yComp; } else { theta = xComp; }","}","","if (yComp < 0.0 || xComp < 0.0) {","// In this area set to pure border color","} else if (theta < u_dw) {","// If within effect scale distance","if (u_borderStyle == 5) {","theta = theta < 0.0 ? 0.0 : theta;","factor = pow(theta / u_dw, 2.0);","} else if (u_borderStyle == 6) {","factor = 1.0 - (0.4 * rand(v_texCoord) + 0.6) * 2.0 * pow((1.0 - theta / u_dw), 4.0);","} else if (u_borderStyle == 16) {","factor = 1.0 - (0.4 * rand(v_texCoord) + 0.6) * 2.0 * pow((1.0 - theta / u_dw), 4.0);","} else if (u_borderStyle == 3) {","factor = 1.0 - 2.0 * pow((1.0 - theta / u_dw), 4.0);","}","factor = clamp(factor, 0.0, 1.0);","color.a = (1.0 - factor);","}else{","color.a = 0.0;","}","","gl_FragColor = color;","}"].join("\n"),MoaBorderSideVertexShader:["attribute highp vec2 a_position;","attribute float a_alpha;","varying highp vec2 v_position;","varying float v_alpha;","","void main()","{","v_alpha = a_alpha;","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","}","",""].join("\n"),MoaBorderSideFragmentShader:["precision highp float;","","uniform vec4 u_borderColor;","","varying float v_alpha;","","void main()","{","vec4 color = u_borderColor;","float alpha = v_alpha;","alpha = clamp(alpha, 0.0, 0.9999);","color.a = color.a * alpha;","gl_FragColor = color;","}"].join("\n"),MoaBordersHardRandFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform sampler2D u_linesSampler;","uniform float u_height;","uniform float u_width;","uniform float u_widthTexCoordMult;","uniform float u_heightTexCoordMult;","uniform float u_h2;","uniform float u_w2;","uniform float u_offset;","uniform float u_dw;","uniform vec4 u_color;","uniform float u_scale;","uniform float u_floatMult;","uniform float u_floatTrans;","uniform float u_randomSeed;","","","float rand(in vec2 n)","{","//                                                   n *= u_randomSeed;","return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);","}","","highp float unpackFloatFromVec4i(const vec4 value)","{","const vec4 bitSh = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);","float rawVal = dot(value, bitSh);","return ((rawVal / u_floatMult) + u_floatTrans);","}","","void main(void) {","float x = v_texCoord.x * u_width;","float y = v_texCoord.y * u_height;","","// Y tex coords for given lines","float lineL = 0.125;","float lineR = 0.375;","float lineT = 0.625;","float lineB = 0.875;","","float xComp;","float yComp;","float theta;","float factor;","","if (y < u_h2) {","vec2 samplingCoord = vec2(x * u_widthTexCoordMult, lineT);","vec4 sampledValue = texture2D(u_linesSampler, samplingCoord);","yComp = y - u_offset - unpackFloatFromVec4i(sampledValue);","}","","else {","vec2 samplingCoord = vec2(x * u_widthTexCoordMult, lineB);","yComp = u_height - 1.0 - y - u_offset - unpackFloatFromVec4i(texture2D(u_linesSampler, samplingCoord));","}","if (x < u_w2) {","vec2 samplingCoord = vec2(y * u_heightTexCoordMult, lineL);","xComp = x - u_offset - unpackFloatFromVec4i(texture2D(u_linesSampler, samplingCoord));","}else {","vec2 samplingCoord = vec2(y * u_heightTexCoordMult, lineR);","xComp = u_width - 1.0 - x - u_offset - unpackFloatFromVec4i(texture2D(u_linesSampler, samplingCoord));","}","","// Set theta to distance to edge with case for rounded edges","if (yComp < 1.41421356237309504880168872420969808 * u_dw && xComp < 1.41421356237309504880168872420969808 * u_dw) {","theta = 1.41421356237309504880168872420969808*u_dw - sqrt((yComp - 1.41421356237309504880168872420969808 * u_dw) * (yComp - 1.41421356237309504880168872420969808 * u_dw) + (xComp - 1.41421356237309504880168872420969808 * u_dw) * (xComp - 1.41421356237309504880168872420969808 * u_dw));","} else {","if (yComp < xComp) { theta = yComp; } else { theta = xComp; }","}","","vec4 finalColor = u_color;","if (yComp < 0.0 || xComp < 0.0) {","","}","else if (theta < u_dw) {","// If within effect scale distance","factor = 1.0-(0.4*rand(vec2(x,y))+0.6) * 2.0 * pow(1.0 - theta / u_dw, 4.0*u_scale);","factor = clamp(factor, 0.0, 1.0);","finalColor.a *= 1.0 - factor;","}else{","finalColor.a = 0.0;","}","gl_FragColor = finalColor;","}"].join("\n"),MoaGradientFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_scale;","uniform float u_xCenter;","uniform float u_yCenter;","uniform float u_dx_2;","uniform float u_dy_2;","uniform float u_denomI;","uniform float u_alphaBlend;","uniform int u_shapeMode;","uniform int u_vignetteShape;","uniform float u_angleCos;","uniform float u_angleSin;","uniform int u_overlayBlendMode; // Only used for linear vignette gradients","uniform lowp sampler2D u_gradientMap;","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","float xComp = (v_texCoord.x - u_xCenter) / u_scale;","float yComp = (v_texCoord.y - u_yCenter) / u_scale;","","float factor = 0.0;","float alphaBlend = u_alphaBlend;","","if(u_shapeMode == 0){","factor = u_angleCos * xComp - u_angleSin * yComp;","}else if(u_shapeMode == 1){","factor = sqrt(xComp*xComp + yComp*yComp);","}","","factor = clamp(factor, 0.0, 1.0);","","vec4 gradientColor = texture2D(u_gradientMap, vec2(0.0, factor));","gradientColor.a = gradientColor.a * alphaBlend;","gl_FragColor = gradientColor;","}"].join("\n"),MoaGradientLinearVignetteFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_scale;","uniform float u_xCenter;","uniform float u_yCenter;","uniform float u_dx_2;","uniform float u_dy_2;","uniform float u_denomI;","uniform float u_alphaBlend;","uniform int u_shapeMode;","uniform int u_vignetteShape;","uniform float u_angleCos;","uniform float u_angleSin;","uniform int u_overlayBlendMode; // Only used for linear vignette gradients","uniform lowp sampler2D u_gradientMap;","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","float xComp = (v_texCoord.x - u_xCenter) / u_scale;","float yComp = (v_texCoord.y - u_yCenter) / u_scale;","","float factor = 0.0;","float alphaBlend = u_alphaBlend;","","factor = u_angleCos * xComp - u_angleSin * yComp;","","float xDist = u_width * (v_texCoord.x - 0.5 - u_dx_2);","float yDist = u_height * (v_texCoord.y - 0.5 - u_dy_2);","","float theta = u_denomI * (xDist * xDist /  (u_width * u_width) + yDist * yDist /  (u_height * u_height));","","if(u_vignetteShape == 1){theta *= theta;}","else if(u_vignetteShape == 3){theta *= theta; theta *= theta;}","else if(u_vignetteShape == 2){theta = pow(theta,1.5);}","","alphaBlend = u_alphaBlend;","","if (theta < 0.04) {","alphaBlend = 0.0;","} else if (theta <= cutoff){","float t2;","float t4;","float t6;","float t8;","t2 = theta * theta;","t4 = t2 * t2;","t6 = t4 * t2;","t8 = t6 * t2;","alphaBlend = u_alphaBlend * (1.0 - (1.0 - 2.0 * t2 + c4 * t4 - c6 * t6 + c8 * t8 - c10 * t8 * t2));","}","","factor = clamp(factor, 0.0, 1.0);","","vec4 gradientColor = texture2D(u_gradientMap, vec2(0.0, factor));","","if(u_overlayBlendMode == 1){","vec4 imageColor = texture2D(u_sampler, v_texCoord);","alphaBlend *= gradientColor.a;","","vec4 mult = 2.0 * imageColor * gradientColor;","vec4 screen = 1.0 - 2.0 * (1.0 - imageColor) * (1.0 - gradientColor);","vec4 transition = imageColor * imageColor * (2.0 - 4.0 * gradientColor) + imageColor * (4.0 * gradientColor - 1.0) + (1.0 - 2.0 * gradientColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, imageColor)) * mult + (step(0.25, imageColor) - step(0.75, imageColor)) * transition + step(0.75, imageColor) * screen;","","gl_FragColor = vec4(mix(imageColor.rgb, blendColor.rgb, alphaBlend),imageColor.a);","}else{","gradientColor.a = gradientColor.a * alphaBlend;","gl_FragColor = gradientColor;","}","}"].join("\n"),MoaGradientOverlayFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_scale;","uniform float u_xCenter;","uniform float u_yCenter;","uniform float u_dx_2;","uniform float u_dy_2;","uniform float u_denomI;","uniform float u_alphaBlend;","uniform int u_shapeMode;","uniform int u_vignetteShape;","uniform float u_angleCos;","uniform float u_angleSin;","uniform int u_overlayBlendMode; // Only used for linear vignette gradients","uniform lowp sampler2D u_gradientMap;","","const float cutoff = 1.15;","const float c4 = 5.0 / 3.0;","const float c6 = 34.0 / 45.0;","const float c8 = 13.0 / 63.0;","const float c10 = 514.0 / 14175.0;","","void main(void) {","lowp vec4 dst = texture2D(u_sampler, v_texCoord);","","float xComp = (v_texCoord.x - u_xCenter) / u_scale;","float yComp = (v_texCoord.y - u_yCenter) / u_scale;","","float factor = 0.0;","float alphaBlend = u_alphaBlend;","","if(u_shapeMode == 0){","factor = u_angleCos * xComp - u_angleSin * yComp;","}else if(u_shapeMode == 1){","factor = sqrt(xComp*xComp + yComp*yComp);","}","","factor = clamp(factor, 0.0, 1.0);","","vec4 gradientColor = texture2D(u_gradientMap, vec2(0.0, factor));","alphaBlend = gradientColor.a * alphaBlend;","","factor = clamp(alphaBlend,0.0,1.0);","float factorI = 1.0 - factor;","","vec4 mult = 2.0 * dst * gradientColor;","vec4 screen = 1.0 - 2.0 * (1.0 - dst) * (1.0 - gradientColor);","vec4 transition = dst * dst * (2.0 - 4.0 * gradientColor) + dst * (4.0 * gradientColor - 1.0) + (1.0 - 2.0 * gradientColor) / 8.0;","vec4 blendColor = (1.0 - step(0.25, dst)) * mult + (step(0.25, dst) - step(0.75, dst)) * transition + step(0.75, dst) * screen;","","dst = factorI * dst + factor * blendColor;","dst.a = 1.0;","","gl_FragColor = dst;","}"].join("\n"),MoaSketchVertexShader:["attribute highp vec4 a_color;","attribute highp vec2 a_position;","","varying vec4 v_color;","","void main()","{","v_color = a_color;","gl_Position = vec4(a_position.x, a_position.y, 0.0, 1.0);","}","",""].join("\n"),MoaSketchFragmentShader:["precision highp float;","","varying vec4 v_color;","","void main()","{","gl_FragColor = v_color;","}"].join("\n"),MoaAutoEnhanceFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform lowp sampler2D u_mapFactorSampler;","uniform float u_gain;","uniform float u_rScale;","uniform float u_gScale;","uniform float u_bScale;","uniform float u_rMin;","uniform float u_gMin;","uniform float u_bMin;","uniform float u_floatMult;","uniform float u_floatTrans;","","highp float unpackFloatFromVec4i(const vec4 value)","{","const vec4 bitSh = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);","float rawVal = dot(value, bitSh);","return ((rawVal / u_floatMult) + u_floatTrans);","}","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","float r = color.r;","float g = color.g;","float b = color.b;","","float lum = 0.213*r+0.715*g+0.072*b;","","float factor = unpackFloatFromVec4i(texture2D(u_mapFactorSampler, vec2(lum, 0)));","","float gNew = factor*g;","","r = (r+(r*factor-r)*u_gain + (gNew - g)*(1.0-u_gain)-u_rMin)*u_rScale;","b = (b+(b*factor-b)*u_gain + (gNew - g)*(1.0-u_gain)-u_bMin)*u_bScale;","g = (gNew-u_gMin)*u_gScale;","","color.r = r;","color.g = g;","color.b = b;","","gl_FragColor = color;","}"].join("\n"),MoaLABToRGBFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_scaleA;","uniform float u_scaleB;","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","float lab0 = color.r * 255.0;","float lab1 = color.g * u_scaleA * 255.0;","float lab2 = color.b * u_scaleB * 255.0;","","float Y = ( lab0/2.55 + 16.0) / 116.0;","float X = (lab1-127.0) / 500.0 + Y;","float Z = Y - (lab2-127.0) / 200.0;","","float Y3 = Y*Y*Y;","float X3 = X*X*X;","float Z3 = Z*Z*Z;","","if ( Y3 > 0.008856 ){ Y = Y3;}else{Y = ( Y - 16.0 / 116.0 ) / 7.787;}","","if ( X3 > 0.008856 ){ X = X3;}else{X = ( X - 16.0 / 116.0 ) / 7.787;}","","if ( Z3 > 0.008856 ){ Z = Z3;}else{Z = ( Z - 16.0 / 116.0 ) / 7.787;}","","X = .95047  * X;","Y = 1.00000 * Y;","Z = 1.08883 * Z;","","float R = X *  3.2406 + Y * -1.5372 + Z * -0.4986;","float G = X * -0.9689 + Y *  1.8758 + Z *  0.0415;","float B = X *  0.0557 + Y * -0.2040 + Z *  1.0570;","","if ( R > 0.0031308 ) {R = 1.055 * ( pow(R , ( 0.41666666666667 )) ) - 0.055;}else{ R = 12.92 * R;}","if ( G > 0.0031308 ) {G = 1.055 * ( pow(G , ( 0.41666666666667 )) ) - 0.055;}else{ G = 12.92 * G;}","if ( B > 0.0031308 ) {B = 1.055 * ( pow(B , ( 0.41666666666667 )) ) - 0.055;}else{ B = 12.92 * B;}","","","color.r = R; color.g = G; color.b = B;","gl_FragColor = color;","}"].join("\n"),MoaRGBToLABFragmentShader:["precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","float R = color.r * 255.0;","float G = color.g * 255.0;","float B = color.b * 255.0;","","float l1;","float a1;","float b1;","float r;","float g;","float b;","float x;","float y;","float z;","","if(R/255.0 <= 0.04045){r = 100.0 *R/255.0/12.92;} else{ r = 100.0*pow((R/255.0+0.055)/1.055,2.40);}","if(G/255.0 <= 0.04045){g = 100.0 *G/255.0/12.92;} else{ g = 100.0*pow((G/255.0+0.055)/1.055,2.40);}","if(B/255.0 <= 0.04045){b = 100.0 *B/255.0/12.92;} else{ b = 100.0*pow((B/255.0+0.055)/1.055,2.40);}","","x = 0.00433891*r  + 0.00376234915*g + 0.0018990604648*b;","y = 0.002126*r    + 0.007152*g      + 0.000722*b;","z = 0.000177255*r + 0.00109475308*g + 0.0087295537*b;","","if(x > 0.008856){x = pow(x,1.0/3.0);}else{x = 7.787*x+16.0/116.0;}","if(y > 0.008856){y = pow(y,1.0/3.0);}else{y = 7.787*y+16.0/116.0;}","if(z > 0.008856){z = pow(z,1.0/3.0);}else{z = 7.787*z+16.0/116.0;}","","l1 = 116.0*y-16.0;","a1 = 500.0*(x-y);","b1 = 200.0*(y-z);","","color.r = l1 * 2.55 / 255.0; color.g = (a1+127.0) / 255.0; color.b = (b1+127.0) / 255.0;","gl_FragColor = color;","}"].join("\n"),
MoaTwitterGrittyDotsFragmentShader:["","precision highp float;","","varying highp vec2 v_texCoord;","","uniform float u_width;","uniform float u_height;","uniform float u_alpha;","","int modi(int x,int y){","return x - y * (x / y);","}","","void main(void) {","","// get coords","int xCoord = int(v_texCoord.x * u_width);","int yCoord = int(v_texCoord.y * u_height);","","lowp vec4 color = vec4(0,0,0,0);","","if(modi(yCoord,2) == 0 && modi((xCoord + modi(yCoord,4)),4) == 0){","color = vec4(1.0,1.0,1.0,u_alpha);","}","","","gl_FragColor = color;","}"].join("\n"),MoaTwitterPhotoshopSatBWShader:["","precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_transitionWidth;","uniform float u_regionWidth;","uniform float u_weights[6];","uniform int u_saturationMode;","uniform float u_alpha;","","int modi(int x,int y){","return x - y * (x / y);","}","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","// Can't index uniform arrays with non constant integral expressions....ugh","float weights[6];","weights[0] = u_weights[0];","weights[1] = u_weights[1];","weights[2] = u_weights[2];","weights[3] = u_weights[3];","weights[4] = u_weights[4];","weights[5] = u_weights[5];","","","// Get Color Components","","float components[6];","","components[0] = color.r;","components[2] = color.g;","components[4] = color.b;","components[1] = (color.r + color.g) / 2.0;","components[3] = (color.g + color.b) / 2.0;","components[5] = (color.r + color.b) / 2.0;","","// Get H,S,V colors","float r;","float g;","float b;","float delta;","float hue;","float maxColor;","float minColor;","","r = color.r;","g = color.g;","b = color.b;","","maxColor = max(max(r,g), b);","minColor = min(min(r,g), b);","","delta = maxColor - minColor;","","if(maxColor == 0.0 || delta == 0.0){","hue = 0.0;","}else{","if( r == maxColor ){","hue = ( g - b ) / delta;		// between yellow & magenta","}else if( g == maxColor ){","hue = 2.0 + ( b - r ) / delta;	// between cyan & yellow","}else{","hue = 4.0 + ( r - g ) / delta;	// between magenta & cyan","}","","hue *= 60.0;				// degrees","if( hue < 0.0 ){","hue += 360.0;","}","}","","// End hue","","float v;","int hex;","float start;","float end;","float w1;","float w2;","float w3;","float weight;","","hex = modi(int(((hue + 30.0) / 60.0)), 6);","v = 0.0;","","","w1 = 0.0; w3 = 0.0;","if(hex == 0){","start = 330.0;","end = 30.0;","","if(hue > end && hue < start + u_transitionWidth){","w1 = 0.5*(start + u_transitionWidth - hue) / u_transitionWidth;","}else if(hue < start && hue > end - u_transitionWidth){","w3 = 0.5*(hue - (end - u_transitionWidth)) / u_transitionWidth;","}","","}else{","start = float(hex) * u_regionWidth - u_regionWidth/2.0;","end   = start + u_regionWidth;","","if(hue < start + u_transitionWidth){","w1 = 0.5*(start + u_transitionWidth - hue) / u_transitionWidth;","}else if(hue > end - u_transitionWidth){","w3 = 0.5*(hue - (end - u_transitionWidth)) / u_transitionWidth;","}","}","","w2 = 1.0 - w1 - w3;","","int hex5Mod = modi(hex+5,6);","int hexMod = modi(hex,6);","int hex1Mod = modi(hex+1,6);","","","weight = 	weights[hex5Mod]*w1 +","weights[hexMod]*w2 +","weights[hex1Mod]*w3;","","v = 		weights[hex5Mod]*w1*components[hex5Mod] +","weights[hexMod]*w2*components[hexMod] +","weights[hex1Mod]*w3*components[hex1Mod];","","v += (1.0-weight) * min(min(r,g),b);","","if(u_saturationMode==0){","weight = -1.0;","}else{","//Lower weight low brightness pixels","weight *= pow(v,0.3);","}","","r = (0.0-weight)*v + (weight+1.0)*r;","g = (0.0-weight)*v + (weight+1.0)*g;","b = (0.0-weight)*v + (weight+1.0)*b;","","color.r = mix(color.r, r, u_alpha);","color.g = mix(color.g, g, u_alpha);","color.b = mix(color.b, b, u_alpha);","","gl_FragColor = color;","}",""].join("\n"),MoaTwitterPhotoshopSatBWOverlayShader:["","precision highp float;","","uniform lowp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform float u_transitionWidth;","uniform float u_regionWidth;","uniform float u_weights[6];","uniform int u_saturationMode;","uniform float u_alpha;","","int modi(int x,int y){","return x - y * (x / y);","}","","void main(void) {","lowp vec4 color = texture2D(u_sampler, v_texCoord);","","// Can't index uniform arrays with non constant integral expressions....ugh","float weights[6];","weights[0] = u_weights[0];","weights[1] = u_weights[1];","weights[2] = u_weights[2];","weights[3] = u_weights[3];","weights[4] = u_weights[4];","weights[5] = u_weights[5];","","","// Get Color Components","","float components[6];","","components[0] = color.r;","components[2] = color.g;","components[4] = color.b;","components[1] = (color.r + color.g) / 2.0;","components[3] = (color.g + color.b) / 2.0;","components[5] = (color.r + color.b) / 2.0;","","// Get H,S,V colors","float r;","float g;","float b;","float delta;","float hue;","float maxColor;","float minColor;","","r = color.r;","g = color.g;","b = color.b;","","maxColor = max(max(r,g), b);","minColor = min(min(r,g), b);","","delta = maxColor - minColor;","","if(maxColor == 0.0 || delta == 0.0){","hue = 0.0;","}else{","if( r == maxColor ){","hue = ( g - b ) / delta;		// between yellow & magenta","}else if( g == maxColor ){","hue = 2.0 + ( b - r ) / delta;	// between cyan & yellow","}else{","hue = 4.0 + ( r - g ) / delta;	// between magenta & cyan","}","","hue *= 60.0;				// degrees","if( hue < 0.0 ){","hue += 360.0;","}","}","","// End hue","","float v;","int hex;","float start;","float end;","float w1;","float w2;","float w3;","float weight;","","hex = modi(int(((hue + 30.0) / 60.0)), 6);","v = 0.0;","","","w1 = 0.0; w3 = 0.0;","if(hex == 0){","start = 330.0;","end = 30.0;","","if(hue > end && hue < start + u_transitionWidth){","w1 = 0.5*(start + u_transitionWidth - hue) / u_transitionWidth;","}else if(hue < start && hue > end - u_transitionWidth){","w3 = 0.5*(hue - (end - u_transitionWidth)) / u_transitionWidth;","}","","}else{","start = float(hex) * u_regionWidth - u_regionWidth/2.0;","end   = start + u_regionWidth;","","if(hue < start + u_transitionWidth){","w1 = 0.5*(start + u_transitionWidth - hue) / u_transitionWidth;","}else if(hue > end - u_transitionWidth){","w3 = 0.5*(hue - (end - u_transitionWidth)) / u_transitionWidth;","}","}","","w2 = 1.0 - w1 - w3;","","int hex5Mod = modi(hex+5,6);","int hexMod = modi(hex,6);","int hex1Mod = modi(hex+1,6);","","","weight = 	weights[hex5Mod]*w1 +","weights[hexMod]*w2 +","weights[hex1Mod]*w3;","","v = 		weights[hex5Mod]*w1*components[hex5Mod] +","weights[hexMod]*w2*components[hexMod] +","weights[hex1Mod]*w3*components[hex1Mod];","","v += (1.0-weight) * min(min(r,g),b);","","if(u_saturationMode==0){","weight = -1.0;","}else{","//Lower weight low brightness pixels","weight *= pow(v,0.3);","}","","r = (0.0-weight)*v + (weight+1.0)*r;","g = (0.0-weight)*v + (weight+1.0)*g;","b = (0.0-weight)*v + (weight+1.0)*b;","","float factor = clamp(u_alpha, 0.0, 1.0);","float factorI = 1.0-factor;","","if (color.r <= 0.5) {","color.r = factorI * color.r + factor * 2.0 * color.r * r;","} else {","color.r = factorI * color.r + factor * (1.0 - (1.0 - color.r) * (1.0 - r) / 0.5);","}","if (color.g <= 0.5) {","color.g = factorI * color.g + factor * 2.0 * color.g * g;","} else {","color.g = factorI * color.g + factor * (1.0 - (1.0 - color.g) * (1.0 - g) / 0.5);","}","if (color.b <= 0.5) {","color.b = factorI * color.b + factor * 2.0 * color.b * b;","} else {","color.b = factorI * color.b + factor * (1.0 - (1.0 - color.b) * (1.0 - b) / 0.5);","}","","","gl_FragColor = color;","}",""].join("\n"),MoaTwitterClarityFragmentShader:["precision highp float;","","uniform highp sampler2D u_sampler;","varying highp vec2 v_texCoord;","","uniform highp sampler2D u_avgImgSampler;","uniform highp sampler2D u_effectedAvgImgSampler;","uniform float u_gain;","uniform float u_sharpenAmount;","","const float lowestColorVal = 1.0/255.0;","","void main(void) {","highp vec4 color = texture2D(u_sampler, v_texCoord);","","// Might want to encode these into floats;","float avgGray = texture2D(u_avgImgSampler, v_texCoord).r;","float avgHistGray = texture2D(u_effectedAvgImgSampler, v_texCoord).r;","","// Get factor and diff","float factor = avgHistGray / clamp(avgGray, lowestColorVal, 1.0);","float diff = avgHistGray - avgGray;","","// Do wonderful things to the color.","float sharpenedVal = u_sharpenAmount * ((0.2 * color.r + 0.7 * color.g + 0.1 * color.b) - avgGray);","","color.rgb += sharpenedVal;","","color.rgb = color.rgb * (factor * u_gain) + (1.0 - u_gain) * (color.rgb + diff);","","gl_FragColor = color;","}"].join("\n"),MoaDisplayTransparencyFragmentShader:["","precision mediump float;","","uniform sampler2D u_sampler;","uniform vec2 u_textureSize;","","varying vec2 v_texCoord;","","void main() {","","vec4 src = texture2D(u_sampler, v_texCoord);","","vec4 bg = vec4(0.0,0.0,0.0,1.0);","","if(mod(floor(v_texCoord.x * 100.0) + floor(v_texCoord.y * 100.0), 2.0) > 0.5){","bg = vec4(1.0);","}","","//Get rid of alpha in blue channel","","// float alpha = fract(src.b*64.0)/255.0 + src.a;","","float alpha = mod(floor(src.b*255.0+0.5),4.0)/4.0/255.0 + src.a;","","src.b = floor(floor(src.b*255.0*4.0+0.5))/4.0/255.0;","","vec4 displayColor = alpha*src+(1.0-alpha)*bg;","","gl_FragColor = vec4(displayColor.rgb,1.0);","}","",""].join("\n"),MoaShapeMaskFragmentShader:["","precision highp float;","","vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec2 mod289(vec2 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","","vec3 permute(vec3 x) {","return mod289(((x*34.0)+1.0)*x);","}","","float snoise(vec2 v)","{","const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","-0.577350269189626,  // -1.0 + 2.0 * C.x","0.024390243902439); // 1.0 / 41.0","","// First corner","vec2 i  = floor(v + dot(v, C.yy) );","vec2 x0 = v -   i + dot(i, C.xx);","","// Other corners","vec2 i1;","//i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","//i1.y = 1.0 - i1.x;","i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","// x0 = x0 - 0.0 + 0.0 * C.xx ;","// x1 = x0 - i1 + 1.0 * C.xx ;","// x2 = x0 - 1.0 + 2.0 * C.xx ;","vec4 x12 = x0.xyxy + C.xxzz;","x12.xy -= i1;","","// Permutations","i = mod289(i); // Avoid truncation effects in permutation","vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","+ i.x + vec3(0.0, i1.x, 1.0 ));","","vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","m = m*m ;","m = m*m ;","","// Gradients: 41 points uniformly over a line, mapped onto a diamond.","// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)","","vec3 x = 2.0 * fract(p * C.www) - 1.0;","vec3 h = abs(x) - 0.5;","vec3 ox = floor(x + 0.5);","vec3 a0 = x - ox;","","// Normalise gradients implicitly by scaling m","// Approximation of: m *= inversesqrt( a0*a0 + h*h );","m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","","// Compute final noise value at P","vec3 g;","g.x  = a0.x  * x0.x  + h.x  * x0.y;","g.yz = a0.yz * x12.xz + h.yz * x12.yw;","return 130.0 * dot(m, g);","}","","// Cellular noise, returning F1 and F2 in a vec2.","// Standard 3x3 search window for good F1 and F2 values","vec2 cellular(vec2 P) {","#define K 0.142857142857 // 1/7","#define Ko 0.428571428571 // 3/7","#define jitter 1.0 // Less gives more regular pattern","vec2 Pi = mod(floor(P), 289.0);","vec2 Pf = fract(P);","vec3 oi = vec3(-1.0, 0.0, 1.0);","vec3 of = vec3(-0.5, 0.5, 1.5);","vec3 px = permute(Pi.x + oi);","vec3 p = permute(px.x + Pi.y + oi); // p11, p12, p13","vec3 ox = fract(p*K) - Ko;","vec3 oy = mod(floor(p*K),7.0)*K - Ko;","vec3 dx = Pf.x + 0.5 + jitter*ox;","vec3 dy = Pf.y - of + jitter*oy;","vec3 d1 = dx * dx + dy * dy; // d11, d12 and d13, squared","p = permute(px.y + Pi.y + oi); // p21, p22, p23","ox = fract(p*K) - Ko;","oy = mod(floor(p*K),7.0)*K - Ko;","dx = Pf.x - 0.5 + jitter*ox;","dy = Pf.y - of + jitter*oy;","vec3 d2 = dx * dx + dy * dy; // d21, d22 and d23, squared","p = permute(px.z + Pi.y + oi); // p31, p32, p33","ox = fract(p*K) - Ko;","oy = mod(floor(p*K),7.0)*K - Ko;","dx = Pf.x - 1.5 + jitter*ox;","dy = Pf.y - of + jitter*oy;","vec3 d3 = dx * dx + dy * dy; // d31, d32 and d33, squared","// Sort out the two smallest distances (F1, F2)","vec3 d1a = min(d1, d2);","d2 = max(d1, d2); // Swap to keep candidates for F2","d2 = min(d2, d3); // neither F1 nor F2 are now in d3","d1 = min(d1a, d2); // F1 is now in d1","d2 = max(d1a, d2); // Swap to keep candidates for F2","d1.xy = (d1.x < d1.y) ? d1.xy : d1.yx; // Swap if smaller","d1.xz = (d1.x < d1.z) ? d1.xz : d1.zx; // F1 is in d1.x","d1.yz = min(d1.yz, d2.yz); // F2 is now not in d2.yz","d1.y = min(d1.y, d1.z); // nor in  d1.z","d1.y = min(d1.y, d2.x); // F2 is in d1.y, we're done.","return sqrt(d1.xy);","}","","float noiseMultiscale(vec2 v_texCoord, float octaves, float seed){","","float scale = 1.0;","float scaleinv = 1.0;","float sumNoise = 0.0;","float noise;","","for(int i = 0; i < 6; i++){","noise = snoise((2.0*(v_texCoord+seed+5.0)-1.0)*scale);","sumNoise += noise*scaleinv;","scale *= 2.0;","scaleinv *= 0.5;","seed += 137.0;","}","","return sumNoise*0.5;","}","","float noiseMultiscaleAbs(vec2 v_texCoord, float octaves, float seed){","","float scale = 1.0;","float scaleinv = 1.0;","float sumNoise = 0.0;","float noise;","","for(int i = 0; i < 6; i++){","noise = snoise((2.0*(v_texCoord+seed+5.0)-1.0)*scale);","sumNoise += abs(noise*scaleinv);","scale *= 2.0;","scaleinv *= 0.5;","seed += 137.0;","}","","return sumNoise*0.5;","}","// our texture","uniform sampler2D u_gradientMap;","uniform sampler2D u_sampler;","uniform int u_compositeMode;","uniform int u_noiseType;","uniform int u_aspectMode;","","uniform int u_invert; //TODO change to bool","uniform int u_maskOnly; //TODO change to bool","","uniform mat4 u_params;","uniform mat4 u_transform;","","uniform float u_width;","uniform float u_height;","","// the texCoords passed in from the vertex shader.","varying vec2 v_texCoord;","","float cellPaintNoise(vec2 coords){","vec2 F = cellular(coords);","float noise = noiseMultiscale(F, 5.0, 123.0);","noise = noise*0.5+0.5; //convert to [0,1]","","return noise;","}","","float perlinNoise(vec2 coords){","float noise = noiseMultiscale(coords, 5.0, 123.0);","noise = noise*0.5+0.5; //convert to [0,1]","","return noise;","}","","float perlinNoiseAbs(vec2 coords){","float noise = noiseMultiscaleAbs(coords, 5.0, 123.0);","// noise = noise*0.5+0.5; //convert to [0,1]","","return noise;","}","","float marbleNoise(vec2 coords){","","float xyValue = coords.x + coords.y + noiseMultiscale(coords, 5.0, 123.0);","float noise = abs(sin(xyValue * 3.14159));","","return noise;","}","","void main() {","","vec2 texCoordsTmp = v_texCoord;","","if(u_aspectMode == MOA_ASPECT_MODE_STRETCH){","//Nothing, alread in stretch mode implicitly","}else if(u_aspectMode == MOA_ASPECT_MODE_AVERAGE){","float avgD = (u_width+u_height)/2.0;","","texCoordsTmp -= 0.5;","texCoordsTmp.x *= u_width / avgD;","texCoordsTmp.y *= u_height / avgD;","texCoordsTmp += 0.5;","","}else if(u_aspectMode == MOA_ASPECT_MODE_MAX){","float maxD = max(u_width,u_height);","","texCoordsTmp -= 0.5;","texCoordsTmp.x *= u_width / maxD;","texCoordsTmp.y *= u_height / maxD;","texCoordsTmp += 0.5;","","}else if(u_aspectMode == MOA_ASPECT_MODE_MIN){","float minD = min(u_width,u_height);","","texCoordsTmp -= 0.5;","texCoordsTmp.x *= u_width / minD;","texCoordsTmp.y *= u_height / minD;","texCoordsTmp += 0.5;","}","","vec4 transformed = (vec4(texCoordsTmp,0.0,1.0) * u_transform);","","//TODO: figure out 3d projection","//vec2 transformedSpace = transformed.xy;// / (transformed.z/1.0+1.0);","vec2 coords = (transformed.xy-0.5);","","float noise = 0.0;","","if(u_noiseType == 0){","noise = perlinNoise(coords);","}else if(u_noiseType == 1){","vec2 F = cellular(coords);","noise = u_params[0].z * dot(u_params[0].xy,F) / (u_params[0].x+u_params[0].y);","}else if(u_noiseType == 2){","noise = cellPaintNoise(coords);","}else if(u_noiseType == 3){","noise = marbleNoise(coords);","}else if(u_noiseType == 4){","noise = perlinNoiseAbs(coords);","}else if(u_noiseType == 5){","noise = 0.0;","}else if(u_noiseType == 6){","noise = 0.5+0.5*sin(coords.x+coords.y);","}else if(u_noiseType == 7){","noise = 0.5+0.5*sin(coords.x+2.0*(u_params[0].x)*sin(coords.y));","}else if(u_noiseType == 8){","noise = 0.5 + 0.5*coords.x;","}else if(u_noiseType == 9){","// noise = pow(abs(cos(sqrt(pow(coords.x,2.0)+pow(coords.y,2.0)))),4.0);","","float metric = u_params[0].x;","noise = pow(pow(abs(coords.x),metric)+pow(abs(coords.y),metric),1.0/metric);","}else if(u_noiseType == 10){","// noise = pow(abs(cos(sqrt(pow(coords.x,2.0)+pow(coords.y,2.0)))),4.0);","","float metric = u_params[0].x;","float x = pow(abs(pow(coords.x,metric))+abs(pow(coords.y,metric)),1.0/metric);","","if(x == 0.0){","noise = 1.0;","}else{","noise = (cos(x)/x);","}","}else if(u_noiseType == 11){","float xF = coords.x;","float yF = coords.y;","float expV   = (u_params[0].x*((yF-u_params[0].z)*(yF-u_params[0].z)+(xF-u_params[0].w)*(xF-u_params[0].w))+u_params[0].y*(yF-u_params[1].x)*(yF-u_params[1].x)*(xF-u_params[1].y)*(xF-u_params[1].y));","// float expV   = (-(xF*xF+yF*yF)*2.0-16.0*(yF+1.0)*(yF+1.0)*(xF-0.5)*(xF-0.5));","noise = exp(expV);","}","//else if(u_noiseType == 12){","//   float x = 0.0;","//   float y = 0.0;","","//   const float max_iteration = 200.0;","//   float iterationF = 0.0;","","//   for(float iteration = 0.0; iteration < max_iteration; iteration+=1.0){","//     if(x*x + y*y >= 2.0*2.0 || iteration > u_params[0].x){","//       break;","//     }else{","//       iterationF = iteration;","//     }","","//     float xtemp = x*x - y*y + coords.x;","//     y = 2.0*x*y + coords.y;","","//     x = xtemp;","//   }","","//   noise = (coords.x+coords.y)*iterationF / max_iteration;","","// }else if(u_noiseType == 13){","//   float x = coords.x;","//   float y = coords.y;","","//   float x2 = x*x;","//   float y2 = y*y;","","//   const float max_iteration = 200.0;","//   float iterationF = 0.0;","","//   for(float iteration = 0.0; iteration < max_iteration; iteration+=1.0){","//     if(x2 + y2 >= 2.0*2.0 || iteration > u_params[0].x){break;}else{iterationF = iteration;}","","//     y = 2.0*x*y + u_params[0].y;","//     x = x2 - y2 + u_params[0].z;","","//     x2 = x*x;","//     y2 = y*y;","//   }","","//   noise = iterationF / u_params[0].x;","// }","else if(u_noiseType == 14){","noise = 1.0;","}","","noise = clamp(noise,0.0,1.0);","","vec4 dst = vec4(1.0);","if(u_maskOnly == 1){","noise = texture2D(u_gradientMap, vec2(0,noise)).a;","","if(u_invert == 1){","noise = 1.0 - noise;","}","","dst.a = floor(noise*255.0)/255.0; //[0,1]  8 most significant bits","dst.b = fract(noise*255.0); //[0,1) remainder","}else{","float alphaMask = texture2D(u_sampler, v_texCoord).a;","","if(u_invert == 1){","noise = 1.0 - noise;","}","","dst = texture2D(u_gradientMap, vec2(0,noise));","dst.a *= alphaMask; //Assumes previous was mask only","}","","","gl_FragColor = dst;//blendColor*src.a + dst*(1.0-src.a);","","}","",""].join("\n")};if("function"!=typeof a)var a=function(e){e||(e=[]);for(var t,r={},o=0;o<e.length;o++)t=e[o],t&&t.length&&2==t.length&&(r[t[0]]=t[1]);return{get:function(e){return r[e]}}};var i=e("../../../src/js/processors/MoaColorConversion.js"),n=e("../../../src/js/core/MoaBitmap"),s=e("../../../src/js/core/rng"),l=e("../../../src/js/core/MoaColor.js"),u=e("../../../src/js/processors/MoaHistogram.js"),c=e("../../../src/js/core/MoaAllocAndCopy"),d=e("../../../src/js/interactive/MoaRegionInfo"),p=e("../../../src/js/processors/MoaSharpen"),h=e("../../../src/js/core/MoaTransform"),f=16,m={OVERWRITE_ORIGINAL:0,DEFAULT:1,READ_SOURCE_WRITE_NONE:2,READ_LAST_WRITE_NONE:3,READ_LAST_WRITE_TARGET:4},g={NONE:0,NORMAL:1,OVERLAY:2,PREMULTIPLIED_ALPHA:3,DRAW_OVER:4,DRAW_BEHIND:5,NONE_DONT_CLEAR:6},v={TRIANGLE_FAN:"fan",TRIANGLE_STRIP:"strip"},_=["normal","soft","overlay","multiply","screen","darken","lighten","difference","negation","exclusion","hard"],x=["red","green","blue","interpolation","colordodge","invcolordodge","softdodge","colorburn","invcolorburn","softburn","add","subtract","stamp"],w=new a([["sinc",0],["gaussianThing",1],["gaussianThing2",2],["gaussianThing3",3],["gaussianThing4",4],["angleGaussian",5],["stardom",6],["lobes",7],["lensFlare",8],["stripe",9],["stripe2",10],["dimondFlare",11],["crossFlare",12],["cornerFlares",13],["fingerFlare",14],["blobFlare",15],["blah",16],["blob",17],["blob2",18]]),y=new a([["identity",0],["line",1],["circle",2],["gaussian",3],["square",4],["square_round",5],["stardom",6],["lobes",7],["ring_lobes",8],["heart",9],["star",10],["crescent",11],["squiggly",12],["zigzag",13],["spiral",14]]),b=new a([["clamp",0],["repeat",1],["mirroredRepeat",2]]),M=new a([["normal",0],["overlay",1],["color",2],["screen",3],["darken",4],["multiply",5],["soft",6],["lighten",7],["difference",8],["negation",9],["exclusion",10],["hard",11],["red",12],["green",13],["blue",14],["interpolation",15],["colordodge",16],["invcolordodge",17],["softdodge",18],["colorburn",19],["invcolorburn",20],["softburn",21],["add",22],["subtract",23],["stamp",24],["reflect",25],["glow",26],["freeze",27],["heat",28]]),C=(new a([["Perlin",0],["Worley Addition",1],["Cell Paintbrush",2],["Marble",3],["Perlin Abs",4],["Sin(x+y)",6],["Sin(x+2pi*sin(y))",7],["Linear",8],["Radial",9],["Sinc",10],["Gaussian Thing",11],["Mandelbrot",12],["Julia Set",13],["Identity",14]]),new a([["linear",0],["radial",1],["linearVignette",2]])),T=(new a([["stretch",0],["average",1],["min",2],["max",3]]),new a([["normal",0],["sharp",1],["mediumSharp",2],["ultraSharp",3]])),S=new a([["none",0],["halftone",1],["lines",2],["smooth",3],["shadow",4],["fade",5],["rough",6],["bulge",7],["torn",8],["torn2",9],["rect",10],["round",11],["flickr",12],["hardrand",13],["instant",14],["vignette",15],["viewfinder",16]]),A=new a([["intensity",0],["chroma",1],["redChannel",2],["greenChannel",3],["blueChannel",4],["maxChannel",5],["minChannel",6]]),E={};E.MoaGL=r,t.exports=E,r.prototype.buildGLMipmap=function(e,t){var r=this.gl,o=this._claimFreeTexture();r.activeTexture(this._getTextureForIndex(o));var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),e.mipmapTexture=a;for(var i=0;i<e.numLevels;i++)t&&n.convertToPremultiplied(e.bitmapLevels[i]),r.texImage2D(r.TEXTURE_2D,i,r.RGBA,e.bitmapLevels[i].width,e.bitmapLevels[i].height,0,r.RGBA,r.UNSIGNED_BYTE,e.bitmapLevels[i].data),e.bitmapLevels[i]=null;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);var s=r.createTexture();if(r.bindTexture(r.TEXTURE_2D,s),e.originalImageTexture=s,t){var l=c.makeBitmap(e.originalWidth,e.originalHeight);c.copyTo(l,e.originalBitmap),n.convertToPremultiplied(l),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.originalWidth,e.originalHeight,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(l.data)),l.data=null}else r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.originalWidth,e.originalHeight,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(e.originalBitmap.data));r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),this._resetTextureToFree(o)},r.prototype.createEffect=function(){var e=this.gl;this._resetFreeTextures(),e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),e.activeTexture(e.TEXTURE0),this.renderingMode!=m.READ_LAST_WRITE_NONE&&this.renderingMode!=m.READ_LAST_WRITE_TARGET&&(this.glRenderingObjects.readTexture=this.glImageData.sourceTexture,this.glRenderingObjects.writeTexture=this.glRenderingObjects.processedTexture1),this._setTextureParams(e.LINEAR,e.LINEAR,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE)},r.prototype.finalizeEffect=function(){var e=this.gl;if(this.renderingMode==m.DEFAULT||this.renderingMode==m.READ_LAST_WRITE_TARGET){e.bindFramebuffer(e.FRAMEBUFFER,null),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.glRenderingObjects.readTexture),e.useProgram(this.glPrograms.bitmapIdentityProgram),e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,this.glImageData.width,this.glImageData.height);var t=[1,1,1,0,0,0,0,1];e.bindBuffer(e.ARRAY_BUFFER,this.glBuffers.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),this._configureVertexArraysForDraw(this.glPrograms.bitmapIdentityProgram),e.uniform1i(this.glPrograms.bitmapIdentityProgram.samplerSlot,0),e.drawElements(e.TRIANGLES,this.currentIndeces.length,e.UNSIGNED_SHORT,0),this._resetVertexBufferVertices()}else if(this.renderingMode==m.OVERWRITE_ORIGINAL){var r=this.glRenderingObjects.readTexture;if(r!=this.glImageData.sourceTexture){var o=this.glImageData.sourceTexture,a=this.glRenderingObjects.writeTexture;this.glImageData.sourceTexture=r,this.glRenderingObjects.processedTexture2=a,this.glRenderingObjects.processedTexture1=o}}},r.prototype.commit=r.prototype.commitContentsOfFramebuffer=function(e,t){var r=this.glImageData.sourceTexture;this.glImageData.sourceTexture=this.glRenderingObjects.readTexture,this.glRenderingObjects.readTexture==this.glRenderingObjects.processedTexture2?(this.glRenderingObjects.processedTexture2=r,this.glRenderingObjects.readTexture=r):(this.glRenderingObjects.processedTexture1=r,this.glRenderingObjects.readTexture=r)},r.prototype._swapTextures=function(){this.glRenderingObjects.writeTexture=this.glRenderingObjects.writeTexture==this.glRenderingObjects.processedTexture2?this.glRenderingObjects.processedTexture1:this.glRenderingObjects.processedTexture2,this.glRenderingObjects.readTexture=this.glRenderingObjects.writeTexture==this.glRenderingObjects.processedTexture2?this.glRenderingObjects.processedTexture1:this.glRenderingObjects.processedTexture2},r.prototype.startRender=function(e,t){var r=this.gl;this.currentBlendMode=t,t!=g.NONE&&t!=g.NONE_DONT_CLEAR?(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&(this.renderIdentity(),this.currentBlendMode=t,r.useProgram(e)),r.enable(r.BLEND),t==g.NORMAL?r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE):t==g.OVERLAY?r.blendFuncSeparate(r.DST_COLOR,r.SRC_ALPHA,r.ZERO,r.ONE):t==g.PREMULTIPLIED_ALPHA?r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE):t==g.DRAW_OVER?r.blendFunc(r.SRC_ALPHA,r.SRC_ALPHA):t==g.DRAW_BEHIND&&r.blendFunc(r.ONE_MINUS_DST_ALPHA,r.DST_ALPHA),r.blendEquation(r.FUNC_ADD),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.glRenderingObjects.readTexture,0)):(r.disable(r.BLEND),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.glRenderingObjects.writeTexture,0),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.glRenderingObjects.readTexture),t!=g.NONE_DONT_CLEAR&&r.clear(r.COLOR_BUFFER_BIT)),r.viewport(0,0,this.glImageData.width,this.glImageData.height),-1!=e.positionSlot&&-1!=e.texCoordSlot&&this._configureVertexArraysForDraw(e),r.uniform1i(e.samplerSlot,0)},r.prototype.finishRender=function(e){var t=this.gl;t.drawElements(t.TRIANGLES,this.currentIndeces.length,t.UNSIGNED_SHORT,0),t.finish(),e&&this._swapTextures()},r.prototype.clearCurrentFrameBuffer=function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),e.clear(e.COLORATTACHMENT0)},r.prototype.getImageDataFromFramebuffer=function(){var e=this.gl,t=new Uint8Array(new Array(this.glImageData.width*this.glImageData.height*4));return e.readPixels(0,0,this.glImageData.width,this.glImageData.height,e.RGBA,e.UNSIGNED_BYTE,t),t},r.prototype._getWriteTextureAndSet=function(e){if(this.gl.isTexture(e)){var t=this.glRenderingObjects.writeTexture;return this.glRenderingObjects.writeTexture===this.glRenderingObjects.processedTexture1?(this.glRenderingObjects.writeTexture=e,this.glRenderingObjects.processedTexture1=e):(this.glRenderingObjects.writeTexture=e,this.glRenderingObjects.processedTexture2=e),t}return null},r.prototype._getReadTextureAndSet=function(e){if(this.gl.isTexture(e)){var t=this.glRenderingObjects.readTexture;return e===this.glRenderingObjects.sourceTexture?this.glRenderingObjects.readTexture=this.glRenderingObjects.sourceTexture:this.glRenderingObjects.readTexture===this.glRenderingObjects.processedTexture1?(this.glRenderingObjects.readTexture=e,this.glRenderingObjects.processedTexture1=e):(this.glRenderingObjects.readTexture=e,this.glRenderingObjects.processedTexture2=e),t}return null},r.prototype._getSourceTextureAndSet=function(e){if(this.gl.isTexture(e)){var t=this.glImageData.sourceTexture;return this.glImageData.sourceTexture=e,t===this.glRenderingObjects.readTexture&&(this.glRenderingObjects.readTexture=e),t}return null},r.prototype._configurePipelineWithTempReadAndWriteTextures=function(e,t){if(this.gl.isTexture(e)&&this.gl.isTexture(t)){for(var r={},o=Object.keys(this.glRenderingObjects),a=0;a<o.length;a++)r[o[a]]=this.glRenderingObjects[o[a]];return this.glRenderingObjects.readTexture=e,this.glRenderingObjects.writeTexture=t,this.glRenderingObjects.processedTexture1=e,this.glRenderingObjects.processedTexture2=t,r}return null},r.prototype._resetRenderingObjects=function(e){this.glRenderingObjects=e},r.prototype.showTexture=function(e){this.gl.isTexture(e)&&(this._getReadTextureAndSet(e),this.glRenderingObjects.writeTexture,this._getSourceTextureAndSet(e),this.finalizeEffect())},r.prototype._createFramebuffersAndTextures=function(e,t){var r=this.gl;this.createFramebuffer(),"undefined"==typeof this.glRenderingObjects.processedTexture1||null==this.glRenderingObjects.processedTexture1?(this.glRenderingObjects.processedTexture1=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.glRenderingObjects.processedTexture1),this._setTextureParams(r.LINEAR,r.LINEAR,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE)):r.bindTexture(r.TEXTURE_2D,this.glRenderingObjects.processedTexture1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),"undefined"==typeof this.glRenderingObjects.processedTexture2||null==this.glRenderingObjects.processedTexture2?(this.glRenderingObjects.processedTexture2=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.glRenderingObjects.processedTexture2),this._setTextureParams(r.LINEAR,r.LINEAR,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE)):r.bindTexture(r.TEXTURE_2D,this.glRenderingObjects.processedTexture2),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null)},r.prototype.createFramebuffer=function(){var e=this.gl;("undefined"==typeof this.glRenderingObjects.offscreenFramebuffer||null==this.glRenderingObjects.offscreenFramebuffer)&&(this.glRenderingObjects.offscreenFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer))},r.prototype._configureVertexArraysForDraw=function(e){var t=this.gl;t.enableVertexAttribArray(e.positionSlot),t.enableVertexAttribArray(e.texCoordSlot),t.bindBuffer(t.ARRAY_BUFFER,this.glBuffers.positionBuffer),t.vertexAttribPointer(e.positionSlot,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.glBuffers.texCoordBuffer),t.vertexAttribPointer(e.texCoordSlot,2,t.FLOAT,!1,0,0),t.vertexAttrib3fv(e.positionSlot,this.currentVertices),t.vertexAttrib2fv(e.texCoordSlot,this.currentTexCoords),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)},r.prototype._setupVBOs=function(){var e=this.gl;this.glBuffers.positionBuffer=e.createBuffer(),this.glBuffers.texCoordBuffer=e.createBuffer(),this._resetVertexBufferVertices();var t=[0,1,2,2,3,0];this.currentIndeces=t,this.glBuffers.currentIndexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW)},r.prototype.setImage=function(e){var t=this.gl;t.activeTexture(t.TEXTURE0),"undefined"==typeof this.glImageData.sourceTexture||null==this.glImageData.sourceTexture?(this.glImageData.sourceTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glImageData.sourceTexture),
this._setTextureParams(t.NEAREST,t.NEAREST,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE)):t.bindTexture(t.TEXTURE_2D,this.glImageData.sourceTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),(this.glImageData.width!=e.width||this.glImageData.height!=e.height)&&(this.glImageData.width=e.width,this.glImageData.height=e.height,this._createFramebuffersAndTextures(e.width,e.height))},r.prototype.setTextureAsSourceImage=function(e,t,r){var o=this.gl;o.isTexture(e)&&("undefined"!=typeof t&&"undefined"!=typeof r&&(t!=this.glImageData.width||r!=this.glImageData.height)&&(this._createFramebuffersAndTextures(t,r),o.bindTexture(o.TEXTURE_2D,this.glImageData.sourceTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t,r,0,o.RGBA,o.UNSIGNED_BYTE,null),this.glImageData.width=t,this.glImageData.height=r),o.isTexture(e)&&this._copyTexture(this.glImageData.sourceTexture,e,this.glImageData.width,this.glImageData.height))},r.prototype.deleteProcessingObjects=function(){var e=this.gl;this.glRenderingObjects.offscreenFramebuffer&&(e.deleteFramebuffer(this.glRenderingObjects.offscreenFramebuffer),this.glRenderingObjects.offscreenFramebuffer=null),this.glRenderingObjects.processedTexture1&&(e.deleteTexture(this.glRenderingObjects.processedTexture1),this.glRenderingObjects.processedTexture1=null),this.glRenderingObjects.processedTexture2&&(e.deleteTexture(this.glRenderingObjects.processedTexture2),this.glRenderingObjects.processedTexture2=null),this.glRenderingObjects.readTexture=null,this.glRenderingObjects.writeTexture=null},r.prototype._setTextureParams=function(e,t,r,o){var a=this.gl;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,o)},r.prototype._setCurrentlyBoundTexture2DFilterProperties=function(e,t){var r=this.gl;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t)},r.prototype.setBilinearSampling=function(e){var t=this.gl;this.glRenderingObjects.processedTexture1&&(t.bindTexture(t.TEXTURE_2D,this.glRenderingObjects.processedTexture1),this._setCurrentlyBoundTexture2DFilterProperties(e?t.LINEAR:t.NEAREST,e?t.LINEAR:t.NEAREST)),this.glRenderingObjects.processedTexture2&&(t.bindTexture(t.TEXTURE_2D,this.glRenderingObjects.processedTexture2),this._setCurrentlyBoundTexture2DFilterProperties(e?t.LINEAR:t.NEAREST,e?t.LINEAR:t.NEAREST)),this.glImageData.sourceTexture&&(t.bindTexture(t.TEXTURE_2D,this.glImageData.sourceTexture),this._setCurrentlyBoundTexture2DFilterProperties(e?t.LINEAR:t.NEAREST,e?t.LINEAR:t.NEAREST))},r.prototype._resetVertexBufferVertices=function(){var e=this.gl,t=[1,-1,0,1,1,0,-1,1,0,-1,-1,0],r=[1,0,1,1,0,1,0,0];this.currentVertices=t,this.currentTexCoords=r,e.bindBuffer(e.ARRAY_BUFFER,this.glBuffers.positionBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffers.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW)},r.prototype._resetFreeTextures=function(){this.freeTextures[0]=!0;for(var e=1;f>e;e++)this.freeTextures[e]=!1},r.prototype._claimFreeTexture=function(){for(var e=0;f>e;e++)if(!this.freeTextures[e])return this.freeTextures[e]=!0,e;return-1},r.prototype._getTextureForIndex=function(e){var t=this.gl,r=[t.TEXTURE0,t.TEXTURE1,t.TEXTURE2,t.TEXTURE3,t.TEXTURE4,t.TEXTURE5,t.TEXTURE6,t.TEXTURE7];return r[e]},r.prototype._resetTextureToFree=function(e){this.freeTextures[e]=!1};var P=function(e,t,r){var o=D(e,r.VERTEX_SHADER,r),a=D(t,r.FRAGMENT_SHADER,r),i=r.createProgram();if(r.attachShader(i,o),r.attachShader(i,a),r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS))throw new Error("Could not create program: "+r.getProgramInfoLog(i));return r.deleteShader(o),r.deleteShader(a),i},D=function(e,t,r){var o=r.createShader(t);if(r.shaderSource(o,e),r.compileShader(o),!r.getShaderParameter(o,r.COMPILE_STATUS))throw new Error("Could not compile shaders: "+r.getShaderInfoLog(o));return o};r.prototype.setup=function(e){this.gl=e,this.glImageData.pixelFormat=this.gl.RGBA,this.createFramebuffer(),this._setupVBOs(),this.gl.clearColor(0,0,0,1),this.glPrograms.bitmapIdentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,this.gl)},r.prototype.deleteAllShaders=function(){var e=this.gl;for(var t in this.glPrograms)e.deleteProgram(this.glPrograms[t]),delete this.glPrograms[t]},r.prototype.destroyGL=function(){var e=this.gl;this.deleteAllShaders(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.deleteBuffer(this.glBuffers.vertexBufferFlipped),e.deleteBuffer(this.glBuffers.currentIndexBuffer),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteFramebuffer(this.glRenderingObjects.offscreenFramebuffer),e.activeTexture(e.TEXTURE,null),e.bindTexture(e.TEXTURE_2D,null),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(this.glRenderingObjects.processedTexture1),e.deleteTexture(this.glRenderingObjects.processedTexture2),e.deleteTexture(this.glImageData.sourceTexture),this.glBuffers=null,this.glBuffers=null,this.glPrograms=null,this.glRenderingObjects=null,this.glImageData=null,this.renderingMode=null,this.freeTextures=null,this.currentVertices=null,this.currentTexCoords=null,this.currentIndeces=null,this.currentBlendMode=null,this.freeTextures=null,e=null},r.prototype.willAcceptImageOfSize=function(e,t){var r=this.maxImageDim();return r>=e&&e>0&&r>=t&&t>0},r.prototype.maxImageDim=function(){var e=this.gl;return e.getParameter(e.MAX_TEXTURE_SIZE)};var F=function(e,t){t.useProgram(e,t),_e(e,t),e.colorShadowsHighlightsSamplerSlot=t.getUniformLocation(e,"u_colorShadowsHighlightsSampler"),e.colorMatrixSlot=t.getUniformLocation(e,"u_colorMatrix"),e.threeChannelColorMapSamplerSlot=t.getUniformLocation(e,"u_threeChannelColorMapSampler")},L=function(e,t){t.useProgram(e,t),_e(e,t)},R=function(e,t){t.useProgram(e,t),_e(e,t),e.brightnessSlot=t.getUniformLocation(e,"u_brightness"),e.contrastSlot=t.getUniformLocation(e,"u_contrast"),e.saturationSlot=t.getUniformLocation(e,"u_saturation"),e.warmthSlot=t.getUniformLocation(e,"u_warmth"),e.warmthDeltaSlot=t.getUniformLocation(e,"u_warmthDelta"),e.contrastExpSlot=t.getUniformLocation(e,"u_contrastExp"),e.contrastLessThanZeroSlot=t.getUniformLocation(e,"u_contrastLessThanZero"),e.contrastSatAdjustSlot=t.getUniformLocation(e,"u_contrastSatAdjust"),e.cMapSlot=t.getUniformLocation(e,"u_cMap"),e.saturationMatrixSlot=t.getUniformLocation(e,"u_saturationMatrix")},I=function(e,t){t.useProgram(e,t),e.colorMatSlot=t.getUniformLocation(e,"u_colorMat"),e.colorTransSlot=t.getUniformLocation(e,"u_colorTrans"),_e(e,t)},B=function(e,t){t.useProgram(e,t),_e(e,t),e.colorMapSamplerSlot=t.getUniformLocation(e,"u_colorMapSampler"),e.colorMapAmountSlot=t.getUniformLocation(e,"u_colorMapAmount")},O=function(e,t){t.useProgram(e,t),_e(e,t),e.scaleDiffxSlot=t.getUniformLocation(e,"u_scaleDiffx"),e.scaleDiffySlot=t.getUniformLocation(e,"u_scaleDiffy"),e.onePlusDxTimesCenterCoordSlot=t.getUniformLocation(e,"u_onePlusDxTimesCenterCoord"),e.flareColorSlot=t.getUniformLocation(e,"u_flareColor"),e.minEXPSlot=t.getUniformLocation(e,"u_minEXP"),e.maxEXPSlot=t.getUniformLocation(e,"u_maxEXP"),e.aFSlot=t.getUniformLocation(e,"u_aF"),e.flareAmountSlot=t.getUniformLocation(e,"u_flareAmount"),e.flareTypeSlot=t.getUniformLocation(e,"u_flareType"),e.blendModeSlot=t.getUniformLocation(e,"u_blendMode"),e.alphaBlendSlot=t.getUniformLocation(e,"u_alphaBlend")},N=function(e,t){t.useProgram(e,t),_e(e,t),e.srcSamplerSlot=t.getUniformLocation(e,"u_srcSampler"),e.srcAmountSlot=t.getUniformLocation(e,"u_srcAmount"),e.dstAmountSlot=t.getUniformLocation(e,"u_dstAmount")},k=function(e,t){t.useProgram(e,t),_e(e,t),e.srcSamplerSlot=t.getUniformLocation(e,"u_srcSampler"),e.factorSlot=t.getUniformLocation(e,"u_factor")},U=function(e,t){t.useProgram(e,t),_e(e,t),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.vignetteScaleSlot=t.getUniformLocation(e,"u_vignetteScale"),e.vignetteColorSlot=t.getUniformLocation(e,"u_vignetteColor"),e.blendModeSlot=t.getUniformLocation(e,"u_blend"),e.dx_2Slot=t.getUniformLocation(e,"u_dx_2"),e.dy_2Slot=t.getUniformLocation(e,"u_dy_2"),e.shouldStrecthSlot=t.getUniformLocation(e,"u_shouldStretch"),e.shapeModeSlot=t.getUniformLocation(e,"u_shapeMode")},W=function(e,t){t.useProgram(e,t),_e(e,t),e.dwSlot=t.getUniformLocation(e,"u_dw"),e.rFactorSlot=t.getUniformLocation(e,"u_rFactor"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.borderStyleSlot=t.getUniformLocation(e,"u_borderStyle"),e.borderColorSlot=t.getUniformLocation(e,"u_borderColor"),e.linesScaleSlot=t.getUniformLocation(e,"u_linesScale"),e.dotScaleSlot=t.getUniformLocation(e,"u_dotScale"),e.offsetLSlot=t.getUniformLocation(e,"u_offsetL"),e.offsetRSlot=t.getUniformLocation(e,"u_offsetR"),e.offsetTSlot=t.getUniformLocation(e,"u_offsetT"),e.offsetBSlot=t.getUniformLocation(e,"u_offsetB"),e.offsetXSlot=t.getUniformLocation(e,"u_offsetX"),e.offsetYSlot=t.getUniformLocation(e,"u_offsetY")},G=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.alphaSlot=t.getAttribLocation(e,"a_alpha"),e.borderColorSlot=t.getUniformLocation(e,"u_borderColor")},j=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.pointSizeSlot=t.getUniformLocation(e,"u_pointSize"),e.dotSamplerSlot=t.getUniformLocation(e,"u_dotSampler")},V=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.pointSizeSlot=t.getAttribLocation(e,"a_pointSize"),e.dotSamplerSlot=t.getUniformLocation(e,"u_dotSampler")},z=function(e,t){t.useProgram(e,t),_e(e,t),e.dr22Slot=t.getUniformLocation(e,"u_dr22"),e.dr12Slot=t.getUniformLocation(e,"u_dr12"),e.daaSlot=t.getUniformLocation(e,"u_daa"),e.avgDSlot=t.getUniformLocation(e,"u_avgD"),e.bASlot=t.getUniformLocation(e,"u_bA"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.yCenterSlot=t.getUniformLocation(e,"u_yCenter"),e.xCenterSlot=t.getUniformLocation(e,"u_xCenter"),e.colorSlot=t.getUniformLocation(e,"u_color")},H=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.imagePosSlot=t.getAttribLocation(e,"a_imagePos"),e.nHatxSlot=t.getUniformLocation(e,"u_nHatx"),e.nHatySlot=t.getUniformLocation(e,"u_nHaty"),e.x1Slot=t.getUniformLocation(e,"u_x1"),e.y1Slot=t.getUniformLocation(e,"u_y1"),e.x2Slot=t.getUniformLocation(e,"u_x2"),e.y2Slot=t.getUniformLocation(e,"u_y2"),e.rSlot=t.getUniformLocation(e,"u_r"),e.r2Slot=t.getUniformLocation(e,"u_r2"),e.dAASlot=t.getUniformLocation(e,"u_dAA"),e.bASlot=t.getUniformLocation(e,"u_bA"),e.r2AASlot=t.getUniformLocation(e,"u_r2AA"),e.colorSlot=t.getUniformLocation(e,"u_color"),e.vLength2Slot=t.getUniformLocation(e,"u_vLength2")},X=function(e,t){t.useProgram(e,t),_e(e,t),e.randomSeedSlot=t.getUniformLocation(e,"u_randomSeed"),e.intensitySlot=t.getUniformLocation(e,"u_intensity")},$=function(e,t){t.useProgram(e,t),_e(e,t),e.linesSamplerSlot=t.getUniformLocation(e,"u_linesSampler"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.widthTexCoordMultSlot=t.getUniformLocation(e,"u_widthTexCoordMult"),e.heightTexCoordMultSlot=t.getUniformLocation(e,"u_heightTexCoordMult"),e.h2Slot=t.getUniformLocation(e,"u_h2"),e.w2Slot=t.getUniformLocation(e,"u_w2"),e.offsetSlot=t.getUniformLocation(e,"u_offset"),e.dwSlot=t.getUniformLocation(e,"u_dw"),e.colorSlot=t.getUniformLocation(e,"u_color"),e.scaleSlot=t.getUniformLocation(e,"u_scale"),e.floatMultSlot=t.getUniformLocation(e,"u_floatMult"),e.floatTransSlot=t.getUniformLocation(e,"u_floatTrans"),e.randomSeedSlot=t.getUniformLocation(e,"u_randomSeed")},Y=function(e,t){t.useProgram(e,t),_e(e,t),e.mapFactorSamplerSlot=t.getUniformLocation(e,"u_mapFactorSampler"),e.gainSlot=t.getUniformLocation(e,"u_gain"),e.rScaleSlot=t.getUniformLocation(e,"u_rScale"),e.gScaleSlot=t.getUniformLocation(e,"u_gScale"),e.bScaleSlot=t.getUniformLocation(e,"u_bScale"),e.rMinSlot=t.getUniformLocation(e,"u_rMin"),e.gMinSlot=t.getUniformLocation(e,"u_gMin"),e.bMinSlot=t.getUniformLocation(e,"u_bMin"),e.floatMultSlot=t.getUniformLocation(e,"u_floatMult"),e.floatTransSlot=t.getUniformLocation(e,"u_floatTrans")},q=function(e,t){t.useProgram(e,t),_e(e,t)},Z=function(e,t){t.useProgram(e,t),e.scaleASlot=t.getUniformLocation(e,"u_scaleA"),e.scaleBSlot=t.getUniformLocation(e,"u_scaleB"),_e(e,t)},K=function(e,t){t.useProgram(e,t),_e(e,t),e.maskSamplerSlot=t.getUniformLocation(e,"u_maskSampler")},Q=function(e,t){t.useProgram(e,t),_e(e,t)},J=function(e,t){t.useProgram(e,t),_e(e,t),e.avgImgSamplerSlot=t.getUniformLocation(e,"u_avgImgSampler"),e.effectedAvgImgSamplerSlot=t.getUniformLocation(e,"u_effectedAvgImgSampler"),e.gainSlot=t.getUniformLocation(e,"u_gain"),e.sharpenAmountSlot=t.getUniformLocation(e,"u_sharpenAmount")},ee=function(e,t){t.useProgram(e,t),_e(e,t),e.colorMapSamplerSlot=t.getUniformLocation(e,"u_colorMapSampler"),e.colorMapAmountSlot=t.getUniformLocation(e,"u_colorMapAmount"),e.intensitySlot=t.getUniformLocation(e,"u_intensity")},te=function(e,t){t.useProgram(e,t),_e(e,t),e.blendColorSlot=t.getUniformLocation(e,"u_blendColor"),e.blendAmountSlot=t.getUniformLocation(e,"u_blendAmount"),e.blendColorAlphaSlot=t.getUniformLocation(e,"u_blendColorAlpha")},re=function(e,t){t.useProgram(e,t),_e(e,t),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.scaleSlot=t.getUniformLocation(e,"u_scale"),e.xCenterSlot=t.getUniformLocation(e,"u_xCenter"),e.yCenterSlot=t.getUniformLocation(e,"u_yCenter"),e.dx_2Slot=t.getUniformLocation(e,"u_dx_2"),e.dy_2Slot=t.getUniformLocation(e,"u_dy_2"),e.denomISlot=t.getUniformLocation(e,"u_denomI"),e.alphaBlendSlot=t.getUniformLocation(e,"u_alphaBlend"),e.vignetteShapeSlot=t.getUniformLocation(e,"u_vignetteShape"),e.shapeModeSlot=t.getUniformLocation(e,"u_shapeMode"),e.angleCosSlot=t.getUniformLocation(e,"u_angleCos"),e.angleSinSlot=t.getUniformLocation(e,"u_angleSin"),e.overlayBlendModeSlot=t.getUniformLocation(e,"u_overlayBlendMode"),e.gradientMapSlot=t.getUniformLocation(e,"u_gradientMap")},oe=function(e,t){t.useProgram(e,t),_e(e,t),e.centerPointSlot=t.getUniformLocation(e,"u_centerPoint"),e.sigmaR2Slot=t.getUniformLocation(e,"u_sigmaR2"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.normXSlot=t.getUniformLocation(e,"u_normX"),e.normYSlot=t.getUniformLocation(e,"u_normY")},ae=function(e,t){t.useProgram(e,t),_e(e,t),e.centerPointSlot=t.getUniformLocation(e,"u_centerPoint"),e.sigmaR2Slot=t.getUniformLocation(e,"u_sigmaR2"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height")},ie=function(e,t){t.useProgram(e,t),_e(e,t),e.maskSamplerSlot=t.getUniformLocation(e,"u_maskSampler"),e.sourceSamplerSlot=t.getUniformLocation(e,"u_sourceSampler")},ne=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.texCoordSlot=t.getAttribLocation(e,"a_texCoord"),e.centerTexCoordSlot=t.getAttribLocation(e,"a_centerTexCoord"),e.pointSizeSlot=t.getUniformLocation(e,"u_pointSize"),e.radiusSlot=t.getUniformLocation(e,"u_radius"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.alphaSlot=t.getUniformLocation(e,"u_alpha"),e.dEdgeSlot=t.getUniformLocation(e,"u_dEdge")},se=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.colorSlot=t.getAttribLocation(e,"a_color")},le=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.strokeGrayLevelSlot=t.getAttribLocation(e,"a_strokeGrayLevel"),e.shadeSlot=t.getAttribLocation(e,"a_shade"),e.canvasColorSlot=t.getUniformLocation(e,"u_canvasColor"),e.strokeColorSlot=t.getUniformLocation(e,"u_strokeColor")},ue=function(e,t){t.useProgram(e,t),_e(e,t),e.positionSlot=t.getAttribLocation(e,"a_position"),e.texCoordSlot=t.getAttribLocation(e,"a_texCoord"),e.centerTexCoordSlot=t.getAttribLocation(e,"a_centerTexCoord"),e.pointSizeSlot=t.getUniformLocation(e,"u_pointSize"),e.radiusSlot=t.getUniformLocation(e,"u_radius"),e.widthSlot=t.getUniformLocation(e,"u_width"),e.heightSlot=t.getUniformLocation(e,"u_height"),e.alphaSlot=t.getUniformLocation(e,"u_alpha"),e.dEdgeSlot=t.getUniformLocation(e,"u_dEdge"),e.lSlot=t.getUniformLocation(e,"u_l"),e.aSlot=t.getUniformLocation(e,"u_a"),e.bSlot=t.getUniformLocation(e,"u_b"),e.sigmaCSlot=t.getUniformLocation(e,"u_sigmaC")},ce=function(e,t){t.useProgram(e,t),_e(e,t),e.texelStrideSlot=t.getUniformLocation(e,"u_texelStride")},de=function(e,t){t.useProgram(e,t),_e(e,t),e.texelStrideSlot=t.getUniformLocation(e,"u_texelStride"),e.weight0Slot=t.getUniformLocation(e,"u_weight0"),e.weight1Slot=t.getUniformLocation(e,"u_weight1"),e.weight2Slot=t.getUniformLocation(e,"u_weight2"),e.weight3Slot=t.getUniformLocation(e,"u_weight3"),e.weight4Slot=t.getUniformLocation(e,"u_weight4")},pe=function(e,t){t.useProgram(e),_e(e,t),e.gradientMapSlot=t.getUniformLocation(e,"u_gradientMap"),e.gradientVarSlot=t.getUniformLocation(e,"u_gradVar"),e.invertGradientSlot=t.getUniformLocation(e,"u_invertMap"),e.blendModeSlot=t.getUniformLocation(e,"u_blendMode"),e.alphaBlendSlot=t.getUniformLocation(e,"u_alphaBlend")},he=function(e,t){t.useProgram(e),_e(e,t),e.shapeSlot=t.getUniformLocation(e,"u_shape"),e.alphaBlendSlot=t.getUniformLocation(e,"u_alphaBlend"),e.gradientMapSlot=t.getUniformLocation(e,"u_gradientMap"),e.invertGradientSlot=t.getUniformLocation(e,"u_invert"),e.wrapModeSlot=t.getUniformLocation(e,"u_wrapMode"),e.transformMatSlot=t.getUniformLocation(e,"u_transform"),e.paramsMatSlot=t.getUniformLocation(e,"u_params")},fe=function(e,t){t.useProgram(e),_e(e,t),e.bitmapBlendSlot=t.getUniformLocation(e,"u_blendSampler"),e.alphaSlot=t.getUniformLocation(e,"u_alpha")},me=function(e,t){t.useProgram(e,t),_e(e,t),e.transformSlot=t.getUniformLocation(e,"u_transform")},ge=function(e,t){t.useProgram(e,t),_e(e,t),e.overlaySamplerSlot=t.getUniformLocation(e,"u_overlaySampler"),e.transformSlot=t.getUniformLocation(e,"u_transform"),e.alphaSlot=t.getUniformLocation(e,"u_alpha")},ve=function(e,t){t.useProgram(e,t),_e(e,t),e.bitmapLFSamplerSlot=t.getUniformLocation(e,"u_samplerLF"),e.bitmapOffsetSamplerSlot=t.getUniformLocation(e,"u_samplerOffset"),e.bitmapOffsetLFSamplerSlot=t.getUniformLocation(e,"u_samplerOffsetLF"),e.centerSlot=t.getUniformLocation(e,"u_center"),e.offsetSlot=t.getUniformLocation(e,"u_offset"),e.aspectISlot=t.getUniformLocation(e,"u_aspectI"),e.radiusSlot=t.getUniformLocation(e,"u_radius"),e.avgColorSlot=t.getUniformLocation(e,"u_avgColor")},_e=function(e,t){e.positionSlot=t.getAttribLocation(e,"a_position"),e.texCoordSlot=t.getAttribLocation(e,"a_texCoord"),e.samplerSlot=t.getUniformLocation(e,"u_sampler"),e.blendModeSlot=t.getUniformLocation(e,"u_blendMode")};r.prototype.createTexture=function(e,t){var r=this.gl,o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),this._setTextureParams(r.NEAREST,r.NEAREST,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE),o},r.prototype.createTextureFromBitmap=function(e){var t=this.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(e.data)),this._setTextureParams(t.NEAREST,t.NEAREST,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE),r},r.prototype.destroyTexture=function(e){var t=this.gl;t.isTexture(e)&&(t.deleteTexture(e),t.bindTexture(t.TEXTURE_2D,null))},r.prototype.getImageDataFromTexture=function(e){var t=this.gl;return t.bindFramebuffer(t.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.getImageDataFromFramebuffer()},r.prototype._copyTexture=function(e,t,r,a){var i=this.gl;if(i.isTexture(t)&&i.isTexture(e)){this.glPrograms.bitmapIdentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,i);var n=this.glPrograms.bitmapIdentityProgram;i.useProgram(this.glPrograms.bitmapIdentityProgram);var s=this._configurePipelineWithTempReadAndWriteTextures(t,e),l=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(l)),i.bindTexture(i.TEXTURE_2D,e),this._setTextureParams(i.LINEAR,i.LINEAR,i.CLAMP_TO_EDGE,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,r,a,0,i.RGBA,i.UNSIGNED_BYTE,null);var u=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(u)),i.bindTexture(i.TEXTURE_2D,t),i.disable(i.BLEND);var c=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,c),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.glRenderingObjects.writeTexture,0),i.clear(i.COLOR_BUFFER_BIT),i.viewport(0,0,r,a),this._configureVertexArraysForDraw(n),i.uniform1i(n.samplerSlot,u),i.drawElements(i.TRIANGLES,this.currentIndeces.length,i.UNSIGNED_SHORT,0),i.finish(),i.bindFramebuffer(i.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),i.deleteFramebuffer(c),this._resetTextureToFree(l),this._resetTextureToFree(u),this._resetRenderingObjects(s)}},r.prototype.copyLastRender=function(e){var t,r=this.gl;if(r.isTexture(e))if(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture){var a=this._getWriteTextureAndSet(e);this.glPrograms.bitmapIdentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,r),r.useProgram(this.glPrograms.bitmapIdentityProgram),this.startRender(this.glPrograms.bitmapIdentityProgram,g.NONE),this.finishRender(!1),this._getWriteTextureAndSet(a),this.glRenderingObjects.readTexture=this.glImageData.sourceTexture}else t=this.glRenderingObjects.readTexture,this._copyTexture(e,t,this.glImageData.width,this.glImageData.height)};var xe=function(e,t,r,o,a,i){return"undefined"==typeof e&&(e=P(r,o,i),e?(t(e,i),a&&i.drawArrays(GL_TRIANGLES,0,0)):glData.state=MoaGLState.FAILED),e};r.prototype.renderAdjustments=function(e,t,r,a,i,n,s,l){var u,c=this.gl,d="normal"!=s||1!=l;if(d){var u=this.createTexture(e.width,e.height);this.copyLastRender(u)}this.glPrograms.adjustmentsProgram=xe(this.glPrograms.adjustmentsProgram,F,o.MoaVertexShader,o.MoaAdjustmentsFragmentShader,!1,c);var p=this.glPrograms.adjustmentsProgram;c.useProgram(p),this.startRender(p,g.NONE);for(var h=new Uint8ClampedArray(1024),f=0;256>f;f++){var m=4*f;h[m]=t[f]+.5|0,h[m+1]=r[f]+a[f]-f+.5|0,h[m+2]=0,h[m+3]=255}for(var f=0;4>f;f++)i.push(0);for(var v=new Uint8ClampedArray(1024),f=0;256>f;f++){var m=4*f;v[m]=n.r[f],v[m+1]=n.g[f],v[m+2]=n.b[f],v[m+3]=255}var _=this._claimFreeTexture(),x=this._createGradientTexture(_,h);c.uniform1i(p.colorShadowsHighlightsSamplerSlot,_),c.uniformMatrix4fv(p.colorMatrixSlot,c.True,new Float32Array(i));var w=this._claimFreeTexture(),y=this._createGradientTexture(w,v);if(c.uniform1i(p.threeChannelColorMapSamplerSlot,w),this.finishRender(!0),this._resetTextureToFree(_),c.deleteTexture(x),this._resetTextureToFree(w),c.deleteTexture(y),d){var b=this.glRenderingObjects.writeTexture,M=this.glRenderingObjects.readTexture;this.bitmapBlendBitmap(b,u,M,s,l),this._swapTextures(),this.destroyTexture(u)}},r.prototype._createBasicDotTexture=function(e,t,r,o){var a,i,n,s,l,u,c,d,p,h,f,m,g,v,_,x=this.gl;for(t=1.5,r=2*t,x.activeTexture(this._getTextureForIndex(o)),a=x.createTexture(),x.bindTexture(x.TEXTURE_2D,a),i=Math.ceil(2*(t+r)),u=t*t,c=Math.pow(t+r,2),d=e.a/255,_=[],n=0;i>n;n++)for(p=4*i*n,s=0;i>s;s++)l=p+4*s,_[l]=e.r,_[l+1]=e.g,_[l+2]=e.b,f=n+.5,m=s+.5,g=i/2,v=(f-g)*(f-g)+(m-g)*(m-g),h=v>c?0:v>u?1-(1-d+d*(Math.sqrt(v)-t)/r):d,_[l+3]=255*h;return x.texImage2D(x.TEXTURE_2D,0,x.RGBA,i,i,0,x.RGBA,x.UNSIGNED_BYTE,new Uint8Array(_)),this._setTextureParams(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE),a},r.prototype.renderBasicDots=function(e,t,r,a,i){var n,s,l,u=this.gl;this.glPrograms.basicDotsProgram=xe(this.glPrograms.basicDotsProgram,V,o.MoaBasicDotsVertexShader,o.MoaDotMatrixFragmentShader,!1,u),n=this.glPrograms.basicDotsProgram,u.useProgram(n),this.startRender(n,g.NORMAL),u.enable(u.BLEND),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ZERO,u.ONE),u.blendEquation(u.FUNC_ADD),u.enableVertexAttribArray(n.positionSlot),u.enableVertexAttribArray(n.pointSizeSlot);var c=u.createBuffer(),d=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,c),u.vertexAttribPointer(n.positionSlot,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,new Float32Array(t),u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,d),u.vertexAttribPointer(n.pointSizeSlot,1,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,new Float32Array(r),u.STATIC_DRAW),s=this._claimFreeTexture(),l=this._createBasicDotTexture(e,a,i,s),u.uniform1i(n.dotSamplerSlot,s),u.drawArrays(u.POINTS,0,r.length),u.disable(u.BLEND),u.deleteTexture(l),u.deleteBuffer(c),u.deleteBuffer(d),this._resetTextureToFree(s),u.bindFramebuffer(u.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),u.bindBuffer(u.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)},r.prototype.renderIdentity=function(){var e=this.gl;this.glPrograms.bitmapIdentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,e),e.useProgram(this.glPrograms.bitmapIdentityProgram),this.startRender(this.glPrograms.bitmapIdentityProgram,g.NONE),this.finishRender(!0)},r.prototype.copyBitmapSubsection=function(e,t,r){var a=this.gl;this.glPrograms.bitmapIndentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,a);var i=this.glPrograms.bitmapIdentityProgram,n=[r[0],r[1]],s=[r[0]+r[2],r[1]],l=[r[0],r[1]+r[3]],u=[r[0]+r[2],r[1]+r[3]],c=[s[0],s[1],u[0],u[1],l[0],l[1],n[0],n[1]];a.useProgram(i);var d=this._getWriteTextureAndSet(t);this.startRender(i,g.NONE),this.currentTexCoords=c,a.bindBuffer(a.ARRAY_BUFFER,this.glBuffers.texCoordBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);var p=this._claimFreeTexture();a.activeTexture(this._getTextureForIndex(p)),a.bindTexture(a.TEXTURE_2D,e),this._setCurrentlyBoundTexture2DFilterProperties(a.NEAREST,a.NEAREST),a.uniform1i(i.samplerSlot,p),this.finishRender(!1),a.activeTexture(this._getTextureForIndex(p)),a.bindTexture(a.TEXTURE_2D,e),this._setCurrentlyBoundTexture2DFilterProperties(a.NEAREST,a.NEAREST),a.bindTexture(a.TEXTURE_2D,null),this._resetTextureToFree(p),this._getWriteTextureAndSet(d),this._resetVertexBufferVertices()},r.prototype.drawTextureToSubregionOfDstTexture=function(e,t,r){var a=this.gl;this.glPrograms.bitmapIndentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,a);var i=this.glPrograms.bitmapIdentityProgram,n=[r[0],r[1]],s=[r[0]+r[2],r[1]],l=[r[0],r[1]+r[3]],u=[r[0]+r[2],r[1]+r[3]],c=[2*(s[0]-.5),2*(s[1]-.5),0,2*(u[0]-.5),2*(u[1]-.5),0,2*(l[0]-.5),2*(l[1]-.5),0,2*(n[0]-.5),2*(n[1]-.5),0];a.useProgram(i);var d=this._getWriteTextureAndSet(t);this.startRender(i,g.NONE_DONT_CLEAR),this.currentVertices=c,a.bindBuffer(a.ARRAY_BUFFER,this.glBuffers.positionBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(c),a.STATIC_DRAW);var p=this._claimFreeTexture();a.activeTexture(this._getTextureForIndex(p)),a.bindTexture(a.TEXTURE_2D,e),a.uniform1i(i.samplerSlot,p),this.finishRender(!1),a.activeTexture(this._getTextureForIndex(p)),a.bindTexture(a.TEXTURE_2D,null),this._resetTextureToFree(p),this._getWriteTextureAndSet(d),this._resetVertexBufferVertices()},r.prototype.renderColorBlendColor=function(e,t,r){var a,i=this.gl;this.glPrograms.colorBlendColorProgram=xe(this.glPrograms.colorBlendColorProgram,te,o.MoaVertexShader,o.MoaBitmapColorBlendColorFragmentShader,!1,i),a=this.glPrograms.colorBlendColorProgram,i.useProgram(a),this.startRender(a,g.NONE),i.uniform3fv(a.blendColorSlot,new Float32Array(e)),i.uniform1f(a.blendAmountSlot,r),i.uniform1f(a.blendColorAlphaSlot,t),this.finishRender(!0)},r.prototype.renderBlendWithOriginal=function(e,t){var r=this.gl;this.glPrograms.bitmapBlendProgram=xe(this.glPrograms.bitmapBlendProgram,N,o.MoaVertexShader,o.MoaBitmapBlendFragmentShader,!1,r);var a=this.glPrograms.bitmapBlendProgram;r.useProgram(a),this.startRender(a,g.NONE);var i=this._claimFreeTexture();this.glRenderingObjects.readTexture!=this.glImageData.sourceTexture?(r.activeTexture(this._getTextureForIndex(i)),r.bindTexture(r.TEXTURE_2D,this.glImageData.sourceTexture)):i=0,r.uniform1i(a.srcSamplerSlot,i),r.uniform1f(a.srcAmountSlot,t),r.uniform1f(a.dstAmountSlot,e),this.finishRender(!0),0!=i&&(r.activeTexture(this._getTextureForIndex(i)),r.bindTexture(r.TEXTURE_2D,null)),this._resetTextureToFree(i)},r.prototype.renderBlendWithOriginalOverlayReverse=function(e){var t=this.gl;this.glPrograms.bitmapBlendOverlayReverseProgram=xe(this.glPrograms.bitmapBlendOverlayReverseProgram,k,o.MoaVertexShader,o.MoaBitmapBlendOverlayReverseFragmentShader,!1,t);var r=this.glPrograms.bitmapBlendOverlayReverseProgram;t.useProgram(r),this.startRender(r,g.NONE);var a=this._claimFreeTexture();this.glRenderingObjects.readTexture!=this.glImageData.sourceTexture?(t.activeTexture(this._getTextureForIndex(a)),t.bindTexture(t.TEXTURE_2D,this.glImageData.sourceTexture)):a=0,t.uniform1i(r.srcSamplerSlot,a),t.uniform1f(r.factorSlot,e),this.finishRender(!0),0!=a&&(t.activeTexture(this._getTextureForIndex(a)),t.bindTexture(t.TEXTURE_2D,null)),this._resetTextureToFree(a)},r.prototype.bitmapBlendBitmap=function(e,t,r,a,i){var n,s=this.gl;if(_.indexOf(a)>-1)this.glPrograms.bitmapBlendBitmapProgram1=xe(this.glPrograms.bitmapBlendBitmapProgram,fe,o.MoaVertexShader,o.MoaBitmapBlendBitmapFragmentShader1,!1,s),n=this.glPrograms.bitmapBlendBitmapProgram1;else if(x.indexOf(a)>-1)this.glPrograms.bitmapBlendBitmapProgram2=xe(this.glPrograms.bitmapBlendBitmapProgram,fe,o.MoaVertexShader,o.MoaBitmapBlendBitmapFragmentShader2,!1,s),n=this.glPrograms.bitmapBlendBitmapProgram2;else{if("color"!=a)return;this.glPrograms.bitmapBlendBitmapColorModeProgram=xe(this.glPrograms.bitmapBlendBitmapColorModeProgram,fe,o.MoaVertexShader,o.MoaBitmapBlendBitmapColorModeFragmentShader,!1,s),n=this.glPrograms.bitmapBlendBitmapColorModeProgram}var l=this._claimFreeTexture();s.activeTexture(this._getTextureForIndex(l)),s.bindTexture(s.TEXTURE_2D,r);var u=this._configurePipelineWithTempReadAndWriteTextures(t,e);s.useProgram(n),this.startRender(n,g.NONE),s.uniform1i(n.bitmapBlendSlot,l),s.uniform1f(n.alphaSlot,i),"color"!=a&&s.uniform1i(n.blendModeSlot,M.get(a)),this.finishRender(!0),this._resetTextureToFree(l),this._resetRenderingObjects(u)},r.prototype.bitmapBlendBitmapSeparate=function(e,t,r,a,i){var n,s=this.gl;this.glPrograms.bitmapBlendProgram=xe(this.glPrograms.bitmapBlendProgram,N,o.MoaVertexShader,o.MoaBitmapBlendFragmentShader,!1,s),n=this.glPrograms.bitmapBlendProgram;var l=this._configurePipelineWithTempReadAndWriteTextures(t,e),u=this._claimFreeTexture();s.activeTexture(this._getTextureForIndex(u)),s.bindTexture(s.TEXTURE_2D,r),s.useProgram(n),this.startRender(n,g.NONE),s.uniform1i(n.srcSamplerSlot,u),s.uniform1f(n.srcAmountSlot,i),s.uniform1f(n.dstAmountSlot,a),this.finishRender(!1),this._resetTextureToFree(u),this._resetRenderingObjects(l)},r.prototype.compositeTexturesUsingPremultipliedAlpha=function(e,t,r){var a,i=this.gl;this.glPrograms.bitmapIdentityProgram=xe(this.glPrograms.bitmapIdentityProgram,L,o.MoaVertexShader,o.MoaBitmapIdentityFragmentShader,!1,i),a=this.glPrograms.bitmapIdentityProgram;var n=this._claimFreeTexture(),s=this._claimFreeTexture(),l=this._configurePipelineWithTempReadAndWriteTextures(t,e);i.activeTexture(this._getTextureForIndex(n)),i.bindTexture(i.TEXTURE_2D,t),i.activeTexture(this._getTextureForIndex(s)),i.bindTexture(i.TEXTURE_2D,r),i.useProgram(a),this.startRender(a,g.NONE),i.uniform1i(a.samplerSlot,n),this.finishRender(!0),this.startRender(a,g.PREMULTIPLIED_ALPHA),
i.uniform1i(a.samplerSlot,s),this.finishRender(!1),this._resetRenderingObjects(l),i.activeTexture(this._getTextureForIndex(s)),i.bindTexture(i.TEXTURE_2D,null),i.activeTexture(this._getTextureForIndex(n)),i.bindTexture(i.TEXTURE_2D,null),this._resetTextureToFree(n),this._resetTextureToFree(s)},r.prototype.blendTextureWithLastRenderAsBaseLayer=function(e,t,r){this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,e,this.glRenderingObjects.readTexture,t,r),this._swapTextures()};var we=70;r.prototype.renderBlemishPoint=function(e,t,r){var a,i=this.gl,n=e.width,s=e.height,l=t.center,l=t.center,u=t.radius,c=t.offset,h=t.skinColor,f=u*n,m=[l[0]*n,l[1]*s],v=!1;if(("undefined"==typeof c||"undefined"==typeof h)&&(v=!0),v){var _=d.findClosestPatch(e,m,f);t.offset=[],t.offset[0]=_[0]/n,t.offset[1]=_[1]/s,a=d.findAvgSkinColor(e,m,f),t.skinColor=a}else _=[c[0]*n,c[1]*s],_[0]=0|_[0],_[1]=0|_[1],a=t.skinColor;var x=m[0]-f+.5|0,w=m[1]-f+.5|0,y=m[0]+f+.5|0,b=m[1]+f+.5|0,M=m[0]+_[0]-f+.5|0,C=m[1]+_[1]-f+.5|0,T=m[0]+_[0]+f+.5|0,S=m[1]+_[1]+f+.5|0;if(!(0>M||0>C||T>n-1||S>s-1)){var A=y-x+1,E=b-w+1;blurAmount=we*(n+s)/(A+E);var P=this.createTexture(A,E),D=this.createTexture(A,E),F=this.createTexture(A,E),L=this.createTexture(A,E),R=this.createTexture(A,E),I=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(I)),i.bindTexture(i.TEXTURE_2D,P);var B=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(B)),i.bindTexture(i.TEXTURE_2D,D);var O=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(O)),i.bindTexture(i.TEXTURE_2D,F);var N=this._claimFreeTexture();i.activeTexture(this._getTextureForIndex(N)),i.bindTexture(i.TEXTURE_2D,L),this.glImageData.width=A,this.glImageData.height=E;var k,U,k=[x/n,w/s,A/n,E/s],U=[M/n,C/s,A/n,E/s];U[0]=k[0]<0?U[0]+1/n:U[0],U[1]=k[1]<0?U[1]+1/s:U[1];var W=((0|m[0])-x)/(A-1),G=((0|m[1])-w)/(E-1);this.copyBitmapSubsection(r,P,k),this.copyBitmapSubsection(r,F,U);var j=this._configurePipelineWithTempReadAndWriteTextures(P,D),V=this._getSourceTextureAndSet(r);this.renderIdentity(),this._getWriteTextureAndSet(R),e.width=A,e.height=E,p.sharpen(e,-blurAmount),this._getReadTextureAndSet(F),this._getWriteTextureAndSet(L),this.renderIdentity(),this._getWriteTextureAndSet(R),p.sharpen(e,-blurAmount),this._getReadTextureAndSet(P),this._getWriteTextureAndSet(R),this.glPrograms.blemishProgram=xe(this.glPrograms.blemishProgram,ve,o.MoaVertexShader,o.MoaBlemishFragmentShader,!1,i);var z=this.glPrograms.blemishProgram;i.useProgram(z),this.startRender(z,g.NONE),i.uniform1i(z.bitmapLFSamplerSlot,B),i.uniform1i(z.bitmapOffsetSamplerSlot,O),i.uniform1i(z.bitmapOffsetLFSamplerSlot,N),i.uniform1f(z.aspectISlot,s/n),i.uniform1f(z.radiusSlot,f/n),i.uniform2f(z.centerSlot,W,G),i.uniform4f(z.avgColorSlot,a.r/255,a.g/255,a.b/255,1),this.finishRender(!0),e.width=n,e.height=s,this.glImageData.width=n,this.glImageData.height=s;var k=[x/n,w/s,A/n,E/s];this.drawTextureToSubregionOfDstTexture(R,r,k),this._getReadTextureAndSet(r),this._getWriteTextureAndSet(j.writeTexture),this.renderIdentity(),this._getSourceTextureAndSet(V),this._resetRenderingObjects(j),this._swapTextures(),i.deleteTexture(P),i.deleteTexture(F),i.deleteTexture(D),i.deleteTexture(L),i.deleteTexture(R),this._resetTextureToFree(I),this._resetTextureToFree(O),this._resetTextureToFree(B),this._resetTextureToFree(N)}},r.prototype.renderVignette=function(e){var t=this.gl,r=e.blendMode;"undefined"==typeof M.get(r)&&(r="normal");var a,i,n,s,l=this.glImageData.width,u=this.glImageData.height,c=!1;"overlay"==r?(this.glPrograms.borderVignetteOverlayProgram=xe(this.glPrograms.borderVignetteOverlayProgram,U,o.MoaVertexShader,o.MoaBordersVignetteOverlayFragmentShader,!1,t),a=this.glPrograms.borderVignetteOverlayProgram):"multiply"==r?(this.glPrograms.borderVignetteMultiplyProgram=xe(this.glPrograms.borderVignetteMultiplyProgram,U,o.MoaVertexShader,o.MoaBordersVignetteMultiplyFragmentShader,!1,t),a=this.glPrograms.borderVignetteMultiplyProgram):"normal"==r?(this.glPrograms.borderVignetteProgram=xe(this.glPrograms.borderVignetteProgram,U,o.MoaVertexShader,o.MoaBordersVignetteFragmentShader,!1,t),a=this.glPrograms.borderVignetteProgram):(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),this.glPrograms.borderVignetteProgram=xe(this.glPrograms.borderVignetteProgram,U,o.MoaVertexShader,o.MoaBordersVignetteFragmentShader,!1,t),a=this.glPrograms.borderVignetteProgram,i=this.createTexture(l,u),n=this._claimFreeTexture(),t.activeTexture(this._getTextureForIndex(n)),t.bindTexture(t.TEXTURE_2D,i),s=this._getWriteTextureAndSet(i),c=!0);var d=[];this._fillFloatColorWithMoaColorVals(d,e.color),t.useProgram(a),"normal"==r?this.startRender(a,g.NORMAL):this.startRender(a,g.NONE),t.uniform1f(a.widthSlot,this.glImageData.width),t.uniform1f(a.heightSlot,this.glImageData.height),t.uniform1f(a.vignetteScaleSlot,e.vignetteScale),t.uniform1f(a.dx_2Slot,e.dx/2),t.uniform1f(a.dy_2Slot,e.dy/2),t.uniform4fv(a.vignetteColorSlot,d),t.uniform1i(a.shouldStrecthSlot,e.stretch?1:0),t.uniform1i(a.shapeModeSlot,T.get(e.shapeMode)),"overlay"==r||"multiply"==r?this.finishRender(!0):this.finishRender(!1),c&&(this._getWriteTextureAndSet(s),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,i,e.blendMode,1),this._swapTextures(),this._resetTextureToFree(n),t.deleteTexture(i))},r.prototype.renderThetaBorder=function(e,t,r,a,i,n,s,l,u,c,d,p){var h,f=this.gl,m=[];this.glPrograms.borderThetaProgram=xe(this.glPrograms.borderThetaProgram,W,o.MoaVertexShader,o.MoaBordersThetaFragmentShader,!1,f),h=this.glPrograms.borderThetaProgram,this._fillFloatColorWithMoaColorVals(m,e),f.useProgram(h),this.startRender(h,g.NORMAL),f.uniform1f(h.dwSlot,r),f.uniform1f(h.rFactorSlot,a),f.uniform1f(h.widthSlot,this.glImageData.width),f.uniform1f(h.heightSlot,this.glImageData.height),f.uniform1i(h.borderStyleSlot,S.get(t)),f.uniform4fv(h.borderColorSlot,m),f.uniform1f(h.offsetLSlot,i),f.uniform1f(h.offsetRSlot,n),f.uniform1f(h.offsetTSlot,s),f.uniform1f(h.offsetBSlot,l),f.uniform1f(h.offsetXSlot,u),f.uniform1f(h.offsetYSlot,c),this.finishRender(!1)},r.prototype._createLinesTexture=function(e,t,r,o,a,i,n,s,l,u){var c,d,p,h,f,m,g,v,_,x=this.gl;for(x.activeTexture(this._getTextureForIndex(u)),h=x.createTexture(),x.bindTexture(x.TEXTURE_2D,h),p=[],c=0;t>c;c++)f=s*(r[c]-l),m=256*f*256*256-Math.floor(256*f*256*256),g=256*f*256-Math.floor(256*f*256)-m/256,v=256*f-Math.floor(256*f)-g/256,_=f-v/256,p[4*c]=255*m,p[4*c+1]=255*g,p[4*c+2]=255*v,p[4*c+3]=255*_;for(var w=4*c;4*n>w;w++)p[w]=0;for(d=4*n,c=0;t>c;c++)f=s*(o[c]-l),m=256*f*256*256-Math.floor(256*f*256*256),g=256*f*256-Math.floor(256*f*256)-m/256,v=256*f-Math.floor(256*f)-g/256,_=f-v/256,p[d+4*c]=255*m,p[d+4*c+1]=255*g,p[d+4*c+2]=255*v,p[d+4*c+3]=255*_;for(var w=4*c;4*n>w;w++)p[d+w]=0;for(d=8*n,c=0;e>c;c++)f=s*(a[c]-l),m=256*f*256*256-Math.floor(256*f*256*256),g=256*f*256-Math.floor(256*f*256)-m/256,v=256*f-Math.floor(256*f)-g/256,_=f-v/256,p[d+4*c]=255*m,p[d+4*c+1]=255*g,p[d+4*c+2]=255*v,p[d+4*c+3]=255*_;for(var w=4*c;4*n>w;w++)p[d+w]=0;for(d=12*n,c=0;e>c;c++)f=s*(i[c]-l),m=256*f*256*256-Math.floor(256*f*256*256),g=256*f*256-Math.floor(256*f*256)-m/256,v=256*f-Math.floor(256*f)-g/256,_=f-v/256,p[d+4*c]=255*m,p[d+4*c+1]=255*g,p[d+4*c+2]=255*v,p[d+4*c+3]=255*_;for(var w=4*c;4*n>w;w++)p[d+w]=0;return x.texImage2D(x.TEXTURE_2D,0,x.RGBA,n,4,0,x.RGBA,x.UNSIGNED_BYTE,new Uint8Array(p)),this._setTextureParams(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE),h},r.prototype.renderHardRandBorder=function(e,t,r,a,i,n,s,l,u,c,d){var p,h,f,m=this.gl,v=[];this.glPrograms.hardRandProgram=xe(this.glPrograms.hardRandProgram,$,o.MoaVertexShader,o.MoaBordersHardRandFragmentShader,!1,m),f=this.glPrograms.hardRandProgram,0==i&&(i=1),this._fillFloatColorWithMoaColorVals(v,e),m.useProgram(f),this.startRender(f,g.NORMAL),h=Math.max(this.glImageData.width,this.glImageData.height);var _,x,w,y,b,M,C,T,S,A,E=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],P=[0,0,0,0];for(p=0;p<this.glImageData.width;p++)S=c[p],A=d[p],S>P[2]&&(P[2]=S),A>P[3]&&(P[3]=A),S<E[2]&&(E[2]=S),A<E[3]&&(E[3]=A);for(p=0;p<this.glImageData.height;p++)C=l[p],T=u[p],C>P[0]&&(P[0]=C),T>P[1]&&(P[1]=T),C<E[0]&&(E[0]=C),T<E[1]&&(E[1]=T);x=Math.max(Math.max(P[0],P[1]),Math.max(P[2],P[3])),_=Math.min(Math.min(E[0],E[1]),Math.min(E[2],E[3])),w=1/(x-_),y=_,b=this._claimFreeTexture(),M=this._createLinesTexture(this.glImageData.width,this.glImageData.height,l,u,c,d,h,w,y,b),m.uniform1i(f.linesSamplerSlot,b),m.uniform1f(f.heightSlot,this.glImageData.height),m.uniform1f(f.widthSlot,this.glImageData.width),m.uniform1f(f.widthTexCoordMultSlot,1/h),m.uniform1f(f.heightTexCoordMultSlot,1/h),m.uniform1f(f.h2Slot,s),m.uniform1f(f.w2Slot,n),m.uniform1f(f.offsetSlot,a),m.uniform1f(f.dwSlot,t),m.uniform4fv(f.colorSlot,v),m.uniform1f(f.scaleSlot,r),m.uniform1f(f.floatMultSlot,w),m.uniform1f(f.floatTransSlot,y),m.uniform1f(f.randomSeedSlot,i),this.finishRender(!1),m.deleteTexture(M),this._resetTextureToFree(b)},r.prototype.beginSideBorder=function(e){var t=this.gl,r=[];this._fillFloatColorWithMoaColorVals(r,e),this.glPrograms.borderSideProgram=xe(this.glPrograms.borderSideProgram,G,o.MoaBorderSideVertexShader,o.MoaBorderSideFragmentShader,!1,t);var a=this.glPrograms.borderSideProgram;t.useProgram(a),t.enableVertexAttribArray(a.positionSlot),t.enableVertexAttribArray(a.alphaSlot),t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE),t.blendEquation(t.FUNC_ADD),t.uniform4fv(a.borderColorSlot,r)},r.prototype.addSideBorder=function(e,t,r){var a=this.gl;this.glPrograms.borderSideProgram=xe(this.glPrograms.borderSideProgram,G,o.MoaBorderSideVertexShader,o.MoaBorderSideFragmentShader,!1,a);var i=this.glPrograms.borderSideProgram;a.useProgram(i);var n,s,l=8*(0==r||3==r?this.glImageData.height:this.glImageData.width),u=0==r||3==r?this.glImageData.width:this.glImageData.height,c=0==r||3==r?this.glImageData.height:this.glImageData.width,d=[],p=[];if(n=0==r||1==r?1:-1,0!=t)for(s=0;l>s;s+=8){var h=s/(4*(c-1))-1;0==r||3==r?(d[s/2]=2*(e[s/8]+n*t)/(u-1)-1,d[s/2+1]=h,d[s/2+2]=0==r?-1:1,d[s/2+3]=h,p[s/4]=0,p[s/4+1]=0==r?(e[s/8]+t)/(2*t):(u-(e[s/8]-t))/(2*t)):(d[s/2]=h,d[s/2+1]=2*(e[s/8]+n*t)/(u-1)-1,d[s/2+2]=h,d[s/2+3]=1==r?-1:1,p[s/4]=0,p[s/4+1]=1==r?(e[s/8]+t)/(2*t):(u-(e[s/8]-t))/(2*t))}else for(s=0;l>s;s+=8){var h=s/(4*(c-1))-1;0==r||3==r?(d[s/2]=2*e[s/8]/(u-1)-1,d[s/2+1]=h,d[s/2+2]=0==r?-1:1,d[s/2+3]=h,p[s/4]=1,p[s/4+1]=1):(d[s/2]=h,d[s/2+1]=2*e[s/8]/(u-1)-1,d[s/2+2]=h,d[s/2+3]=1==r?-1:1,p[s/4]=1,p[s/4+1]=1)}var f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,new Float32Array(d),a.STATIC_DRAW),a.vertexAttribPointer(i.positionSlot,2,a.FLOAT,!1,0,0);var m=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,m),a.bufferData(a.ARRAY_BUFFER,new Float32Array(p),a.STATIC_DRAW),a.vertexAttribPointer(i.alphaSlot,1,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,l/4),a.deleteBuffer(f),a.deleteBuffer(m)},r.prototype.addBorderDoubleSide=function(e,t,r,a){var i,n,s,l,u,c=this.gl,d=[],p=[];this.glPrograms.borderSideProgram=xe(this.glPrograms.borderSideProgram,G,o.MoaBorderSideVertexShader,o.MoaBorderSideFragmentShader,!1,c);var h=this.glPrograms.borderSideProgram;c.useProgram(h);var i=8*(0==a||3==a?this.glImageData.height:this.glImageData.width),n=0==a||3==a?this.glImageData.width:this.glImageData.height,s=0==a||3==a?this.glImageData.height:this.glImageData.width,u=2==a||3==a?-1:1,d=[],p=[],f=[],m=[];for(l=0;i/8>l;l++)d[l]=(e[l]+t[l])/2,p[l]=(u*e[l]-u*t[l])/(2*r);for(l=0;i>l;l+=8){var g=l/(4*(s-1))-1;0==a||3==a?(f[l/2]=2*e[l/8]/(n-1)-1,f[l/2+1]=g,f[l/2+2]=2*d[l/8]/(n-1)-1,f[l/2+3]=g,m[l/4]=0,m[l/4+1]=p[l/8]):(f[l/2]=g,f[l/2+1]=2*e[l/8]/(n-1)-1,f[l/2+2]=g,f[l/2+3]=2*d[l/8]/(n-1)-1,m[l/4]=0,m[l/4+1]=p[l/8])}var v=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,v),c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW),c.vertexAttribPointer(h.positionSlot,2,c.FLOAT,!1,0,0);var _=c.createBuffer();for(c.bindBuffer(c.ARRAY_BUFFER,_),c.bufferData(c.ARRAY_BUFFER,new Float32Array(m),c.STATIC_DRAW),c.vertexAttribPointer(h.alphaSlot,1,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLE_STRIP,0,i/4),l=0;i>l;l+=8)0==a||3==a?f[l/2]=2*t[l/8]/(n-1)-1:f[l/2+1]=2*t[l/8]/(n-1)-1;c.bindBuffer(c.ARRAY_BUFFER,v),c.bufferData(c.ARRAY_BUFFER,new Float32Array(f),c.STATIC_DRAW),c.vertexAttribPointer(h.positionSlot,2,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLE_STRIP,0,i/4),c.deleteBuffer(v),c.deleteBuffer(_)},r.prototype.endSideBorder=function(){var e=this.gl;e.disable(e.BLEND);var t=this.glPrograms.borderSideProgram;e.disableVertexAttribArray(t.positionSlot),e.disableVertexAttribArray(t.alphaSlot),e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)};var ye=function(e){return 0>e?0:e>255?255:e};r.prototype._createColorMapTexture=function(e,t,r,o){var a,i,n,s,l=this.gl;n=4,s=256;var u=[];for(l.activeTexture(this._getTextureForIndex(o)),a=l.createTexture(),l.bindTexture(l.TEXTURE_2D,a),i=0;s>i;i++)u[i*n]=ye(e[i]),u[i*n+1]=ye(t[i]),u[i*n+2]=ye(r[i]),u[i*n+3]=0;return l.texImage2D(l.TEXTURE_2D,0,l.RGBA,1,256,0,l.RGBA,l.UNSIGNED_BYTE,new Uint8Array(u)),this._setTextureParams(l.LINEAR,l.LINEAR,l.CLAMP_TO_EDGE,l.CLAMP_TO_EDGE),a},r.prototype.renderColorMap=function(e){var t,r,a=this.gl;this.glPrograms.colorMapProgram=xe(this.glPrograms.colorMapProgram,B,o.MoaVertexShader,o.MoaColorMapFragmentShader,!1,a);var i=this.glPrograms.colorMapProgram;a.useProgram(i),this.startRender(i,g.NONE),t=this._claimFreeTexture(),r=this._createColorMapTexture(e.r,e.g,e.b,t),a.uniform1i(i.colorMapSamplerSlot,t),this.finishRender(!0),a.activeTexture(this._getTextureForIndex(t)),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(r),this._resetTextureToFree(t)},r.prototype._populateGLMultAndTransMatrices=function(e,t,r){t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[1],t[4]=e[5],t[5]=e[9],t[6]=e[2],t[7]=e[6],t[8]=e[10],r[0]=e[3]/255,r[1]=e[7]/255,r[2]=e[11]/255},r.prototype.renderColorMatrixTransform=function(e){var t=this.gl;this.glPrograms.colorTransformProgram=xe(this.glPrograms.colorTransformProgram,I,o.MoaVertexShader,o.MoaColorTransformFragmentShader,!1,t);var r=this.glPrograms.colorTransformProgram,a=[],i=[];this._populateGLMultAndTransMatrices(e,a,i),t.useProgram(r),this.startRender(r,g.NONE),t.uniform3fv(r.colorTransSlot,new Float32Array(i)),t.uniformMatrix3fv(r.colorMatSlot,!1,new Float32Array(a)),this.finishRender(!0)},r.prototype.renderColorMatrixTransformAndBlendWithOriginal=function(e,t,r){var a=this.gl;if("undefined"!=typeof M.get(t)){var i=this.glImageData.width,n=this.glImageData.height;this.glPrograms.colorTransformProgram=xe(this.glPrograms.colorTransformProgram,I,o.MoaVertexShader,o.MoaColorTransformFragmentShader,!1,a);var s,l,u,c=this.glPrograms.colorTransformProgram,d=!1;("normal"!=t||1!=r)&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),s=this.createTexture(i,n),l=this._claimFreeTexture(),a.activeTexture(this._getTextureForIndex(l)),a.bindTexture(a.TEXTURE_2D,s),u=this._getWriteTextureAndSet(s),d=!0);var p=[],h=[];this._populateGLMultAndTransMatrices(e,p,h),a.useProgram(c),this.startRender(c,g.NONE),a.uniform3fv(c.colorTransSlot,new Float32Array(h)),a.uniformMatrix3fv(c.colorMatSlot,!1,new Float32Array(p)),this.finishRender(!d),d&&(this._getWriteTextureAndSet(u),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,s,t,r),this._swapTextures(),this._resetTextureToFree(l),a.deleteTexture(s))}},r.prototype._get357FactorsOfClosetsFactorableNumber=function(e,t){for(var r=!1,o=!1,a=0,i=e;!r;)if(i=e+a,a*=-1,0>=a&&a--,!(3>i)){r=!0,o=!1;var n=i,s=[3,5,7];t[0]=0,t[1]=0,t[2]=0;for(var l=0,u=0;n>1;)if(n%s[l]==0?(t[l]++,u++,n=n/s[l]|0):l++,l>=3){r=!1;break}}},r.prototype.addBoxBlur=function(e,t){var r=this.gl,a=[];if(!(2>e)){this._get357FactorsOfClosetsFactorableNumber(e,a);var i=1/("horizontal"==t?this.glImageData.width:this.glImageData.height);"horizontal"==t?(this.glPrograms.horizontalBoxBlur3Program=xe(this.glPrograms.horizontalBoxBlur3Program,ce,o.MoaConvolutionHorizontalBoxBlur3VertexShader,o.MoaConvolutionBoxBlur3FragmentShader,!1,r),this.glPrograms.horizontalBoxBlur5Program=xe(this.glPrograms.horizontalBoxBlur5Program,ce,o.MoaConvolutionHorizontalBoxBlur5VertexShader,o.MoaConvolutionBoxBlur5FragmentShader,!1,r),this.glPrograms.horizontalBoxBlur7Program=xe(this.glPrograms.horizontalBoxBlur7Program,ce,o.MoaConvolutionHorizontalBoxBlur7VertexShader,o.MoaConvolutionBoxBlur7FragmentShader,!1,r)):(this.glPrograms.verticalBoxBlur3Program=xe(this.glPrograms.verticalBoxBlur3Program,ce,o.MoaConvolutionVerticalBoxBlur3VertexShader,o.MoaConvolutionBoxBlur3FragmentShader,!1,r),this.glPrograms.verticalBoxBlur5Program=xe(this.glPrograms.verticalBoxBlur5Program,ce,o.MoaConvolutionVerticalBoxBlur5VertexShader,o.MoaConvolutionBoxBlur5FragmentShader,!1,r),this.glPrograms.verticalBoxBlur7Program=xe(this.glPrograms.verticalBoxBlur7Program,ce,o.MoaConvolutionVerticalBoxBlur7VertexShader,o.MoaConvolutionBoxBlur7FragmentShader,!1,r));var n,s=a[0]+a[1]+a[2],l=i,u=l;for(n=0;s>n;n++){var c;n<a[0]?(c="horizontal"==t?this.glPrograms.horizontalBoxBlur3Program:this.glPrograms.verticalBoxBlur3Program,u*=3):n<a[0]+a[1]?(c="horizontal"==t?this.glPrograms.horizontalBoxBlur5Program:this.glPrograms.verticalBoxBlur5Program,u*=5):(c="horizontal"==t?this.glPrograms.horizontalBoxBlur7Program:this.glPrograms.verticalBoxBlur7Program,u*=7),r.useProgram(c),r.uniform1f(c.texelStrideSlot,l),this.startRender(c,g.NONE),r.activeTexture(r.TEXTURE0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),this.finishRender(!0),l=u}r.activeTexture(r.TEXTURE0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)}},r.prototype.addConvolution=function(e,t,r){var a,i=this.gl;t>1&&this.addBoxBlur(t,r,this);var n=1/("horizontal"==r?this.glImageData.width:this.glImageData.height),s=n*(t?t:1);"horizontal"==r?(this.glPrograms.gaussianBlurHorizontalProgram=xe(this.glPrograms.gaussianBlurHorizontalProgram,de,o.MoaConvolutionHorizontalGaussian9VertexShader,o.MoaConvolutionGaussian9FragmentShader,!1,i),a=this.glPrograms.gaussianBlurHorizontalProgram):(this.glPrograms.gaussianBlurVerticalProgram=xe(this.glPrograms.gaussianBlurVerticalProgram,de,o.MoaConvolutionVerticalGaussian9VertexShader,o.MoaConvolutionGaussian9FragmentShader,!1,i),a=this.glPrograms.gaussianBlurVerticalProgram),i.useProgram(a),this.startRender(a,g.NONE),i.uniform1f(a.texelStrideSlot,s),i.uniform1f(a.weight0Slot,e[4]),i.uniform1f(a.weight1Slot,e[3]),i.uniform1f(a.weight2Slot,e[2]),i.uniform1f(a.weight3Slot,e[1]),i.uniform1f(a.weight4Slot,e[0]),i.activeTexture(i.TEXTURE0),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),this.finishRender(!0),i.activeTexture(i.TEXTURE0),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR)},r.prototype.renderWhiten=function(){var e=this.gl;this.glPrograms.whitenProgram=xe(this.glPrograms.whitenProgram,K,o.MoaVertexShader,o.MoaWhitenFragmentShader,!1,e);var t=this.glPrograms.whitenProgram;e.useProgram(t),this.startRender(t,g.NONE),this.finishRender(!0)},r.prototype.renderMaskDraw=function(){var e=this.gl,t=this.claimFreeTexture(),r=this._createEmptyTexture(t,this.glImageData.width,this.glImageData.height),a=this.glRenderingObjects.readTexture,i=this.glRenderingObjects.writeTexture;this.glRenderingObjects.writeTexture=r,this.renderIdentity(),this.glRenderingObjects.readTexture=a,this.glRenderingObjects.writeTexture=i;var n,s=r,l=t;this.glPrograms.noiseProgram=xe(this.glPrograms.noiseProgram,X,o.MoaVertexShader,o.MoaNoiseFragmentShader,!1,e),n=this.glPrograms.noiseProgram,e.useProgram(n),this.startRender(n,g.NONE),e.uniform1f(n.randomSeedSlot,0),e.uniform1f(n.intensitySlot,1),this.finishRender(!0),this.glPrograms.bitmapBlendBitmapProgram=xe(this.glPrograms.bitmapBlendBitmapProgram,fe,o.MoaVertexShader,o.MoaBitmapBlendBitmapFragmentShader,!1,e);var n=this.glPrograms.bitmapBlendBitmapProgram;e.useProgram(n),this.startRender(n,g.NONE),e.uniform1i(n.bitmapBlendSampler,l),e.uniform1f(n.alphaUniform,.5),e.uniform1i(n.blendModeUniform,0),this.finishRender(!0),e.activeTexture(this._getTextureForIndex(l)),e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(s),this._resetTextureToFree(l)},r.prototype.renderRedeye=function(){var e=this.gl;this.glPrograms.redeyeProgram=xe(this.glPrograms.redeyeProgram,Q,o.MoaVertexShader,o.MoaRedeye2013FragmentShader,!1,e);var t=this.glPrograms.redeyeProgram;e.useProgram(t),this.startRender(t,g.NONE),this.finishRender(!0)},r.prototype._createMatrixDotTexture=function(e,t,r){var o,a,i,n,s,l,u,c,d,p,h,f,m,g,v,_=this.gl;for(3.3>t&&(t=3.3),Math.ceil(10*t)%2==0&&(t=(Math.ceil(10*t)+1)/10),_.activeTexture(this._getTextureForIndex(r)),s=_.createTexture(),_.bindTexture(_.TEXTURE_2D,s),i=Math.ceil(2*t*5),l=Math.PI/(2*t*t),u=e.a/255,g=[],o=0;i>o;o++)for(m=4*i*o,a=0;i>a;a++)n=m+4*a,g[n]=e.r,g[n+1]=e.g,g[n+2]=e.b,d=o+.5,p=a+.5,h=i/2,f=(d-h)*(d-h)+(p-h)*(p-h),f>t*t*5?c=0:(v=f*l,c=2.25>v?u*Math.max(Math.cos(v),Math.cos(Math.sqrt(v)/1.8)/2):u*Math.cos(Math.sqrt(v)/1.8)/2,0>c?c=0:c>1&&(c=1)),g[n+3]=255*c;return _.texImage2D(_.TEXTURE_2D,0,_.RGBA,i,i,0,_.RGBA,_.UNSIGNED_BYTE,new Uint8Array(g)),this._setTextureParams(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE),s},r.prototype.renderDotMatrix=function(e,t,r){var a,i,n,s,l=this.gl,u=[];this.glPrograms.dotMatrixProgram=xe(this.glPrograms.dotMatrixProgram,j,o.MoaDotMatrixVertexShader,o.MoaDotMatrixFragmentShader,!1,l),a=this.glPrograms.dotMatrixProgram,this._fillFloatColorWithMoaColorVals(u,e),l.useProgram(a),l.enableVertexAttribArray(a.positionSlot),l.enable(l.BLEND),l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ZERO,l.ONE),l.blendEquation(l.FUNC_ADD);var c=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,c),l.bufferData(l.ARRAY_BUFFER,new Float32Array(t),l.STATIC_DRAW),l.vertexAttribPointer(a.positionSlot,2,l.FLOAT,!1,0,0),i=r*this.glImageData.width/2,l.uniform1f(a.pointSizeSlot,2*i*5),n=this._claimFreeTexture(),s=this._createMatrixDotTexture(e,i,n),l.uniform1i(a.dotSamplerSlot,n),l.drawArrays(l.POINTS,0,t.length/2),l.finish(),l.disable(l.BLEND),l.deleteTexture(s),l.deleteBuffer(c),this._resetTextureToFree(n),l.bindFramebuffer(l.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),l.bindBuffer(l.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)},r.prototype._createmapFTexture=function(e,t,r,o){var a,i,n,s=this.gl;for(s.activeTexture(this._getTextureForIndex(o)),a=s.createTexture(),s.bindTexture(s.TEXTURE_2D,a),i=[],n=0;256>n;n++){var l=t*(e[n]-r),u=256*l*256*256-Math.floor(256*l*256*256),c=256*l*256-Math.floor(256*l*256)-u/256,d=256*l-Math.floor(256*l)-c/256,p=l-d/256;i[4*n]=255*u|0,i[4*n+1]=255*c|0,i[4*n+2]=255*d|0,i[4*n+3]=255*p|0}return s.texImage2D(s.TEXTURE_2D,0,s.RGBA,256,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array(i)),this._setTextureParams(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE),a},r.prototype.renderAutoEnhance=function(e,t,r,a,i,n,s,l){var u,c,d,p,h,f,m,v=this.gl,_=Number.MAX_VALUE,x=0;for(this.glPrograms.autoEnhanceProgram=xe(this.glPrograms.autoEnhanceProgram,Y,o.MoaVertexShader,o.MoaAutoEnhanceFragmentShader,!1,v),u=this.glPrograms.autoEnhanceProgram,c=0;256>c;c++)d=l[c],_>d&&(_=d),d>x&&(x=d);i/=255,n/=255,s/=255,v.useProgram(u),this.startRender(u,g.NONE),p=1/(x-_),h=_,f=this._claimFreeTexture(),m=this._createmapFTexture(l,p,h,f),v.uniform1i(u.mapFactorSamplerSlot,f),v.uniform1f(u.gainSlot,e),v.uniform1f(u.rMinSlot,i),v.uniform1f(u.gMinSlot,n),v.uniform1f(u.bMinSlot,s),v.uniform1f(u.rScaleSlot,t),v.uniform1f(u.gScaleSlot,r),v.uniform1f(u.bScaleSlot,a),v.uniform1f(u.floatMultSlot,p),v.uniform1f(u.floatTransSlot,h),this.finishRender(!0),v.activeTexture(this._getTextureForIndex(f)),v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(m),this._resetTextureToFree(f)},r.prototype._createEmptyTexture=function(e,t,r){var o,a=this.gl;return a.activeTexture(this._getTextureForIndex(e)),o=a.createTexture(),a.bindTexture(a.TEXTURE_2D,o),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,r,0,a.RGBA,a.UNSIGNED_BYTE,null),this._setTextureParams(a.LINEAR,a.LINEAR,a.CLAMP_TO_EDGE,a.CLAMP_TO_EDGE),o},r.prototype._getAvgGrayImage=function(e,t,r,o){this.glRenderingObjects.readTexture=e,this.glRenderingObjects.writeTexture=t,this.renderIdentity(),this.glRenderingObjects.readTexture=t,this.glRenderingObjects.writeTexture=r,this.glRenderingObjects.processedTexture1=t,this.glRenderingObjects.processedTexture2=r,this.addBoxBlur(2*o+1,"horizontal",this),this.addBoxBlur(2*o+1,"vertical",this);var a=[.213,.715,.072,0,.213,.715,.072,0,.213,.715,.072,0];this.renderColorMatrixTransform(a)},r.prototype.renderClarity=function(e,t,r,a){var i,n,s,l,u,c,d,p,h,f=this.gl;this.glPrograms.twitterClarityProgram=xe(this.glPrograms.twitterClarityProgram,J,o.MoaVertexShader,o.MoaTwitterClarityFragmentShader,!1,f),h=this.glPrograms.twitterClarityProgram,u=this.glRenderingObjects.readTexture,c=this.glRenderingObjects.writeTexture,d=this.glRenderingObjects.processedTexture1,p=this.glRenderingObjects.processedTexture2,this.renderColorMap(e),i=this._claimFreeTexture(),s=this._createEmptyTexture(i,this.glImageData.width,this.glImageData.height),n=this._claimFreeTexture(),l=this._createEmptyTexture(n,this.glImageData.width,this.glImageData.height),this._getAvgGrayImage(c,l,s,t),this._getAvgGrayImage(u,c,l,t),this.glRenderingObjects.readTexture=u,this.glRenderingObjects.writeTexture=c,this.glRenderingObjects.processedTexture1=d,this.glRenderingObjects.processedTexture2=p,f.useProgram(h),this.startRender(h,g.NONE),f.activeTexture(this._getTextureForIndex(n)),f.bindTexture(f.TEXTURE_2D,l),f.activeTexture(this._getTextureForIndex(i)),f.bindTexture(f.TEXTURE_2D,s),f.uniform1i(h.avgImgSamplerSlot,n),f.uniform1i(h.effectedAvgImgSamplerSlot,i),f.uniform1f(h.gainSlot,r),f.uniform1f(h.sharpenAmountSlot,a),this.finishRender(!0),f.deleteTexture(l),f.deleteTexture(s),this._resetTextureToFree(n),this._resetTextureToFree(i)},r.prototype.renderConvertLABToRGB=function(e,t){var r,a=this.gl;this.glPrograms.labToRgbProgram=xe(this.glPrograms.labToRgbProgram,Z,o.MoaVertexShader,o.MoaLABToRGBFragmentShader,!1,a),r=this.glPrograms.labToRgbProgram,a.useProgram(r),this.startRender(r,g.NONE),a.uniform1f(r.scaleASlot,e),a.uniform1f(r.scaleBSlot,t),this.finishRender(!0)},r.prototype.renderConvertRGBToLAB=function(){var e,t=this.gl;this.glPrograms.rgbToLabProgram=xe(this.glPrograms.rgbToLabProgram,q,o.MoaVertexShader,o.MoaRGBToLABFragmentShader,!1,t),e=this.glPrograms.rgbToLabProgram,t.useProgram(e),this.startRender(e,g.NONE),this.finishRender(!0)},r.prototype._fillFloatColorWithMoaColorVals=function(e,t){e[0]=t.r/255,e[1]=t.g/255,e[2]=t.b/255,e[3]=t.a/255},r.prototype.renderFlare=function(e,t,r,a,i,n,s,l,u){var c=this.gl;"undefined"==typeof e&&(e="normal"),"undefined"==typeof u&&(u=1);var d,p,h,f,m,v,_=[],x=[];this._fillFloatColorWithMoaColorVals(x,a),_[0]=(1+i)/2,_[1]=(1+n)/2,d=Math.log(1/(255*a.a)),p=0,h=1/r/.5/s,f=1/r/.5/l,"sinc"==t&&(h=2/r,f=h),m=x[3],"blob"!=t||"overlay"!=e&&"normal"!=e?"angleGaussian"==t&&"normal"==e?(this.glPrograms.flareAngleGaussianProgram=xe(this.glPrograms.flareAngleGaussianProgram,O,o.MoaVertexShader,o.MoaFlareAngleGaussianFragmentShader,!1,c),v=this.glPrograms.flareAngleGaussianProgram):"gaussianThing"==t&&"normal"==e?(this.glPrograms.flareGaussianThingProgram=xe(this.glPrograms.flareGaussianThingProgram,O,o.MoaVertexShader,o.MoaFlareGaussianThingFragmentShader,!1,c),v=this.glPrograms.flareGaussianThingProgram):"gaussianThing2"==t&&"normal"==e?(this.glPrograms.flareGaussianThing2Program=xe(this.glPrograms.flareGaussianThing2Program,O,o.MoaVertexShader,o.MoaFlareGaussianThing2FragmentShader,!1,c),v=this.glPrograms.flareGaussianThing2Program):"blob2"!=t||"normal"!=e&&"overlay"!=e?"cornerFlares"!=t||"normal"!=e&&"overlay"!=e?"gaussianThing3"==t&&"overlay"==e?(this.glPrograms.flareGaussianThing3OverlayProgram=xe(this.glPrograms.flareGaussianThing3OverlayProgram,O,o.MoaVertexShader,o.MoaFlareGaussianThing3OverlayFragmentShader,!1,c),v=this.glPrograms.flareGaussianThing3OverlayProgram):(this.glPrograms.flareFallbackProgram=xe(this.glPrograms.flareFallbackProgram,O,o.MoaVertexShader,o.MoaFlareFragmentShader,!1,c),v=this.glPrograms.flareFallbackProgram):"overlay"==e?(this.glPrograms.flareCornerflaresOverlayProgram=xe(this.glPrograms.flareCornerflaresOverlayProgram,O,o.MoaVertexShader,o.MoaFlareCornerflaresOverlayFragmentShader,!1,c),v=this.glPrograms.flareCornerflaresOverlayProgram):(this.glPrograms.flareCornerflaresProgram=xe(this.glPrograms.flareCornerflaresProgram,O,o.MoaVertexShader,o.MoaFlareCornerflaresFragmentShader,!1,c),v=this.glPrograms.flareCornerflaresProgram):"overlay"==e?(this.glPrograms.flareBlob2OverlayProgram=xe(this.glPrograms.flareBlob2OverlayProgram,O,o.MoaVertexShader,o.MoaFlareBlob2OverlayFragmentShader,!1,c),v=this.glPrograms.flareBlob2OverlayProgram):(this.glPrograms.flareBlob2Program=xe(this.glPrograms.flareBlob2Program,O,o.MoaVertexShader,o.MoaFlareBlob2FragmentShader,!1,c),v=this.glPrograms.flareBlob2Program):"overlay"==e?(this.glPrograms.flareBlobOverlayProgram=xe(this.glPrograms.flareBlobOverlayProgram,O,o.MoaVertexShader,o.MoaFlareBlobOverlayFragmentShader,!1,c),v=this.glPrograms.flareBlobOverlayProgram):(this.glPrograms.flareBlobProgram=xe(this.glPrograms.flareBlobProgram,O,o.MoaVertexShader,o.MoaFlareBlobFragmentShader,!1,c),v=this.glPrograms.flareBlobProgram),c.useProgram(v),"normal"!=e||v==this.glPrograms.flareFallbackProgram?this.startRender(v,g.NONE):this.startRender(v,g.NORMAL),v==this.glPrograms.flareFallbackProgram&&(c.uniform1i(v.flareTypeSlot,w.get(t)),c.uniform1i(v.blendModeSlot,M.get(e)),c.uniform1f(v.alphaBlendSlot,u)),c.uniform1f(v.scaleDiffxSlot,h),c.uniform1f(v.scaleDiffySlot,f),c.uniform2fv(v.onePlusDxTimesCenterCoordSlot,new Float32Array(_)),c.uniform4fv(v.flareColorSlot,new Float32Array(x)),c.uniform1f(v.minEXPSlot,d),c.uniform1f(v.maxEXPSlot,p),c.uniform1f(v.aFSlot,m),"normal"!=e||v==this.glPrograms.flareFallbackProgram?this.finishRender(!0):this.finishRender(!1)},r.prototype._createGradientTexture=function(e,t){var r,o=this.gl;return o.activeTexture(this._getTextureForIndex(e)),r=o.createTexture(),o.bindTexture(o.TEXTURE_2D,r),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,t.length/4,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array(t)),this._setTextureParams(o.LINEAR,o.LINEAR,o.CLAMP_TO_EDGE,o.CLAMP_TO_EDGE),r},r.prototype.renderGradient=function(e,t,r,a,i,n,s){var l,u,c,d=this.gl;if("overlay"==r)"linearVignette"==e.gradientShape?(this.glPrograms.gradientLinearVignetteProgram=xe(this.glPrograms.gradientLinearVignetteProgram,re,o.MoaVertexShader,o.MoaGradientLinearVignetteFragmentShader,!1,d),c=this.glPrograms.gradientLinearVignetteProgram):(this.glPrograms.gradientOverlayProgram=xe(this.glPrograms.gradientOverlayProgram,re,o.MoaVertexShader,o.MoaGradientOverlayFragmentShader,!1,d),c=this.glPrograms.gradientOverlayProgram);else{if("normal"!=r)return;"linearVignette"==e.gradientShape?(this.glPrograms.gradientLinearVignetteProgram=xe(this.glPrograms.gradientLinearVignetteProgram,re,o.MoaVertexShader,o.MoaGradientLinearVignetteFragmentShader,!1,d),c=this.glPrograms.gradientLinearVignetteProgram):(this.glPrograms.gradientProgram=xe(this.glPrograms.gradientProgram,re,o.MoaVertexShader,o.MoaGradientFragmentShader,!1,d),c=this.glPrograms.gradientProgram)}if(l=this._claimFreeTexture(),u=this._createGradientTexture(l,t),d.useProgram(c),"overlay"==r)this.startRender(c,g.NONE);else{if("normal"!=r)return;this.startRender(c,g.NORMAL)}d.uniform1f(c.widthSlot,this.glImageData.width),d.uniform1f(c.heightSlot,this.glImageData.height),
d.uniform1f(c.scaleSlot,e.scale),d.uniform1f(c.xCenterSlot,e.xCenter),d.uniform1f(c.yCenterSlot,e.yCenter),d.uniform1f(c.dx_2Slot,e.dx/2),d.uniform1f(c.dy_2Slot,e.dy/2),d.uniform1f(c.denomISlot,s),d.uniform1f(c.alphaBlendSlot,a),d.uniform1f(c.angleCosSlot,n),d.uniform1f(c.angleSinSlot,i),d.uniform1i(c.shapeModeSlot,C.get(e.gradientShape)),d.uniform1i(c.vignetteShapeSlot,T.get(e.shapeMode)),d.uniform1i(c.overlayBlendModeSlot,"overlay"==r),d.uniform1i(c.gradientMapSlot,l),"overlay"==r?this.finishRender(!0):this.finishRender(!1),d.activeTexture(this._getTextureForIndex(l)),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(u),this._resetTextureToFree(l)},r.prototype.renderGradientFlare=function(e){var t=this.gl;if("undefined"!=typeof M.get(e.blendMode)){var r=this.glImageData.width,a=this.glImageData.height,i=e.gradientShapeType,n=(e.aspectMode,e.blendMode),s=e.gradientWrapMode,l=e.invertGradient,u=e.alpha,c=e.gradMap,d=e.gradientParams,p=Me(e.gradientTransform);if(p[3]-=.5,p[7]-=.5,"average"==e.aspectMode){var h=(r+a)/2;p=Ce(p,.5,.5),p=Te(p,r/h,a/h),p=Ce(p,-.5,-.5)}else if("fill"==e.aspectMode){var f=Math.max(r,a);p=Ce(p,.5,.5),p=Te(p,r/f,a/f),p=Ce(p,-.5,-.5)}else if("fit"==e.aspectMode){var m=Math.min(r,a);p=Ce(p,.5,.5),p=Te(p,r/m,a/m),p=Ce(p,-.5,-.5)}var v,_,x,r=this.glImageData.width,a=this.glImageData.height,w=!1;"normal"!=n&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),v=this.createTexture(r,a),_=this._claimFreeTexture(),t.activeTexture(this._getTextureForIndex(_)),t.bindTexture(t.TEXTURE_2D,v),x=this._getWriteTextureAndSet(v),w=!0);var C,T=this._claimFreeTexture(),S=this._createGradientTexture(T,c);switch(i){case"stardom":this.glPrograms.gradientFlareStardomProgram=xe(this.glPrograms.gradientFlareStardomProgram,he,o.MoaVertexShader,o.MoaGradientFlareStardomFragmentShader,!1,t),C=this.glPrograms.gradientFlareStardomProgram;break;case"lobes":this.glPrograms.gradientFlareLobesProgram=xe(this.glPrograms.gradientFlareLobesProgram,he,o.MoaVertexShader,o.MoaGradientFlareLobesFragmentShader,!1,t),C=this.glPrograms.gradientFlareLobesProgram;break;case"ringLobes":this.glPrograms.gradientFlareRingLobesProgram=xe(this.glPrograms.gradientFlareRingLobesProgram,he,o.MoaVertexShader,o.MoaGradientFlareRingLobesFragmentShader,!1,t),C=this.glPrograms.gradientFlareRingLobesProgram;break;case"star":this.glPrograms.gradientFlareStarProgram=xe(this.glPrograms.gradientFlareStarProgram,he,o.MoaVertexShader,o.MoaGradientFlareStarFragmentShader,!1,t),C=this.glPrograms.gradientFlareStarProgram;break;case"squiggly":this.glPrograms.gradientFlareSquigglyProgram=xe(this.glPrograms.gradientFlareSquigglyProgram,he,o.MoaVertexShader,o.MoaGradientFlareSquigglyFragmentShader,!1,t),C=this.glPrograms.gradientFlareSquigglyProgram;break;case"zigzag":this.glPrograms.gradientFlareZigZagProgram=xe(this.glPrograms.gradientFlareZigZagProgram,he,o.MoaVertexShader,o.MoaGradientFlareZigZagFragmentShader,!1,t),C=this.glPrograms.gradientFlareZigZagProgram;break;case"spiral":this.glPrograms.gradientFlareSpiralProgram=xe(this.glPrograms.gradientFlareSpiralProgram,he,o.MoaVertexShader,o.MoaGradientFlareSpiralFragmentShader,!1,t),C=this.glPrograms.gradientFlareSpiralProgram;break;default:this.glPrograms.gradientFlareProgram=xe(this.glPrograms.gradientFlareProgram,he,o.MoaVertexShader,o.MoaGradientFlareFragmentShader,!1,t),C=this.glPrograms.gradientFlareProgram}t.useProgram(C),"normal"==n?this.startRender(C,g.NORMAL):this.startRender(C,g.NONE);var A=w?1:u;t.uniform1f(C.alphaBlendSlot,A),t.uniform1i(C.invertGradientSlot,l?1:0),t.uniform1i(C.shapeSlot,y.get(i)),t.uniform1i(C.wrapModeSlot,b.get(s)),t.uniform1i(C.gradientMapSlot,T),t.uniformMatrix4fv(C.transformMatSlot,!1,p),t.uniformMatrix4fv(C.paramsMatSlot,!1,d),this.finishRender(!1),w&&(this._getWriteTextureAndSet(x),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,v,e.blendMode,u),this._swapTextures(),this._resetTextureToFree(_),t.deleteTexture(v)),t.activeTexture(this._getTextureForIndex(T)),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(S),this._resetTextureToFree(T)}};var be=function(e,t){var r=[];return r[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],r[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],r[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],r[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],r[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],r[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],r[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],r[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],r[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],r[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],r[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],r[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],r[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],r[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],r[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],r[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],r},Me=function(e){var t=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]];return t},Ce=function(e,t,r,o){var a=Me(e);"number"!=typeof o&&(o=0);var i=[1,0,0,t,0,1,0,r,0,0,1,o,0,0,0,1];return a=be(a,i)},Te=function(e,t,r){var o=Me(e),a=[t,0,0,0,0,r,0,0,0,0,1,0,0,0,0,1];return o=be(o,a)};r.prototype.renderGradientMap=function(e){var t=this.gl,r=e.blendMode;if("undefined"!=typeof M.get(e.blendMode)){var a,i,n,s=this.glImageData.width,l=this.glImageData.height,u="normal"!=r&&"soft"!=r&&"multiply"!=r&&"screeen"!=r&&"darken"!=r&&"overlay"!=r;u&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),a=this.createTexture(s,l),i=this._claimFreeTexture(),t.activeTexture(this._getTextureForIndex(i)),t.bindTexture(t.TEXTURE_2D,a),n=this._getWriteTextureAndSet(a),u=!0),this.glPrograms.gradientMapProgram=xe(this.glPrograms.gradientMapProgram,pe,o.MoaVertexShader,o.MoaGradientMapFragmentShader,!1,t);var c=this.glPrograms.gradientMapProgram,d=this._claimFreeTexture(),p=this._createGradientTexture(d,e.gradMap),h=u?M.get("normal"):M.get(r),f=u?1:e.alpha;t.useProgram(c),this.startRender(c,g.NONE),t.uniform1i(c.gradientMapSlot,d),t.uniform1i(c.gradientVarSlot,A.get(e.gradientVariable)),t.uniform1i(c.invertGradientSlot,e.invertGradient),t.uniform1i(c.blendModeSlot,h),t.uniform1f(c.alphaBlendSlot,f),this.finishRender(!u),u&&(this._getWriteTextureAndSet(n),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,a,e.blendMode,e.alpha),this._swapTextures(),this._resetTextureToFree(i),t.deleteTexture(a)),t.activeTexture(this._getTextureForIndex(d)),t.bindTexture(t.TEXTURE_2D,null),t.deleteTexture(p),this._resetTextureToFree(d)}},r.prototype._createEmptyHistogram=function(){var e={};e.r=[],e.g=[],e.b=[];for(var t=0;256>t;t++)e.r[t]=0,e.g[t]=0,e.b[t]=0;return e},r.prototype.histogramBuild=function(){var e=this.gl,t=this.glImageData.width,r=this.glImageData.height,o=new Uint8Array(4*t*r),a=this._createEmptyHistogram();this.finalizeEffect(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,t,r,e.RGBA,e.UNSIGNED_BYTE,o),e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer);var i,n=t*r;for(i=0;n>i;i++)a.r[o[4*i]]++,a.g[o[4*i+1]]++,a.b[o[4*i+2]]++;return a},r.prototype.renderIntensityMap=function(e,t,r){var a,i,n,s=this.gl;if("multiply"==t)this.glPrograms.intensityMapMultiplyProgram=xe(this.glPrograms.intensityMapMultiplyProgram,ee,o.MoaVertexShader,o.MoaIntensityMapMultiplyFragmentShader,!1,s),n=this.glPrograms.intensityMapMultiplyProgram;else if("overlay"==t)this.glPrograms.intensityMapOverlayProgram=xe(this.glPrograms.intensityMapOverlayProgram,ee,o.MoaVertexShader,o.MoaIntensityMapOverlayFragmentShader,!1,s),n=this.glPrograms.intensityMapOverlayProgram;else{if("normal"!=t)return;this.glPrograms.intensityMapProgram=xe(this.glPrograms.intensityMapProgram,ee,o.MoaVertexShader,o.MoaIntensityMapFragmentShader,!1,s),n=this.glPrograms.intensityMapProgram}s.useProgram(n),this.startRender(n,g.NONE),a=this._claimFreeTexture(),i=this._createColorMapTexture(e.r,e.g,e.b,a),s.uniform1i(n.colorMapSamplerSlot,a),s.uniform1f(n.intensitySlot,r),this.finishRender(!0),s.activeTexture(this._getTextureForIndex(a)),s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(i),this._resetTextureToFree(a)},r.prototype.renderLine=function(e,t,r,a,i,n,s,l,u,c,d,p,h,f,m,g,v){var _,x=this.gl,w=[],y=[],b=[];this.glPrograms.lineProgram=xe(this.glPrograms.lineProgram,H,o.MoaLineVertexShader,o.MoaLineFragmentShader,!1,x),_=this.glPrograms.lineProgram,this._fillFloatColorWithMoaColorVals(b,e),x.useProgram(_);var M=x.createBuffer(),C=x.createBuffer(),T=f/(this.glImageData.width-1)*2-1,S=m/(this.glImageData.height-1)*2-1,A=g/(this.glImageData.width-1)*2-1,E=v/(this.glImageData.height-1)*2-1;w[0]=T,w[1]=S,y[0]=f,y[1]=m,w[2]=A,w[3]=S,y[2]=g,y[3]=m,w[4]=T,w[5]=E,y[4]=f,y[5]=v,w[6]=A,w[7]=E,y[6]=g,y[7]=v,x.enableVertexAttribArray(_.positionSlot),x.bindBuffer(x.ARRAY_BUFFER,M),x.bufferData(x.ARRAY_BUFFER,new Float32Array(w),x.STATIC_DRAW),x.vertexAttribPointer(_.positionSlot,2,x.FLOAT,!1,0,0),x.enableVertexAttribArray(_.imagePosSlot),x.bindBuffer(x.ARRAY_BUFFER,C),x.bufferData(x.ARRAY_BUFFER,new Float32Array(y),x.STATIC_DRAW),x.vertexAttribPointer(_.imagePosSlot,2,x.FLOAT,!1,0,0),x.enable(x.BLEND),x.blendFuncSeparate(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA,x.ZERO,x.ONE),x.blendEquation(x.FUNC_ADD),x.uniform1f(_.nHatxSlot,t),x.uniform1f(_.nHatySlot,r),x.uniform1f(_.x1Slot,a),x.uniform1f(_.y1Slot,n),x.uniform1f(_.x2Slot,i),x.uniform1f(_.y2Slot,s),x.uniform1f(_.rSlot,l),x.uniform1f(_.r2Slot,u),x.uniform1f(_.dAASlot,c),x.uniform1f(_.bASlot,d),x.uniform1f(_.r2AASlot,p),x.uniform4fv(_.colorSlot,b),x.uniform1f(_.vLength2Slot,h),x.drawArrays(x.TRIANGLE_STRIP,0,4),x.finish(),x.disable(x.BLEND),x.deleteBuffer(M),x.deleteBuffer(C),x.disableVertexAttribArray(_.positionSlot),x.disableVertexAttribArray(_.imagePosSlot),x.bindFramebuffer(x.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),x.bindBuffer(x.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)},r.prototype.createMask=function(e,t){var r=this.gl;if(!this.willAcceptImageOfSize(e,t))return null;var o=this._claimFreeTexture();r.activeTexture(this._getTextureForIndex(o));var a=r.createTexture();return r.bindTexture(r.TEXTURE_2D,a),this._setTextureParams(r.LINEAR,r.LINEAR,r.CLAMP_TO_EDGE,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),this._resetTextureToFree(o),a},r.prototype.setMaskTransparent=function(e){this.setTextureToColor(e,{r:0,g:0,b:0,a:0})},r.prototype.setMaskOpaque=function(e){this.setTextureToColor(e,{r:1,g:1,b:1,a:1})},r.prototype.setTextureToColor=function(e,t){var r=this.gl;r.isTexture(e)&&(r.bindFramebuffer(r.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),r.clearColor(t.r,t.g,t.b,t.a),r.clear(r.COLOR_BUFFER_BIT))},r.prototype.destroyMask=function(e){var t=this.gl;t.isTexture(e)&&(t.deleteTexture(e),e=null)},r.prototype.maskFillRadial=function(e,t,r,a){var i=this.gl,n=a.posX,s=a.posY,l=a.sigmaR;this.glPrograms.maskRadialProgram=xe(this.glPrograms.maskRadialProgram,ae,o.MoaVertexShader,o.MoaMaskRadialFragmentShader,!1,i);var u,c,d,p=this.glPrograms.maskRadialProgram;u=this.glRenderingObjects.writeTexture,c=this.glImageData.width,d=this.glImageData.height,this.glRenderingObjects.writeTexture=e,i.useProgram(p),i.bindFramebuffer(i.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),this.startRender(p,g.NONE),i.viewport(0,0,t,r);var h=[n,s];i.uniform2fv(p.centerPointSlot,new Float32Array(h)),i.uniform1f(p.sigmaR2Slot,l*l),i.uniform1f(p.widthSlot,t),i.uniform1f(p.heightSlot,r),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.clearColor(0,0,0,1),this.finishRender(!1),this.glRenderingObjects.writeTexture=u},r.prototype.maskFillLinear=function(e,t,r,a){var i=this.gl,n=a.posX,s=a.posY,l=a.sigmaR,u=a.angle;this.glPrograms.maskLinearProgram=xe(this.glPrograms.maskLinearProgram,oe,o.MoaVertexShader,o.MoaMaskLinearFragmentShader,!1,i);var c,d,p,h=this.glPrograms.maskLinearProgram;c=this.glRenderingObjects.writeTexture,d=this.glImageData.width,p=this.glImageData.height,this.glRenderingObjects.writeTexture=e,i.useProgram(h),i.bindFramebuffer(i.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),this.startRender(h,g.NONE),i.viewport(0,0,t,r);var f=[n,s],m=-Math.sin(u),v=Math.cos(u);i.uniform2fv(h.centerPointSlot,new Float32Array(f)),i.uniform1f(h.sigmaR2Slot,l*l),i.uniform1f(h.widthSlot,t),i.uniform1f(h.heightSlot,r),i.uniform1f(h.normXSlot,m),i.uniform1f(h.normYSlot,v),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.clearColor(0,0,0,1),this.finishRender(!1),this.glRenderingObjects.writeTexture=c};var Se=7;r.prototype.maskAddPoints=function(e,t,r,a,n,s,l,u,c,d){var p,h,f,m=this.gl,v=a.length;p=this.glRenderingObjects.writeTexture,h=this.glImageData.width,f=this.glImageData.height,this.glRenderingObjects.writeTexture=e,this.glImageData.width=t,this.glImageData.height=r;var _;if("normal"==u)this.glPrograms.maskDotsProgram=xe(this.glPrograms.maskDotsProgram,ne,o.MoaMaskDotsVertexShader,o.MoaMaskDotFragmentShader,!1,m),_=this.glPrograms.maskDotsProgram;else{if("splash"!=u)throw"Error, invalid GL Mask Type";this.glPrograms.colorSplashAutoProgram=xe(this.glPrograms.colorSplashAutoProgram,ue,o.MoaMaskDotsVertexShader,o.MoaColorSplashAutoFragmentShader,!1,m),_=this.glPrograms.colorSplashAutoProgram}m.bindFramebuffer(m.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),m.useProgram(_),this.startRender(_,g.NONE_DONT_CLEAR),m.enable(m.BLEND),d?(m.blendEquation(m.FUNC_REVERSE_SUBTRACT),m.blendFunc(m.ZERO,m.ONE_MINUS_SRC_ALPHA)):(m.blendEquation(m.FUNC_ADD),m.blendFunc(m.ONE,m.ONE_MINUS_SRC_ALPHA)),m.bindBuffer(m.ARRAY_BUFFER,null),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null);for(var x,w,y,b,M,C,T=n*t,S=.5*T,A=T+S*(1-Math.sqrt(.4/255)),E=6*v,P=[],D=2*A/t,F=2*A/r,L=A/t,R=A/r,I=0,B=0,O=t/(t-1),N=r/(r-1),k=0;v>k;k++)a[k][0]=a[k][0]*O,a[k][1]=a[k][1]*N;for(var k=0;E>k;k++){switch(M=Math.floor(k/6),x=2*a[M][0]-1,w=2*a[M][1]-1,y=a[M][0],b=a[M][1],k%6){case 0:I=-1,B=-1;break;case 1:I=1,B=-1;break;case 2:I=-1,B=1;break;case 3:I=-1,B=1;break;case 4:I=1,B=-1;break;case 5:I=1,B=1}C=k*Se,P[C+0]=x+I*D,P[C+1]=w+B*F,P[C+2]=0,P[C+3]=y+I*L,P[C+4]=b+B*R,P[C+5]=y,P[C+6]=b}var U=m.createBuffer();if(m.bindBuffer(m.ARRAY_BUFFER,U),m.bufferData(m.ARRAY_BUFFER,new Float32Array(P),m.STATIC_DRAW),m.vertexAttribPointer(_.positionSlot,3,m.FLOAT,m.FALSE,4*Se,0),m.vertexAttribPointer(_.texCoordSlot,2,m.FLOAT,m.FALSE,4*Se,12),m.vertexAttribPointer(_.centerTexCoordSlot,2,m.FLOAT,m.FALSE,4*Se,20),m.enableVertexAttribArray(_.positionSlot),m.enableVertexAttribArray(_.texCoordSlot),m.enableVertexAttribArray(_.centerTexCoordSlot),m.activeTexture(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,this.glImageData.sourceTexture),m.uniform1f(_.radiusSlot,T),m.uniform1f(_.widthSlot,t),m.uniform1f(_.heightSlot,r),m.uniform1f(_.alphaSlot,l),m.uniform1f(_.dEdgeSlot,S),m.uniform1i(_.eraseSlot,d),"splash"==u){var W=i.rgb2labwithcbrtmapping(c.r,c.g,c.b);m.uniform1f(_.lSlot,W[0]),m.uniform1f(_.aSlot,W[1]),m.uniform1f(_.bSlot,W[2]),m.uniform1f(_.sigmaCSlot,s)}m.drawArrays(m.TRIANGLES,0,E),m.finish(),this.glRenderingObjects.writeTexture=p,this.glImageData.width=h,this.glImageData.height=f,m.deleteBuffer(U),m.disableVertexAttribArray(_.positionSlot),m.disableVertexAttribArray(_.texCoordSlot),m.disableVertexAttribArray(_.centerTexCoordSlot),m.disable(m.BLEND),m.bindBuffer(m.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,this.glBuffers.currentIndexBuffer)},r.prototype.redrawBitmapWithGLMask=function(e,t,r){var a,i,n=this.gl;this.glPrograms.redrawWithMaskProgram=xe(this.glPrograms.redrawWithMaskProgram,ie,o.MoaVertexShader,o.MoaBitmapRedrawWithMaskFragmentShader,!1,n);var s=this.glPrograms.redrawWithMaskProgram;n.useProgram(s),this.startRender(s,g.NONE),a=this._claimFreeTexture(),n.activeTexture(this._getTextureForIndex(a)),n.bindTexture(n.TEXTURE_2D,t),i=this._claimFreeTexture(),n.activeTexture(this._getTextureForIndex(i)),n.bindTexture(n.TEXTURE_2D,e),r?(n.uniform1i(s.samplerSlot,i),n.uniform1i(s.sourceSamplerSlot,0)):n.uniform1i(s.sourceSamplerSlot,i),n.uniform1i(s.maskSamplerSlot,a),this.finishRender(!0),n.activeTexture(this._getTextureForIndex(a)),n.bindTexture(n.TEXTURE_2D,null),this._resetTextureToFree(a),n.activeTexture(this._getTextureForIndex(i)),n.bindTexture(n.TEXTURE_2D,null),this._resetTextureToFree(i)},r.prototype.drawMaskOverOriginalImagePreMultipliedAlpha=function(e,t){var r=this.glRenderingObjects.readTexture;this.compositeTexturesUsingPremultipliedAlpha(r,t,e)},r.prototype.drawExistingProcessedTextureWithMaskTexture=function(e,t){var r=0;e==this.glRenderingObjects.processedTexture1?r=this.glRenderingObjects.processedTexture2:e==this.glRenderingObjects.processedTexture2&&(r=this.glRenderingObjects.processedTexture1),this.glRenderingObjects.readTexture=this.glImageData.sourceTexture,this.glRenderingObjects.writeTexture=r,this.redrawBitmapWithGLMask(e,t,!1)},r.prototype.getColorAtPoint=function(e,t){var r=this.gl,o=new Uint8Array(4),a=e/this.glImageData.width,i=t/this.glImageData.height;return a=0>a?0:a>1?1:a,i=0>i?0:i>1?1:i,r.bindFramebuffer(r.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.glImageData.sourceTexture,0),r.readPixels(e,t,1,1,r.RGBA,r.UNSIGNED_BYTE,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.glRenderingObjects.writeTexture,0),{r:o[0],g:o[1],b:o[2],a:o[3]}},r.prototype.renderNoise=function(e,t){var r,a=this.gl;this.glPrograms.noiseProgram=xe(this.glPrograms.noiseProgram,X,o.MoaVertexShader,o.MoaNoiseFragmentShader,!1,a),r=this.glPrograms.noiseProgram,0==t&&(t=1),a.useProgram(r),this.startRender(r,g.NONE),a.uniform1f(r.randomSeedSlot,t),a.uniform1f(r.intensitySlot,e),this.finishRender(!0)},r.prototype.getGLConstantForMipmapSamplingMode=function(e){return"linearLinear"==e?this.gl.LINEAR_MIPMAP_LINEAR:"linearNearest"==e?this.gl.LINEAR_MIPMAP_NEAREST:"nearestLinear"==e?this.gl.NEAREST_MIPMAP_LINEAR:"nearestNearest"==e?this.gl.NEAREST_MIPMAP_NEAREST:this.gl.LINEAR_MIPMAP_LINEAR},r.prototype.getGLConstantForBitmapSamplingMode=function(e){return"linear"==e?this.gl.LINEAR:"nearest"==e?this.gl.NEAREST:this.gl.LINEAR},r.prototype.transformOverlay=function(e,t,r,o,a,i){var s=c.copy(t);n.convertToPremultiplied(s);var l=this.createTextureFromBitmap(s);s.data=null,this.transformOverlayFromPremultipliedTexture(e,l,r,o,a,i),this.destroyTexture(l)},r.prototype.transformPremultipliedOverlay=function(e,t,r,o,a,i){var n=this.createTextureFromBitmap(t);this.transformOverlayFromPremultipliedTexture(e,n,r,o,a,i),this.destroyTexture(n)},r.prototype.transformOverlayFromPremultipliedTexture=function(e,t,r,a,i,n){var s=this.gl,l="normal"!=i;this.glPrograms.transformOverlayProgram=xe(this.glPrograms.transformOverlayProgram,ge,o.MoaTransformOverlayVertexShader,o.MoaTransformOverlayFragmentShader,!1,s);var u=this.glPrograms.transformOverlayProgram;r.preScaleXY(2,2),r.postScaleXY(.5,.5),r.invert();var c=this._claimFreeTexture();if(-1==c)return!1;s.activeTexture(this._getTextureForIndex(c)),s.bindTexture(s.TEXTURE_2D,t),"nearest"==a?this._setTextureParams(s.NEAREST,s.NEAREST,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE):this._setTextureParams(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE);var d,p,h,f=this.glImageData.width,m=this.glImageData.height,l=!1;"normal"!=i&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),d=this.createTexture(f,m),p=this._claimFreeTexture(),s.activeTexture(this._getTextureForIndex(p)),s.bindTexture(s.TEXTURE_2D,d),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e.width,e.height,0,s.RGBA,s.UNSIGNED_BYTE,null),h=this._getWriteTextureAndSet(d),l=!0);var v=l?1:n;s.useProgram(u),"normal"!=i?this.startRender(u,g.NONE):this.startRender(u,g.PREMULTIPLIED_ALPHA),s.uniform1i(u.overlaySamplerSlot,c),s.uniform1f(u.alphaSlot,v),s.uniformMatrix4fv(u.transformSlot,s.FALSE,new Float32Array(r.transformMatrix)),this.finishRender(!1),l&&(this._getWriteTextureAndSet(h),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,d,params.blendMode,n),this._swapTextures(),this._resetTextureToFree(p),s.deleteTexture(d)),s.activeTexture(this._getTextureForIndex(c)),s.bindTexture(s.TEXTURE_2D,null),this._resetTextureToFree(c)},r.prototype.transformOverlayUsingMipmap=function(e,t,r,a,i,n){var s=this.gl,l="normal"!=i;this.glPrograms.transformOverlayProgram=xe(this.glPrograms.transformOverlayProgram,ge,o.MoaTransformOverlayVertexShader,o.MoaTransformOverlayFragmentShader,!1,s);var u=this.glPrograms.transformOverlayProgram;r.preScaleXY(2,2),r.postScaleXY(.5,.5),r.invert();var c=this._claimFreeTexture();if(-1==c)return!1;s.activeTexture(this._getTextureForIndex(c));var d={x:1,y:0,z:0,w:0},p={x:0,y:1,z:0,w:0};r.rightMultiplyVector(d),r.rightMultiplyVector(p),d.x*=e.width,d.y*=e.height,p.x*=e.width,p.y*=e.height;var h=Math.sqrt(d.x*d.x+d.y*d.y),f=Math.sqrt(p.x*p.x+p.y*p.y),m=h/t.originalWidth,v=f/t.originalHeight;if(.5>m||.5>v){var _=this.getGLConstantForMipmapSamplingMode(a);s.bindTexture(s.TEXTURE_2D,t.mipmapTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,_),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR)}else s.bindTexture(s.TEXTURE_2D,t.originalImageTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);var x,w,y,b=this.glImageData.width,M=this.glImageData.height,l=!1;"normal"!=i&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),x=this.createTexture(b,M),w=this._claimFreeTexture(),s.activeTexture(this._getTextureForIndex(w)),s.bindTexture(s.TEXTURE_2D,x),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e.width,e.height,0,s.RGBA,s.UNSIGNED_BYTE,null),this._setTextureParams(s.NEAREST,s.NEAREST,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE),y=this._getWriteTextureAndSet(x),l=!0);var C=l?1:n;s.useProgram(u),"normal"!=i?this.startRender(u,g.NONE):this.startRender(u,g.PREMULTIPLIED_ALPHA),s.uniform1i(u.overlaySamplerSlot,c),s.uniform1f(u.alphaSlot,C),s.uniformMatrix4fv(u.transformSlot,s.FALSE,new Float32Array(r.transformMatrix)),this.finishRender(!1),l&&(this._getWriteTextureAndSet(y),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,x,params.blendMode,n),this._swapTextures(),this._resetTextureToFree(w),s.deleteTexture(x)),s.activeTexture(this._getTextureForIndex(c)),s.bindTexture(s.TEXTURE_2D,null),this._resetTextureToFree(c)},r.prototype.transformAndResizeImage=function(e,t,r,a,i,n){var s=this.gl;this.glPrograms.transformImageProgram=xe(this.glPrograms.transformImageProgram,me,o.MoaTransformImageVertexShader,o.MoaTransformImageFragmentShader,!1,s);var l=this.glPrograms.transformImageProgram,u=this._claimFreeTexture();s.activeTexture(this._getTextureForIndex(u)),s.bindTexture(s.TEXTURE_2D,this.glImageData.sourceTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,a,i,0,s.RGBA,s.UNSIGNED_BYTE,null),this.glImageData.width=a,this.glImageData.height=i,this.glRenderingObjects.renderbufferWidth=a,this.glRenderingObjects.renderbufferHeight=i,this._createFramebuffersAndTextures(a,i),r.preTranslate(.5,.5),r.postTranslate(-.5,-.5);var c=this._claimFreeTexture();s.activeTexture(this._getTextureForIndex(c)),s.bindTexture(s.TEXTURE_2D,t),"nearest"==n?this._setTextureParams(s.NEAREST,s.NEAREST,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE):this._setTextureParams(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE),s.useProgram(l),this.startRender(l,g.NONE),s.uniform1i(l.samplerSlot,c),s.uniformMatrix4fv(l.transformSlot,s.FALSE,new Float32Array(r.transformMatrix)),this.finishRender(!0),this._resetTextureToFree(c),this._resetTextureToFree(u)},r.prototype.transformAndResizeImageUsingMipmap=function(e,t,r,a,i,n){var s=this.gl;this.glPrograms.transformImageProgram=xe(this.glPrograms.transformImageProgram,me,o.MoaTransformImageVertexShader,o.MoaTransformImageFragmentShader,!1,s);var l=this.glPrograms.transformImageProgram,u=this._claimFreeTexture();s.activeTexture(this._getTextureForIndex(u)),s.bindTexture(s.TEXTURE_2D,this.glImageData.sourceTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,a,i,0,s.RGBA,s.UNSIGNED_BYTE,null),this.glImageData.width=a,this.glImageData.height=i,this.glRenderingObjects.renderbufferWidth=a,this.glRenderingObjects.renderbufferHeight=i,this._createFramebuffersAndTextures(a,i);var c={x:1,y:0,z:0,w:0},d={x:0,y:1,z:0,w:0},p=r.makeCopy();p.invert(),p.rightMultiplyVector(c),p.rightMultiplyVector(d),c.x*=a,c.y*=i,d.x*=a,d.y*=i;var h=Math.sqrt(c.x*c.x+c.y*c.y),f=Math.sqrt(d.x*d.x+d.y*d.y),m=h/t.originalWidth,v=f/t.originalHeight;r.preTranslate(.5,.5),r.postTranslate(-.5,-.5);var _=this._claimFreeTexture();if(s.activeTexture(this._getTextureForIndex(_)),.5>m||.5>v){var x=this.getGLConstantForMipmapSamplingMode(n);s.bindTexture(s.TEXTURE_2D,t.mipmapTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,x),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR)}else s.bindTexture(s.TEXTURE_2D,t.originalImageTexture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);s.useProgram(l),this.startRender(l,g.NONE),s.uniform1i(l.samplerSlot,_),s.uniformMatrix4fv(l.transformSlot,s.FALSE,new Float32Array(r.transformMatrix)),this.finishRender(!0),this._resetTextureToFree(_),this._resetTextureToFree(u)},r.prototype.renderRingFlare=function(e,t,r,a,i,n,s,l){var u,c=this.gl,d=[];this.glPrograms.ringFlareProgram=xe(this.glPrograms.ringFlareProgram,z,o.MoaVertexShader,o.MoaRingFlareFragmentShader,!1,c),u=this.glPrograms.ringFlareProgram,this._fillFloatColorWithMoaColorVals(d,e),c.useProgram(u),this.startRender(u,g.NORMAL),c.uniform1f(u.dr22Slot,a),c.uniform1f(u.dr12Slot,i),c.uniform1f(u.daaSlot,n),c.uniform1f(u.avgDSlot,s),c.uniform1f(u.bASlot,l),c.uniform1f(u.widthSlot,this.glImageData.width),c.uniform1f(u.heightSlot,this.glImageData.height),c.uniform1f(u.xCenterSlot,t),c.uniform1f(u.yCenterSlot,r),c.uniform4fv(u.colorSlot,d),this.finishRender(!1)},r.prototype.renderSketch=function(e,t,r,a,i,n){var c=this.gl,d=[],p=this.getImageDataFromTexture(this.glImageData.sourceTexture),h=this.glImageData.width,f=this.glImageData.height,m={data:p,width:h,height:f},v=new l,_=v.rgb2graySingleChannel(m),x=u.equalizeSingleChannel(_);e=Math.min(h,f)*e/1e3;var w=Math.floor(a/100*_.length),y=Ae(x,t),d={r:i.r/255,g:i.g/255,b:i.b/255,a:1};this.setTextureToColor(this.glRenderingObjects.writeTexture,d),d=[i.r/255,i.g/255,i.b/255,1],strokeColor=[n.r/255,n.g/255,n.b/255,1],this.glPrograms.drawingLightenBlendModeProgram=xe(this.glPrograms.drawingLightenBlendModeProgram,le,o.MoaDrawingLightenBlendModeVertexShader,o.MoaDrawingLightenBlendModeFragmentShader,!1,c);var b=this.glPrograms.drawingLightenBlendModeProgram,M=c.createTexture(),C=this._claimFreeTexture();c.activeTexture(this._getTextureForIndex(C)),c.bindTexture(c.TEXTURE_2D,M),this._setTextureParams(c.NEAREST,c.NEAREST,c.CLAMP_TO_EDGE,c.CLAMP_TO_EDGE),c.pixelStorei(c.UNPACK_ALIGNMENT,1),c.texImage2D(c.TEXTURE_2D,0,c.LUMINANCE,h,f,0,c.LUMINANCE,c.UNSIGNED_BYTE,new Uint8Array(x)),c.pixelStorei(c.UNPACK_ALIGNMENT,4),this._resetTextureToFree(C),c.bindFramebuffer(c.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer);var T=this._configurePipelineWithTempReadAndWriteTextures(M,this.glRenderingObjects.writeTexture);c.useProgram(b),this.startRender(b,g.NONE),c.enable(c.BLEND),c.blendEquation(c.FUNC_ADD),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.enableVertexAttribArray(b.positionSlot),c.enableVertexAttribArray(b.strokeGrayLevelSlot),c.enableVertexAttribArray(b.shadeSlot);var S=[],A=[],E=[];c.uniform4fv(b.canvasColorSlot,d),c.uniform4fv(b.strokeColorSlot,strokeColor);var P=e,D=r;t=Math.round(t);for(var F=c.createBuffer(),L=c.createBuffer(),R=c.createBuffer(),I=5e3,B=0,O=0,N=0,k=0,U=t-1;U>=0;U--){for(var W=y[U],G=new s.RNG(U),j=0;w>j;j++){var V=G.nextFloat()*h,z=G.nextFloat()*f;V=V>h-1?h-1:V,z=z>f-1?f-1:z;var H=(z+.5|0)*h+(V+.5|0);if(x[H]<=W){for(var X=W/255,$=X*d[0]+(1-X)*strokeColor[0],Y=X*d[1]+(1-X)*strokeColor[1],q=X*d[2]+(1-X)*strokeColor[2],Z=0;10>Z;Z++)E[N++]=X,E[N++]=X,E[N++]=X,E[N++]=1;for(var Z=0;3>Z;Z++)S[B++]=0,S[B++]=0,S[B++]=0,S[B++]=0;for(var Z=3;7>Z;Z++)S[B++]=$,S[B++]=Y,S[B++]=q,S[B++]=1;for(var Z=7;10>Z;Z++)S[B++]=0,S[B++]=0,S[B++]=0,S[B++]=0;var K=(V+D-P-1.5)/h,Q=(z+D)/f,J=(V-D-P-1.5)/h,ee=(z-D)/f,te=(V+D-P)/h,re=(z+D)/f,oe=(V-D-P)/h,ae=(z-D)/f,ie=(V+D+P)/h,ne=(z+D)/f,se=(V-D+P)/h,ue=(z-D)/f,ce=(V+D+P+1.5)/h,de=(z+D)/f,pe=(V-D+P+1.5)/h,he=(z-D)/f;K=2*K-1,Q=2*Q-1,J=2*J-1,ee=2*ee-1,te=2*te-1,re=2*re-1,oe=2*oe-1,ae=2*ae-1,ie=2*ie-1,ne=2*ne-1,se=2*se-1,ue=2*ue-1,ce=2*ce-1,de=2*de-1,pe=2*pe-1,he=2*he-1,A[O++]=K,A[O++]=Q,A[O++]=K,A[O++]=Q,A[O++]=J,A[O++]=ee,A[O++]=te,A[O++]=re,A[O++]=oe,A[O++]=ae,A[O++]=ie,A[O++]=ne,A[O++]=se,A[O++]=ue,A[O++]=ce,A[O++]=de,A[O++]=pe,A[O++]=he,A[O++]=pe,A[O++]=he,k+=10,k>=I&&(c.bindBuffer(c.ARRAY_BUFFER,F),c.bufferData(c.ARRAY_BUFFER,new Float32Array(S),c.STATIC_DRAW),c.vertexAttribPointer(b.strokeGrayLevelSlot,4,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,L),c.bufferData(c.ARRAY_BUFFER,new Float32Array(A),c.STATIC_DRAW),c.vertexAttribPointer(b.positionSlot,2,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,R),c.bufferData(c.ARRAY_BUFFER,new Float32Array(E),c.STATIC_DRAW),c.vertexAttribPointer(b.shadeSlot,4,c.FLOAT,c.FALSE,0,0),c.drawArrays(c.TRIANGLE_STRIP,0,I),O=0,B=0,N=0,k=0)}}I>k&&(c.bindBuffer(c.ARRAY_BUFFER,F),c.bufferData(c.ARRAY_BUFFER,new Float32Array(S),c.STATIC_DRAW),c.vertexAttribPointer(b.strokeGrayLevelSlot,4,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,L),c.bufferData(c.ARRAY_BUFFER,new Float32Array(A),c.STATIC_DRAW),c.vertexAttribPointer(b.positionSlot,2,c.FLOAT,c.FALSE,0,0),c.bindBuffer(c.ARRAY_BUFFER,R),c.bufferData(c.ARRAY_BUFFER,new Float32Array(E),c.STATIC_DRAW),c.vertexAttribPointer(b.shadeSlot,4,c.FLOAT,c.FALSE,0,0),c.drawArrays(c.TRIANGLE_STRIP,0,k),O=0,B=0,N=0,k=0)}c.disable(c.BLEND),c.deleteBuffer(L),c.deleteBuffer(F),c.deleteBuffer(R),c.disableVertexAttribArray(b.positionSlot),c.disableVertexAttribArray(b.strokeGrayLevelSlot),c.disableVertexAttribArray(b.shadeSlot),this._resetRenderingObjects(T),this._swapTextures()};var Ae=function(e,t){for(var r=[],o=0;t>o;o++)r[o]=25*(o+1);return r};r.prototype.drawToolStartEffect=function(e,t){var r=this.gl;this.drawToolState={},this.glPrograms.multiColorDrawingProgram=xe(this.glPrograms.multiColorDrawingProgram,se,o.MoaMultiColorDrawingVertexShader,o.MoaMultiColorDrawingFragmentShader,!1,r);var a=this.glPrograms.multiColorDrawingProgram,i=this.glRenderingObjects.readTexture;this.drawToolState.cachedRenderingObjects=this._configurePipelineWithTempReadAndWriteTextures(i,e.getTexture()),r.bindFramebuffer(r.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),r.useProgram(a),this.startRender(a,g.NONE_DONT_CLEAR),r.enable(r.BLEND),t?(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ZERO,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA)),"undefined"==typeof this.drawToolState.vertexPositionBuffer&&(this.drawToolState.vertexPositionBuffer=r.createBuffer()),"undefined"==typeof this.drawToolState.vertexColorBuffer&&(this.drawToolState.vertexColorBuffer=r.createBuffer()),r.enableVertexAttribArray(a.positionSlot),r.enableVertexAttribArray(a.colorSlot)},r.prototype.drawTrianglesWithColor=function(e,t,r){var o=this.gl;if(t.length>2){for(var a=this.glPrograms.multiColorDrawingProgram,i=[],n=[],s=0,l=0,u=0;u<t.length;u++)n[s++]=2*(t[u].x/e.width-.5),n[s++]=2*(t[u].y/e.height-.5),i[l++]=t[u].color.r/255,
i[l++]=t[u].color.g/255,i[l++]=t[u].color.b/255,i[l++]=t[u].color.a/255;o.bindBuffer(o.ARRAY_BUFFER,this.drawToolState.vertexPositionBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),o.vertexAttribPointer(a.positionSlot,2,o.FLOAT,o.FALSE,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.drawToolState.vertexColorBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(i),o.STATIC_DRAW),o.vertexAttribPointer(a.colorSlot,4,o.FLOAT,o.FALSE,0,0);var c=0;r===v.TRIANGLE_STRIP?c=o.TRIANGLE_STRIP:r===v.TRIANGLE_FAN&&(c=o.TRIANGLE_FAN),o.drawArrays(c,0,t.length)}},r.prototype.drawToolEndEffect=function(){var e=this.gl;this._resetRenderingObjects(this.drawToolState.cachedRenderingObjects),e.disable(e.BLEND);var t=this.glPrograms.multiColorDrawingProgram;e.disableVertexAttribArray(t.positionSlot),e.disableVertexAttribArray(t.colorSlot),e.bindFramebuffer(e.FRAMEBUFFER,this.glRenderingObjects.offscreenFramebuffer),e.bindBuffer(e.ARRAY_BUFFER,this.glBuffers.vertexBufferFlipped),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.glBuffers.indexBuffer)},r.prototype.applyVignetteToolToMask=function(e,t){var r=this.gl,a=(this.glImageData.width,this.glImageData.height,t.gradientShapeType),i=(t.aspectMode,t.blendMode,t.wrapMode),n=t.invertGradient,s=t.alpha,l=t.gradMap,u=t.gradientParams,c=new h(t.gradientTransform);c.preTranslate(-.5,-.5);var d,p;d=this._claimFreeTexture(),r.activeTexture(this._getTextureForIndex(d)),r.bindTexture(r.TEXTURE_2D,e.getTexture()),p=this._getWriteTextureAndSet(e.getTexture());var f=this._claimFreeTexture(),m=this._createGradientTexture(f,l);this.glPrograms.gradientFlareProgram=xe(this.glPrograms.gradientFlareProgram,he,o.MoaVertexShader,o.MoaGradientFlareFragmentShader,!1,r);var v=this.glPrograms.gradientFlareProgram;r.useProgram(v),this.startRender(v,g.NONE),r.uniform1f(v.alphaBlendSlot,s),r.uniform1i(v.invertGradientSlot,n?1:0),r.uniform1i(v.shapeSlot,y.get(a)),r.uniform1i(v.wrapModeSlot,b.get(i)),r.uniform1i(v.gradientMapSlot,f),r.uniformMatrix4fv(v.transformMatSlot,!1,c.transformMatrix),r.uniformMatrix4fv(v.paramsMatSlot,!1,u),this.finishRender(!1),this._getWriteTextureAndSet(p),this._resetTextureToFree(d),r.activeTexture(this._getTextureForIndex(f)),r.bindTexture(r.TEXTURE_2D,null),r.deleteTexture(m),this._resetTextureToFree(f),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glImageData.sourceTexture,e.getTexture(),"normal",1),this._swapTextures()},r.prototype.renderLegacyAdjustments=function(e,t,r,a,i,n,s,l,u,c,d){var p=this.gl;if("undefined"!=typeof M.get(c)){var h,f,m,v=this.glImageData.width,_=this.glImageData.height,x=!1;("normal"!=c||1!=d)&&(this.glRenderingObjects.readTexture==this.glImageData.sourceTexture&&this.renderIdentity(),h=this.createTexture(v,_),f=this._claimFreeTexture(),p.activeTexture(this._getTextureForIndex(f)),p.bindTexture(p.TEXTURE_2D,h),m=this._getWriteTextureAndSet(h),x=!0),this.glPrograms.brightnessContrastSaturationWarmthProgram=xe(this.glPrograms.brightnessContrastSaturationWarmthProgram,R,o.MoaVertexShader,o.MoaBrightnessContrastSaturationWarmthShader,!1,p);var w=this.glPrograms.brightnessContrastSaturationWarmthProgram,y=this._claimFreeTexture();if(-1!=y){var b=this._createColorMapTexture(i,n,n,y);p.useProgram(w),this.startRender(w,g.NONE);var C=[1,0,0,0,1,0,0,0,1],T=[],S=[];C[0]=u[0],C[1]=u[1],C[2]=u[2],C[3]=u[3],C[4]=u[4],C[5]=u[5],C[6]=u[6],C[7]=u[7],C[8]=u[8],T[0]=s[0],T[1]=s[1],T[2]=s[2],T[3]=s[3],T[4]=s[4],T[5]=s[5],T[6]=s[6],T[7]=s[7],T[8]=s[8],S[0]=l[0],S[1]=l[1],S[2]=l[2],p.uniform1f(w.brightnessSlot,e),p.uniform1f(w.contrastSlot,t),p.uniform1f(w.saturationSlot,r),p.uniform1f(w.warmthSlot,a),p.uniform1i(w.cMapSlot,y),p.uniformMatrix3fv(w.contrastSatAdjustSlot,p.FALSE,C),p.uniformMatrix3fv(w.saturationMatrixSlot,p.FALSE,T),p.uniform3fv(w.warmthDeltaSlot,S),this.finishRender(!x),p.deleteTexture(b),this._resetTextureToFree(y),x&&(this._getWriteTextureAndSet(m),this.bitmapBlendBitmap(this.glRenderingObjects.writeTexture,this.glRenderingObjects.readTexture,h,c,d),this._swapTextures(),this._resetTextureToFree(f),p.deleteTexture(h))}}}}()},{"../../../src/js/core/MoaAllocAndCopy":34,"../../../src/js/core/MoaBitmap":35,"../../../src/js/core/MoaColor.js":36,"../../../src/js/core/MoaTransform":40,"../../../src/js/core/rng":42,"../../../src/js/interactive/MoaRegionInfo":59,"../../../src/js/processors/MoaColorConversion.js":74,"../../../src/js/processors/MoaHistogram.js":89,"../../../src/js/processors/MoaSharpen":96}],2:[function(e,t,o){var a={copyCanvas:function(e,t,o,a,i){var n,s=r.createElement("canvas");if(void 0===i)if(s.width=e.width,s.height=e.height,n=s.getContext("2d"),"undefined"!=typeof avpw$&&avpw$.browser&&avpw$.browser.msie){var l=e.getContext("2d");n.putImageData(l.getImageData(0,0,e.width,e.height),0,0)}else n.drawImage(e,0,0);else s.width=a,s.height=i,n=s.getContext("2d"),n.drawImage(e,-t,-o);return s},getCanvasPixelData:function(e){var t=e.getContext("2d");return t.getImageData(0,0,e.width,e.height)},getBitmapForImage:function(e){var t=r.createElement("canvas"),o=t.getContext("2d");return t.width=e.width,t.height=e.height,o.drawImage(e,0,0,e.width,e.height),o.getImageData(0,0,t.width,t.height)},convertToPremultipliedAlpha:function(e){for(var t=0;t<e.height;t++)for(var r=0;r<e.width;r++){var o=4*(t*e.width+r),a=e.data[o+3]/255,i=e.data[o],n=e.data[o+1],s=e.data[o+2];e.data[o]=a*i,e.data[o+1]=a*n,e.data[o+2]=a*s}return e},isOriginClean:function(e){var t=!0;try{e.getImageData(0,0,1,1)}catch(r){r&&r.message&&-1!==r.message.toLowerCase().indexOf("security")&&(t=!1),r&&r.name&&-1!==r.name.toLowerCase().indexOf("security")&&(t=!1)}return t}};t.exports=a},{}],3:[function(e,r,o){function a(e,r){var o=e.label;if(e.system)r.active&&r.active();else if(i){e.familyStyle&&(o+=":"+e.familyStyle);var a={loading:r.loading||function(){},active:r.active||function(){},inactive:r.inactive||function(){}};e.custom?(a.custom={families:[o],urls:[e.url]},a.active=function(){r.active&&t.setTimeout(function(){r.active()},0)}):a.google={families:[o]},i.load(a)}}var i=e("./lib/webfontloader.js").WebFont;r.exports={loadFont:a}},{"./lib/webfontloader.js":7}],4:[function(e,t,r){var o=e("./../../../src/js/actionlist/MoaLiteRequires");"undefined"!=typeof Aviary&&"undefined"!=typeof Aviary.util&&(Aviary.util.resourceProvider=e("./MoaResourceProvider"),Aviary.util.cnvs=e("./MoaCanvasUtils.js"),Aviary.util.moaLite=o),t.exports=o},{"./../../../src/js/actionlist/MoaLiteRequires":10,"./MoaCanvasUtils.js":2,"./MoaResourceProvider":5}],5:[function(e,t,r){function o(){var e={},t={saveResource:function(t,r,o){t&&r&&(e[t+r]=o)},doesResourceExist:function(t,r){return t&&r?"undefined"!=typeof e[t+r]:!1},effectJSONProvider:function(t,r,o){return e[t+r]},contentImageProvider:function(t,r,o,a){var n=e[t+r],s=i.getBitmapForImage(n);return i.convertToPremultipliedAlpha(s)},frameSegmentProvider:function(t,r,o,a){return e[t+r][o]},textProvider:a.provideTextImage,updateViewDimensions:null,context:null,utils:{TextProvider:a}};return t}var a=e("./MoaTextProvider.js"),i=e("./MoaCanvasUtils.js");e("./lib/webfontloader.js"),t.exports=o},{"./MoaCanvasUtils.js":2,"./MoaTextProvider.js":6,"./lib/webfontloader.js":7}],6:[function(e,t,o){function a(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function i(e,t,r,o,i){t.textCase===y.MoaActionlistTextCaseUpper?e=e.toUpperCase():t.textCase===y.MoaActionlistTextCaseLower&&(e=e.toLowerCase());var l=t.fontSize,c=e.length;i&&"top"===i?"undefined"!=typeof d&&"undefined"!=typeof p&&c>p&&(l=d):i&&"bottom"===i&&"undefined"!=typeof h&&"undefined"!=typeof f&&c>f&&(l=h),"League Gothic"===t.fontName&&(t.fontName="LeagueGothic-Regular");var m={text:e,length:c,fontSize:l,fontName:t.fontName,color:t.color,alignment:t.alignment,maxLineWidth:0,totalHeight:0};a(m,t);var g;r?A[i].hasOwnProperty(e)?g=A[i][e]:(g=n(e,c,l,t,r,m),A[i][e]=g):g=s(e,c,l,m,!0),a(m,g),i&&"top"===i?(p=e.length,d=m.fontSize):i&&"bottom"===i&&(f=e.length,h=m.fontSize);var v=u(m);return v}function n(e,t,r,o,a,i){for(var n,l=new Array(2*e.length),u={},c=o.outlineSize*r/o.fontSize,d=-1,p=0,h=0,f=0,m=a.minimumBitmapSize.width,g=a.minimumBitmapSize.height,v=0,_=0,x=1,w=0,y=0,b=0,M=!1,C=!1,T=0,S=r+1,A=0;t>b;){if(y=b+w,l[y]=e[b],"\n"===l[y])d=-1,p=0,_=0,x++,t+w-1>y&&(v=0+y+1),M=!1;else{if(0===p&&M&&(" "===l[y]||"	"===l[y])){w--,b++;continue}p++;var E=e.substr(v,p);if(n=s(E,p,r,i),_=n.maxLineWidth,1===p){var P=l.join(""),D=P.substr(0,y+1);n=s(D,y+1,r,i),f=n.totalHeight}}" "===l[y]||"	"===l[y]?(C?T++:(d=y,T=1),C=!0):(C=!1,T=0),_>m&&(p=0,d>-1?(l[d]="\n",w-=Math.max(0,T-1),b=d-w,t-1>b+w&&(v=0+b+w+1)):(l[y]="\n",w++,b--,t+w-1>y&&(v=0+y+1)),d=-1,p=0,_=0,x++,M=!0);var F=f>g,L=b===t-1&&S-r>1;if(F||L){if(b=0,d=-1,p=0,_=0,x=1,v=l,w=0,y=0,M=!1,C=!1,T=0,L)A=r,r++;else if(A>0)S=r,r--;else if(r>a.minimumFontSize){S>r&&(S=r);var R=Math.sqrt(b/(t-1)),I=Math.floor(r*R);I<a.minimumFontSize?r=a.minimumFontSize:I===r?r--:r=I}else m*=2,g*=2,r=o.fontSize,S=r+1,A=0;c=o.outlineRatio*r}else b++}c=o.outlineRatio*r;var B=l.join(""),n=s(B,t,r,i,!0),O=n.topOffset,N=n.bottomOffset,k=n.maxLineHeight,f=n.totalHeight;return u.width=m,u.height=g,{length:t,maxLineWidth:h,fontSize:r,outlineSize:c,text:B,totalHeight:f,maxLineHeight:k,stringCopy:l,outSize:u,topOffset:O,bottomOffset:N}}function s(e,t,o,a,i){var n=c||r.createElement("canvas"),s=n.getContext("2d"),u=o,d=e.split("\n"),p=0,h=0,f=0;l(s,o,a?a.fontName:null,null,a?a.alignment:null);for(var m,d=e.split("\n"),g=0;g<d.length;g++)m=s.measureText(d[g]).width,p=Math.max(p,m);if(i){for(var _=[],g=0;256>g;g++)_.push(String.fromCharCode(g));_.join(""),n.width=1.5*a.fontSize,n.height=1.5*a.fontSize,l(s,o,a?a.fontName:null,null,a?a.alignment:null);var x=n.height/2;s.textAlign="left",s.fillStyle="black",s.textBaseline="middle";for(var m,g=0;g<_.length;g++)s.fillText(_[g],0,x);for(var w=s.getImageData(0,0,n.width,n.height),y=w.data,b=n.width,M=n.height,C=!1,T=0,S=0;M-1>S;S++){for(var A=0;b-1>A;A++){var E=4*(S*b+A)+3,P=y[E];if(P>0){C=!0,T=S;break}}if(C)break}for(var D=!1,F=M,S=M-1;S>=T;S--){for(var A=0;b-1>A;A++){var E=4*(S*b+A)+3,P=y[E];if(P>0){D=!0,F=S;break}}if(D)break}u=F-T,h=x-T,f=F-x}return l(s,o,a?a.fontName:null,null,a?a.alignment:null),{length:t,maxLineWidth:p,maxLineHeight:u,totalHeight:d.length*o*v,topOffset:h,bottomOffset:f}}function l(e,t,r,o,a,i,n){var s=(n||"normal")+" "+t+"px "+(r+E||"Arial");if(e.font=s,o){var l=o.a/255;e.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+l+")"}a&&(e.textAlign=a),e.textBaseline="alphabetic"}function u(e,t,o){var a,i=t||c||r.createElement("canvas"),n=i.getContext("2d"),s=(e.maxLineHeight,0),u=e.text.split("\n"),d=0,p=0;e.outSize?(i.width=e.outSize.width,i.height=e.outSize.height):(d=Math.max(x*e.maxLineWidth,e.fontSize*w),p=Math.max(x*e.fontSize*u.length*v,e.fontSize*w),i.width=e.maxLineWidth+2*d,i.height=e.fontSize*u.length*v+2*p),e.vAlignment&&e.vAlignment!=b?e.vAlignment==M&&(a=i.height-((u.length*v-1)*e.fontSize+p)):a=p+e.fontSize;var h;if(e.alignment===C?h=d:e.alignment===T?h=Math.floor(i.width/2):e.alignment===S&&(h=i.width-d),l(n,e.fontSize,e.fontName,e.color,e.alignment),e.outlineSize>0){var f=e.outlineColor,m=f.a/255;n.strokeStyle="rgba("+f.r+","+f.g+","+f.b+","+m+")",n.lineWidth=e.outlineSize*_}for(var y=a,A=0;A<u.length;A++)e.outlineSize>0&&n.strokeText(u[A],s+h,a),n.fillText(u[A],s+h,a),a+=e.fontSize*v;return o?{horizontalPaddingPixels:d,yOffset:-(y-i.height)-(u.length-1)*e.fontSize*v}:g.convertToPremultipliedAlpha(n.getImageData(0,0,i.width,i.height))}var c,d,p,h,f,m=e("./MoaFontLoader.js"),g=e("./MoaCanvasUtils.js"),v=1.17,_=2.4,x=.1,w=.5,y={MoaActionlistTextCaseNormal:"normal",MoaActionlistTextCaseLower:"lower",MoaActionlistTextCaseUpper:"upper"},b="verticalAlignTop",M="verticalAlignBottom",C="left",T="center",S="right",A={top:{},bottom:{}},E=", 'Arial','Arial-BoldMT','ArialMT','Arial','Lucida Grande','Arial Unicode MS',sans-serif";t.exports={provideTextImage:i,getStringDimensions:s,drawString:u,loadFont:m.loadFont}},{"./MoaCanvasUtils.js":2,"./MoaFontLoader.js":3}],7:[function(e,o,a){"use strict";if("undefined"==typeof r)return void(o.exports={});var i={};i.bind=function(e,t,r){var o=arguments.length>2?Array.prototype.slice.call(arguments,2):[];return function(){return o.push.apply(o,arguments),t.apply(e,o)}},i.extendsClass=function(e,t){function r(){}r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superCtor_=e,t.super_=e.prototype},i.DomHelper=function(e){this.document_=e,this.supportForStyle_=void 0},i.DomHelper.prototype.createElement=function(e,t,r){var o=this.document_.createElement(e);if(t)for(var a in t)t.hasOwnProperty(a)&&("style"==a?this.setStyle(o,t[a]):o.setAttribute(a,t[a]));return r&&o.appendChild(this.document_.createTextNode(r)),o},i.DomHelper.prototype.insertInto=function(e,t){var o=this.document_.getElementsByTagName(e)[0];return o||(o=r.documentElement),o&&o.lastChild?(o.insertBefore(t,o.lastChild),!0):!1},i.DomHelper.prototype.whenBodyExists=function(e){var t=function(){r.body?e():setTimeout(t,0)};t()},i.DomHelper.prototype.removeElement=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},i.DomHelper.prototype.createCssLink=function(e){return this.createElement("link",{rel:"stylesheet",href:e})},i.DomHelper.prototype.createScriptSrc=function(e){return this.createElement("script",{src:e})},i.DomHelper.prototype.appendClassName=function(e,t){for(var r=e.className.split(/\s+/),o=0,a=r.length;a>o;o++)if(r[o]==t)return;r.push(t),e.className=r.join(" ").replace(/^\s+/,"")},i.DomHelper.prototype.removeClassName=function(e,t){for(var r=e.className.split(/\s+/),o=[],a=0,i=r.length;i>a;a++)r[a]!=t&&o.push(r[a]);e.className=o.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")},i.DomHelper.prototype.hasClassName=function(e,t){for(var r=e.className.split(/\s+/),o=0,a=r.length;a>o;o++)if(r[o]==t)return!0;return!1},i.DomHelper.prototype.setStyle=function(e,t){this.hasSupportForStyle_()?e.setAttribute("style",t):e.style.cssText=t},i.DomHelper.prototype.hasSupportForStyle_=function(){if(void 0===this.supportForStyle_){var e=this.document_.createElement("p");e.innerHTML='<a style="top:1px;">w</a>',this.supportForStyle_=/top/.test(e.getElementsByTagName("a")[0].getAttribute("style"))}return this.supportForStyle_},i.UserAgent=function(e,t,r,o,a,i,n,s){this.name_=e,this.version_=t,this.engine_=r,this.engineVersion_=o,this.platform_=a,this.platformVersion_=i,this.documentMode_=n,this.webFontSupport_=s},i.UserAgent.prototype.getName=function(){return this.name_},i.UserAgent.prototype.getVersion=function(){return this.version_},i.UserAgent.prototype.getEngine=function(){return this.engine_},i.UserAgent.prototype.getEngineVersion=function(){return this.engineVersion_},i.UserAgent.prototype.getPlatform=function(){return this.platform_},i.UserAgent.prototype.getPlatformVersion=function(){return this.platformVersion_},i.UserAgent.prototype.getDocumentMode=function(){return this.documentMode_},i.UserAgent.prototype.isSupportingWebFont=function(){return this.webFontSupport_},i.UserAgentParser=function(e,t){this.userAgent_=e,this.doc_=t},i.UserAgentParser.UNKNOWN="Unknown",i.UserAgentParser.UNKNOWN_USER_AGENT=new i.UserAgent(i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,void 0,!1),i.UserAgentParser.prototype.parse=function(){return this.isIe_()?this.parseIeUserAgentString_():this.isOpera_()?this.parseOperaUserAgentString_():this.isWebKit_()?this.parseWebKitUserAgentString_():this.isGecko_()?this.parseGeckoUserAgentString_():i.UserAgentParser.UNKNOWN_USER_AGENT},i.UserAgentParser.prototype.getPlatform_=function(){var e=this.getMatchingGroup_(this.userAgent_,/(iPod|iPad|iPhone|Android)/,1);if(""!=e)return e;var t=this.getMatchingGroup_(this.userAgent_,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1);return""!=t?("Mac_PowerPC"==t&&(t="Macintosh"),t):i.UserAgentParser.UNKNOWN},i.UserAgentParser.prototype.getPlatformVersion_=function(){var e=this.getMatchingGroup_(this.userAgent_,/(OS X|Windows NT|Android|CrOS) ([^;)]+)/,2);if(e)return e;var t=this.getMatchingGroup_(this.userAgent_,/(iPhone )?OS ([\d_]+)/,2);if(t)return t;var r=this.getMatchingGroup_(this.userAgent_,/Linux ([i\d]+)/,1);return r?r:i.UserAgentParser.UNKNOWN},i.UserAgentParser.prototype.isIe_=function(){return-1!=this.userAgent_.indexOf("MSIE")},i.UserAgentParser.prototype.parseIeUserAgentString_=function(){var e=this.getMatchingGroup_(this.userAgent_,/(MSIE [\d\w\.]+)/,1);if(i.UserAgentParser.UNKNOWN,i.UserAgentParser.UNKNOWN,""!=e){var t=e.split(" "),r=t[0],o=t[1];return new i.UserAgent(r,o,r,o,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),this.getMajorVersion_(o)>=6)}return new i.UserAgent("MSIE",i.UserAgentParser.UNKNOWN,"MSIE",i.UserAgentParser.UNKNOWN,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),!1)},i.UserAgentParser.prototype.isOpera_=function(){return-1!=this.userAgent_.indexOf("Opera")},i.UserAgentParser.prototype.parseOperaUserAgentString_=function(){var e=i.UserAgentParser.UNKNOWN,t=i.UserAgentParser.UNKNOWN,r=this.getMatchingGroup_(this.userAgent_,/(Presto\/[\d\w\.]+)/,1);if(""!=r){var o=r.split("/");e=o[0],t=o[1]}else{-1!=this.userAgent_.indexOf("Gecko")&&(e="Gecko");var a=this.getMatchingGroup_(this.userAgent_,/rv:([^\)]+)/,1);""!=a&&(t=a)}if(-1!=this.userAgent_.indexOf("Opera Mini/")){var n=this.getMatchingGroup_(this.userAgent_,/Opera Mini\/([\d\.]+)/,1);return""==n&&(n=i.UserAgentParser.UNKNOWN),new i.UserAgent("OperaMini",n,e,t,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),!1)}if(-1!=this.userAgent_.indexOf("Version/")){var n=this.getMatchingGroup_(this.userAgent_,/Version\/([\d\.]+)/,1);if(""!=n)return new i.UserAgent("Opera",n,e,t,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),this.getMajorVersion_(n)>=10)}var n=this.getMatchingGroup_(this.userAgent_,/Opera[\/ ]([\d\.]+)/,1);return""!=n?new i.UserAgent("Opera",n,e,t,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),this.getMajorVersion_(n)>=10):new i.UserAgent("Opera",i.UserAgentParser.UNKNOWN,e,t,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),!1)},i.UserAgentParser.prototype.isWebKit_=function(){return-1!=this.userAgent_.indexOf("AppleWebKit")},i.UserAgentParser.prototype.parseWebKitUserAgentString_=function(){var e=this.getPlatform_(),t=this.getPlatformVersion_(),r=this.getMatchingGroup_(this.userAgent_,/AppleWebKit\/([\d\.\+]+)/,1);""==r&&(r=i.UserAgentParser.UNKNOWN);var o=i.UserAgentParser.UNKNOWN;-1!=this.userAgent_.indexOf("Chrome")||-1!=this.userAgent_.indexOf("CrMo")||-1!=this.userAgent_.indexOf("CriOS")?o="Chrome":-1!=this.userAgent_.indexOf("Safari")?o="Safari":-1!=this.userAgent_.indexOf("AdobeAIR")&&(o="AdobeAIR");var a=i.UserAgentParser.UNKNOWN;-1!=this.userAgent_.indexOf("Version/")?a=this.getMatchingGroup_(this.userAgent_,/Version\/([\d\.\w]+)/,1):"Chrome"==o?a=this.getMatchingGroup_(this.userAgent_,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):"AdobeAIR"==o&&(a=this.getMatchingGroup_(this.userAgent_,/AdobeAIR\/([\d\.]+)/,1));var n=!1;if("AdobeAIR"==o){var s=this.getMatchingGroup_(a,/\d+\.(\d+)/,1);n=this.getMajorVersion_(a)>2||2==this.getMajorVersion_(a)&&parseInt(s,10)>=5}else{var s=this.getMatchingGroup_(r,/\d+\.(\d+)/,1);n=this.getMajorVersion_(r)>=526||this.getMajorVersion_(r)>=525&&parseInt(s,10)>=13}return new i.UserAgent(o,a,"AppleWebKit",r,e,t,this.getDocumentMode_(this.doc_),n)},i.UserAgentParser.prototype.isGecko_=function(){return-1!=this.userAgent_.indexOf("Gecko")},i.UserAgentParser.prototype.parseGeckoUserAgentString_=function(){var e=i.UserAgentParser.UNKNOWN,t=i.UserAgentParser.UNKNOWN,r=!1;if(-1!=this.userAgent_.indexOf("Firefox")){e="Firefox";var o=this.getMatchingGroup_(this.userAgent_,/Firefox\/([\d\w\.]+)/,1);if(""!=o){var a=this.getMatchingGroup_(o,/\d+\.(\d+)/,1);t=o,r=""!=o&&this.getMajorVersion_(o)>=3&&parseInt(a,10)>=5}}else-1!=this.userAgent_.indexOf("Mozilla")&&(e="Mozilla");var n=this.getMatchingGroup_(this.userAgent_,/rv:([^\)]+)/,1);if(""==n)n=i.UserAgentParser.UNKNOWN;else if(!r){var s=this.getMajorVersion_(n),l=parseInt(this.getMatchingGroup_(n,/\d+\.(\d+)/,1),10),u=parseInt(this.getMatchingGroup_(n,/\d+\.\d+\.(\d+)/,1),10);r=s>1||1==s&&l>9||1==s&&9==l&&u>=2||null!=n.match(/1\.9\.1b[123]/)||null!=n.match(/1\.9\.1\.[\d\.]+/)}return new i.UserAgent(e,t,"Gecko",n,this.getPlatform_(),this.getPlatformVersion_(),this.getDocumentMode_(this.doc_),r)},i.UserAgentParser.prototype.getMajorVersion_=function(e){var t=this.getMatchingGroup_(e,/(\d+)/,1);return""!=t?parseInt(t,10):-1},i.UserAgentParser.prototype.getMatchingGroup_=function(e,t,r){var o=e.match(t);return o&&o[r]?o[r]:""},i.UserAgentParser.prototype.getDocumentMode_=function(e){return e.documentMode?e.documentMode:void 0},i.EventDispatcher=function(e,t,r,o){this.domHelper_=e,this.htmlElement_=t,this.callbacks_=r,this.namespace_=o||i.EventDispatcher.DEFAULT_NAMESPACE,this.cssClassName_=new i.CssClassName("-")},i.EventDispatcher.DEFAULT_NAMESPACE="wf",i.EventDispatcher.LOADING="loading",i.EventDispatcher.ACTIVE="active",i.EventDispatcher.INACTIVE="inactive",i.EventDispatcher.FONT="font",i.EventDispatcher.prototype.dispatchLoading=function(){this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.LOADING)),this.dispatch_(i.EventDispatcher.LOADING)},i.EventDispatcher.prototype.dispatchFontLoading=function(e,t){this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.LOADING)),this.dispatch_(i.EventDispatcher.FONT+i.EventDispatcher.LOADING,e,t)},i.EventDispatcher.prototype.dispatchFontActive=function(e,t){this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.LOADING)),this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.INACTIVE)),this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.ACTIVE)),this.dispatch_(i.EventDispatcher.FONT+i.EventDispatcher.ACTIVE,e,t)},i.EventDispatcher.prototype.dispatchFontInactive=function(e,t){this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.LOADING));var r=this.domHelper_.hasClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.ACTIVE));r||this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,e,t,i.EventDispatcher.INACTIVE)),this.dispatch_(i.EventDispatcher.FONT+i.EventDispatcher.INACTIVE,e,t)},i.EventDispatcher.prototype.dispatchInactive=function(){this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.LOADING));var e=this.domHelper_.hasClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.ACTIVE));e||this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.INACTIVE)),this.dispatch_(i.EventDispatcher.INACTIVE)},i.EventDispatcher.prototype.dispatchActive=function(){this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.LOADING)),this.domHelper_.removeClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.INACTIVE)),this.domHelper_.appendClassName(this.htmlElement_,this.cssClassName_.build(this.namespace_,i.EventDispatcher.ACTIVE)),this.dispatch_(i.EventDispatcher.ACTIVE)},i.EventDispatcher.prototype.dispatch_=function(e,t,r){this.callbacks_[e]&&this.callbacks_[e](t,r)},i.FontModuleLoader=function(){this.modules_={}},i.FontModuleLoader.prototype.addModuleFactory=function(e,t){this.modules_[e]=t},i.FontModuleLoader.prototype.getModules=function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r)){var o=this.modules_[r];o&&t.push(o(e[r]))}return t},i.FontWatcher=function(e,t,r,o,a){this.domHelper_=e,this.eventDispatcher_=t,this.fontSizer_=r,this.asyncCall_=o,this.getTime_=a,this.currentlyWatched_=0,this.last_=!1,this.success_=!1},i.FontWatcher.DEFAULT_VARIATION="n4",i.FontWatcher.prototype.watch=function(e,t,r,o,a){for(var n=e.length,s=0;n>s;s++){var l=e[s];t[l]||(t[l]=[i.FontWatcher.DEFAULT_VARIATION]),this.currentlyWatched_+=t[l].length}a&&(this.last_=a);for(var s=0;n>s;s++)for(var l=e[s],u=t[l],c=r[l],d=0,p=u.length;p>d;d++){var h=u[d];this.eventDispatcher_.dispatchFontLoading(l,h);var f=i.bind(this,this.fontActive_),m=i.bind(this,this.fontInactive_),g=new o(f,m,this.domHelper_,this.fontSizer_,this.asyncCall_,this.getTime_,l,h,c);g.start()}},i.FontWatcher.prototype.fontActive_=function(e,t){this.eventDispatcher_.dispatchFontActive(e,t),this.success_=!0,this.decreaseCurrentlyWatched_()},i.FontWatcher.prototype.fontInactive_=function(e,t){this.eventDispatcher_.dispatchFontInactive(e,t),this.decreaseCurrentlyWatched_()},i.FontWatcher.prototype.decreaseCurrentlyWatched_=function(){0==--this.currentlyWatched_&&this.last_&&(this.success_?this.eventDispatcher_.dispatchActive():this.eventDispatcher_.dispatchInactive())},i.FontWatchRunner=function(e,t,r,o,a,n,s,l,u){this.activeCallback_=e,this.inactiveCallback_=t,this.domHelper_=r,this.fontSizer_=o,this.asyncCall_=a,this.getTime_=n,this.nameHelper_=new i.CssFontFamilyName,this.fvd_=new i.FontVariationDescription,this.fontFamily_=s,this.fontDescription_=l,this.fontTestString_=u||i.FontWatchRunner.DEFAULT_TEST_STRING,this.originalSizeA_=this.getDefaultFontSize_(i.FontWatchRunner.DEFAULT_FONTS_A),this.originalSizeB_=this.getDefaultFontSize_(i.FontWatchRunner.DEFAULT_FONTS_B),this.lastObservedSizeA_=this.originalSizeA_,this.lastObservedSizeB_=this.originalSizeB_,this.requestedFontA_=this.createHiddenElementWithFont_(i.FontWatchRunner.DEFAULT_FONTS_A),this.requestedFontB_=this.createHiddenElementWithFont_(i.FontWatchRunner.DEFAULT_FONTS_B)},i.FontWatchRunner.DEFAULT_FONTS_A="arial,'URW Gothic L',sans-serif",i.FontWatchRunner.DEFAULT_FONTS_B="Georgia,'Century Schoolbook L',serif",i.FontWatchRunner.DEFAULT_TEST_STRING="BESbswy",i.FontWatchRunner.prototype.start=function(){this.started_=this.getTime_(),this.check_()},i.FontWatchRunner.prototype.check_=function(){var e=this.fontSizer_.getWidth(this.requestedFontA_),t=this.fontSizer_.getWidth(this.requestedFontB_);this.originalSizeA_==e&&this.originalSizeB_==t||this.lastObservedSizeA_!=e||this.lastObservedSizeB_!=t?this.getTime_()-this.started_>=5e3?this.finish_(this.inactiveCallback_):(this.lastObservedSizeA_=e,this.lastObservedSizeB_=t,this.asyncCheck_()):this.finish_(this.activeCallback_)},i.FontWatchRunner.prototype.asyncCheck_=function(){this.asyncCall_(function(e,t){return function(){t.call(e)}}(this,this.check_),25)},i.FontWatchRunner.prototype.finish_=function(e){this.domHelper_.removeElement(this.requestedFontA_),this.domHelper_.removeElement(this.requestedFontB_),e(this.fontFamily_,this.fontDescription_)},i.FontWatchRunner.prototype.getDefaultFontSize_=function(e){var t=this.createHiddenElementWithFont_(e,!0),r=this.fontSizer_.getWidth(t);return this.domHelper_.removeElement(t),r},i.FontWatchRunner.prototype.createHiddenElementWithFont_=function(e,t){var r=this.computeStyleString_(e,this.fontDescription_,t),o=this.domHelper_.createElement("span",{style:r},this.fontTestString_);return this.domHelper_.insertInto("body",o),o},i.FontWatchRunner.prototype.computeStyleString_=function(e,t,r){var o=this.fvd_.expand(t),a="position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;font-family:"+(r?"":this.nameHelper_.quote(this.fontFamily_)+",")+e+";"+o;return a},i.WebFont=function(e,t,r,o,a){this.domHelper_=e,this.fontModuleLoader_=t,this.htmlElement_=r,this.asyncCall_=o,this.userAgent_=a,this.moduleLoading_=0,this.moduleFailedLoading_=0},i.WebFont.prototype.addModule=function(e,t){this.fontModuleLoader_.addModuleFactory(e,t)},i.WebFont.prototype.load=function(e){var t=new i.EventDispatcher(this.domHelper_,this.htmlElement_,e);this.userAgent_.isSupportingWebFont()?this.load_(t,e):t.dispatchInactive()},i.WebFont.prototype.isModuleSupportingUserAgent_=function(e,t,r,o){var a=e.getFontWatchRunnerCtor?e.getFontWatchRunnerCtor():i.FontWatchRunner;if(!o){var n=0==--this.moduleLoading_;return this.moduleFailedLoading_--,n&&(0==this.moduleFailedLoading_?t.dispatchInactive():t.dispatchLoading()),void r.watch([],{},{},a,n)}e.load(i.bind(this,this.onModuleReady_,t,r,a))},i.WebFont.prototype.onModuleReady_=function(e,t,r,o,a,n){var s=0==--this.moduleLoading_;s&&e.dispatchLoading(),this.asyncCall_(i.bind(this,function(e,t,r,o,a,i){e.watch(t,r||{},o||{},a,i)},t,o,a,n,r,s))},i.WebFont.prototype.load_=function(e,t){var r=this.fontModuleLoader_.getModules(t),o=this;this.moduleFailedLoading_=this.moduleLoading_=r.length;for(var a=new i.FontWatcher(this.domHelper_,e,{getWidth:function(e){return e.offsetWidth}},o.asyncCall_,function(){return(new Date).getTime()}),n=0,s=r.length;s>n;n++){var l=r[n];l.supportUserAgent(this.userAgent_,i.bind(this,this.isModuleSupportingUserAgent_,l,e,a))}},i.CssClassName=function(e){this.joinChar_=e||i.CssClassName.DEFAULT_JOIN_CHAR},i.CssClassName.DEFAULT_JOIN_CHAR="-",i.CssClassName.prototype.sanitize=function(e){return e.replace(/[\W_]+/g,"").toLowerCase()},i.CssClassName.prototype.build=function(e){for(var t=[],r=0;r<arguments.length;r++)t.push(this.sanitize(arguments[r]));return t.join(this.joinChar_)},i.CssFontFamilyName=function(){this.quote_="'"},i.CssFontFamilyName.prototype.quote=function(e){for(var t=[],r=e.split(/,\s*/),o=0;o<r.length;o++){var a=r[o].replace(/['"]/g,"");-1==a.indexOf(" ")?t.push(a):t.push(this.quote_+a+this.quote_)}return t.join(",")},i.FontVariationDescription=function(){this.properties_=i.FontVariationDescription.PROPERTIES,this.values_=i.FontVariationDescription.VALUES},i.FontVariationDescription.PROPERTIES=["font-style","font-weight"],i.FontVariationDescription.VALUES={"font-style":[["n","normal"],["i","italic"],["o","oblique"]],"font-weight":[["1","100"],["2","200"],["3","300"],["4","400"],["5","500"],["6","600"],["7","700"],["8","800"],["9","900"],["4","normal"],["7","bold"]]},i.FontVariationDescription.Item=function(e,t,r){this.index_=e,this.property_=t,this.values_=r},i.FontVariationDescription.Item.prototype.compact=function(e,t){for(var r=0;r<this.values_.length;r++)if(t==this.values_[r][1])return void(e[this.index_]=this.values_[r][0])},i.FontVariationDescription.Item.prototype.expand=function(e,t){for(var r=0;r<this.values_.length;r++)if(t==this.values_[r][0])return void(e[this.index_]=this.property_+":"+this.values_[r][1])},i.FontVariationDescription.prototype.compact=function(e){for(var t=["n","4"],r=e.split(";"),o=0,a=r.length;a>o;o++){var i=r[o].replace(/\s+/g,"").split(":");if(2==i.length){var n=i[0],s=i[1],l=this.getItem_(n);l&&l.compact(t,s)}}return t.join("")},i.FontVariationDescription.prototype.expand=function(e){if(2!=e.length)return null;for(var t=[null,null],r=0,o=this.properties_.length;o>r;r++){var a=this.properties_[r],n=e.substr(r,1),s=this.values_[a],l=new i.FontVariationDescription.Item(r,a,s);l.expand(t,n)}return t[0]&&t[1]?t.join(";")+";":null},i.FontVariationDescription.prototype.getItem_=function(e){for(var t=0;t<this.properties_.length;t++)if(e==this.properties_[t]){var r=this.values_[e];return new i.FontVariationDescription.Item(t,e,r)}return null};var n="WebFont",s=o.exports[n]=function(){var e=new i.UserAgentParser(navigator.userAgent,r),t=e.parse(),o=new i.DomHelper(r),a=function(e,t){setTimeout(e,t)};return new i.WebFont(o,new i.FontModuleLoader,r.documentElement,a,t)}();s.load=s.load,s.addModule=s.addModule,i.UserAgent.prototype.getName=i.UserAgent.prototype.getName,i.UserAgent.prototype.getVersion=i.UserAgent.prototype.getVersion,i.UserAgent.prototype.getEngine=i.UserAgent.prototype.getEngine,i.UserAgent.prototype.getEngineVersion=i.UserAgent.prototype.getEngineVersion,
i.UserAgent.prototype.getPlatform=i.UserAgent.prototype.getPlatform,i.UserAgent.prototype.getPlatformVersion=i.UserAgent.prototype.getPlatformVersion,i.UserAgent.prototype.getDocumentMode=i.UserAgent.prototype.getDocumentMode,i.UserAgent.prototype.isSupportingWebFont=i.UserAgent.prototype.isSupportingWebFont,i.FontdeckScript=function(e,t,r){this.global_=e,this.domHelper_=t,this.configuration_=r,this.fontFamilies_=[],this.fontVariations_={},this.fvd_=new i.FontVariationDescription},i.FontdeckScript.NAME="fontdeck",i.FontdeckScript.HOOK="__webfontfontdeckmodule__",i.FontdeckScript.API="//f.fontdeck.com/s/css/js/",i.FontdeckScript.prototype.getScriptSrc=function(e){var t="https:"==this.global_.location.protocol?"https:":"http:",r=this.configuration_.api||i.FontdeckScript.API;return t+r+this.global_.document.location.hostname+"/"+e+".js"},i.FontdeckScript.prototype.supportUserAgent=function(e,t){var r=this.configuration_.id,o=this;if(r){this.global_[i.FontdeckScript.HOOK]||(this.global_[i.FontdeckScript.HOOK]={}),this.global_[i.FontdeckScript.HOOK][r]=function(e,r){for(var a=0,i=r.fonts.length;i>a;++a){var n=r.fonts[a];o.fontFamilies_.push(n.name),o.fontVariations_[n.name]=[o.fvd_.compact("font-weight:"+n.weight+";font-style:"+n.style)]}t(e)};var a=this.domHelper_.createScriptSrc(this.getScriptSrc(r));this.domHelper_.insertInto("head",a)}else t(!0)},i.FontdeckScript.prototype.load=function(e){e(this.fontFamilies_,this.fontVariations_)},s.addModule(i.FontdeckScript.NAME,function(e){var o=new i.DomHelper(r);return new i.FontdeckScript(t,o,e)}),i.CustomCss=function(e,t){this.domHelper_=e,this.configuration_=t},i.CustomCss.NAME="custom",i.CustomCss.prototype.load=function(e){for(var t=this.configuration_.urls||[],r=this.configuration_.families||[],o=0,a=t.length;a>o;o++){var i=t[o];this.domHelper_.insertInto("head",this.domHelper_.createCssLink(i))}e(r)},i.CustomCss.prototype.supportUserAgent=function(e,t){return t(e.isSupportingWebFont())},s.addModule(i.CustomCss.NAME,function(e){var t=new i.DomHelper(r);return new i.CustomCss(t,e)}),i.LastResortWebKitFontWatchRunner=function(e,t,r,o,a,n,s,l,u){i.LastResortWebKitFontWatchRunner.superCtor_.call(this,e,t,r,o,a,n,s,l,u),this.webKitLastResortFontSizes_=this.setUpWebKitLastResortFontSizes_(),this.webKitLastResortSizeChange_=!1},i.extendsClass(i.FontWatchRunner,i.LastResortWebKitFontWatchRunner),i.LastResortWebKitFontWatchRunner.METRICS_COMPATIBLE_FONTS={Arimo:!0,Cousine:!0,Tinos:!0},i.LastResortWebKitFontWatchRunner.prototype.setUpWebKitLastResortFontSizes_=function(){var e=["Times New Roman","Arial","Times","Sans","Serif"],t=e.length,r={},o=this.createHiddenElementWithFont_(e[0],!0);r[this.fontSizer_.getWidth(o)]=!0;for(var a=1;t>a;a++){var i=e[a];this.domHelper_.setStyle(o,this.computeStyleString_(i,this.fontDescription_,!0)),r[this.fontSizer_.getWidth(o)]=!0,"4"!=this.fontDescription_[1]&&(this.domHelper_.setStyle(o,this.computeStyleString_(i,this.fontDescription_[0]+"4",!0)),r[this.fontSizer_.getWidth(o)]=!0)}return this.domHelper_.removeElement(o),r},i.LastResortWebKitFontWatchRunner.prototype.check_=function(){var e=this.fontSizer_.getWidth(this.requestedFontA_),t=this.fontSizer_.getWidth(this.requestedFontB_);!this.webKitLastResortSizeChange_&&e==t&&this.webKitLastResortFontSizes_[e]&&(this.webKitLastResortFontSizes_={},this.webKitLastResortFontSizes_[e]=!0,this.webKitLastResortSizeChange_=!0),this.originalSizeA_==e&&this.originalSizeB_==t||this.webKitLastResortFontSizes_[e]||this.webKitLastResortFontSizes_[t]?this.getTime_()-this.started_>=5e3?this.webKitLastResortFontSizes_[e]&&this.webKitLastResortFontSizes_[t]&&i.LastResortWebKitFontWatchRunner.METRICS_COMPATIBLE_FONTS[this.fontFamily_]?this.finish_(this.activeCallback_):this.finish_(this.inactiveCallback_):this.asyncCheck_():this.finish_(this.activeCallback_)},i.FontApiUrlBuilder=function(e){if(e)this.apiUrl_=e;else{var r="https:"==t.location.protocol?"https:":"http:";this.apiUrl_=r+i.FontApiUrlBuilder.DEFAULT_API_URL}this.fontFamilies_=[],this.subsets_=[]},i.FontApiUrlBuilder.DEFAULT_API_URL="//fonts.googleapis.com/css",i.FontApiUrlBuilder.prototype.setFontFamilies=function(e){this.parseFontFamilies_(e)},i.FontApiUrlBuilder.prototype.parseFontFamilies_=function(e){for(var t=e.length,r=0;t>r;r++){var o=e[r].split(":");3==o.length&&this.subsets_.push(o.pop());var a="";2==o.length&&""!=o[1]&&(a=":"),this.fontFamilies_.push(o.join(a))}},i.FontApiUrlBuilder.prototype.webSafe=function(e){return e.replace(/ /g,"+")},i.FontApiUrlBuilder.prototype.build=function(){if(0==this.fontFamilies_.length)throw new Error("No fonts to load !");if(-1!=this.apiUrl_.indexOf("kit="))return this.apiUrl_;for(var e=this.fontFamilies_.length,t=[],r=0;e>r;r++)t.push(this.webSafe(this.fontFamilies_[r]));var o=this.apiUrl_+"?family="+t.join("%7C");return this.subsets_.length>0&&(o+="&subset="+this.subsets_.join(",")),o},i.FontApiParser=function(e){this.fontFamilies_=e,this.parsedFontFamilies_=[],this.variations_={},this.fontTestStrings_={},this.fvd_=new i.FontVariationDescription},i.FontApiParser.VARIATIONS={ultralight:"n2",light:"n3",regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",ul:"n2",l:"n3",r:"n4",b:"n7",i:"i4",bi:"i7"},i.FontApiParser.INT_FONTS={latin:i.FontWatchRunner.DEFAULT_TEST_STRING,cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},i.FontApiParser.prototype.parse=function(){for(var e=this.fontFamilies_.length,t=0;e>t;t++){var r=this.fontFamilies_[t].split(":"),o=r[0].replace(/\+/g," "),a=["n4"];if(r.length>=2){var n=this.parseVariations_(r[1]);if(n.length>0&&(a=n),3==r.length){var s=this.parseSubsets_(r[2]);if(s.length>0){var l=i.FontApiParser.INT_FONTS[s[0]];l&&(this.fontTestStrings_[o]=l)}}}if(!this.fontTestStrings_[o]){var u=i.FontApiParser.INT_FONTS[o];u&&(this.fontTestStrings_[o]=u)}this.parsedFontFamilies_.push(o),this.variations_[o]=a}},i.FontApiParser.prototype.generateFontVariationDescription_=function(e){if(!e.match(/^[\w ]+$/))return"";var t=i.FontApiParser.VARIATIONS[e];if(t)return t;var r=e.match(/^(\d*)(\w*)$/),o=r[1],a=r[2],n=a?a:"n",s=o?o.substr(0,1):"4",l=this.fvd_.expand([n,s].join(""));return l?this.fvd_.compact(l):null},i.FontApiParser.prototype.parseVariations_=function(e){var t=[];if(!e)return t;for(var r=e.split(","),o=r.length,a=0;o>a;a++){var i=r[a],n=this.generateFontVariationDescription_(i);n&&t.push(n)}return t},i.FontApiParser.prototype.parseSubsets_=function(e){var t=[];return e?e.split(","):t},i.FontApiParser.prototype.getFontFamilies=function(){return this.parsedFontFamilies_},i.FontApiParser.prototype.getVariations=function(){return this.variations_},i.FontApiParser.prototype.getFontTestStrings=function(){return this.fontTestStrings_},i.GoogleFontApi=function(e,t,r){this.userAgent_=e,this.domHelper_=t,this.configuration_=r},i.GoogleFontApi.NAME="google",i.GoogleFontApi.prototype.supportUserAgent=function(e,t){t(e.isSupportingWebFont())},i.GoogleFontApi.prototype.getFontWatchRunnerCtor=function(){return"AppleWebKit"==this.userAgent_.getEngine()?i.LastResortWebKitFontWatchRunner:i.FontWatchRunner},i.GoogleFontApi.prototype.load=function(e){var t=this.domHelper_,r="MSIE"==this.userAgent_.getName()&&1!=this.configuration_.blocking;r?t.whenBodyExists(i.bind(this,this.insertLink_,e)):this.insertLink_(e)},i.GoogleFontApi.prototype.insertLink_=function(e){var t=this.domHelper_,r=new i.FontApiUrlBuilder(this.configuration_.api),o=this.configuration_.families;r.setFontFamilies(o);var a=new i.FontApiParser(o);a.parse(),t.insertInto("head",t.createCssLink(r.build())),e(a.getFontFamilies(),a.getVariations(),a.getFontTestStrings())},s.addModule(i.GoogleFontApi.NAME,function(e){var t=new i.UserAgentParser(navigator.userAgent,r),o=t.parse();return new i.GoogleFontApi(o,new i.DomHelper(r),e)}),i.AscenderScript=function(e,t){this.domHelper_=e,this.configuration_=t},i.AscenderScript.NAME="ascender",i.AscenderScript.VARIATIONS={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"},i.AscenderScript.prototype.supportUserAgent=function(e,t){return t(e.isSupportingWebFont())},i.AscenderScript.prototype.load=function(e){var t=this.configuration_.key,o="https:"==r.location.protocol?"https:":"http:",a=o+"//webfonts.fontslive.com/css/"+t+".css";this.domHelper_.insertInto("head",this.domHelper_.createCssLink(a));var i=this.parseFamiliesAndVariations(this.configuration_.families);e(i.families,i.variations)},i.AscenderScript.prototype.parseFamiliesAndVariations=function(e){var t,r,o;t=[],r={};for(var a=0,i=e.length;i>a;a++)o=this.parseFamilyAndVariations(e[a]),t.push(o.family),r[o.family]=o.variations;return{families:t,variations:r}},i.AscenderScript.prototype.parseFamilyAndVariations=function(e){var t,r,o;return o=e.split(":"),t=o[0],r=[],r=o[1]?this.parseVariations(o[1]):["n4"],{family:t,variations:r}},i.AscenderScript.prototype.parseVariations=function(e){for(var t=e.split(","),r=[],o=0,a=t.length;a>o;o++){var n=t[o];if(n){var s=i.AscenderScript.VARIATIONS[n];r.push(s?s:n)}}return r},s.addModule(i.AscenderScript.NAME,function(e){var t=new i.DomHelper(r);return new i.AscenderScript(t,e)}),i.MonotypeScript=function(e,t,r,o,a){this.global_=e,this.userAgent_=t,this.domHelper_=r,this.doc_=o,this.configuration_=a,this.fontFamilies_=[],this.fontVariations_={}},i.MonotypeScript.NAME="monotype",i.MonotypeScript.HOOK="__mti_fntLst",i.MonotypeScript.SCRIPTID="__MonotypeAPIScript__",i.MonotypeScript.prototype.supportUserAgent=function(e,t){var r=this,o=r.configuration_.projectId;if(o){var a=r.domHelper_.createScriptSrc(r.getScriptSrc(o));a.id=i.MonotypeScript.SCRIPTID+o,a.onreadystatechange=function(e){("loaded"===a.readyState||"complete"===a.readyState)&&(a.onreadystatechange=null,a.onload(e))},a.onload=function(a){if(r.global_[i.MonotypeScript.HOOK+o]){var n=r.global_[i.MonotypeScript.HOOK+o]();if(n&&n.length){var s;for(s=0;s<n.length;s++)r.fontFamilies_.push(n[s].fontfamily)}}t(e.isSupportingWebFont())},this.domHelper_.insertInto("head",a)}else t(!0)},i.MonotypeScript.prototype.getScriptSrc=function(e){var t=this.protocol(),r=(this.configuration_.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return t+"//"+r+"/"+e+".js"},i.MonotypeScript.prototype.load=function(e){e(this.fontFamilies_,this.fontVariations_)},i.MonotypeScript.prototype.protocol=function(){var e=["http:","https:"],t=e[0];if(this.doc_&&this.doc_.location&&this.doc_.location.protocol){var r=0;for(r=0;r<e.length;r++)if(this.doc_.location.protocol===e[r])return this.doc_.location.protocol}return t},s.addModule(i.MonotypeScript.NAME,function(e){var o=new i.UserAgentParser(navigator.userAgent,r),a=o.parse(),n=new i.DomHelper(r);return new i.MonotypeScript(t,a,n,r,e)}),i.TypekitScript=function(e,t,r){this.global_=e,this.domHelper_=t,this.configuration_=r,this.fontFamilies_=[],this.fontVariations_={}},i.TypekitScript.NAME="typekit",i.TypekitScript.HOOK="__webfonttypekitmodule__",i.TypekitScript.prototype.getScriptSrc=function(e){var r="https:"==t.location.protocol?"https:":"http:",o=this.configuration_.api||r+"//use.typekit.com";return o+"/"+e+".js"},i.TypekitScript.prototype.supportUserAgent=function(e,t){var r=this.configuration_.id,o=this.configuration_,a=this;if(r){this.global_[i.TypekitScript.HOOK]||(this.global_[i.TypekitScript.HOOK]={}),this.global_[i.TypekitScript.HOOK][r]=function(r){var i=function(e,r,o){a.fontFamilies_=r,a.fontVariations_=o,t(e)};r(e,o,i)};var n=this.domHelper_.createScriptSrc(this.getScriptSrc(r));this.domHelper_.insertInto("head",n)}else t(!0)},i.TypekitScript.prototype.load=function(e){e(this.fontFamilies_,this.fontVariations_)},s.addModule(i.TypekitScript.NAME,function(e){var o=new i.DomHelper(r);return new i.TypekitScript(t,o,e)})},{}],8:[function(e,t,r){function o(e,t,r){function o(e){return(a?/^\d+[A-Za-z]*$/:/^\d+$/).test(e)}var a=r&&r.lexicographical,i=r&&r.zeroExtend,n=e.split("."),s=t.split(".");if(!n.every(o)||!s.every(o))return NaN;if(i){for(;n.length<s.length;)n.push("0");for(;s.length<n.length;)s.push("0")}a||(n=n.map(Number),s=s.map(Number));for(var l=0;l<n.length;++l){if(s.length==l)return 1;if(n[l]!=s[l])return n[l]>s[l]?1:-1}return n.length!=s.length?-1:0}r.versionCompare=o},{}],9:[function(e,r,o){function a(e,t,r){if(!e)return null;for(var o,a=e.minVersion||"0.0.0",i=0,n=e[t].length;n>i;i++)o=r(e[t][i]),c.versionCompare(o,a)>0&&(a=o);return a}function i(e){return a(e,"items",n)}function n(e){return a(e,"processors",s)}function s(e){if(!u.schemasByProcessor)throw"Error: No global schemasByProcessor map";var t,r=u.schemasByProcessor[e.name],o=r.properties,a=r.minVersion||e.minVersion||"0.0.0";for(var i in e.parameters){if(t=l(e.parameters[i],o.parameters.properties[i]),!t)throw"Error: No minVersionNumber found";c.versionCompare(t,a)>0&&(a=t)}return a}function l(e,t){if(!t)throw"Error: Bad schema";var r,o=t.minVersion||"1.0.0";if("array"===t.type){if(t.items.type&&t.items.type instanceof Array){for(var a,i,n=0;n<e.length;n++){a=e[n];for(var s=0;s<t.items.type.length;s++){var u=!0;i=t.items.type[s];for(var d in i.properties)a.hasOwnProperty(d)||(u=!1);if(u)if("undefined"!=typeof a)r=l(a,i),c.versionCompare(r,o)>0&&(o=r);else if(i&&i.required)throw"Missing required property "+a}}return o}if(!t.items.properties)return o;for(var n=0,p=e.length;p>n;n++)r=l(e[n],t.items),c.versionCompare(r,o)>0&&(o=r);return o}if(!t["enum"]||!t.enumMinVersions){if("object"===t.type){for(var h=Object.keys(t.properties),n=0,p=h.length;p>n;n++){var f=t.properties[h[n]];if(!f)throw"Error: No subitem schema";if("undefined"!=typeof e[h[n]])r=l(e[h[n]],f),c.versionCompare(r,o)>0&&(o=r);else if(f&&f.required)throw"Missing required property "+h[n]}return o}return t.minVersion}for(var n=0,p=t.enumMinVersions.length;p>n;n++)if(t["enum"][n]===e)return r=t.enumMinVersions[n],c.versionCompare(r,o)>0&&(o=r),o}var u,c=e("./helpers/version-util");"undefined"!=typeof GLOBAL?u=GLOBAL:"undefined"!=typeof t?u=t:"undefined"!=typeof self&&(u=self),r.exports={getMinPackVersion:i,getMinEffectVersion:n,getMinProcessorVersion:s,getMinParameterVersion:l,versionCompare:c.versionCompare}},{"./helpers/version-util":8}],10:[function(e,t,r){t.exports={Version:e("./../core/MoaVersion"),moaGL:e("../../../platforms/web/dist/moaGL_bundle"),copyProcessor:e("../core/MoaAllocAndCopy"),enhanceProcessor:e("../processors/MoaEnhance"),adjustmentsProcessor:e("../processors/MoaAdjustments"),adjustColorProcessor:e("../processors/MoaAdjustColor"),adjustLightingProcessor:e("../processors/MoaAdjustLighting"),versionerUtil:e("../../../scripts/versioner.js"),MoaResizeProcessor:e("../processors/MoaResize"),MoaliteActionlistEffectProcessorRunning:e("./MoaliteActionlistEffectProcessorRunning"),MoaliteActionlistManager:e("./MoaliteActionlistManager"),MoaliteActionlistGenerator:e("./MoaliteActionlistGenerator"),MoaBlemishState:e("../interactive/MoaBlemishState"),MoaDrawBrushState:e("../interactive/MoaDrawBrushState"),MoaSelectiveBrushState:e("../interactive/MoaSelectiveBrushState"),MoaTiltShiftState:e("../interactive/MoaTiltShiftState"),MoaVignetteToolState:e("../interactive/MoaVignetteToolState"),MoaFrame:e("../processors/MoaFrame")}},{"../../../platforms/web/dist/moaGL_bundle":1,"../../../scripts/versioner.js":9,"../core/MoaAllocAndCopy":34,"../interactive/MoaBlemishState":44,"../interactive/MoaDrawBrushState":50,"../interactive/MoaSelectiveBrushState":60,"../interactive/MoaTiltShiftState":63,"../interactive/MoaVignetteToolState":66,"../processors/MoaAdjustColor":68,"../processors/MoaAdjustLighting":69,"../processors/MoaAdjustments":71,"../processors/MoaEnhance":78,"../processors/MoaFrame":82,"../processors/MoaResize":94,"./../core/MoaVersion":41,"./MoaliteActionlistEffectProcessorRunning":18,"./MoaliteActionlistGenerator":21,"./MoaliteActionlistManager":22}],11:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaAdjustColor");o.runAction=function(e,t,r){if("object"!=typeof e.parameters)return!1;var o=e.parameters;return"number"!=typeof o[a.kSaturation]||"number"!=typeof o[a.kWarmth]||"number"!=typeof o[a.kTint]||"number"!=typeof o[a.kFade]?!1:a.adjustColor(t,o)},t.exports=o},{"../processors/MoaAdjustColor":68}],12:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaAdjustLighting");o.runAction=function(e,t,r){if("object"!=typeof e.parameters)return!1;var o=e.parameters;return"number"!=typeof o[a.kBrightness]||"number"!=typeof o[a.kContrast]||"number"!=typeof o[a.kHighlights]||"number"!=typeof o[a.kShadows]?!1:a.adjustLighting(t,o)},t.exports=o},{"../processors/MoaAdjustLighting":69}],13:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaAdjustments"),i="brightness",n="exposure",s="contrast",l="shadows",u="highlights",c="warmth",d="tint",p="saturation",h="vibrance",f="fade",m=-100,g=100;o.runAction=function(e,t,r){if("object"!=typeof e.parameters)return!1;var o=e.parameters;if("number"!=typeof o[i]||"number"!=typeof o[n]||"number"!=typeof o[s]||"number"!=typeof o[l]||"number"!=typeof o[u]||"number"!=typeof o[c]||"number"!=typeof o[d]||"number"!=typeof o[p]||"number"!=typeof o[h]||"number"!=typeof o[f])return!1;var v={};if(o[i]<m||o[n]<m||o[s]<m||o[l]<m||o[u]<m||o[c]<m||o[d]<m||o[p]<m||o[h]<m||o[f]<m||o[i]>g||o[n]>g||o[s]>g||o[l]>g||o[u]>g||o[c]>g||o[d]>g||o[p]>g||o[h]>g||o[f]>g)return!1;var v={brightness:o[i],exposure:o[n],contrast:o[s],shadows:o[l],highlights:o[u],warmth:o[c],tint:o[d],saturation:o[p],vibrance:o[h],fade:o[f],blendMode:"normal",alpha:1};return a.runAdjustments(t,v)},t.exports=o},{"../processors/MoaAdjustments":71}],14:[function(e,t,r){"use strict";var o={},a=e("../interactive/MoaBlemishState"),i="locations",n="point",s="radius",l="offset",u="color";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var c=e.parameters;if("object"!=typeof c[i])return!1;for(var d=c[i],p=0;p<d.length;p++){var h=d[p];if("object"!=typeof h[n]||"number"!=typeof h[s]||"object"!=typeof h[l]||"object"!=typeof h[u])return!1}for(var f=new a(t),p=0;p<d.length;p++){var h=d[p];f.addPointWithOffsetAndColor(h[n],h[s],h[l],h[u])}return o=f.renderPreview()},t.exports=o},{"../interactive/MoaBlemishState":44}],15:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaResize"),i="cropParams",n="topLeft",s="width",l="aspectRatio",u="size";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var c=e.parameters;if("object"!=typeof c[i])return!1;var d=c[i];if("object"!=typeof d[n]||"number"!=typeof d[s]||"number"!=typeof d[l])return!1;var p=d[n],h=d[s],f=d[l];if(2!=p.length)return!1;if("object"!=typeof c[u])return!1;var m=c[u];return 2!=m.length?!1:(o=a.cropImage(t,p,h,f,r.updateViewDimensions))?("function"==typeof r.updateViewDimensions&&null!=r.updateViewDimensions&&r.updateViewDimensions(m[0],m[1]),o=a.resizeImage(t,m[0],m[1])):!1},t.exports=o},{"../processors/MoaResize":94}],16:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaResize"),i="cropParams",n="topLeft",s="width",l="aspectRatio";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var u=e.parameters;if("object"!=typeof u[i])return!1;var c=u[i];if("object"!=typeof c[n]||"number"!=typeof c[s]||"number"!=typeof c[l])return!1;var d=c[n],p=c[s],h=c[l];return 2!=d.length?!1:o=a.cropImage(t,d,p,h,r.updateViewDimensions)},t.exports=o},{"../processors/MoaResize":94}],17:[function(e,t,r){"use strict";var o=e("../interactive/MoaDrawBrushState"),a={},i=function(e,t){var r=!1;if("object"!=typeof e.parameters)return!1;var a=e.parameters,i=0;if("undefined"==typeof a.strokes)return null;for(var s=a.strokes,i=s.length,l=new o(t,t),u=0;i>u;u++){var c=s[u],d=[];if(!n(c,d))return!1;l.startNewStroke(c.radius,c.color,c.brushMode,c.zoomFactor),l.addPointsToCurrentStroke(d),l.endCurrentStroke()}return r=l.renderPreview()},n=function(e,t){if("number"!=typeof e.radius||"string"!=typeof e.brushMode||"object"!=typeof e.color||"object"!=typeof e.points)return!1;var r=e.color;if("number"!=typeof r.r||"number"!=typeof r.g||"number"!=typeof r.b||"number"!=typeof r.a)return!1;for(var o=e.points,a=0;a<o.length;a++){var i=o[a];if("number"!=typeof i.point[0]||"number"!=typeof i.point[1]||"number"!=typeof i.timeOffset)return!1;t[a]=[i.point[0],i.point[1],i.timeOffset]}return!0};a.runAction=function(e,t,r){return"undefined"==typeof e.name?null:(e.name,i(e,t))},t.exports=a},{"../interactive/MoaDrawBrushState":50}],18:[function(e,t,r){"use strict";var o,a={},i=e("../core/MoaAllocAndCopy"),n=e("../processors/MoaBitmapBlend"),o=e("./MoaliteProclistProcessorRunning"),s="alpha",l="pack",u="item",c="actions",d="processors";a.MLPLLoadEffect=function(e){var t,r,o;return(r=JSON.parse(e))?(t=r.identifier,o=r.processors,t&&o?r:null):null},a.MLPLRunEffect=function(e,t,r){var a,i,n;if(n=!1,a=e.identifier,i=e.processors,!a||!i)return!1;for(var s=0;s<i.length;s++){var l=i[s];if(n=o.MLPLRunProcessor(l,t,r),!n)return!1}return n},a.runAction=function(e,t,r){var o,a=!1;if("object"!=typeof e.parameters)return!1;var i,n=e.parameters;if(i="number"!=typeof n[s]?1:n[s],"undefined"!=typeof n[c])o=n[c];else if("undefined"!=typeof n[d])o=n[d];else{if("undefined"==typeof n[l]||"undefined"==typeof n[u])return!1;var o,f=n[l],m=n[u],g=r.effectJSONProvider(f,m,r.context);if(g&&"string"==typeof g)try{o=JSON.parse(g)}catch(v){return!1}else o=g}return a=t.moaGL?p(t,o,i):h(t,o,i)};var p=function(e,t,r){for(var a=!1,i=0;i<t.length;i++){var n=t[i];if(a=o.MLPLRunProcessor(n,e),!a)return!1}return 1!=r&&e.moaGL.renderBlendWithOriginal(r,1-r),a},h=function(e,t,r){var a,s=!1;if(0===r)return!0;1!=r&&(a=i.copy(e));for(var l=0;l<t.length;l++){var u=t[l];if(s=o.MLPLRunProcessor(u,e),!s)return!1}return 1==r||(s=!1,s=n.blendWithBitmap(e,a,e,"normal",r))?s:!1};t.exports=a},{"../core/MoaAllocAndCopy":34,"../processors/MoaBitmapBlend":72,"./MoaliteProclistProcessorRunning":33}],19:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaEnhance.js");o.runAction=function(e,t,r){if("object"!=typeof e.parameters)return!1;var o=e.parameters;if("undefined"==typeof o.type)return!1;var i=o.type,n=a[i];return"undefined"==typeof n?!1:n(t)},t.exports=o},{"../processors/MoaEnhance.js":78}],20:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaFrame.js"),i="pack",n="item",s="width",l="refBitmapSize",u=["l","r","t","b","tl","tr","bl","br"];o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var c=e.parameters;if("string"!=typeof c[i]||"string"!=typeof c[n]||"number"!=typeof c[s])return!1;var d,p=c[i],h=c[n];if("object"==typeof c[l]){var f=c[l];if(2!=f.length||f[0]<=0||f[1]<=0)return!1;d={width:Math.floor(f[0]),height:Math.floor(f[1])}}else d={width:0,height:0};for(var m={},g=0;g<u.length;g++){var v=u[g];if(m[v]=r.frameSegmentProvider(p,h,v,r.context),"object"!=typeof m[v].data||"number"!=typeof m[v].width||"number"!=typeof m[v].height)return!1}var _=c[s],x=r.renderQuality,w="fastest"===x?"nearest":"linear";return o=a.applyFrame(t,m,_,d,w)},t.exports=o},{"../processors/MoaFrame.js":82}],21:[function(e,t,r){"use strict";function o(e,t){var r={};return r[q]=e,r[Z]=t,r}function a(e,t){var r="string"==typeof e;return r&&"undefined"!=typeof t&&(r=r&&-1!==t.indexOf(e)),r}function i(e,t,r){var o=e.constructor===Array;return"undefined"!=typeof t&&(o=o&&e.length>=t),"undefined"!=typeof r&&(o=o&&e.length<=t),o}function n(e,t,r){return 0>=r?!1:0>=t?!1:e[0]>=0&&e[1]>=0&&e[0]+t<=1}function s(e){if(!i(e,ir,ir))return!1;for(var t=0;t<e.length;t++)if(!p(e[t]))return!1;return e[0]>1||e[1]>1?!1:e[0]+e[2]<0||e[1]+e[3]<0?!1:!0}function l(e){return p(e,lr,ur)}function u(e){return p(e,cr,null,!0,!1)}function c(e){if(!i(e,nr,nr))return!1;for(var t=0;t<e.length;t++)if(!p(e[t]))return!1;return!0}function d(e){if(!i(e,sr,sr))return!1;for(var t=0;t<e.length;t++)if(!h(e[t],0,null,!0))return!1;return!0}function p(e,t,r,o,a){var i="number"==typeof e;return i&&null!==t&&"undefined"!=typeof t&&(i=i&&(o===!0?e>t:e>=t)),i&&null!==r&&"undefined"!=typeof r&&(i=i&&(a===!0?r>e:r>=e)),i}function h(e,t,r,o,a){var i=p(e,t,r,o,a);return i=i&&Math.floor(e)===e}function f(e){return p(e,dr,pr)}function m(e){return e===!0||e===!1}function g(e){if("object"==typeof e)return e;try{return JSON.parse(e)}catch(t){return null}}function v(e){return"object"==typeof e&&e.hasOwnProperty(xt)&&e.hasOwnProperty(wt)}function _(e){var t=[Tr,Sr,Ar],r="object"==typeof e&&e.hasOwnProperty(yr)&&e.hasOwnProperty(br)&&e.hasOwnProperty(Mr)&&e.hasOwnProperty(Cr)&&a(e[yr])&&p(e[br],0,null,!0)&&a(e[Mr],t)&&x(e[Cr]);return r}function x(e){var t="object"==typeof e&&e.hasOwnProperty(tr)&&e.hasOwnProperty(rr)&&e.hasOwnProperty(or)&&e.hasOwnProperty(ar)&&p(e[tr],hr,fr)&&p(e[rr],hr,fr)&&p(e[or],hr,fr)&&p(e[ar],hr,fr);return t}function w(e){var t=[it,at],r="object"==typeof e&&e.hasOwnProperty(Er)&&e.hasOwnProperty(Pr)&&e.hasOwnProperty(Dr)&&u(e[Er])&&a(e[Pr],t)&&i(e[Dr],1);if(r)for(var o=0;o<e[Dr].length;o++)if(!c(e[Dr][o]))return!1;return r}function y(e){var t=[it,at],r="object"==typeof e&&e.hasOwnProperty(Er)&&e.hasOwnProperty(Pr)&&e.hasOwnProperty(Dr)&&e.hasOwnProperty(Fr)&&e.hasOwnProperty(Lr)&&u(e[Er])&&a(e[Pr],t)&&i(e[Dr],1)&&x(e[Fr])&&p(e[Lr],0,null,!0);if(r)for(var o,n=0;n<e[Dr].length;n++){if(o=e[Dr][n],!o.hasOwnProperty(Rr)||!c(o[Rr]))return!1;if(!o.hasOwnProperty(Ir)||!p(o[Ir],0))return!1}return r}function b(e){var t=[it,at,nt],r="object"==typeof e&&e.hasOwnProperty(Er)&&e.hasOwnProperty(Pr)&&e.hasOwnProperty(Dr)&&u(e[Er])&&a(e[Pr],t)&&i(e[Dr],1);if(r&&(r=e.brushMode==nt?e.hasOwnProperty(Fr)&&x(e.color):!e.hasOwnProperty(Fr)),r)for(var o=0;o<e[Dr].length;o++)if(!c(e[Dr][o]))return!1;return r}function M(e){var t="object"==typeof e&&e.hasOwnProperty(ct)&&e.hasOwnProperty(pt)&&e.hasOwnProperty(ut)&&e.hasOwnProperty(dt)&&c(e[ct])&&u(e[pt])&&c(e[ut],1)&&x(e[dt]);return t}function C(e){if(!i(e))return null;var t={};return t[$]=e,t[Y]=X.getVersion(),t}function T(e,t,r,a,i,n,s,l,u,c){var d=-100,h=100,f=p(e,d,h,!1,!1)&&p(t,d,h,!1,!1)&&p(r,d,h,!1,!1)&&p(a,d,h,!1,!1)&&p(i,d,h,!1,!1)&&p(n,d,h,!1,!1)&&p(s,d,h,!1,!1)&&p(l,d,h,!1,!1)&&p(u,d,h,!1,!1)&&p(c,d,h,!1,!1);if(!f)return null;if(0==e&&0==t&&0==r&&0==a&&0==i&&0==n&&0==s&&0==l&&0==u&&0==c)return null;var m={};return m[ye]=e,m[be]=t,m[Me]=r,m[Ce]=a,m[Te]=i,m[Se]=n,m[Ae]=s,m[Ee]=l,m[Pe]=u,m[De]=c,o(K,m)}function S(e,t,r,a){if(!n(e,t,r))return null;if(!d(a))return null;if(a[0]<1||a[1]<1)return null;var i={};i[We]=e,i[Ge]=t,i[je]=r;var s={};return s[Ue]=i,s[Ve]=a,o(re,s)}function A(e,t,r,i){var n=[He,Xe];if(!a(e,n))return null;if(!c(t))return null;if(!p(r))return null;if(!l(i))return null;var s={};return s[ze]=e,s[$e]=t,s[Ye]=r,s[qe]=i,o(_e,s)}function E(e){if(!i(e))return null;for(var t=0;t<e.length;t++)if(!M(e[t]))return null;var r={};return r[lt]=e,o(Q,r)}function P(e,t){var r=[oe,me,J,we,pe];if(!a(e,r))return null;if(!i(t))return null;if(t.length<1&&e!=me)return null;if(e===oe){for(var n=0;n<t.length;n++)if(!y(t[n]))return null}else if(e===me){for(var n=0;n<t.length;n++)if(!b(t[n]))return null}else for(var n=0;n<t.length;n++)if(!w(t[n]))return null;var s={};return s[st]=t,o(e,s)}function D(e,t,r,a){if(!p(e,vr,_r))return null;if(!p(t,vr,_r))return null;if(!p(r,vr,_r))return null;if(!p(a,vr,_r))return null;var i={};return i[$t]=e,i[Yt]=t,i[qt]=r,i[Zt]=a,o(ee,i)}function F(e,t,r){if(!n(e,t,r))return null;var a={};a[We]=e,a[Ge]=t,a[je]=r;var i={};return i[Ue]=a,o(te,i)}function L(e){var t=[Le,Re,Ie,Be,Oe,Ne,ke];if(!a(e,t))return null;var r={};return r[Fe]=e,o(ie,r)}function R(e,t){var r=g(e);if(!r)return null;if(!f(t))return null;var a={};return a[Ft]=r,a[Lt]=t,o(ae,a)}function I(e,t){if(!v(e))return null;if(!f(t))return null;var r={};return r[xt]=e[xt],r[wt]=e[wt],r[Lt]=t,o(ae,r)}function B(e,t,r){if(!v(e))return null;if(!p(t,At,Et))return null;var a={};if(a[xt]=e[xt],a[wt]=e[wt],a[Tt]=t,r){if(!d(r))return null;a[St]=r}return o(ne,a)}function O(e,t,r,a){if(!p(e,xr,wr))return null;if(!p(t,xr,wr))return null;if(!p(r,xr,wr))return null;if(!p(a,xr,wr))return null;var i={};return i[Kt]=e,i[Qt]=t,i[Jt]=r,i[er]=a,o(le,i)}function N(e,t){var r=[K,Q,J,ee,te,oe,ae,ie,ne,le,ue,ce,de,pe,he,fe,me,ge,ve,_e,xe,we];if(!a(t,r))return null;for(var i=0;i<e.length;i++)if("string"!=typeof e[i].name||e[i].name!=t)return null;var n={};return n[Pt]=e,n[Dt]=t,o(se,n)}function k(e,t,r,a){if(!m(e))return null;if(!m(t))return null;if(!l(r))return null;if(!p(a,_t,vt))return null;var i={};return i[ht]=e,i[ft]=t,i[mt]=r,i[gt]=a,o(ue,i)}function U(e,t,r,a){if(!v(e))return null;if(!n(t,r,a))return null;var i={};i[We]=t,i[Ge]=r,i[je]=a;var s={};return s[xt]=e[xt],s[wt]=e[wt],s[Rt]=i,o(ce,s)}function W(e,t,r,i){if(!a(e))return null;if(!a(t))return null;if(!x(r))return null;if(!x(i))return null;var n={};return n[It]=e,n[Bt]=t,n[Ot]=r,n[Nt]=i,o(de,n)}function G(e){if(!d(e))return null;var t={};return t[Ve]=e,o(he,t)}function j(e){if(!p(e,mr,gr))return null;var t={};return t[Xt]=e,o(fe,t)}function V(e,t,r,a,i){if(!v(e))return null;if(!s(t))return null;if(!f(r))return null;if(!l(a))return null;if(!m(i))return null;var n={};return n[xt]=e[xt],n[wt]=e[wt],n[yt]=t,n[Mt]=r,n[bt]=a,n[Ct]=i,o(ge,n)}function z(e,t,r,i,n){if(!a(e))return null;if(!_(t))return null;if(!f(r))return null;if(!c(i))return null;if(!l(n))return null;var s={};return s[kt]=e,s[Ut]=t.fontName,s[Wt]=t.fontSize,s[Gt]=t.alignment,s[Vt]=t.color,s[jt]=r,s[zt]=i,s[Ht]=n,o(ve,s)}function A(e,t,r,i){var n=[He,Xe];if(!a(e,n))return null;if(!c(t))return null;if(!p(r))return null;if(!l(i))return null;var s={};return s[ze]=e,s[$e]=t,s[Ye]=r,s[qe]=i,o(_e,s)}function H(e,t,r,i){var n=[Ke,Qe];if(!a(e,n))return null;if(!s(t))return null;if(!f(r))return null;if(!p(i,rt,ot))return null;var l={};return l[Ze]=e,l[Je]=t,l[et]=r,l[tt]=i,o(xe,l)}var X=e("../core/MoaVersion"),$="actions",Y="version",q="name",Z="parameters",K="adjust",Q="blemish",J="blur",ee="color",te="crop",re="cropAndResize",oe="draw",ae="effect",ie="enhance",ne="frame",se="group",le="lighting",ue="orientation",ce="overlay",de="meme",pe="redeye",he="resize",fe="sharpness",me="splash",ge="sticker",ve="text",_e="focus",xe="vignette",we="whiten",ye="brightness",be="exposure",Me="contrast",Ce="shadows",Te="highlights",Se="saturation",Ae="vibrance",Ee="warmth",Pe="tint",De="fade",Fe="type",Le="hidef",Re="portrait",Ie="food",Be="scenery",Oe="night",Ne="illuminate",ke="colorfix",Ue="cropParams",We="topLeft",Ge="width",je="aspectRatio",Ve="size",ze="mode",He="radial",Xe="linear",$e="center",Ye="radius",qe="angle",Ze="mode",Ke="black",Qe="white",Je="rect",et="alpha",tt="feather",rt=0,ot=1,at="free",it="erase",nt="smart",st="strokes",lt="locations",ut="offset",ct="point",dt="color",pt="radius",ht="flipAroundX",ft="flipAroundY",mt="imageRotation",gt="straightenRotation",vt=45,_t=-45,xt="pack",wt="item",yt="rect",bt="rotation",Mt="alpha",Ct="flip",Tt="width",St="refBitmapSize",At=0,Et=1,Pt="components",Dt="actionType",Ft="processors",Lt="alpha",Rt="cropParams",It="topString",Bt="bottomString",Ot="fillColor",Nt="strokeColor",kt="string",Ut="fontName",Wt="size",Gt="align",jt="alpha",Vt="color",zt="center",Ht="rotation",Xt="amount",$t="saturation",Yt="warmth",qt="fade",Zt="tint",Kt="brightness",Qt="contrast",Jt="highlights",er="shadows",tr="r",rr="g",or="b",ar="a",ir=4,nr=2,sr=2,lr=0,ur=360,cr=0,dr=0,pr=1,hr=0,fr=255,mr=-100,gr=100,vr=-100,_r=100,xr=-100,wr=100,yr="fontName",br="fontSize",Mr="alignment",Cr="color",Tr="left",Sr="center",Ar="right",Er="radius",Pr="brushMode",Dr="points",Fr="color",Lr="zoomFactor",Rr="point",Ir="timeOffset";t.exports={MLPLActionlistWithActions:C,MLPLActionAdjust:T,MLPLActionBlemish:E,MLPLActionBrush:P,MLPLActionColor:D,MLPLActionCrop:F,MLPLActionCropAndResize:S,MLPLActionEffectJSON:R,MLPLActionEffectIdentifier:I,MLPLActionEnhance:L,MLPLActionFrame:B,MLPLActionGroup:N,MLPLActionLighting:O,MLPLActionOrientation:k,MLPLActionOverlay:U,MLPLActionMeme:W,MLPLActionResize:G,MLPLActionSharpness:j,MLPLActionSticker:V,MLPLActionText:z,MLPLActionTiltShift:A,MLPLActionVignette:H}},{"../core/MoaVersion":41}],22:[function(e,t,r){"use strict";var o={},a="name",i="parameters",n="components",s="actionType",l={};l.runAction=function(e,t,r){
if("object"!=typeof e[i])return!1;var o=e[i];if("object"!=typeof o[n])return!1;var a=o[n];if("string"!=typeof o[s])return!1;for(var l=o[s],u=a.length,c=!1,d=0;u>d;d++){var p=a[d];if("string"!=typeof p.name)return!1;if(p.name!=l)return!1}for(var d=0;u>d;d++){var p=a[d];if(c=D(p,t,r),!c)return c}return c};var u=e("./MoaliteActionlistAdjustProcessorRunning"),c=e("./MoaliteActionlistAdjustColorProcessorRunning"),d=e("./MoaliteActionlistAdjustLightingProcessorRunning"),p=e("./MoaliteActionlistBlemishProcessorRunning"),h=e("./MoaliteActionlistCropProcessorRunning"),f=e("./MoaliteActionlistCropAndResizeProcessorRunning"),m=e("./MoaliteActionlistDrawProcessorRunning"),g=e("./MoaliteActionlistEffectProcessorRunning"),v=e("./MoaliteActionlistEnhanceProcessorRunning"),_=e("./MoaliteActionlistFrameProcessorRunning"),x=e("./MoaliteActionlistMemeProcessorRunning"),w=e("./MoaliteActionlistOverlayProcessorRunning"),y=e("./MoaliteActionlistResizeProcessorRunning"),b=e("./MoaliteActionlistStickerProcessorRunning"),M=e("./MoaliteActionlistSharpnessProcessorRunning"),C=e("./MoaliteActionlistTextProcessorRunning"),T=e("./MoaliteActionlistTiltShiftProcessorRunning"),S=e("./MoaliteActionlistVignetteToolProcessorRunning"),A=e("./MoaliteActionlistSelectiveBrushProcessorRunning"),E=e("./MoaliteActionlistOrientationProcessorRunning"),P={adjust:u,blemish:p,blur:A,color:c,crop:h,cropAndResize:f,draw:m,effect:g,enhance:v,focus:T,frame:_,group:l,lighting:d,overlay:w,meme:x,orientation:E,redeye:A,resize:y,sharpness:M,splash:A,sticker:b,text:C,vignette:S,whiten:A};o.MLPLRunActionlistFromJSON=function(e,t,r){var a=this.MLPLLoadActionlist(e);return null==a?null:o.MLPLRunActionlistObject(a,t,r)},o.MLPLLoadActionlist=function(e){var t,r;try{t=JSON.parse(e)}catch(o){return!1}return t?(r=t.actions,r?t:null):null},o.MLPLRunActionlistObject=function(e,t,r){if("undefined"==typeof t)return!1;if("undefined"==typeof e.actions)return!1;var o=e.actions;t.moaGL&&t.moaGL.createEffect();for(var a=0;a<o.length;a++){var i=o[a],n=D(i,t,r);if(!n)return!1}return t.moaGL&&t.moaGL.finalizeEffect(),n},o.MLPLRunAction=function(e,t,r){if("undefined"==typeof t)return!1;if("undefined"==typeof e)return!1;var o=e[a];P[o],t.moaGL&&t.moaGL.createEffect();var i=D(e,t,r);return t.moaGL&&t.moaGL.finalizeEffect(),i};var D=function(e,t,r){var o=e[a],i=P[o];if("undefined"==typeof i)return!1;var n=i.runAction(e,t,r);return n};t.exports=o},{"./MoaliteActionlistAdjustColorProcessorRunning":11,"./MoaliteActionlistAdjustLightingProcessorRunning":12,"./MoaliteActionlistAdjustProcessorRunning":13,"./MoaliteActionlistBlemishProcessorRunning":14,"./MoaliteActionlistCropAndResizeProcessorRunning":15,"./MoaliteActionlistCropProcessorRunning":16,"./MoaliteActionlistDrawProcessorRunning":17,"./MoaliteActionlistEffectProcessorRunning":18,"./MoaliteActionlistEnhanceProcessorRunning":19,"./MoaliteActionlistFrameProcessorRunning":20,"./MoaliteActionlistMemeProcessorRunning":23,"./MoaliteActionlistOrientationProcessorRunning":24,"./MoaliteActionlistOverlayProcessorRunning":25,"./MoaliteActionlistResizeProcessorRunning":26,"./MoaliteActionlistSelectiveBrushProcessorRunning":27,"./MoaliteActionlistSharpnessProcessorRunning":28,"./MoaliteActionlistStickerProcessorRunning":29,"./MoaliteActionlistTextProcessorRunning":30,"./MoaliteActionlistTiltShiftProcessorRunning":31,"./MoaliteActionlistVignetteToolProcessorRunning":32}],23:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaComposite"),i=e("./MoaliteActionlistGenerator"),n="topString",s="bottomString",l=2,u=16,c=2.5,d=3,p="League Gothic",h=.035,f="center",m="upper",g="verticalAlignTop",v="verticalAlignBottom",_="fillColor",x="strokeColor";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var w=e.parameters;if("string"!=typeof w[n]||"string"!=typeof w[s]||"object"!=typeof w[_]||"object"!=typeof w[x])return!1;var y=w[n],b=w[s],M=w[_],C=w[x];if(!i.MLPLActionMeme(b,y,M,C))return!1;var T={width:Math.ceil(t.width-2*l),height:Math.ceil(t.height/d)},S={minimumBitmapSize:T,minimumFontSize:u},A=Math.max(Math.floor(T.height/c),u),E={fontName:p,fontSize:A,outlineRatio:h,outlineColor:C,alignment:f,vAlignment:g,color:M,textCase:m},P=r.renderQuality,D="fastest"===P?"nearest":"linear";if(""!==y){r.hasOwnProperty("textBitmapsProvidedCount")||(r.textBitmapsProvidedCount=0);var F=r.textProvider(y,E,S,r.context,"top");if(r.textBitmapsProvidedCount++,null===F||"object"!=typeof F.data||"number"!=typeof F.width||"number"!=typeof F.height)return!1;var L=[.5,T.height/2/t.height],R=[S.minimumBitmapSize.width/t.width,S.minimumBitmapSize.height/t.height],I=[L[0]-.5*R[0],L[1]-.5*R[1],R[0],R[1]];if(o="nearest"==D?a.compositeBitmapWithoutScalingOrRotation(t,F,I,1):a.compositePremultipliedBitmap(t,F,I,0,!1,D,1),!o)return!1}if(""!==b){r.hasOwnProperty("textBitmapsProvidedCount")||(r.textBitmapsProvidedCount=0),E.vAlignment=v;var B=r.textProvider(b,E,S,r.context,"bottom");if(r.textBitmapsProvidedCount++,null===B||"object"!=typeof B.data||"number"!=typeof B.width||"number"!=typeof B.height)return!1;var O=[.5,1-T.height/2/t.height],N=[S.minimumBitmapSize.width/t.width,S.minimumBitmapSize.height/t.height],k=[O[0]-.5*N[0],O[1]-.5*N[1],N[0],N[1]];if(o="nearest"==D?a.compositeBitmapWithoutScalingOrRotation(t,B,k,1):a.compositePremultipliedBitmap(t,B,k,0,!1,D,1),!o)return!1}return o},t.exports=o},{"../processors/MoaComposite":77,"./MoaliteActionlistGenerator":21}],24:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaResize"),i="flipAroundX",n="flipAroundY",s="imageRotation",l="straightenRotation";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var u=e.parameters;if("boolean"!=typeof u[i]||"boolean"!=typeof u[n]||"number"!=typeof u[s]||"number"!=typeof u[l])return!1;var c=u[i],d=u[n],p=u[s],h=u[l];return p%90!=0?!1:Math.abs(h)>45?!1:o=a.renderOrientation(t,c,d,p,h,r.updateViewDimensions)},t.exports=o},{"../processors/MoaResize":94}],25:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaResize"),i=e("../processors/MoaComposite"),n="pack",s="item",l="cropParams",u="topLeft",c="width",d="aspectRatio";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var p=e.parameters;if("string"!=typeof p[n]||"string"!=typeof p[s]||"undefined"==typeof p[l])return!1;var h=r.contentImageProvider(p[n],p[s],"overlay",r.context),f=r.renderQuality,m="fastest"===f?"nearest":"linear";if("object"!=typeof h||"object"!=typeof h.data||"number"!=typeof h.width||"number"!=typeof h.height)return!1;var g=p[l];if("object"!=typeof g[u]||"number"!=typeof g[c]||"number"!=typeof g[d])return!1;var v=g[u],_=g[c],x=g[d];if(2!=v.length)return!1;var w=[0,0,1,1];return o=a.cropImage(t,v,_,x,r.updateViewDimensions),o&&(o=i.compositePremultipliedBitmapWithResize(t,h,w,0,!1,m,1)),o},t.exports=o},{"../processors/MoaComposite":77,"../processors/MoaResize":94}],26:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaResize.js"),i="size";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var n=e.parameters;if("object"!=typeof n[i])return!1;var s=n[i];return 2!=s.length?!1:("function"==typeof r.updateViewDimensions&&null!=r.updateViewDimensions&&r.updateViewDimensions(s[0],s[1]),o=a.resizeImage(t,s[0],s[1]))},t.exports=o},{"../processors/MoaResize.js":94}],27:[function(e,t,r){"use strict";var o={},a=e("../interactive/MoaSelectiveBrushState"),i=(e("../core/MoaAllocAndCopy"),function(e,t,r){var o=!1,i=0;if("object"!=typeof e.parameters)return!1;var n=e.parameters;if("undefined"==typeof n.strokes)return!1;for(var s=n.strokes,i=s.length,l=new a(t,t,r),u=0;i>u;u++){var c=s[u];if("number"!=typeof c.radius||"string"!=typeof c.brushMode||"object"!=typeof c.points)return!1;l.startNewStroke(c.radius,c.brushMode,c.color),l.addPointsToCurrentStroke(c.points),l.endCurrentStroke()}return o=l.renderPreview()});o.runAction=function(e,t,r){var o=!1;if("undefined"==typeof e.name)return!1;var a=e.name;return o=i(e,t,a)},t.exports=o},{"../core/MoaAllocAndCopy":34,"../interactive/MoaSelectiveBrushState":60}],28:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaSharpen");o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var i=e.parameters;if("number"!=typeof i[a.kAmount])return!1;var n,s,l=i[a.kAmount];return n="number"!=typeof i[a.kAlpha]?1:i[a.kAlpha],s="string"!=typeof i[a.kBlendMode]?"normal":i[a.kBlendMode],o=a.sharpen(t,l,n,s)},t.exports=o},{"../processors/MoaSharpen":96}],29:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaComposite"),i="pack",n="item",s="rect",l="rotation",u="alpha",c="flip";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var d=e.parameters;if("string"!=typeof d[i]||"string"!=typeof d[n]||"undefined"==typeof d[s]||"number"!=typeof d[l]||"number"!=typeof d[u]||"boolean"!=typeof d[c])return!1;var p=r.contentImageProvider(d[i],d[n],"sticker",r.context),h=r.renderQuality,f="fastest"===h?"nearest":"linear";if("object"!=typeof p.data||"number"!=typeof p.width||"number"!=typeof p.height)return!1;var m=d[s];if(4!=m.length)return!1;for(var g=0;g<m.length;g++)if("number"!=typeof m[g])return!1;var v=d[l],_=d[u],x=d[c];return o=a.compositePremultipliedBitmapWithResize(t,p,m,v,x,f,_)},t.exports=o},{"../processors/MoaComposite":77}],30:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaComposite"),i="string",n="fontName",s="size",l="align",u="color",c="rotation",d="center",p="alpha",h="verticalAlignTop";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var f=e.parameters;if("string"!=typeof f[i]||"string"!=typeof f[n]||"number"!=typeof f[s]||"string"!=typeof f[l]||"object"!=typeof f[u]||"number"!=typeof f[c]||"object"!=typeof f[d]||"number"!=typeof f[p])return!1;var m=f[l];if("left"!==m&&"center"!==m&&"right"!==m)return!1;var g=f[u];if("number"!=typeof g.r||"number"!=typeof g.g||"number"!=typeof g.b||"number"!=typeof g.a)return!1;var v=f[d];if("number"!=typeof v[0]||"number"!=typeof v[1])return!1;var _={fontName:f[n],fontSize:f[s]*t.width,outlineRatio:0,outlineColor:{r:0,g:0,b:0,a:0},alignment:m,vAlignment:h,textCase:"normal",color:g},x=r.textProvider(f[i],_,null,r.context);if(null===x||"object"!=typeof x.data||"number"!=typeof x.width||"number"!=typeof x.height)return!1;var w=x.width/t.width,y=x.height/t.height,b=[v[0]-.5*w,v[1]-.5*y,w,y],M=f[c],C=f[p],T=r.renderQuality,S="fastest"===T?"nearest":"linear";return o=a.compositePremultipliedBitmap(t,x,b,M,!1,S,C)},t.exports=o},{"../processors/MoaComposite":77}],31:[function(e,t,r){"use strict";var o={},a=e("../interactive/MoaTiltShiftState"),i="mode",n="center",s="radius",l="angle",u="linear",c="radial";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var d=e.parameters;if("undefined"==typeof e.name||"string"!=typeof d[i]||"object"!=typeof d[n]||"number"!=typeof d[s]||"number"!=typeof d[l])return!1;var p=d[i],h=d[n],f=d[s],m=d[l];if(p!=u&&p!=c)return!1;if(2!=h.length||"number"!=typeof h[0]||"number"!=typeof h[1])return!1;m*=Math.PI/180;var g=new a(t,t);if(p==u)g.renderLinearBlur(h[0],h[1],f,m);else{if(p!=c)return!1;g.renderRadialBlur(h[0],h[1],f)}return o=g.renderPreview()},t.exports=o},{"../interactive/MoaTiltShiftState":63}],32:[function(e,t,r){"use strict";var o={},a=e("../interactive/MoaVignetteToolState"),i="mode",n="rect",s="feather",l="alpha",u="black",c="white";o.runAction=function(e,t,r){var o=!1;if("object"!=typeof e.parameters)return!1;var d=e.parameters;if("undefined"==typeof e.name||"string"!=typeof d[i]||"object"!=typeof d[n]||"number"!=typeof d[s]||"number"!=typeof d[l])return!1;var p=d[i],h=d[n],f=d[s],m=d[l];if(p!=u&&p!=c)return!1;if(4!=h.length)return!1;for(var g=0;4>g;g++)if("number"!=typeof h[g])return!1;var v=new a(t,t);return o=v.applyVignetteTool(h,m,f,p,!1)},t.exports=o},{"../interactive/MoaVignetteToolState":66}],33:[function(e,t,r){(function(){var r,o,a,i,n,s=function(e,t){function r(){this.constructor=e}for(var o in t)l.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},l={}.hasOwnProperty;r=function(e){function t(e,r){t.__super__.constructor.call(this),this.name="Processor Error",this.processorName=r,this.message=e,this.toString=function(){return this.name+": "+this.message+" ("+this.processorName+")"}}return s(t,e),t}(Error),n={},n.original=function(t,r,o,a){var i,n;return n=!1,i=e("../../../src/js/core/MoaAllocAndCopy"),r=i.copy(r),n=!0},n.legacyProcessor=function(t,r,o,a){var i,n,s;return s=!1,n=e("../../../src/js/processors/MoaLegacyProcessors"),i=t.legacyName,r&&r.moaGL&&r.moaGL.glRenderingObjects.readTexture===r.moaGL.glImageData.sourceTexture&&r.moaGL.renderIdentity(),null!=i&&"function"==typeof n[i]&&(n[i](r,o),s=!0),s},n.colorMatrixTransform=function(t,r,o,a){var i=!1,n=e("../../../src/js/processors/MoaColorMatrixTransform"),s=(e("../../../src/js/processors/MoaAdjustments"),t.operations),l=t.blendMode,u=t.alpha;return 0==s.length?!0:(s&&(i=n.runOperations(r,s,l,u)),i)},n.histogramMapping=function(t,o,i,n){var s,l,u;if(u=!1,l=e("../../../src/js/processors/MoaHistogramMapping"),s=t.histMap,!s)throw new r("histMap dne or is not an object.","histogramMapping");return s=a(s),l.fadeMapping(s,i.intensity),l.mapHist(o,s),u=!0},n.vignette=function(t,o,a,i){var n,s,l,u,c,d,p,h,f,m,g,v;switch(g=!1,d=e("../../../src/js/processors/MoaVignette"),n=1e-9,l=t.color,s=t.blendMode,h=t.shape,v=h.vignetteScale,f=h.shapeMode,p=h.scaling,u=h.dx,c=h.dy,m=!1,p){case"average":v=(o.width+o.height)/2*v/(a.intensity+n),m=!1;break;case"max":v=Math.max(o.width,o.height)*v/(a.intensity+n),m=!1;break;case"stretch":v/=a.intensity+n,m=!0;break;default:throw new r("scaling mode "+p+" not defined.","vignette")}return d.vignette(o,v,l.r,l.g,l.b,l.a,s,f,m,u,c),g=!0},n.contrast=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaAdjustmentCurves"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","contrast");return amount=o(u,1,i.intensity),l.contrastCurve(a,amount),s=!0},n.adjustments=function(t,o,a,i){var n,s;if(s=!1,n=e("../../../src/js/processors/legacy/MoaLegacyAdjustments"),"number"!=typeof t.brightness||"number"!=typeof t.contrast||"number"!=typeof t.warmth||"number"!=typeof t.saturation||"string"!=typeof t.blendMode||"number"!=typeof t.alpha)throw new r("value is missing.","adjustments");return s=n.adjustments(o,t)},n.adjustments2=function(t,o,a,i){var n=!1;if(MoaAdjustments2=e("../../../src/js/processors/MoaAdjustments"),"number"!=typeof t.exposure||"number"!=typeof t.brightness||"number"!=typeof t.contrast||"number"!=typeof t.highlights||"number"!=typeof t.shadows||"number"!=typeof t.saturation||"number"!=typeof t.vibrance||"number"!=typeof t.warmth||"number"!=typeof t.tint||"number"!=typeof t.fade||"string"!=typeof t.blendMode||"number"!=typeof t.alpha)throw new r("value is missing.","adjustments");return n=MoaAdjustments2.runAdjustments(o,t)},n.noise=function(t,o,a,i){var n=!1,s=e("../../../src/js/core/rng"),l=e("../../../src/js/processors/MoaNoise"),u=t.intensity;if("number"!=typeof u)throw new r("intensity is missing.","noise");return u*=a.intensity,rng=new s.RNG(a.seed),l.noise(o,u,rng.nextInt()),n=!0},n.blendWithColor=function(t,o,a,i){var n=!1,s=e("../../../src/js/processors/MoaBlendWithColor"),l=t.color,u=t.blendMode;if(u||(u="normal"),alpha=t.alpha,null==l||null==alpha)throw new r("color or alpha param is missing.","blendWithColor");return s.blendWithColor(o,{color:l,blendMode:u,alpha:alpha}),n=!0},n.gamma=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaGamma"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","gamma");return amount=o(u,1,i.intensity),l.gamma(a,amount),s=!0},n.fade=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaFade"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","fade");return amount=o(u,1,i.intensity),l.fade(a,amount),s=!0},n.exposure=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaExposure"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","exposure");var c=o(u,1,i.intensity);return l.exposure(a,c),s=!0},n.shadows=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaShadows"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","shadows");var c=o(u,1,i.intensity);return l.shadows(a,c),s=!0},n.highlights=function(t,a,i,n){var s=!1,l=e("../../../src/js/processors/MoaHighlights"),u=t.value;if("number"!=typeof u)throw new r("value is missing.","highlights");var c=o(u,1,i.intensity);return l.highlights(a,c),s=!0},n.flare=function(t,o,a,i){var n=!1,s=e("../../../src/js/processors/MoaFlare"),l=t.color,u=t.blendMode,c=t.type,d=t.dx,p=t.dy,h=t.dsx,f=t.dsy,m=t.fScale;if("string"!=typeof c||"object"!=typeof l||"string"!=typeof u||"number"!=typeof d||"number"!=typeof p||"number"!=typeof h||"number"!=typeof f||"number"!=typeof m)throw new r("some params are incorrect or missing.","flare");var g=parseFloat(l.a/255);return"fingerFlare"!==c&&(g*=a.intensity),s.flare(o,m,l.r,l.g,l.b,g,c,d,p,h,f,u,a.intensity),n=!0},n.intensityMap=function(t,o,i,n){var s,l,u,c,d,p;if(p=!1,d=e("../../../src/js/processors/MoaIntensityMap"),c=e("../../../src/js/processors/MoaHistogramMapping"),u=null!=t?t.histMap:void 0,l=null!=t?t.blendMode:void 0,s=null!=t?t.alpha:void 0,null==u||null==s)throw new r("histMap or alpha missing or problematic.","intensityMap");return u=a(u),c.fadeMapping(u,null!=i?i.intensity:void 0),d.mapIntensity(o,u,l,s*i.intensity),p=!0},n.sharpness=function(t,o,a,i){var n,s,l,u=!1,c=e("../../../src/js/processors/MoaSharpen");if("number"!=typeof t.amount||null==t.amount)throw new r("amount param is missing.","sharpness");return s=t.amount,n="number"!=typeof t.alpha||null==t.alpha?1:t.alpha,"string"!=typeof t.blendMode||null==t.blendMode||(l=t.blendMode),n*=a.intensity,c.sharpen(o,s,n,l),u=!0},n.gradient=function(t,o,a,i){var n,s,l,u,c,d,p,h,f,m,g,v,_,x,w,y;if(_=!1,f=e("../../../src/js/processors/MoaGradient"),c=t.colors,h=t.opacities,p=t.gradientShape,m=t.scale,w=t.xCenter,y=t.yCenter,l=t.angle,l*=Math.PI/180,s=t.alpha,u=t.blendMode,v=t.vignetteShape||{},t.vignetteShape)switch(n=1e-9,g=v.scaling,x=v.vignetteScale,g){case"average":v.vignetteScale=(o.width+o.height)/2*x/(a.intensity+n),v.stretch=!1;break;case"max":v.vignetteScale=Math.max(o.width,o.height)*x/(a.intensity+n),v.stretch=!1;break;case"stretch":v.vignetteScale=x/(a.intensity+n),v.stretch=!0;break;default:throw new r("scaling mode "+g+" not defined.","vignette")}if(null==c||null==h)throw new r("colors or opacities param is missing.","sharpness");return d={colors:c,opacities:h},f.applyGradient(o,d,p,m,w,y,l,v,u,s),_=!0},n.gradientFlare=function(t,r,o,a){var i,n;return n=!1,i=e("../../../src/js/processors/MoaGradientFlare"),i.gradientFlare(r,t),n=!0},n.gradientMap=function(t,r,o,a){var i,n;return n=!1,i=e("../../../src/js/processors/MoaGradientMap"),i.gradientMap(r,t),n=!0},n.sketch=function(t,r,o,a){var i=e("../../../src/js/processors/MoaSketch"),n=t.canvasColor,s=t.strokeColor;return"number"!=typeof t.radius||"number"!=typeof t.levels||"number"!=typeof t.strokeLength||"number"!=typeof t.saturation||"object"!=typeof s||"object"!=typeof n?!1:(i.runSketch(r,t.radius,t.levels,t.strokeLength,t.saturation,n,s),!0)},n.halftone=function(t,r,o,a){var i,n;return n=!1,i=e("../../../src/js/processors/MoaHalftone"),i.halftone(r,t),n=!0},i=function(e){var t,r,o;for(t=[],r=0,o=e.length;o>r;)t.push(e[r]),r++;return t},a=function(e){return{r:i(e.r),g:i(e.g),b:i(e.b)}},o=function(e,t,r){return null==t&&(t=1),"number"!=typeof r&&(r=1),e*r+1*(1-r)},t.exports={MLPLRunProcessor:function(e,t,o){var a,i,s;if(a=null!=e?e.parameters:void 0,"undefined"==typeof o&&(o={}),"undefined"==typeof o.border&&(o.border=!0),"undefined"==typeof o.intensity&&(o.intensity=1),"undefined"==typeof o.seed&&(o.seed=0),i=n[e.name],"undefined"!=typeof i)s=i(a,t,o);else{if(null==i)throw new r("unrecognized processor");try{s=i(a,t,o)}catch(l){}}return s}}}).call(this)},{"../../../src/js/core/MoaAllocAndCopy":34,"../../../src/js/core/rng":42,"../../../src/js/processors/MoaAdjustmentCurves":70,"../../../src/js/processors/MoaAdjustments":71,"../../../src/js/processors/MoaBlendWithColor":73,"../../../src/js/processors/MoaColorMatrixTransform":76,"../../../src/js/processors/MoaExposure":79,"../../../src/js/processors/MoaFade":80,"../../../src/js/processors/MoaFlare":81,"../../../src/js/processors/MoaGamma":83,"../../../src/js/processors/MoaGradient":84,"../../../src/js/processors/MoaGradientFlare":85,"../../../src/js/processors/MoaGradientMap":86,"../../../src/js/processors/MoaHalftone":87,"../../../src/js/processors/MoaHighlights":88,"../../../src/js/processors/MoaHistogramMapping":90,"../../../src/js/processors/MoaIntensityMap":91,"../../../src/js/processors/MoaLegacyProcessors":92,"../../../src/js/processors/MoaNoise":93,"../../../src/js/processors/MoaShadows":95,"../../../src/js/processors/MoaSharpen":96,"../../../src/js/processors/MoaSketch":97,"../../../src/js/processors/MoaVignette":98,"../../../src/js/processors/legacy/MoaLegacyAdjustments":99}],34:[function(e,t,o){function a(e){try{var t=r.createElement("canvas"),o=t.getContext("2d"),a=o.getImageData(0,0,1,Math.ceil(e/4));return a.data}catch(i){return new Array(e)}}var i={};i.copy=function(e){var t={};return t.width=e.width,t.height=e.height,e.moaGL?(t.moaGL=e.moaGL,e.moaGL.renderIdentity(),t):("undefined"!=typeof Uint8ClampedArray?t.data=new Uint8ClampedArray(e.data.length):t.data=a(e.data.length),i.copyTo(t,e))},i.copyTo=function(e,t){if("undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof ImageData&&Uint8ClampedArray.prototype.set&&t instanceof ImageData&&e instanceof ImageData)return e.data.set(t),e;for(var r=t.data.length,o=0;r>o;o+=4)e.data[o]=t.data[o],e.data[o+1]=t.data[o+1],e.data[o+2]=t.data[o+2],e.data[o+3]=t.data[o+3];return e},i.copyBitmapSubsection=function(e,t,r,o,a,i){var n=e.width,s=e.height,l=t.width,u=t.height;if(0>r||0>o||a>l-1||i>u-1)return!1;if(n!=a-r+1||s!=i-o+1)return!1;for(var c=e.data,d=t.data,p=0;s>p;p++)for(var h=0;n>h;h++){var f=4*(p*n+h),m=4*((o+p)*l+r+h);c[f]=d[m],c[f+1]=d[m+1],c[f+2]=d[m+2],c[f+3]=d[m+3]}return!0},i.makeData=function(e){var t;return t="undefined"!=typeof Uint8ClampedArray?new Uint8ClampedArray(e):a(e)},i.makeUint8Array=function(e){var t;return t="undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)},i.makeBitmap=function(e,t){var r={},o=4*e*t;return"undefined"!=typeof Uint8ClampedArray?r.data=new Uint8ClampedArray(o):r.data=a(o),r.width=e,r.height=t,r},t.exports=i},{}],35:[function(e,t,r){"use strict";var o={};o.convertToPremultiplied=function(e){if(null==e.moaGL)for(var t=e.data,r=0;r<e.height;r++)for(var o=0;o<e.width;o++){var a=4*(r*e.width+o),i=t[a+3]/255;t[a]*=i,t[a+1]*=i,t[a+2]*=i}},t.exports=o},{}],36:[function(e,t,r){"use strict";function o(e,t,r,o){this.r=e,this.g=t,this.b=r,this.a=o}function i(e,t,r){e/=255,t/=255,r/=255;var o,a,i,n=Math.max(e,t,r),s=Math.min(e,t,r),l=n-s;if(i=(n+s)/2,0==l)o=0,a=0;else{switch(a=i>.5?l/(2-n-s):l/(n+s),n){case e:o=(t-r)/l+(r>t?6:0);break;case t:o=(r-e)/l+2;break;case r:o=(e-t)/l+4}o/=6}return[o,a,i]}function n(e,t,r){var o,a,i,n=6*e,s=r>.5?2*t*(1-r):2*t*r,l=s*(1-Math.abs(n%2-1));1>n?(o=s,a=l,i=0):2>n?(o=l,a=s,i=0):3>n?(o=0,a=s,i=l):4>n?(o=0,a=l,i=s):5>n?(o=l,a=0,i=s):6>=n&&(o=s,a=0,i=l);var u=r-.5*s;return o+=u,a+=u,i+=u,o=255*o+.5|0,a=255*a+.5|0,i=255*i+.5|0,[o,a,i]}var s=e("./MoaAllocAndCopy"),l=e("./MoaEnums"),u=l.BLEND_MODES;o.prototype.setARGB=function(e,t,r,o){this.r=t,this.g=r,this.b=o,this.a=e},o.prototype.setRGB=function(e,t,r){this.r=e,this.g=t,this.b=r,this.a=255},o.prototype.copy=function(e){this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a},o.prototype.isEqual=function(e){return this.r!=e.r||this.g!=e.g||this.b!=e.b||this.a!=e.a?!1:!0},o.prototype.blendEmbededAlphaFromArray=function(e,t,r,o){var i,n,s,l=e[t],c=e[t+1],d=e[t+2],p=r.r,h=r.g,f=r.b,m=r.a;if(0!=m){switch(o){case u.MOA_BLEND_MODE_NORMAL:i=p,n=h,s=f;break;case u.MOA_BLEND_MODE_OVERLAY:i=64>=l?2*l*p/255:l>=192?(65025-2*(255-l)*(255-p))/255:l*l*(510-4*p)/255/255+l*(4*p-255)/255+(255-2*p)/8,n=64>=c?2*c*h/255:c>=192?(65025-2*(255-c)*(255-h))/255:c*c*(510-4*h)/255/255+c*(4*h-255)/255+(255-2*h)/8,s=64>=d?2*d*f/255:d>=192?(65025-2*(255-d)*(255-f))/255:d*d*(510-4*f)/255/255+d*(4*f-255)/255+(255-2*f)/8;break;case u.MOA_BLEND_MODE_COLOR:return void this.colorBlendColorFromArrayEmbeddedAlpha(e,t,r);case u.MOA_BLEND_MODE_SCREEN:i=(65025-(255-l)*(255-p))/255,n=(65025-(255-c)*(255-h))/255,s=(65025-(255-d)*(255-f))/255;break;case u.MOA_BLEND_MODE_DARKEN:i=p>l?l:p,n=h>c?c:h,s=f>d?d:f;break;case u.MOA_BLEND_MODE_MULTIPLY:i=l*p/255,n=c*h/255,s=d*f/255;break;case u.MOA_BLEND_MODE_SOFT:i=(2*l*p+l*l-2*l*l*p/255)/255,n=(2*c*h+c*c-2*c*c*h/255)/255,s=(2*d*f+d*d-2*d*d*f/255)/255;break;case u.MOA_BLEND_MODE_LIGHTEN:i=l>p?l:p,n=c>h?c:h,s=d>f?d:f;break;case u.MOA_BLEND_MODE_DIFFERENCE:i=l>p?l-p:p-l,n=c>h?c-h:h-c,s=d>f?d-f:f-d;break;case u.MOA_BLEND_MODE_NEGATION:i=255-(0>255-l-p?-(255-l-p):255-l-p),n=255-(0>255-c-h?-(255-c-h):255-c-h),s=255-(0>255-d-f?-(255-d-f):255-d-f);break;case u.MOA_BLEND_MODE_EXCLUSION:i=l+p-2*l*p/255,n=c+h-2*c*h/255,s=d+f-2*d*f/255;break;case u.MOA_BLEND_MODE_HARD:i=(127>p?2*l*p:65025-2*(255-l)*(255-p))/255,n=(127>h?2*c*h:65025-2*(255-c)*(255-h))/255,s=(127>f?2*d*f:65025-2*(255-d)*(255-f))/255;break;case u.MOA_BLEND_MODE_RED:i=p,n=c,s=d;break;case u.MOA_BLEND_MODE_GREEN:i=l,n=h,s=d;break;case u.MOA_BLEND_MODE_BLUE:i=l,n=c,s=f;break;case u.MOA_BLEND_MODE_INTERPOLATION:return void MoaColorBlendInterpolationEmbededAlpha(a,b);case u.MOA_BLEND_MODE_COLOR_DODGE:i=l>=255-p?255:255*l/(255-p),n=c>=255-h?255:255*c/(255-h),s=d>=255-f?255:255*d/(255-f);break;case u.MOA_BLEND_MODE_INV_COLOR_DODGE:i=p>=255-l?255:255*p/(255-l),n=h>=255-c?255:255*h/(255-c),s=f>=255-d?255:255*f/(255-d);break;case u.MOA_BLEND_MODE_SOFT_DODGE:i=256>l+p?(255==p?255:255*l/(255-p))/2:255-127*(255-p)/l,n=256>c+h?(255==h?255:255*c/(255-h))/2:255-127*(255-h)/c,s=256>d+f?(255==f?255:255*d/(255-f))/2:255-127*(255-f)/d;break;case u.MOA_BLEND_MODE_COLOR_BURN:i=255-l>=p?0:255-255*(255-l)/p,n=255-c>=h?0:255-255*(255-c)/h,s=255-d>=f?0:255-255*(255-d)/f;break;case u.MOA_BLEND_MODE_INV_COLOR_BURN:i=255-p>=l?0:255-255*(255-p)/l,n=255-h>=c?0:255-255*(255-h)/c,s=255-f>=d?0:255-255*(255-f)/d;break;case u.MOA_BLEND_MODE_SOFT_BURN:i=256>l+p?255==l?255:127*p/(255-l):255-127*(255-l)/p,n=256>c+h?255==c?255:127*h/(255-c):255-127*(255-c)/h,s=256>d+f?255==d?255:127*f/(255-d):255-127*(255-d)/f;break;case u.MOA_BLEND_MODE_ADD:i=l+p>255?255:l+p,n=c+h>255?255:c+h,s=d+f>255?255:d+f;break;case u.MOA_BLEND_MODE_SUBTRACT:i=0>l+p-255?0:l+p-255,n=0>c+h-255?0:c+h-255,s=0>d+f-255?0:d+f-255;break;case u.MOA_BLEND_MODE_STAMP:i=l+2*p>510?255:255>l+2*p?0:l+2*p-255,n=c+2*h>510?255:255>c+2*h?0:c+2*h-255,s=d+2*f>510?255:255>d+2*f?0:d+2*f-255;break;case u.MOA_BLEND_MODE_REFLECT:i=l*l>65025-255*p?255:l*l/(255-p),n=c*c>65025-255*h?255:c*c/(255-h),s=d*d>65025-255*f?255:d*d/(255-f);break;case u.MOA_BLEND_MODE_GLOW:i=p*p>65025-255*l?255:p*p/(255-l),n=h*h>65025-255*c?255:h*h/(255-c),s=f*f>65025-255*d?255:f*f/(255-d);break;case u.MOA_BLEND_MODE_FREEZE:i=(255-l)*(255-l)>=255*p?0:255-(255-l)*(255-l)/p,n=(255-c)*(255-c)>=255*h?0:255-(255-c)*(255-c)/h,s=(255-d)*(255-d)>=255*f?0:255-(255-d)*(255-d)/f;break;case u.MOA_BLEND_MODE_HEAT:i=(255-p)*(255-p)>=255*l?0:255-(255-p)*(255-p)/l,n=(255-h)*(255-h)>=255*c?0:255-(255-h)*(255-h)/c,s=(255-f)*(255-f)>=255*d?0:255-(255-f)*(255-f)/d;break;default:i=0,n=0,s=0}i=0|i,n=0|n,s=0|s,e[t]=(m*i+(255-m)*l)/255|0,e[t+1]=(m*n+(255-m)*c)/255|0,e[t+2]=(m*s+(255-m)*d)/255|0}},o.prototype.generateMoaColorArray=function(e){for(var t=[],r=0;e>r;r++)t[r]=new o;return t},o.prototype.colorBlendColorFromArrayEmbeddedAlpha=function(e,t,r){var o=r.a,a=i(r.r,r.g,r.b),s=e[t],l=e[t+1],u=e[t+2];a[1]*=o/255,a[2]=(.212671*s+.71516*l+.072169*u)/255;var c=n(a[0],a[1],a[2]);e[t]=((255-o)*s+o*c[0])/255|0,e[t+1]=((255-o)*l+o*c[1])/255|0,e[t+2]=((255-o)*u+o*c[2])/255|0},o.prototype.colorBlendColorFromArray=function(e,t,r,o,a){var i,s,l,u,c=e[t],d=e[t+1],p=e[t+2],h=1-a,f=r[0],m=r[1],g=r[2];m*=o/255,g=(.212671*c+.71516*d+.072169*p)/255,i=n(f,m,g),s=h*c+a*i[0],l=h*d+a*i[1],u=h*p+a*i[2],c=0|s,d=0|l,p=0|u,e[t]=c>255?255:0>c?0:c,e[t+1]=d>255?255:0>d?0:d,e[t+2]=p>255?255:0>p?0:p},o.prototype.rgb2graySingleChannel=function(e){for(var t,r,o,a,i,n,l=e.width,u=e.height,c=s.makeData(l*u),d=0;u>d;d++)for(var p=0;l>p;p++)r=d*l+p,t=4*(d*l+p),o=e.data[t],a=e.data[t+1],i=e.data[t+2],n=.3*o+.59*a+.11*i,c[r]=n>255?255:Math.round(n);return c},o.prototype.rgb2hsl=i,o.prototype.hsl2rgb=n,t.exports=o},{"./MoaAllocAndCopy":34,"./MoaEnums":38}],37:[function(e,t,r){"use strict";function o(e,t){this.x=e,this.y=t}o.prototype.translate=function(e,t){this.x+=e,this.y+=t},o.prototype.scale=function(e,t){this.x*=e,this.y*=t},o.prototype.copy=function(){return new o(this.x,this.y)},t.exports={MoaPoint:o}},{}],38:[function(e,t,r){"use strict";var o={MOA_BLEND_MODE_NORMAL:0,MOA_BLEND_MODE_OVERLAY:1,MOA_BLEND_MODE_COLOR:2,MOA_BLEND_MODE_SCREEN:3,MOA_BLEND_MODE_DARKEN:4,MOA_BLEND_MODE_MULTIPLY:5,MOA_BLEND_MODE_SOFT:6,MOA_BLEND_MODE_LIGHTEN:7,MOA_BLEND_MODE_DIFFERENCE:8,MOA_BLEND_MODE_NEGATION:9,MOA_BLEND_MODE_EXCLUSION:10,MOA_BLEND_MODE_HARD:11,MOA_BLEND_MODE_RED:12,MOA_BLEND_MODE_GREEN:13,MOA_BLEND_MODE_BLUE:14,MOA_BLEND_MODE_INTERPOLATION:15,MOA_BLEND_MODE_COLOR_DODGE:16,MOA_BLEND_MODE_INV_COLOR_DODGE:17,MOA_BLEND_MODE_SOFT_DODGE:18,MOA_BLEND_MODE_COLOR_BURN:19,MOA_BLEND_MODE_INV_COLOR_BURN:20,MOA_BLEND_MODE_SOFT_BURN:21,MOA_BLEND_MODE_ADD:22,MOA_BLEND_MODE_SUBTRACT:23,MOA_BLEND_MODE_STAMP:24,MOA_BLEND_MODE_REFLECT:25,MOA_BLEND_MODE_GLOW:26,MOA_BLEND_MODE_FREEZE:27,MOA_BLEND_MODE_HEAT:28,MOA_COMPOSITE_MODE_CLEAR:0,MOA_COMPOSITE_MODE_SRC:1,MOA_COMPOSITE_MODE_DST:2,MOA_COMPOSITE_MODE_SRC_OVER:3,MOA_COMPOSITE_MODE_DST_OVER:4,MOA_COMPOSITE_MODE_SRC_IN:5,MOA_COMPOSITE_MODE_DST_IN:6,MOA_COMPOSITE_MODE_SRC_OUT:7,MOA_COMPOSITE_MODE_DST_OUT:8,MOA_COMPOSITE_MODE_SRC_ATOP:9,MOA_COMPOSITE_MODE_DST_ATOP:10,MOA_COMPOSITE_MODE_XOR:11,MOA_ASPECT_MODE_STRETCH:0,MOA_ASPECT_MODE_AVERAGE:1,MOA_ASPECT_MODE_FIT:2,MOA_ASPECT_MODE_FILL:3,MOA_SHAPE_MODE_IDENTITY:0,MOA_SHAPE_MODE_LINE:1,MOA_SHAPE_MODE_CIRCLE:2,MOA_SHAPE_MODE_GAUSSIAN:3,MOA_SHAPE_MODE_SQUARE:4,MOA_SHAPE_MODE_SQUARE_ROUND:5,MOA_SHAPE_MODE_STARDOM:6,MOA_SHAPE_MODE_LOBES:7,MOA_SHAPE_MODE_RING_LOBES:8,MOA_SHAPE_MODE_HEART:9,MOA_SHAPE_MODE_STAR:10,MOA_SHAPE_MODE_CRESCENT:11,MOA_SHAPE_MODE_SQUIGGLY:12,MOA_SHAPE_MODE_ZIGZAG:13,MOA_SHAPE_MODE_SPIRAL:14};o.getAspectModeIndex=function(e){return"stretch"===e?o.MOA_ASPECT_MODE_STRETCH:"average"===e?o.MOA_ASPECT_MODE_AVERAGE:"fit"===e?o.MOA_ASPECT_MODE_FIT:"fill"===e?o.MOA_ASPECT_MODE_FILL:-1},o.getShapeModeIndex=function(e){return"line"===e?o.MOA_SHAPE_MODE_LINE:"circle"===e?o.MOA_SHAPE_MODE_CIRCLE:"gaussian"===e?o.MOA_SHAPE_MODE_GAUSSIAN:"square"===e?o.MOA_SHAPE_MODE_SQUARE:"squareRound"===e?o.MOA_SHAPE_MODE_SQUARE_ROUND:"stardom"===e?o.MOA_SHAPE_MODE_STARDOM:"lobes"===e?o.MOA_SHAPE_MODE_LOBES:"ringLobes"===e?o.MOA_SHAPE_MODE_RING_LOBES:"heart"===e?o.MOA_SHAPE_MODE_HEART:"star"===e?o.MOA_SHAPE_MODE_STAR:"crescent"===e?o.MOA_SHAPE_MODE_CRESCENT:"squiggly"===e?o.MOA_SHAPE_MODE_SQUIGGLY:"zigzag"===e?o.MOA_SHAPE_MODE_ZIGZAG:"spiral"===e?o.MOA_SHAPE_MODE_SPIRAL:-1},o.getBlendModeIndex=function(e){return"normal"==e?o.MOA_BLEND_MODE_NORMAL:"overlay"==e?o.MOA_BLEND_MODE_OVERLAY:"color"==e?o.MOA_BLEND_MODE_COLOR:"screen"==e?o.MOA_BLEND_MODE_SCREEN:"darken"==e?o.MOA_BLEND_MODE_DARKEN:"multiply"==e?o.MOA_BLEND_MODE_MULTIPLY:"soft"==e?o.MOA_BLEND_MODE_SOFT:"lighten"==e?o.MOA_BLEND_MODE_LIGHTEN:"difference"==e?o.MOA_BLEND_MODE_DIFFERENCE:"negation"==e?o.MOA_BLEND_MODE_NEGATION:"exclusion"==e?o.MOA_BLEND_MODE_EXCLUSION:"hard"==e?o.MOA_BLEND_MODE_HARD:"red"==e?o.MOA_BLEND_MODE_RED:"green"==e?o.MOA_BLEND_MODE_GREEN:"blue"==e?o.MOA_BLEND_MODE_BLUE:"interpolation"==e?o.MOA_BLEND_MODE_INTERPOLATION:"colordodge"==e?o.MOA_BLEND_MODE_COLOR_DODGE:"invcolordodge"==e?o.MOA_BLEND_MODE_INV_COLOR_DODGE:"softdodge"==e?o.MOA_BLEND_MODE_SOFT_DODGE:"colorburn"==e?o.MOA_BLEND_MODE_COLOR_BURN:"invcolorburn"==e?o.MOA_BLEND_MODE_INV_COLOR_BURN:"softburn"==e?o.MOA_BLEND_MODE_SOFT_BURN:"add"==e?o.MOA_BLEND_MODE_ADD:"subtract"==e?o.MOA_BLEND_MODE_SUBTRACT:"stamp"==e?o.MOA_BLEND_MODE_STAMP:"reflect"==e?o.MOA_BLEND_MODE_REFLECT:"glow"==e?o.MOA_BLEND_MODE_GLOW:"freeze"==e?o.MOA_BLEND_MODE_FREEZE:"heat"==e?o.MOA_BLEND_MODE_HEAT:-1;
},o.BLEND_MODES={MOA_BLEND_MODE_NORMAL:"normal",MOA_BLEND_MODE_OVERLAY:"overlay",MOA_BLEND_MODE_COLOR:"color",MOA_BLEND_MODE_SCREEN:"screen",MOA_BLEND_MODE_DARKEN:"darken",MOA_BLEND_MODE_MULTIPLY:"multiply",MOA_BLEND_MODE_SOFT:"soft",MOA_BLEND_MODE_LIGHTEN:"lighten",MOA_BLEND_MODE_DIFFERENCE:"difference",MOA_BLEND_MODE_NEGATION:"negation",MOA_BLEND_MODE_EXCLUSION:"exclusion",MOA_BLEND_MODE_HARD:"hard",MOA_BLEND_MODE_RED:"red",MOA_BLEND_MODE_GREEN:"green",MOA_BLEND_MODE_BLUE:"blue",MOA_BLEND_MODE_INTERPOLATION:"interpolation",MOA_BLEND_MODE_COLOR_DODGE:"colordodge",MOA_BLEND_MODE_INV_COLOR_DODGE:"invcolordodge",MOA_BLEND_MODE_SOFT_DODGE:"softdodge",MOA_BLEND_MODE_COLOR_BURN:"colorburn",MOA_BLEND_MODE_INV_COLOR_BURN:"invcolorburn",MOA_BLEND_MODE_SOFT_BURN:"softburn",MOA_BLEND_MODE_ADD:"add",MOA_BLEND_MODE_SUBTRACT:"subtract",MOA_BLEND_MODE_STAMP:"stamp",MOA_BLEND_MODE_REFLECT:"reflect",MOA_BLEND_MODE_GLOW:"glow",MOA_BLEND_MODE_FREEZE:"freeze",MOA_BLEND_MODE_HEAT:"heat"},t.exports=o},{}],39:[function(e,t,r){"use strict";function o(e){this.originalBitmap=e,this.originalWidth=e.width,this.originalHeight=e.height,this.bitmapLevels=[],this.numLevels=0;var t=!0;"undefined"!=typeof e.moaGL&&(this.moaGL=e.moaGL);var r=this.originalWidth,o=this.originalHeight;if(this.moaGL&&!e.data){t=!1,e.data=a.makeUint8Array(4*this.originalWidth*this.originalHeight);var i=this.moaGL.gl;i.bindFramebuffer(i.FRAMEBUFFER,this.moaGL.glRenderingObjects.offscreenFramebuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.moaGL.glImageData.sourceTexture,0),i.readPixels(0,0,this.originalWidth,this.originalHeight,i.RGBA,i.UNSIGNED_BYTE,e.data)}r=this._findNextPowerOfTwo(this.originalWidth)/2,o=this._findNextPowerOfTwo(this.originalHeight)/2;var n=Math.max(r,o);return this.numLevels=this._findNumLevels(n),this._allocateMipmap(r,o),this._fillMipmap(),this.moaGL&&this.moaGL.buildGLMipmap(this,t),this.setWrapMode(this.WRAP_MODES.TransparentOutsideBounds),this.currentSamplingLevel=0,this.sampleBitmap=this.getColorAtLocationOfBitmapLinearLinear,this.sampleOverlay=this.getColorAtLocationOfOverlayLinearLinear,!0}var a=e("./MoaAllocAndCopy"),i=(e("./MoaColor"),1e-4);o.prototype.WRAP_MODES={Repeat:0,ClampToEdge:1,MirroredRepeat:2,TransparentOutsideBounds:3},o.prototype.setSamplingLevel=function(e,t){var r=e/this.originalWidth,o=t/this.originalHeight;if(r>=.5&&o>=.5)this.currentSamplingLevel=0;else{var a=e/this.bitmapLevels[0].width,i=t/this.bitmapLevels[0].height,n=Math.min(a,i);this.currentSamplingLevel=-Math.log(n)/Math.log(2)}this.currentSamplingLevel=this.currentSamplingLevel<0?0:this.currentSamplingLevel},o.prototype.setOverlaySamplingFuncForSamplingMode=function(e){"linearLinear"==e?this.sampleOverlay=o.prototype.getColorAtLocationOfOverlayLinearLinear:"nearestLinear"==e?this.sampleOverlay=o.prototype.getColorAtLocationOfOverlayNearestLinear:"linearNearest"==e?this.sampleOverlay=o.prototype.getColorAtLocationOfOverlayLinearNearest:"nearestNearest"==e?this.sampleOverlay=o.prototype.getColorAtLocationOfOverlayNearestNearest:this.sampleOverlay=null},o.prototype.setBitmapSamplingFuncForSamplingMode=function(e){"linearLinear"==e?this.sampleImage=o.prototype.getColorAtLocationOfBitmapLinearLinear:"nearestLinear"==e?this.sampleImage=o.prototype.getColorAtLocationOfBitmapNearestLinear:"linearNearest"==e?this.sampleImage=o.prototype.getColorAtLocationOfBitmapLinearNearest:"nearestNearest"==e?this.sampleImage=o.prototype.getColorAtLocationOfBitmapNearestNearest:this.sampleImage=null},o.prototype.getBitmapSamplingFuncForSamplingMode=function(e){return"linear"==e?o.prototype.interpolateBilinear:"nearest"==e?o.prototype.sampleNearestNeighbor:void 0},o.prototype.getColorAtLocationOfBitmapLinearLinear=function(e,t,r){if(!this.moaGL)if(0==this.currentSamplingLevel){var o=(this.originalBitmap.width-1)*e,a=(this.originalBitmap.height-1)*t;this.interpolateBilinear(this.originalBitmap,o,a,r)}else{var i=this.currentSamplingLevel,n=Math.floor(i),s=n+1;n>this.numLevels-1&&(n=this.numLevels-1),s>this.numLevels-1&&(s=this.numLevels-1);var l=i-n,u=1-l,c=(this.bitmapLevels[n].width-1)*e,d=(this.bitmapLevels[n].height-1)*t,p=(this.bitmapLevels[s].width-1)*e,h=(this.bitmapLevels[s].height-1)*t,f={r:0,g:0,b:0,a:0},m={r:0,g:0,b:0,a:0};this.interpolateBilinear(this.bitmapLevels[n],c,d,f),this.interpolateBilinear(this.bitmapLevels[s],p,h,m),rFinal=l*m.r+u*f.r,gFinal=l*m.g+u*f.g,bFinal=l*m.b+u*f.b,aFinal=l*m.a+u*f.a,r.r=rFinal+.5|0,r.g=gFinal+.5|0,r.b=bFinal+.5|0,r.a=aFinal+.5|0}},o.prototype.getColorAtLocationOfBitmapNearestLinear=function(e,t,r){if(!this.moaGL)if(0==this.currentSamplingLevel){var o=(this.originalBitmap.width-1)*e,a=(this.originalBitmap.height-1)*t;this.sampleNearestNeighbor(this.originalBitmap,o,a,r)}else{var i=this.currentSamplingLevel,n=Math.floor(i),s=n+1;n>this.numLevels-1&&(n=this.numLevels-1),s>this.numLevels-1&&(s=this.numLevels-1);var l=i-n,u=1-l,c=(this.bitmapLevels[n].width-1)*e,d=(this.bitmapLevels[n].height-1)*t,p=(this.bitmapLevels[s].width-1)*e,h=(this.bitmapLevels[s].height-1)*t,f={r:0,g:0,b:0,a:0},m={r:0,g:0,b:0,a:0};this.sampleNearestNeighbor(this.bitmapLevels[n],c,d,f),this.sampleNearestNeighbor(this.bitmapLevels[s],p,h,m),rFinal=l*m.r+u*f.r,gFinal=l*m.g+u*f.g,bFinal=l*m.b+u*f.b,aFinal=l*m.a+u*f.a,r.r=rFinal+.5|0,r.g=gFinal+.5|0,r.b=bFinal+.5|0,r.a=aFinal+.5|0}},o.prototype.getColorAtLocationOfBitmapLinearNearest=function(e,t,r){if(!this.moaGL){var o=this.currentSamplingLevel,a=o+.5|0;a>this.numLevels-1&&(a=this.numLevels-1);var i=(this.bitmapLevels[a].width-1)*e,n=(this.bitmapLevels[a].height-1)*t;this.interpolateBilinear(this.bitmapLevels[a],i,n,r)}},o.prototype.getColorAtLocationOfBitmapNearestNearest=function(e,t,r){if(!this.moaGL){var o=this.currentSamplingLevel,a=o+.5|0;a>this.numLevels-1&&(a=this.numLevels-1);var i=(this.bitmapLevels[a].width-1)*e,n=(this.bitmapLevels[a].height-1)*t;this.sampleNearestNeighbor(this.bitmapLevels[a],i,n,r)}},o.prototype.getColorAtLocationOfOverlayLinearLinear=function(e,t,r){if(!this.moaGL)if(0==this.currentSamplingLevel){var o=this.originalBitmap.width*e-.5,a=this.originalBitmap.height*t-.5;this.interpolateBilinear(this.originalBitmap,o,a,r)}else{var i=this.currentSamplingLevel,n=0|i,s=n+1;n>this.numLevels-1&&(n=this.numLevels-1),s>this.numLevels-1&&(s=this.numLevels-1);var l=i-n,u=1-l,c=this.bitmapLevels[n].width*e-.5,d=this.bitmapLevels[n].height*t-.5,p=this.bitmapLevels[s].width*e-.5,h=this.bitmapLevels[s].height*t-.5,f={r:0,g:0,b:0,a:0},m={r:0,g:0,b:0,a:0};this.interpolateBilinear(this.bitmapLevels[n],c,d,f),this.interpolateBilinear(this.bitmapLevels[s],p,h,m);var g=f.a/255,v=m.a/255,_=l*v*m.r+u*g*f.r,x=l*v*m.g+u*g*f.g,w=l*v*m.b+u*g*f.b,y=l*m.a+u*f.a,b=y/255;b=0>=b?1:b,_/=b,x/=b,w/=b,r.r=_+.5|0,r.g=x+.5|0,r.b=w+.5|0,r.a=y+.5|0}},o.prototype.getColorAtLocationOfOverlayNearestLinear=function(e,t,r){if(!this.moaGL)if(0==this.currentSamplingLevel){var o=this.originalBitmap.width*e-.5,a=this.originalBitmap.height*t-.5;this.sampleNearestNeighbor(this.originalBitmap,o,a,r)}else{var i=this.currentSamplingLevel,n=0|i,s=n+1;n>this.numLevels-1&&(n=this.numLevels-1),s>this.numLevels-1&&(s=this.numLevels-1);var l=i-n,u=1-l,c=this.bitmapLevels[n].width*e-.5,d=this.bitmapLevels[n].height*t-.5,p=this.bitmapLevels[s].width*e-.5,h=this.bitmapLevels[s].height*t-.5,f={r:0,g:0,b:0,a:0},m={r:0,g:0,b:0,a:0};this.sampleNearestNeighbor(this.bitmapLevels[n],c,d,f),this.sampleNearestNeighbor(this.bitmapLevels[s],p,h,m);var g=f.a/255,v=m.a/255,_=l*v*m.r+u*g*f.r,x=l*v*m.g+u*g*f.g,w=l*v*m.b+u*g*f.b,y=l*m.a+u*f.a,b=y/255;b=0>=b?1:b,_/=b,x/=b,w/=b,r.r=_+.5|0,r.g=x+.5|0,r.b=w+.5|0,r.a=y+.5|0}},o.prototype.getColorAtLocationOfOverlayLinearNearest=function(e,t,r){if(!this.moaGL){var o=this.currentSamplingLevel,a=o+.5|0;a>this.numLevels-1&&(a=this.numLevels-1);var i=this.bitmapLevels[a].width*e-.5,n=this.bitmapLevels[a].height*t-.5;this.interpolateBilinear(this.bitmapLevels[a],i,n,r)}},o.prototype.getColorAtLocationOfOverlayNearestNearest=function(e,t,r){if(!this.moaGL){var o=this.currentSamplingLevel,a=o+.5|0;a>this.numLevels-1&&(a=this.numLevels-1);var i=this.bitmapLevels[a].width*e,n=this.bitmapLevels[a].height*t;this.sampleNearestNeighbor(this.bitmapLevels[a],i,n,r)}},o.prototype.sampleNearestNeighbor=function(e,t,r,o){if(-i-.5>t||t>e.width-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);if(-i-.5>r||r>e.height-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);var a=e.data,n=e.width-1,s=e.height-1;t=0>t?0:t>n?n:t,r=0>r?0:r>s?s:r;var l=t+.5|0,u=r+.5|0,c=4*(u*e.width+l);o.r=a[c],o.g=a[c+1],o.b=a[c+2],o.a=a[c+3]},o.prototype.interpolateBilinear=function(e,t,r,o){var a=e.width,n=e.height,s=e.data;if(-i-.5>t||t>a-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);if(-i-.5>r||r>n-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);var l,u,c,d,p,h,f,m,g,v,_,x;t=0>t?0:t>a-1?a-1:t,r=0>r?0:r>n-1?n-1:r;var w=0|t,y=0|r;w=w>a-2?a-2:w,y=y>n-2?n-2:y;var b=y+1,M=t-w,C=r-y,T=1-M,S=1-C,A=4*(y*a+w),E=A+4,P=4*(b*a+w),D=P+4;A=0>A?0:A,E=0>E?0:E;var F,L,R,I,B;F=s[A+3]/255,L=s[E+3]/255,R=s[P+3]/255,I=s[D+3]/255;var O=F*T,N=L*M;l=O*s[A]+N*s[E],u=O*s[A+1]+N*s[E+1],c=O*s[A+2]+N*s[E+2],d=T*s[A+3]+M*s[E+3];var k=R*T,U=I*M;p=k*s[P]+U*s[D],h=k*s[P+1]+U*s[D+1],f=k*s[P+2]+U*s[D+2],m=T*s[P+3]+M*s[D+3],g=S*l+C*p,v=S*u+C*h,_=S*c+C*f,x=S*d+C*m,B=x/255,B=0>=B?1:B,g/=B,v/=B,_/=B,o.r=g+.5|0,o.g=v+.5|0,o.b=_+.5|0,o.a=x+.5|0},o.prototype.interpolateBilinearPremultiplied=function(e,t,r,o){var a=e.width,n=e.height,s=e.data;if(-i-.5>t||t>a-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);if(-i-.5>r||r>n-.5+i)return o.r=0,o.g=0,o.b=0,void(o.a=0);var l,u,c,d,p,h,f,m,g,v,_,x;t=0>t?0:t>a-1?a-1:t,r=0>r?0:r>n-1?n-1:r;var w=0|t,y=0|r;w=w>a-2?a-2:w,y=y>n-2?n-2:y;var b=y+1,M=t-w,C=r-y,T=1-M,S=1-C,A=4*(y*a+w),E=A+4,P=4*(b*a+w),D=P+4;l=T*s[A]+M*s[E],u=T*s[A+1]+M*s[E+1],c=T*s[A+2]+M*s[E+2],d=T*s[A+3]+M*s[E+3],p=T*s[P]+M*s[D],h=T*s[P+1]+M*s[D+1],f=T*s[P+2]+M*s[D+2],m=T*s[P+3]+M*s[D+3],g=S*l+C*p,v=S*u+C*h,_=S*c+C*f,x=S*d+C*m,o.r=g+.5|0,o.g=v+.5|0,o.b=_+.5|0,o.a=x+.5|0},o.prototype.setWrapMode=function(e){if(this.wrapMode=e,this.moaGL){var t=this.moaGL.gl,r=this.moaGL._claimFreeTexture();t.activeTexture(this.moaGL._getTextureForIndex(r)),t.bindTexture(t.TEXTURE_2D,this.mipmapTexture),e==this.WRAP_MODES.Repeat?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):e==this.WRAP_MODES.ClampToEdge?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):e==this.WRAP_MODES.MirroredRepeat?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT)):e==this.WRAP_MODES.TransparentOutsideBounds&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),this.moaGL._resetTextureToFree(r)}},o.prototype.freeMipmap=function(){if(this.moaGL)this.moaGL.destroyTexture(this.originalImageTexture),this.moaGL.destroyTexture(this.mipmapTexture);else for(var e=0;e<this.numLevels;e++)this.bitmapLevels[e]=null};var n=[0,.0003035269835,.0006070539671,.0009105809506,.001214107934,.001517634918,.001821161901,.002124688885,.002428215868,.002731742852,.003035269835,.003346535764,.003676507324,.004024717018,.004391442037,.004776953481,.005181516702,.005605391624,.006048833023,.006512090793,.006995410187,.007499032043,.008023192985,.008568125618,.009134058702,.00972121732,.01032982303,.01096009401,.01161224518,.01228648836,.01298303234,.01370208305,.0144438436,.01520851442,.01599629337,.01680737575,.01764195449,.01850022013,.01938236096,.02028856306,.02121901038,.02217388479,.02315336618,.02415763245,.02518685963,.02624122189,.02732089164,.0284260395,.02955683444,.03071344373,.03189603307,.03310476657,.03433980681,.03560131488,.0368894504,.0382043716,.03954623528,.04091519691,.04231141062,.04373502926,.04518620439,.04666508634,.04817182423,.04970656598,.05126945837,.05286064702,.05448027644,.05612849005,.05780543019,.05951123816,.06124605423,.06301001765,.06480326669,.06662593864,.06847816984,.0703600957,.07227185068,.07421356838,.07618538148,.07818742181,.08021982031,.08228270713,.08437621154,.08650046204,.08865558629,.09084171118,.09305896285,.09530746663,.09758734714,.09989872825,.1022417331,.1046164841,.107023103,.1094617108,.1119324278,.1144353738,.1169706678,.119538428,.1221387722,.1247718176,.1274376804,.1301364767,.1328683216,.1356333297,.138431615,.1412632911,.1441284709,.1470272665,.1499597898,.152926152,.1559264637,.1589608351,.1620293756,.1651321945,.1682694002,.1714411007,.1746474037,.177888416,.1811642442,.1844749945,.1878207723,.1912016827,.1946178304,.1980693196,.2015562538,.2050787364,.2086368701,.2122307574,.2158605001,.2195261997,.2232279573,.2269658735,.2307400485,.2345505822,.2383975738,.2422811225,.2462013267,.2501582847,.2541520943,.2581828529,.2622506575,.2663556048,.270497791,.2746773121,.2788942635,.2831487404,.2874408377,.2917706498,.2961382708,.3005437944,.3049873141,.3094689228,.3139887134,.3185467781,.3231432091,.3277780981,.3324515363,.337163615,.3419144249,.3467040564,.3515325995,.3564001441,.3613067798,.3662525956,.3712376805,.376262123,.3813260114,.3864294338,.3915724777,.3967552307,.4019777798,.4072402119,.4125426135,.4178850708,.42326767,.4286904966,.4341536362,.4396571738,.4452011945,.4507857828,.4564110232,.4620769997,.4677837961,.4735314961,.4793201831,.4851499401,.4910208498,.4969329951,.502886458,.5088813209,.5149176654,.5209955732,.5271151257,.533276404,.539479489,.5457244614,.5520114015,.5583403896,.5647115057,.5711248295,.5775804404,.5840784179,.5906188409,.5972017884,.6038273389,.6104955708,.6172065624,.6239603917,.6307571363,.637596874,.644479682,.6514056374,.6583748173,.6653872983,.672443157,.6795424696,.6866853124,.6938717613,.7011018919,.7083757799,.7156935005,.7230551289,.7304607401,.7379104088,.7454042095,.7529422168,.7605245047,.7681511472,.7758222183,.7835377915,.7912979403,.799102738,.8069522577,.8148465722,.8227857544,.8307698768,.8387990117,.8468732315,.8549926081,.8631572135,.8713671192,.8796223969,.8879231179,.8962693534,.9046611744,.9130986518,.9215818563,.9301108584,.9386857285,.9473065367,.9559733532,.9646862479,.9734452904,.9822505503,.9911020971,1],s=[0,1,2,2,3,4,5,6,6,7,8,9,10,10,11,12,13,13,14,15,15,16,16,17,18,18,19,19,20,20,21,21,22,22,23,23,23,24,24,25,25,25,26,26,27,27,27,28,28,29,29,29,30,30,30,31,31,31,32,32,32,33,33,33,34,34,34,34,35,35,35,36,36,36,37,37,37,37,38,38,38,38,39,39,39,40,40,40,40,41,41,41,41,42,42,42,42,43,43,43,43,43,44,44,44,44,45,45,45,45,46,46,46,46,46,47,47,47,47,48,48,48,48,48,49,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,52,52,53,53,53,53,53,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,61,61,61,61,61,61,62,62,62,62,62,62,63,63,63,63,63,63,64,64,64,64,64,64,64,65,65,65,65,65,65,66,66,66,66,66,66,66,67,67,67,67,67,67,67,68,68,68,68,68,68,68,69,69,69,69,69,69,69,70,70,70,70,70,70,70,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,78,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,89,90,90,90,90,90,90,90,90,90,90,91,91,91,91,91,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,93,93,93,93,93,93,93,93,93,93,94,94,94,94,94,94,94,94,94,94,95,95,95,95,95,95,95,95,95,95,96,96,96,96,96,96,96,96,96,96,96,97,97,97,97,97,97,97,97,97,97,98,98,98,98,98,98,98,98,98,98,98,99,99,99,99,99,99,99,99,99,99,99,100,100,100,100,100,100,100,100,100,100,100,101,101,101,101,101,101,101,101,101,101,101,102,102,102,102,102,102,102,102,102,102,102,103,103,103,103,103,103,103,103,103,103,103,103,104,104,104,104,104,104,104,104,104,104,104,105,105,105,105,105,105,105,105,105,105,105,105,106,106,106,106,106,106,106,106,106,106,106,106,107,107,107,107,107,107,107,107,107,107,107,107,108,108,108,108,108,108,108,108,108,108,108,108,109,109,109,109,109,109,109,109,109,109,109,109,110,110,110,110,110,110,110,110,110,110,110,110,111,111,111,111,111,111,111,111,111,111,111,111,111,112,112,112,112,112,112,112,112,112,112,112,112,113,113,113,113,113,113,113,113,113,113,113,113,113,114,114,114,114,114,114,114,114,114,114,114,114,114,115,115,115,115,115,115,115,115,115,115,115,115,115,116,116,116,116,116,116,116,116,116,116,116,116,116,117,117,117,117,117,117,117,117,117,117,117,117,117,117,118,118,118,118,118,118,118,118,118,118,118,118,118,119,119,119,119,119,119,119,119,119,119,119,119,119,119,120,120,120,120,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,121,121,121,121,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,123,123,123,123,123,123,123,123,123,123,123,123,123,123,124,124,124,124,124,124,124,124,124,124,124,124,124,124,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,126,126,126,126,126,126,126,126,126,126,126,126,126,126,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255];o.prototype._allocateMipmap=function(e,t){var r,o;this.bitmapLevels[0]={width:e,height:t,data:a.makeUint8Array(4*e*t)};for(var i=1;i<this.numLevels;i++)r=Math.ceil(this.bitmapLevels[i-1].width/2),o=Math.ceil(this.bitmapLevels[i-1].height/2),this.bitmapLevels[i]={width:r,height:o,data:a.makeUint8Array(4*r*o)}},o.prototype._fillMipmap=function(){this._fillBaseImage(this.originalBitmap,this.bitmapLevels[0]);for(var e=1;e<this.numLevels;)this._averageAndDownSample(this.bitmapLevels[e],this.bitmapLevels[e-1]),e++},o.prototype._fillBaseImage=function(e,t){if(e.width==2*t.width&&e.height==2*t.height)return void this._averageAndDownSample(t,e);for(var r,o,a,i=t.width,n=t.height,s=(e.width-1)/(t.width-1),l=(e.height-1)/(t.height-1),u={r:0,g:0,b:0,a:0},c=0;n>c;c++)for(var d=0;i>d;d++)r=d*s,o=c*l,a=4*(c*i+d),this.interpolateBilinear(e,r,o,u),t.data[a]=u.r,t.data[a+1]=u.g,t.data[a+2]=u.b,t.data[a+3]=u.a},o.prototype._averageAndDownSample=function(e,t){for(var r,o,a,i,l,u,c,d,p,h,f,m,g,v,_,x=e.width,w=e.height,y=t.width,b=(t.height,0);w>b;b++)for(var M=0;x>M;M++)v=2*M<t.width-1,_=2*b<t.height-1,r=4*(x*b+M),o=4*(2*y*b+2*M),c=n[t.data[o+3]],a=c*n[t.data[o]],i=c*n[t.data[o+1]],l=c*n[t.data[o+2]],u=c,d=1,v&&(o+=4,c=n[t.data[o+3]],a+=c*n[t.data[o]],i+=c*n[t.data[o+1]],l+=c*n[t.data[o+2]],u+=c,d++),_&&(o=4*((2*b+1)*y+2*M),c=n[t.data[o+3]],a+=c*n[t.data[o]],i+=c*n[t.data[o+1]],l+=c*n[t.data[o+2]],u+=c,d++),v&&_&&(o=4*((2*b+1)*y+2*M+1),c=n[t.data[o+3]],a+=c*n[t.data[o]],i+=c*n[t.data[o+1]],l+=c*n[t.data[o+2]],u+=c,d++),d=1/d,a*=d,i*=d,l*=d,u*=d,p=0>=u?1:1/u,a*=p,i*=p,l*=p,h=Math.round(4095*a),f=Math.round(4095*i),m=Math.round(4095*l),g=Math.round(4095*u),e.data[r]=s[h],e.data[r+1]=s[f],e.data[r+2]=s[m],e.data[r+3]=s[g]},o.prototype._findNumLevels=function(e){for(var t=0;e>1;)e=Math.ceil(e/2),t++;return t++,t},o.prototype._findNextPowerOfTwo=function(e){for(var t=1;e>t;)t*=2;return t},o.prototype._applyWrapModeToNormalizedCoordinate=function(e,t){
if(e==this.WRAP_MODES.Repeat)t=t>=0?t-Math.floor(t):t-Math.floor(t)+1;else if(e==this.WRAP_MODES.MirroredRepeat){t=Math.abs(t);var r=Math.floor(t);r%2==0?t-=r:t=1-t+r}else e==this.WRAP_MODES.ClampToEdge&&(t=0>t?0:t>1?1:t);return t},t.exports=o},{"./MoaAllocAndCopy":34,"./MoaColor":36}],40:[function(e,t,r){"use strict";function o(e){"undefined"!=typeof e&&16==e.length?this.copy(e):(this.transformMatrix=new Array(16),this.setIdentity())}var a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];o.prototype.setIdentity=function(){this.copy(a)},o.prototype.copy=function(e){this.transformMatrix=e.slice()},o.prototype.makeCopy=function(){var e=new o(this.transformMatrix);return e},o.prototype.postTransformPoint=function(e){var t=this.transformMatrix,r=e[0],o=e[1],a=0,i=1;e[0]=t[0]*r+t[1]*o+t[2]*a+t[3]*i,e[1]=t[4]*r+t[5]*o+t[6]*a+t[7]*i},o.prototype.postTranslateVec=function(e){var t=new o([1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,e.w]);n(this,t)},o.prototype.preTranslateVec=function(e){var t=new o([1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,e.w]);s(this,t)},o.prototype.postTranslate=function(e,t){var r=new o([1,0,0,e,0,1,0,t,0,0,1,0,0,0,0,1]);n(this,r)},o.prototype.preTranslate=function(e,t){var r=new o([1,0,0,e,0,1,0,t,0,0,1,0,0,0,0,1]);s(this,r)},o.prototype.postRotateX=function(e){var t=new o([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]);n(this,t)},o.prototype.postRotateY=function(e){var t=new o([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1]);n(this,t)},o.prototype.postRotateZ=function(e){var t=new o([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1]);n(this,t)},o.prototype.preRotateX=function(e){var t=new o([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]);s(this,t)},o.prototype.preRotateY=function(e){var t=new o([Math.cos(e),0,Math.sin(e),0,0,1,0,0,-Math.sin(e),0,Math.cos(e),0,0,0,0,1]);s(this,t)},o.prototype.preRotateZ=function(e){var t=new o([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1]);s(this,t)},o.prototype.postShearX=function(e,t){var r=new o([1,0,0,0,e,1,0,0,t,0,1,0,0,0,0,1]);n(this,r)},o.prototype.postShearY=function(e,t){var r=new o([1,e,0,0,0,1,0,0,0,t,1,0,0,0,0,1]);n(this,r)},o.prototype.postShearZ=function(e,t){var r=new o([1,0,e,0,0,1,t,0,0,0,1,0,0,0,0,1]);n(this,r)},o.prototype.preShearX=function(e,t){var r=new o([1,0,0,0,e,1,0,0,t,0,1,0,0,0,0,1]);s(this,r)},o.prototype.preShearY=function(e,t){var r=new o([1,e,0,0,0,1,0,0,0,t,1,0,0,0,0,1]);s(this,r)},o.prototype.preShearZ=function(e,t){var r=new o([1,0,e,0,0,1,t,0,0,0,1,0,0,0,0,1]);s(this,r)},o.prototype.postScaleXY=function(e,t){var r={x:e,y:t,z:1,w:1};l(this,r)},o.prototype.postScale=function(e){this.postScaleXY(e,e)},o.prototype.preScaleXY=function(e,t){var r={x:e,y:t,z:1,w:1};u(this,r)},o.prototype.preScale=function(e){this.preScaleXY(e,e)},o.prototype.getLengthX=function(){var e={x:1,y:0,z:0,w:0};this.rightMultiplyVector(e);var t=Math.sqrt(e.x*e.x+e.y*e.y);return t},o.prototype.getLengthY=function(){var e={x:0,y:1,z:0,w:0};this.rightMultiplyVector(e);var t=Math.sqrt(e.x*e.x+e.y*e.y);return t},o.prototype.rightMultiplyVector=function(e){var t=this.transformMatrix,r=e.x,o=e.y,a=e.z,i=e.w;e.x=t[0]*r+t[1]*o+t[2]*a+t[3]*i,e.y=t[4]*r+t[5]*o+t[6]*a+t[7]*i,e.z=t[8]*r+t[9]*o+t[10]*a+t[11]*i,e.w=t[12]*r+t[13]*o+t[14]*a+t[15]*i},o.prototype.leftMultiplyVector=function(e){var t=this.transformMatrix,r=e.x,o=e.y,a=e.z,i=e.w;e.x=t[0]*r+t[4]*o+t[8]*a+t[12]*i,e.y=t[1]*r+t[5]*o+t[9]*a+t[13]*i,e.z=t[2]*r+t[6]*o+t[10]*a+t[14]*i,e.w=t[3]*r+t[7]*o+t[11]*a+t[15]*i},o.prototype.invert=function(){var e,t=this.transformMatrix,r=[];if(r[0]=t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10],r[4]=-t[4]*t[10]*t[15]+t[4]*t[11]*t[14]+t[8]*t[6]*t[15]-t[8]*t[7]*t[14]-t[12]*t[6]*t[11]+t[12]*t[7]*t[10],r[8]=t[4]*t[9]*t[15]-t[4]*t[11]*t[13]-t[8]*t[5]*t[15]+t[8]*t[7]*t[13]+t[12]*t[5]*t[11]-t[12]*t[7]*t[9],r[12]=-t[4]*t[9]*t[14]+t[4]*t[10]*t[13]+t[8]*t[5]*t[14]-t[8]*t[6]*t[13]-t[12]*t[5]*t[10]+t[12]*t[6]*t[9],r[1]=-t[1]*t[10]*t[15]+t[1]*t[11]*t[14]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10],r[5]=t[0]*t[10]*t[15]-t[0]*t[11]*t[14]-t[8]*t[2]*t[15]+t[8]*t[3]*t[14]+t[12]*t[2]*t[11]-t[12]*t[3]*t[10],r[9]=-t[0]*t[9]*t[15]+t[0]*t[11]*t[13]+t[8]*t[1]*t[15]-t[8]*t[3]*t[13]-t[12]*t[1]*t[11]+t[12]*t[3]*t[9],r[13]=t[0]*t[9]*t[14]-t[0]*t[10]*t[13]-t[8]*t[1]*t[14]+t[8]*t[2]*t[13]+t[12]*t[1]*t[10]-t[12]*t[2]*t[9],r[2]=t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6],r[6]=-t[0]*t[6]*t[15]+t[0]*t[7]*t[14]+t[4]*t[2]*t[15]-t[4]*t[3]*t[14]-t[12]*t[2]*t[7]+t[12]*t[3]*t[6],r[10]=t[0]*t[5]*t[15]-t[0]*t[7]*t[13]-t[4]*t[1]*t[15]+t[4]*t[3]*t[13]+t[12]*t[1]*t[7]-t[12]*t[3]*t[5],r[14]=-t[0]*t[5]*t[14]+t[0]*t[6]*t[13]+t[4]*t[1]*t[14]-t[4]*t[2]*t[13]-t[12]*t[1]*t[6]+t[12]*t[2]*t[5],r[3]=-t[1]*t[6]*t[11]+t[1]*t[7]*t[10]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6],r[7]=t[0]*t[6]*t[11]-t[0]*t[7]*t[10]-t[4]*t[2]*t[11]+t[4]*t[3]*t[10]+t[8]*t[2]*t[7]-t[8]*t[3]*t[6],r[11]=-t[0]*t[5]*t[11]+t[0]*t[7]*t[9]+t[4]*t[1]*t[11]-t[4]*t[3]*t[9]-t[8]*t[1]*t[7]+t[8]*t[3]*t[5],r[15]=t[0]*t[5]*t[10]-t[0]*t[6]*t[9]-t[4]*t[1]*t[10]+t[4]*t[2]*t[9]+t[8]*t[1]*t[6]-t[8]*t[2]*t[5],e=t[0]*r[0]+t[1]*r[4]+t[2]*r[8]+t[3]*r[12],0==e)return!1;e=1/e;for(var o=0;16>o;o++)t[o]=r[o]*e;return!0},o.prototype.print=function(){this.transformMatrix.slice(0,4),this.transformMatrix.slice(4,8),this.transformMatrix.slice(8,12),this.transformMatrix.slice(12,16)};var i=function(e,t,r){var o=e.transformMatrix,a=t.transformMatrix,i=r.transformMatrix;o[0]=a[0]*i[0]+a[1]*i[4]+a[2]*i[8]+a[3]*i[12],o[1]=a[0]*i[1]+a[1]*i[5]+a[2]*i[9]+a[3]*i[13],o[2]=a[0]*i[2]+a[1]*i[6]+a[2]*i[10]+a[3]*i[14],o[3]=a[0]*i[3]+a[1]*i[7]+a[2]*i[11]+a[3]*i[15],o[4]=a[4]*i[0]+a[5]*i[4]+a[6]*i[8]+a[7]*i[12],o[5]=a[4]*i[1]+a[5]*i[5]+a[6]*i[9]+a[7]*i[13],o[6]=a[4]*i[2]+a[5]*i[6]+a[6]*i[10]+a[7]*i[14],o[7]=a[4]*i[3]+a[5]*i[7]+a[6]*i[11]+a[7]*i[15],o[8]=a[8]*i[0]+a[9]*i[4]+a[10]*i[8]+a[11]*i[12],o[9]=a[8]*i[1]+a[9]*i[5]+a[10]*i[9]+a[11]*i[13],o[10]=a[8]*i[2]+a[9]*i[6]+a[10]*i[10]+a[11]*i[14],o[11]=a[8]*i[3]+a[9]*i[7]+a[10]*i[11]+a[11]*i[15],o[12]=a[12]*i[0]+a[13]*i[4]+a[14]*i[8]+a[15]*i[12],o[13]=a[12]*i[1]+a[13]*i[5]+a[14]*i[9]+a[15]*i[13],o[14]=a[12]*i[2]+a[13]*i[6]+a[14]*i[10]+a[15]*i[14],o[15]=a[12]*i[3]+a[13]*i[7]+a[14]*i[11]+a[15]*i[15]},n=function(e,t){var r=new o;r.copy(e.transformMatrix),i(e,r,t)},s=function(e,t){var r=new o;r.copy(e.transformMatrix),i(e,t,r)},l=function(e,t){var r=new o([t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,t.w]);n(e,r)},u=function(e,t){var r=new o([t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,t.w]);s(e,r)};t.exports=o},{}],41:[function(e,t,r){var o=e("./../../../version.json");t.exports={getVersion:function(){return[o.major,o.minor,o.patch].join(".")}}},{"./../../../version.json":102}],42:[function(e,t,r){"use strict";function o(e){"number"==typeof e&&e>=0?this.state=e:this.state=Math.floor(4294967295*Math.random()),this.seed=this.state}var a={};o.prototype.nextInt=function(){return this.state=(69069*this.state+1)%4294967296,this.state},o.prototype.nextIntN=function(e){for(;e>0;)this.state=(69069*this.state+1)%4294967296,e--;return this.state},o.prototype.nextFloat=function(){return this.state=(69069*this.state+1)%4294967296,this.state/4294967296},o.prototype.getState=function(){return this.state},o.prototype.getSeed=function(){return this.seed},o.prototype.nextFloatNormal=function(){for(var e=this.nextFloat(),t=this.nextFloat();0===e;)e=this.nextFloat();for(;0===t;)t=this.nextFloat();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)},o.prototype.nextFloatLaplace=function(){var e=.5-this.nextFloat();return 0>e?Math.log(1+2*e):-Math.log(1-2*e)},a.RNG=o,t.exports=a},{}],43:[function(e,t,r){"use strict";var o={},a=e("../core/MoaAllocAndCopy"),i=e("../processors/MoaSharpen"),n=e("./MoaRegionInfo"),s=70;o.renderBlemishPoint=function(e,t){var r=e.width,o=e.height,l=e.data,u=t.center,c=t.radius,d=t.offset,p=t.skinColor,h=c*r,f=[u[0]*r,u[1]*o],m=!1;if(("undefined"==typeof d||"undefined"==typeof p)&&(m=!0),2*h>r||2*h>o)return!0;var g,v,_=1;m?(g=n.findClosestPatch(e,f,h*_),t.offset=[],t.offset[0]=g[0]/r,t.offset[1]=g[1]/o,v=n.findAvgSkinColor(e,f,h,v),t.skinColor=v):(g=[d[0]*r,d[1]*o],g[0]=0|g[0],g[1]=0|g[1],v=p);var x=Math.min(r-1,Math.max(0,f[0]-h+.5|0)),w=Math.min(o-1,Math.max(0,f[1]-h+.5|0)),y=Math.min(r-1,Math.max(0,f[0]+h+.5|0)),b=Math.min(o-1,Math.max(0,f[1]+h+.5|0)),M=f[0]+g[0]-h+.5|0,C=f[1]+g[1]-h+.5|0,T=f[0]+g[0]+h+.5|0,S=f[1]+g[1]+h+.5|0;if(0>M||0>C||T>r-1||S>o-1)return!0;var A=y-x+1,E=b-w+1,P=T-M+1,D=S-C+1,F=a.makeBitmap(A,E),L=a.makeBitmap(P,D),R=a.makeBitmap(P,D),I=F.data,B=L.data,O=R.data;a.copyBitmapSubsection(F,e,x,w,y,b),a.copyBitmapSubsection(L,e,M,C,T,S),a.copyBitmapSubsection(R,e,M,C,T,S),i.sharpen(F,-s*(r+o)/(A+E)),i.sharpen(R,-s*(r+o)/(P+D));for(var N,k,U,W,G,j,V,z,H,X,$,Y,q,Z,K,Q,J,ee,te,re,oe,ae,ie,ne,se,le=0|f[0],ue=0|f[1],ce=.25*P*D,de=w;b>=de;de++)for(var pe=x;y>=pe;pe++)if(G=pe-le,j=de-ue,W=G*G+j*j,ce>W){V=pe+g[0],z=de+g[1],V=0>V?0:V>r-1?r-1:V,z=0>z?0:z>o-1?o-1:z,H=V-M,X=z-C,H=0>H?0:H>P-1?P-1:H,X=0>X?0:X>D-1?D-1:X,N=4*(de*r+pe),k=4*((de-w)*A+pe-x),U=4*(X*P+H),Z=l[N],K=l[N+1],Q=l[N+2],J=I[k],ee=I[k+1],te=I[k+2],re=B[U],oe=B[U+1],ae=B[U+2],ie=O[U],ne=O[U+1],se=O[U+2];var he=1.15651764275*Math.exp(-2*W/ce)-.13533528323;he=0>he?0:he>1?1:he;var fe=1.01865736036*Math.exp(-4*W/ce)-.01831563888;fe=0>fe?0:fe>1?1:fe;var me=1.25*(.1*(re-ie)+.7*(oe-ne)+.2*(ae-se))|0;$=fe*v.r+(1-fe)*J+me,Y=fe*v.g+(1-fe)*ee+me,q=fe*v.b+(1-fe)*te+me;var ge=1-he;Z=he*$+ge*Z|0,K=he*Y+ge*K|0,Q=he*q+ge*Q|0,l[N]=0>Z?0:Z>255?255:Z,l[N+1]=0>K?0:K>255?255:K,l[N+2]=0>Q?0:Q>255?255:Q}return F.data=null,L.data=null,R.data=null,!0},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaSharpen":96,"./MoaRegionInfo":59}],44:[function(e,t,r){"use strict";function o(e){this.dstBitmap=e,e.moaGL&&(this.moaGL=e.moaGL,this.processedTexture=this.moaGL.createTexture(e.width,e.height),this.moaGL.copyLastRender(this.processedTexture)),this.processedPts=[],this.unprocessedPts=[]}var a=e("./MoaBlemish"),i=e("../actionlist/MoaliteActionlistGenerator");o.prototype.addPoint=function(e,t){this.addPointWithOffsetAndColor(e,t)},o.prototype.addPointWithOffsetAndColor=function(e,t,r,o){var a={center:e,radius:t,offset:r,skinColor:o};this.unprocessedPts=this.unprocessedPts.concat(a)},o.prototype.renderPreview=function(){for(var e=this.unprocessedPts.length,t=0;e>t;t++){var r=this.unprocessedPts[t];this.moaGL?this.moaGL.renderBlemishPoint(this.dstBitmap,r,this.processedTexture):a.renderBlemishPoint(this.dstBitmap,r)}return this.processedPts=this.processedPts.concat(this.unprocessedPts),this.unprocessedPts=[],!0},o.prototype.getActionlistObject=function(){for(var e=this.processedPts.length,t=[],r=0;e>r;r++){var o=this.processedPts[r],a={r:o.skinColor.r,g:o.skinColor.g,b:o.skinColor.b,a:o.skinColor.a},n={point:o.center.slice(),radius:o.radius,offset:o.offset.slice(),color:a};t=t.concat(n)}return i.MLPLActionBlemish(t)},t.exports=o},{"../actionlist/MoaliteActionlistGenerator":21,"./MoaBlemish":43}],45:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaSharpen");e("../core/MoaAllocAndCopy"),o.renderEffect=function(e){a.sharpen(e,-100,1,"normal"),e.moaGL&&(e.textureID=e.moaGL.glRenderingObjects.readTexture)},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaSharpen":96}],46:[function(e,t,r){"use strict";function o(e){this.radius=e,this.pointList=[],this.pointCount=0,this.lastProcessedPoint=0}o.prototype.markAllPointsAsProcessed=function(){this.pointCount>0&&(this.lastProcessedPoint=this.pointCount-1)},o.prototype.addPoints=function(e){this.pointList=this.pointList.concat(e),this.pointCount+=e.length},o.prototype.getUnprocessedPoints=function(){return this.pointList.slice(this.lastProcessedPoint)},o.prototype.getFirstPoint=function(){return this.pointList[0]},o.prototype.getPointCount=function(){return this.pointCount},o.prototype.getRadius=function(){return this.radius},t.exports=o},{}],47:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaColorMatrixTransform");e("../core/MoaAllocAndCopy"),o.renderEffect=function(e){var t=[1,0,0,0,0,1,0,0,0,0,1,0];a.adjSaturation(t,0),a.colorMatrixTransform(e,t),e.moaGL&&(e.textureID=e.moaGL.glRenderingObjects.readTexture)},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaColorMatrixTransform":76}],48:[function(e,t,r){"use strict";function o(e,t,r,o,i){this.radius=e,this.pointList=[],this.pointCount=0,this.lastUnprocessedPoint=0,this.strokeColor=new a,this._convertColorToPremultipliedAndSet(t),this.brushMode=r,this.zoomFactor=o,this.filterer=i}var a=e("../core/MoaColor"),i=e("./MoaDrawBrushStroke"),n=e("./MoaToolDataTypes"),s=n.MoaDrawBrushPoint;o.prototype=new i,o.prototype.addPoints=function(e){for(var t=0;t<e.length;t++){var r=e[t],o=new s(r[0],r[1],r[2],this.radius),a=this.filterer.addPointToStrokeAndFilter(this.pointList,o,this.zoomFactor);a&&this.pointCount++}},o.prototype.endStroke=function(e){this.filterer.endFilteredStroke(this.pointList,e),this.pointCount++},o.prototype._convertColorToPremultipliedAndSet=function(e){this.strokeColor.r=(e.r*e.a|0)/255|0,this.strokeColor.g=(e.g*e.a|0)/255|0,this.strokeColor.b=(e.b*e.a|0)/255|0,this.strokeColor.a=e.a},t.exports=o},{"../core/MoaColor":36,"./MoaDrawBrushStroke":51,"./MoaToolDataTypes":64}],49:[function(e,t,r){"use strict";var o={};o.calcLineEdges=function(e,t,r,o,a){e.x=r.x+o*Math.cos(a),e.y=r.y+o*Math.sin(a),t.x=r.x-o*Math.cos(a),t.y=r.y-o*Math.sin(a)},o.calcLineAntiAliasEdge=function(e,t,r,o){e.x=t.x+r*Math.cos(o),e.y=t.y+r*Math.sin(o)},o.calcMidpoint=function(e,t,r){r.x=.5*(e.x+t.x),r.y=.5*(e.y+t.y),r.radius=.5*(e.radius+t.radius)},o.calcDistance=function(e,t){var r=t.x-e.x,o=t.y-e.y;return Math.sqrt(r*r+o*o)},o.calcAngleTwoPoints=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},t.exports=o},{}],50:[function(e,t,r){"use strict";function o(e,t){this.width=e.width,this.height=e.height,"undefined"!=typeof e.moaGL?this.moaGL=e.moaGL:"undefined"!=typeof t.moaGL&&(this.moaGL=t.moaGL),this.processedStrokes=[],this.unprocessedStrokes=[],this.currentStroke=null,this.processedFilteredStrokes=[],this.unprocessedFilteredStrokes=[],this.currentFilteredStroke=null,this.filterer=new l(e),this.originalBitmap=e,this.previewBitmap=t,this.mask=new u(e),this.mask.initTransparent(),this.brushManager=new s(this.mask),this.moaGL&&(this.copyOfSrcTexture=this.moaGL.createTexture(this.width,this.height),this.moaGL.copyLastRender(this.copyOfSrcTexture)),this._resetBoundingBox()}var a=e("./MoaDrawBrushStroke"),i=e("./MoaDrawBrushFilteredStroke"),n=e("../actionlist/MoaliteActionlistGenerator"),s=e("./MoaDrawNormalBrushManager"),l=e("./MoaDrawNormalBrushFilterer"),u=e("./MoaOverlayMask"),c=e("../core/MoaColor");o.prototype.destroy=function(){this.mask.destroy(),this.moaGL&&(this.moaGL.destroyTexture(this.copyOfSrcTexture),this.moaGL=null),this.processedFilteredStrokes=null,this.unprocessedFilteredStrokes=null,this.currentFilteredStroke=null},o.prototype.startNewStroke=function(e,t,r,o){if(null!==this.currentStroke||null!==this.currentFilteredStroke)return!1;var n;return n="erase"==r?new c(0,0,0,255):new c(t.r,t.g,t.b,t.a),this.currentStroke=new a(e,n,r,o),this.currentFilteredStroke=new i(e*this.width,n,r,o,this.filterer),!0},o.prototype.addPointsToCurrentStroke=function(e){if(null===this.currentStroke||null===this.currentFilteredStroke)return!1;this.currentStroke.addPoints(e);for(var t=[],r=0;r<e.length;r++){var o=e[r].slice();o[0]*=this.width,o[1]*=this.height,t[r]=o}return this.currentFilteredStroke.addPoints(t),!0},o.prototype.endCurrentStroke=function(){if(null===this.currentStroke||null===this.currentFilteredStroke)return!1;var e=this.currentStroke.getLastPoint(),t=e.copy();t.scale(this.width,this.height,this.width),this.currentFilteredStroke.endStroke(t),this.unprocessedStrokes=this.unprocessedStrokes.concat(this.currentStroke),this.unprocessedFilteredStrokes=this.unprocessedFilteredStrokes.concat(this.currentFilteredStroke),this.currentStroke=null,this.currentFilteredStroke=null},o.prototype.renderPreview=function(e){return"boolean"!=typeof e&&(e=!1),this._resetBoundingBox(),this._renderUnprocessedStrokes(),this._compositeImages(e),!0},o.prototype.getActionlistObject=function(){for(var e=[],t=0;t<this.processedStrokes.length;t++)e.push(this.processedStrokes[t].getActionlistObject());return n.MLPLActionBrush("draw",e)},o.prototype._renderUnprocessedStrokes=function(){for(var e=0;e<this.unprocessedFilteredStrokes.length;e++)this.brushManager.renderStroke(this.unprocessedFilteredStrokes[e],this.boundingBox,!0),this.processedFilteredStrokes=this.processedFilteredStrokes.concat(this.unprocessedFilteredStrokes[e]),this.processedStrokes=this.processedStrokes.concat(this.unprocessedStrokes[e]);this.unprocessedFilteredStrokes=[],this.unprocessedStrokes=[],null!==this.currentFilteredStroke&&(this.brushManager.renderStroke(this.currentFilteredStroke,this.boundingBox,!1),this.currentFilteredStroke.markAllPointsAsProcessed(),this.currentStroke.markAllPointsAsProcessed())},o.prototype._resetBoundingBox=function(){this.boundingBox=[1,1,0,0]},o.prototype._updateBoundingBox=function(e,t){e<this.boundingBox[0]&&(this.boundingBox[0]=e),e>this.boundingBox[2]&&(this.boundingBox[2]=e),t<this.boundingBox[1]&&(this.boundingBox[1]=t),t>this.boundingBox[3]&&(this.boundingBox[3]=t)},o.prototype._compositeImages=function(e){if(this.moaGL)return this.moaGL.glRenderingObjects.readTexture==this.moaGL.glImageData.sourceTexture&&this.moaGL.renderIdentity(),void this.moaGL.drawMaskOverOriginalImagePreMultipliedAlpha(this.mask.getTexture(),this.copyOfSrcTexture);var t,r,o,a,i=this.width,n=this.height;e?(t=this.boundingBox[0]*(i-1),r=this.boundingBox[1]*(n-1),o=this.boundingBox[2]*(i-1),a=this.boundingBox[3]*(n-1)):(t=0,r=0,o=i-1,a=n-1),t=0>t?0:t>i-1?i-1:Math.round(t),r=0>r?0:r>n-1?n-1:Math.round(r),o=0>o?0:o>i-1?i-1:Math.round(o),a=0>a?0:a>n-1?n-1:Math.round(a);for(var s,l,u=this.previewBitmap.data,c=this.originalBitmap.data,d=this.mask.data,p=r;a>=p;p++)for(var h=t;o>=h;h++)s=4*(p*i+h),l=d[s+3]/255,u[s]=d[s]+(1-l)*c[s],u[s+1]=d[s+1]+(1-l)*c[s+1],u[s+2]=d[s+2]+(1-l)*c[s+2]},t.exports=o},{"../actionlist/MoaliteActionlistGenerator":21,"../core/MoaColor":36,"./MoaDrawBrushFilteredStroke":48,"./MoaDrawBrushStroke":51,"./MoaDrawNormalBrushFilterer":52,"./MoaDrawNormalBrushManager":53,"./MoaOverlayMask":57}],51:[function(e,t,r){"use strict";function o(e,t,r,o){this.radius=e,this.pointList=[],this.pointCount=0,this.lastProcessedPoint=0,this.strokeColor=t,this.brushMode=r,this.zoomFactor=o}var a=e("./MoaBrushStroke"),i=e("./MoaToolDataTypes"),n=i.MoaDrawBrushPoint;o.prototype=new a,o.prototype.brushModes={MoaBrushModeFree:"free",MoaBrushModeSmart:"smart",MoaBrushModeErase:"erase"},o.prototype.addPoints=function(e){for(var t=0;t<e.length;t++){var r=e[t];this.pointList[this.pointCount]=new n(r[0],r[1],r[2],this.radius),this.pointCount++}},o.prototype.getPointList=function(){return this.pointList},o.prototype.getStartIndex=function(){return this.lastProcessedPoint+1},o.prototype.getLastPoint=function(){return this.pointList[this.pointCount-1]},o.prototype.isEraseStroke=function(){return this.brushMode===this.brushModes.MoaBrushModeErase},o.prototype.getActionlistObject=function(){for(var e=[],t=0;t<this.pointList.length;t++)e.push(this.pointList[t].getActionlistObject());var r={radius:this.radius,brushMode:this.brushMode,points:e,color:this.strokeColor,zoomFactor:this.zoomFactor};return r},t.exports=o},{"./MoaBrushStroke":46,"./MoaToolDataTypes":64}],52:[function(e,t,r){"use strict";function o(e){this.width=e.width,this.height=e.height,this.avgDim=.5*(this.width+this.height),this.kLocationWeight=.675,this.kRadiusWeight=.45,this.kSamplingPeriod=20,this.kMinDist=10*this.avgDim/1e3,this.maxRadiusCoeff=1.2,this.minRadiusCoeff=.75,this.rBaseCoeff=0,this.rRateChange=.35}var a=e("./MoaDrawBrushGeometry"),i=e("./MoaToolDataTypes"),n=i.MoaDrawBrushPoint;o.prototype.addPointToStrokeAndFilter=function(e,t,r){var o=e.length;if(o>0){var i=t.t-e[o-1].t,n=r*a.calcDistance(t,e[o-1]);if(!(i>=this.kSamplingPeriod&&n>this.kMinDist))return!1;e.push(t.copy()),this._filterPointLocations(e),this._findPointRadius(e,r)}else e[o]=t.copy();return!0},o.prototype.endFilteredStroke=function(e,t){var r=t.copy(),o=e.length;r.radius=e[o-1].radius,e.push(r)},o.prototype._filterPointLocations=function(e){var t=e.length,r=e[t-1],o=this._calcLastPointForSamplingPeriod(e,r.t);r.x=(1-this.kLocationWeight)*r.x+this.kLocationWeight*o.x,r.y=(1-this.kLocationWeight)*r.y+this.kLocationWeight*o.y},o.prototype._findPointRadius=function(e,t){var r=e.length,o=e[r-1],i=this._calcLastPointForSamplingPeriod(e,o.t),n=a.calcDistance(i,o),s=1e3*t*n/this.avgDim,l=o.t-i.t,u=s/(l+1e-7),c=this._calcVelocityRadiusCoeff(u);o.radius=o.radius*c,2==r?e[0].radius=o.radius:3==r?(e[0].radius=o.radius,e[1].radius=o.radius):r>3&&(o.radius=(1-this.kRadiusWeight)*o.radius+this.kRadiusWeight*i.radius)},o.prototype._calcVelocityRadiusCoeff=function(e){var t=this.rBaseCoeff+this.rRateChange*e;return t=t>this.maxRadiusCoeff?this.maxRadiusCoeff:t,t=t<this.minRadiusCoeff?this.minRadiusCoeff:t},o.prototype._calcLastPointForSamplingPeriod=function(e,t){for(var r,o,a=e.length-1;a>0;a--){var o=e[a],r=e[a-1],i=t-o.t,s=t-r.t;if(i<this.kSamplingPeriod&&s>this.kSamplingPeriod){var l=(s-this.kSamplingPeriod)/(s-i),u=(1-l)*r.radius+l*o.radius,c=(1-l)*r.x+l*o.x,d=(1-l)*r.y+l*o.y,p=t-this.kSamplingPeriod,h=new n(c,d,p,u);return h}}var h=r.copy();return h.t=t-this.kSamplingPeriod,h},t.exports=o},{"./MoaDrawBrushGeometry":49,"./MoaToolDataTypes":64}],53:[function(e,t,r){"use strict";function o(e){this.mask=e,"undefined"!=typeof e.moaGL&&(this.moaGL=e.moaGL),this.antiAliasing=!0,this.renderer=new i(e,this.antiAliasing)}var a=e("./MoaDrawBrushGeometry"),i=e("./MoaDrawNormalBrushRenderer");o.prototype.renderStroke=function(e,t,r){var o=e.getPointList(),a=o.length,i=e.getStartIndex(),n=!1,s=e.isEraseStroke();this.moaGL&&this.moaGL.drawToolStartEffect(this.mask,s);for(var l=i;a>l;l++)2==l?(this._updateMinMaxPointsForStrokeStartEnd(o[0],o[1],t),this._updateMinMaxPointsForStrokeMid(o[0],o[1],o[2],t),this._drawStrokeStart(o[0],o[1],e.strokeColor,s),this._drawStrokeMid(o[0],o[1],o[2],e.strokeColor,s),n=!0):l>2&&(this._updateMinMaxPointsForStrokeMid(o[l-2],o[l-1],o[l],t),this._drawStrokeMid(o[l-2],o[l-1],o[l],e.strokeColor,s),n=!0);if(r&&(1==a?(this._updateMinMaxPointsForPoint(o[0],t),this._drawPoint(o[0],e.strokeColor,s)):2==a?(this._updateMinMaxPointsForStrokeStartEnd(o[0],o[1],t),this._drawStrokeStart(o[0],o[1],e.strokeColor,s),this._drawStrokeEnd(o[0],o[1],e.strokeColor,s)):a>2&&(this._updateMinMaxPointsForStrokeStartEnd(o[a-2],o[a-1],t),this._drawStrokeEnd(o[a-2],o[a-1],e.strokeColor,s)),n=!0),n){var u=2*e.radius+1/this.mask.width;t[0]-=u,t[1]-=u,t[2]+=u,t[3]+=u,t[0]=Math.min(this.mask.width-1,Math.max(0,t[0])),t[1]=Math.min(this.mask.height-1,Math.max(0,t[1])),t[2]=Math.min(this.mask.width-1,Math.max(0,t[2])),t[3]=Math.min(this.mask.height-1,Math.max(0,t[3]))}else t[0]=0,t[1]=0,t[2]=0,t[3]=0;this.moaGL&&this.moaGL.drawToolEndEffect()},o.prototype._drawStrokeStart=function(e,t,r,o){var i=a.calcAngleTwoPoints(e,t),n=i+Math.PI/2,s={};a.calcMidpoint(e,t,s),this.renderer.drawSemicircle(e,r,n,o),this.renderer.drawStraightSegment(e,s,r,n,o)},o.prototype._drawStrokeMid=function(e,t,r,o,i){var n={};a.calcMidpoint(e,t,n),this.renderer.drawNormalBrushStrokeSegment(e,t,r,o,i)},o.prototype._drawStrokeEnd=function(e,t,r,o){var i=a.calcAngleTwoPoints(e,t),n=i+Math.PI/2,s={};a.calcMidpoint(e,t,s),this.renderer.drawStraightSegment(s,t,r,n,o),this.renderer.drawSemicircle(t,r,n+Math.PI,o)},o.prototype._drawPoint=function(e,t,r){this.renderer.drawSemicircle(e,t,0,r),this.renderer.drawSemicircle(e,t,Math.PI,r)},o.prototype._updateMinMaxPointsForPoint=function(e,t){this._updateMinMaxPoints(e,t)},o.prototype._updateMinMaxPointsForStrokeStartEnd=function(e,t,r){this._updateMinMaxPoints(e,r),this._updateMinMaxPoints(t,r)},o.prototype._updateMinMaxPointsForStrokeMid=function(e,t,r,o){var i={},n={};a.calcMidpoint(e,t,i),a.calcMidpoint(t,r,n),this._updateMinMaxPoints(i,o),this._updateMinMaxPoints(t,o),this._updateMinMaxPoints(n,o)},o.prototype._updateMinMaxPoints=function(e,t){e.x<t[0]&&(t[0]=e.x),e.y<t[1]&&(t[1]=e.y),e.x>t[2]&&(t[2]=e.x),e.y>t[3]&&(t[3]=e.y)},t.exports=o},{"./MoaDrawBrushGeometry":49,"./MoaDrawNormalBrushRenderer":54}],54:[function(e,t,r){"use strict";function o(e,t){this.mask=e,"undefined"!=typeof e.moaGL&&(this.moaGL=e.moaGL),this.triangleRender=new i(e),this.kAntiAliasingWidth=1,this.kNumVerticesForSemiCircle=21,this.antiAliasing=t}var a=e("../core/MoaColor"),i=e("./MoaTriangleRenderer"),n=e("./MoaDrawBrushGeometry"),s=e("./MoaToolDataTypes"),l=s.MoaVertex,u=s.MoaDrawBrushPoint,c=s.generateMoaVertexArray;o.prototype.drawNormalBrushStrokeSegment=function(e,t,r,o,i){var s,d,p,h,f,m,g,v,_,x,w,y,b,M=new u,C=new u,T=new u,S=new a(0,0,0,0);n.calcMidpoint(e,t,M),n.calcMidpoint(t,r,C);var A=n.calcAngleTwoPoints(M,t),E=n.calcAngleTwoPoints(t,C),P=E-A;if(P=Math.abs(P),P=P>Math.PI?2*Math.PI-P:P,e.x==t.x&&e.y==t.y)return void this.drawLine(M,C,o,i);if(t.x==r.x&&t.y==r.y)return void this.drawLine(M,C,o,i);if(P>=.85*Math.PI)return this.drawStraightSegment(M,t,o,A+.5*Math.PI,i),this.drawSemicircle(t,o,A-.5*Math.PI,i),this.drawSemicircle(t,o,E+.5*Math.PI,i),void this.drawStraightSegment(t,C,o,E+.5*Math.PI,i);x=2*(C.x-2*t.x+M.x),w=2*(C.y-2*t.y+M.y),y=Math.max(Math.abs(x),Math.abs(w));var D=Math.round(2*(y*P));s=5,d=25,D=Math.max(s,Math.min(d,D));for(var F=c(2*D),L=a.prototype.generateMoaColorArray(2*D),R=[],I=[],B=0;D>B;B++)p=1/(D-1)*B,f=1-p,h=p*p,g=f*p,m=f*f,T.x=m*M.x+2*g*t.x+h*C.x,T.y=m*M.y+2*g*t.y+h*C.y,T.radius=m*M.radius+2*g*t.radius+h*C.radius,0===B?(v=t.x-e.x,_=t.y-e.y):B>=D-1?(v=r.x-t.x,_=r.y-t.y):(v=2*f*(t.x-M.x)+2*p*(C.x-t.x),_=2*f*(t.y-M.y)+2*p*(C.y-t.y)),b=Math.atan2(_,v)+.5*Math.PI,n.calcLineEdges(F[2*B],F[2*B+1],T,T.radius,b),L[B].copy(o),F[2*B].color=L[B],F[2*B+1].color=L[B],this.antiAliasing&&(R[2*B]=new l,I[2*B+1]=new l,R[2*B].color=S,I[2*B+1].color=S,n.calcLineAntiAliasEdge(I[2*B+1],F[2*B],this.kAntiAliasingWidth,b),n.calcLineAntiAliasEdge(R[2*B],F[2*B+1],this.kAntiAliasingWidth,b+Math.PI),R[2*B+1]=F[2*B+1],I[2*B]=F[2*B]);this.antiAliasing&&(this.triangleRender.drawTriangleStrip(R,i),this.triangleRender.drawTriangleStrip(I,i)),this.triangleRender.drawTriangleStrip(F,i)},o.prototype.drawSemicircle=function(e,t,r,o){var i=c(this.kNumVerticesForSemiCircle),n=[],s=this.kNumVerticesForSemiCircle-2,u=Math.PI/s,d=r,p=e.radius+this.kAntiAliasingWidth,h=new a(0,0,0,0);i[0].x=e.x+2*Math.cos(d-.5*Math.PI),i[0].y=e.y+2*Math.sin(d-.5*Math.PI),i[0].color=t;for(var f=1;f<this.kNumVerticesForSemiCircle;f++)i[f]=new l,i[f].x=e.x+e.radius*Math.cos(d),i[f].y=e.y+e.radius*Math.sin(d),i[f].color=t,this.antiAliasing&&(n[2*f-2]=i[f],n[2*f-1]=new l,n[2*f-1].x=e.x+p*Math.cos(d),n[2*f-1].y=e.y+p*Math.sin(d),n[2*f-1].color=h),d+=u;this.triangleRender.drawTriangleFan(i,o),this.antiAliasing&&this.triangleRender.drawTriangleStrip(n,o)},o.prototype.drawStraightSegment=function(e,t,r,o,i){var s=c(4),l=c(4),u=c(4);if(n.calcLineEdges(s[0],s[1],e,e.radius,o),n.calcLineEdges(s[2],s[3],t,t.radius,o),s[0].color=r,s[1].color=r,s[2].color=r,s[3].color=r,this.antiAliasing){var d=new a(0,0,0,0),p=o,h=o;n.calcLineAntiAliasEdge(l[0],s[0],this.kAntiAliasingWidth,p),n.calcLineAntiAliasEdge(u[1],s[1],this.kAntiAliasingWidth,p+Math.PI),n.calcLineAntiAliasEdge(l[2],s[2],this.kAntiAliasingWidth,h),n.calcLineAntiAliasEdge(u[3],s[3],this.kAntiAliasingWidth,h+Math.PI),l[0].color=d,l[2].color=d,u[1].color=d,u[3].color=d,l[1]=s[0],l[3]=s[2],u[0]=s[1],u[2]=s[3],this.triangleRender.drawTriangleStrip(l,i),this.triangleRender.drawTriangleStrip(u,i)}this.triangleRender.drawTriangleStrip(s,i)},o.prototype.drawLine=function(e,t,r,o){var a=n.calcAngleTwoPoints(e,t),i=a+.5*Math.PI;this.drawSemicircle(e,r,i,o),this.drawStraightSegment(e,t,r,i,o),this.drawSemicircle(t,r,i+Math.PI,o)},t.exports=o},{"../core/MoaColor":36,"./MoaDrawBrushGeometry":49,"./MoaToolDataTypes":64,"./MoaTriangleRenderer":65}],55:[function(e,t,r){"use strict";function o(e,t){this.vertex0=e,this.vertex1=t,this.hasInfiniteSlope=e.x==t.x,this.slope=(t.y-e.y)/(t.x-e.x),this.length=e.findDistance(t)}o.prototype.intersectsYVal=function(e){return e<=this.vertex0.y&&e<=this.vertex1.y?!1:e>this.vertex0.y&&e>this.vertex1.y?!1:!0},o.prototype.getXInterceptForYVal=function(e){return this.inf?this.vertex0.x:this.vertex0.x+(e-this.vertex0.y)/this.slope},o.prototype.getSharedVertex=function(e){return this.vertex0==e.vertex0||this.vertex0==e.vertex1?this.vertex0:this.vertex1==e.vertex0||this.vertex1==e.vertex1?this.vertex1:null},t.exports=o},{}],56:[function(e,t,r){var o={},a=.5;o.interpolateStrokePoints=function(e,t,r){var o=[];if(e.length<1||0>=t)return o;o[0]=e[0];for(var a=1;a<e.length;a++){var u,c,d,p=e.length;if(1==a&&r&&2===p){u=e[0],c=e[1];var h=[],f=[];i(u,c,t,h),l(u,c,t,f),o=o.concat(h).concat(f)}else 1==a?(u=e[0],c=e[1],i(u,c,t,o)):r&&a==p-1&&p>2?(u=e[a-2],c=e[a-1],d=e[a],s(u,c,d,t,o)):r&&a==p-1?(u=e[a-2],c=e[a-1],l(u,c,t,o)):p>2&&(u=e[a-2],c=e[a-1],d=e[a],n(u,c,d,t,o))}return o};var i=function(e,t,r,o){for(var i,n,s,l=[(t[0]+e[0])/2,(t[1]+e[1])/2],u=Math.sqrt((l[0]-e[0])*(l[0]-e[0])+(l[1]-e[1])*(l[1]-e[1])),c=a*r,d=Math.floor(1+u/c),p=o.length,h=1;d>h;h++)i=h/d,n=(1-i)*e[0]+i*l[0],s=(1-i)*e[1]+i*l[1],o[p]=[n,s],p++;o[p]=[l[0],l[1]]},n=function(e,t,r,o,i){var n,s,l,u,c=[(t[0]+e[0])/2,(t[1]+e[1])/2],d=[(t[0]+r[0])/2,(t[1]+r[1])/2],p=Math.sqrt((c[0]-t[0])*(c[0]-t[0])+(c[1]-t[1])*(c[1]-t[1]))+Math.sqrt((d[0]-t[0])*(d[0]-t[0])+(d[1]-t[1])*(d[1]-t[1])),h=a*o,f=Math.floor(1+p/h),m=i.length;for(u=1;f>u;u++)n=u/f,s=(1-n)*(1-n)*c[0]+2*(1-n)*n*t[0]+n*n*d[0],l=(1-n)*(1-n)*c[1]+2*(1-n)*n*t[1]+n*n*d[1],i[m]=[s,l],m++;i[m]=[d[0],d[1]]},s=function(e,t,r,o,i){var n,s,l,u,c=[(t[0]+e[0])/2,(t[1]+e[1])/2],d=[(t[0]+r[0])/2,(t[1]+r[1])/2],p=Math.sqrt((c[0]-t[0])*(c[0]-t[0])+(c[1]-t[1])*(c[1]-t[1]))+Math.sqrt((d[0]-t[0])*(d[0]-t[0])+(d[1]-t[1])*(d[1]-t[1])),h=a*o,f=Math.floor(1+p/h),m=Math.sqrt((d[0]-t[0])*(d[0]-t[0])+(d[1]-t[1])*(d[1]-t[1])),g=1+m/h,v=i.length;for(u=1;f>u;u++)n=u/f,s=(1-n)*(1-n)*c[0]+2*(1-n)*n*t[0]+n*n*d[0],l=(1-n)*(1-n)*c[1]+2*(1-n)*n*t[1]+n*n*d[1],i[v]=[s,l],v++;for(i[v++]=[d[0],d[1]],u=1;g>u;u++)n=u/g,s=n*r[0]+(1-n)*d[0],l=n*r[1]+(1-n)*d[1],i[v]=[s,l],v++;i[v]=[r[0],r[1]]},l=function(e,t,r,o){var i,n,s,l,u=[(t[0]+e[0])/2,(t[1]+e[1])/2],c=Math.sqrt((u[0]-t[0])*(u[0]-t[0])+(u[1]-t[1])*(u[1]-t[1])),d=a*r,p=Math.floor(1+c/d),h=o.length;for(l=1;p>l;l++)i=l/p,n=i*u[0]+(1-i)*t[0],s=i*u[1]+(1-i)*t[1],o[h]=[n,s],h++;o[h]=[t[0],t[1]]};t.exports=o},{}],57:[function(e,t,r){"use strict";function o(e){this.width=e.width,this.height=e.height,this.data,this.originalBitmap=e,e.moaGL?(this.moaGL=e.moaGL,this.texture=this.moaGL.createMask(this.width,this.height)):this.data=a.makeData(4*this.width*this.height)}var a=e("../core/MoaAllocAndCopy");e("../processors/MoaColorConversion"),o.prototype.destroy=function(){this.moaGL?(this.moaGL.destroyTexture(this.texture),this.moaGL=null):this.data=null},o.prototype.getTexture=function(){return this.texture},o.prototype.initTransparent=function(){if("undefined"!=typeof this.moaGL)return void this.moaGL.setMaskTransparent(this.texture);for(var e=0;e<this.data.length;e++)this.data[e]=0},o.prototype.initOpaque=function(){if("undefined"!=typeof this.moaGL)return void this.moaGL.setMaskOpaque(this.texture);for(var e=0;e<this.data.length;e++)this.data[e]=255},o.prototype.drawPoint=function(e,t,r,o,a){for(var i,n,s,l,s,u=this.width,c=(this.height,.5*r),d=this.width*e,p=this.height*t,h=Math.pow(r+c*(1-Math.sqrt(5/255)),2),f=Math.sqrt(h),m=Math.max(0,Math.min(this.width-1,Math.round(d-f))),g=Math.max(0,Math.min(this.width-1,Math.round(d+f))),v=Math.max(0,Math.min(this.height-1,Math.round(p-f))),_=Math.max(0,Math.min(this.height-1,Math.round(p+f))),x=v;_>=x;x++)for(var w=m;g>=w;w++)if(i=4*(x*u+w),
n=(w-d)*(w-d)+(x-p)*(x-p),h>n){if(r*r>n)s=1;else{var y=1-(Math.sqrt(n)-r)/c;s=y*y}s*=o,a?(l=255*(0*s+(1-s)*this.data[i]/255),l=0>l?0:l>255?255:l+.5|0,this.data[i]=l):(l=255*(1*s+(1-s)*this.data[i]/255),l=0>l?0:l>255?255:l+.5|0,this.data[i]=l)}},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaColorConversion":74}],58:[function(e,t,r){"use strict";var o={};e("../core/MoaAllocAndCopy"),o.renderEffect=function(e){var t,r,o,a,i,n,s=e.width,l=e.height;if(e.moaGL)return e.moaGL.renderRedeye(),void(e.textureID=e.moaGL.glRenderingObjects.readTexture);var u=0,c=0,d=0;for(r=0;l>r;r++)for(t=0;s>t;t++){o=4*(t+s*r),a=e.data[o],i=e.data[o+1],n=e.data[o+2];var p=Math.max(a,Math.max(i,n))-Math.min(a,Math.min(i,n)),h=.2*a+.7*i+.1*n;p>175?u=1:(u=Math.exp(-(p-175)*(p-175)/11250),u=u>1?1:u),c=n-i,c=0>c?Math.exp(-c*c/800):1,d=a-h,d=0>d?0:1-Math.exp(-d*d/(.02*255*255));var f=u*d*c;f=f>1?1:0>f?0:f;var m=1-f,g=(i+n)/2;g=m*a+f*g,e.data[o]=Math.min(255,Math.max(0,g+.5|0))}},t.exports=o},{"../core/MoaAllocAndCopy":34}],59:[function(e,t,r){var o={};o.findClosestPatch=function(e,t,r){var o,a;o=0|t[0],a=0|t[1];var i=e.width,n=e.height,s=e.data,l=-2.5*r|0,u=2.5*r|0,c=u-l+1,d=c,p=o+l|0,h=a+l|0;r>p&&(p=0|r),r>h&&(h=0|r),p+c>i-1-r&&(c=i-1-r-p+1|0),h+d>n-1-r&&(d=n-1-r-h+1|0);var f=c/2|0,m=d/2|0;if(e.moaGL){var g=e.moaGL.gl,v=new Uint8Array(4*c*d);g.bindFramebuffer(g.FRAMEBUFFER,e.moaGL.glRenderingObjects.offscreenFramebuffer),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,e.moaGL.glRenderingObjects.readTexture,0),g.readPixels(p,h,c,d,g.RGBA,g.UNSIGNED_BYTE,v)}for(var _,x,w=0,y=0,b=-1,M=1.3*1.3*r*r,C=0|r,T=0|Math.max(1,r/10),S=0|Math.max(1,r/25),A=C;d-C>A;A+=T)for(var E=C;c-C>E;E+=T)if(!(M>(E-f)*(E-f)+(A-m)*(A-m))){for(var P=Number.MIN_VALUE,D=Number.MAX_VALUE,F=0,L=-r-1|0;r>L;L+=S)for(var R=-r-1|0;r>R;R+=S)if(0>L+A||L+A>=d||0>R+E||R+E>=c)F+=65025;else if(0>L+m||L+m>=d||0>R+f||R+f>=c)F+=65025;else{var I=i*(L+h+m)+R+p+f,B=i*(L+h+A)+R+p+E;e.moaGL?(I=c*(L+m)+R+f,B=c*(L+A)+R+E,_=v[4*I+1],x=v[4*B+1]):(_=s[4*I+1],x=s[4*B+1]);var O=(_-x)*(_-x);P=O>P?O:P,D=D>O?O:D,F+=O}F*=P-D,(0>b||b>F)&&(b=F,w=E-f,y=A-m)}e.moaGL&&(v=null),r>w+o&&(w=r-o|0),r>y+a&&(y=r-a|0),w+o>i-1-r&&(w=i-1-r-o|0),y+a>n-1-r&&(y=n-1-r-a|0);var N=[w,y];return N},o.findAvgSkinColor=function(e,t,r){var o=0|t[0],a=0|t[1];e.moaGL&&(e.moaGL.glImageData.width!=e.width||e.moaGL.glImageData.height!=e.height)&&(o=e.moaGL.glImageData.width*o/e.width,a=e.moaGL.glImageData.height*a/e.height);var i=e.width,n=e.height,s=e.data,l=-1*r|0,u=1*r|0,c=u-l+1,d=c,p=c/2|0,h=d/2|0,f=o+l|0,m=a+l|0;if(0>f&&(f=0),0>m&&(m=0),f+c>i-1&&(c=i-1-f+1),m+d>n-1&&(d=n-1-m+1),e.moaGL){var g=e.moaGL.gl,v=new Uint8Array(4*c*d);g.bindFramebuffer(g.FRAMEBUFFER,e.moaGL.glRenderingObjects.offscreenFramebuffer),g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,e.moaGL.glRenderingObjects.readTexture,0),g.readPixels(f,m,c,d,g.RGBA,g.UNSIGNED_BYTE,v)}for(var _,x,w,y,b=0,M=0,C=0,T=0,S=(gCenterSum=bCenterSum=pCenterSum=0,.4),A=0;d>A;A++)for(var E=0;c>E;E++){var P=E-p,D=A-h,F=P*P+D*D,L=Math.sqrt(F),R=E+f,I=A+m;R=R>i-1?i-1:R,I=I>n-1?n-1:I,e.moaGL?(_=4*(A*c+E),x=v[_],w=v[_+1],y=v[_+2]):(_=4*(I*i+R),x=s[_],w=s[_+1],y=s[_+2]);var B=1,O=(3*x-1.5*w-1.5*y)/255;O=0>O?.2:O>1?1:.2+.8*O;var N=L-S*r,k=.25*r,U=k*k;N=N*Math.exp(-N*N/U)/U,B=N>0?N:0,B*=O,B=0>B?0:B>1?1:B,b+=B*x,M+=B*w,C+=B*y,T+=B}e.moaGL&&(v=null);var W;if(T>0){var G=b/T,j=M/T,V=C/T;G=0>G?0:G>255?255:G,j=0>j?0:j>255?255:j,V=0>V?0:V>255?255:V,W={r:G,g:j,b:V,a:255}}else W={r:0,g:0,b:0,a:255};return W},t.exports=o},{}],60:[function(e,t,r){"use strict";function o(e,t,r){this.width=e.width,this.height=e.height,this.processedStrokes=[],this.unprocessedStrokes=[],this.currentStroke=null,this.toolType=r,this.originalBitmap=e,this.previewBitmap=t,this.processedBitmap=null,this.mask=new i(e),r==this.toolTypes.SelectiveBrushToolTypeColorSplash?this.mask.initOpaque():this.mask.initTransparent(),this.processedBitmap=l.copy(this.originalBitmap),this.renderEffect(),this._resetBoundingBox()}var a=e("./MoaSelectiveBrushStroke"),i=e("./MoaSelectiveMask"),n=e("../core/MoaColor"),s=e("../actionlist/MoaliteActionlistGenerator"),l=e("../core/MoaAllocAndCopy"),u=e("./MoaInterpolation"),c=e("./MoaBlur"),d=e("./MoaColorSplash"),p=e("./MoaRedeye"),h=e("./MoaWhiten");o.prototype.destroy=function(){this.mask.destroy(),this.processedBitmap.data=null,this.processedBitmap=null},o.prototype.toolTypes={SelectiveBrushToolTypeBlur:"blur",SelectiveBrushToolTypeColorSplash:"splash",SelectiveBrushToolTypeRedeye:"redeye",SelectiveBrushToolTypeWhiten:"whiten"},o.prototype.renderEffect=function(){var e;switch(this.toolType){case this.toolTypes.SelectiveBrushToolTypeBlur:e=c;break;case this.toolTypes.SelectiveBrushToolTypeColorSplash:e=d;break;case this.toolTypes.SelectiveBrushToolTypeRedeye:e=p;break;case this.toolTypes.SelectiveBrushToolTypeWhiten:e=h;break;default:return}e.renderEffect(this.processedBitmap)},o.prototype.startNewStroke=function(e,t,r){return null!=this.currentStroke?!1:(("undefined"==typeof t||null===t)&&(t="free"),"smart"==t&&this.toolType!=this.toolTypes.SelectiveBrushToolTypeColorSplash&&(t="free"),this.currentStroke=new a(e,t),this.toolType==this.toolTypes.SelectiveBrushToolTypeColorSplash&&"smart"==t&&"undefined"!=typeof r&&this.currentStroke.setSmartColor(r),!0)},o.prototype.addPointsToCurrentStroke=function(e){return null==this.currentStroke?!1:(this.currentStroke.addPoints(e),this.currentStroke.getBrushMode()==this.currentStroke.brushModes.MoaBrushModeSmart&&"undefined"==typeof this.currentStroke.getSmartColor()&&this._findSmartColor(this.currentStroke),!0)},o.prototype.endCurrentStroke=function(){return null==this.currentStroke?!1:(this.unprocessedStrokes=this.unprocessedStrokes.concat(this.currentStroke),void(this.currentStroke=null))},o.prototype.getActionlistObject=function(){for(var e=[],t=0;t<this.processedStrokes.length;t++){var r=this.toolType==this.toolTypes.SelectiveBrushToolTypeColorSplash&&"smart"==this.processedStrokes[t].brushMode;e.push(this.processedStrokes[t].getActionlistObject(r))}return s.MLPLActionBrush(this.toolType,e)},o.prototype._findSmartColor=function(e){switch(this.toolType){case this.toolTypes.SelectiveBrushToolTypeColorSplash:e.setSmartColor(this.findColorAtPoint(e.getFirstPoint()))}},o.prototype.findColorAtPoint=function(e){if("undefined"==typeof e[0])return new n(0,0,0,0);var t=e[0]*this.width,r=e[1]*this.height,t=Math.max(0,Math.min(this.width-1,Math.round(t))),r=Math.max(0,Math.min(this.width-1,Math.round(r)));if(this.originalBitmap.moaGL)return this.originalBitmap.moaGL.getColorAtPoint(t,r);var o=4*(r*this.width+t),a=this.originalBitmap.data;return new n(a[o],a[o+1],a[o+2],a[o+3])},o.prototype.renderPreview=function(e){return"boolean"!=typeof e&&(e=!1),this._resetBoundingBox(),this._renderUnprocessedStrokes(),this._compositeImages(e),!0},o.prototype._renderUnprocessedStrokes=function(){for(var e=0;e<this.unprocessedStrokes.length;e++)this._renderStroke(this.unprocessedStrokes[e],!0),this.processedStrokes=this.processedStrokes.concat(this.unprocessedStrokes[e]);this.unprocessedStrokes=[],null!=this.currentStroke&&this._renderStroke(this.currentStroke,!1)},o.prototype._renderStroke=function(e,t){var r=e.getUnprocessedPoints(),o=e.getRadius(),a=this.width,i=this.height,n=o*a,s=r.map(function(e){return[e[0]*a,e[1]*i]}),l=u.interpolateStrokePoints(s,n,t),c=l.map(function(e){return[e[0]/a,e[1]/i]}),d=e.isEraseStroke();this.toolType==this.toolTypes.SelectiveBrushToolTypeColorSplash&&(d=!d);var p=e.isSmartStroke()&&"object"==typeof e.getSmartColor(),h={};if(p&&(h.rgbColor=e.getSmartColor(),h.considerLuminosity=!1,h.sigmaC=10),this.originalBitmap.moaGL)return void this.originalBitmap.moaGL.maskAddPoints(this.mask.getTexture(),this.width,this.height,c,e.radius,h.sigmaC,1,p?"splash":"normal",h.rgbColor,d);for(var f=0;f<c.length;f++){var m=c[f][0],g=c[f][1];this._updateBoundingBox(m-e.radius,g-e.radius),this._updateBoundingBox(m+e.radius,g+e.radius),p?this.mask.maskSimilarColors(m,g,e.getRadius(),1,d,h):this.mask.maskPoint(m,g,e.getRadius(),1,d)}e.markAllPointsAsProcessed()},o.prototype._resetBoundingBox=function(){this.boundingBox=[1,1,0,0]},o.prototype._updateBoundingBox=function(e,t){e<this.boundingBox[0]&&(this.boundingBox[0]=e),e>this.boundingBox[2]&&(this.boundingBox[2]=e),t<this.boundingBox[1]&&(this.boundingBox[1]=t),t>this.boundingBox[3]&&(this.boundingBox[3]=t)},o.prototype._compositeImages=function(e){if(this.originalBitmap.moaGL)return void this.originalBitmap.moaGL.drawExistingProcessedTextureWithMaskTexture(this.processedBitmap.textureID,this.mask.getTexture());var t,r,o,a,i=this.width,n=this.height;e?(t=this.boundingBox[0]*(i-1),r=this.boundingBox[1]*(n-1),o=this.boundingBox[2]*(i-1),a=this.boundingBox[3]*(n-1)):(t=0,r=0,o=i-1,a=n-1),t=0>t?0:t>i-1?i-1:Math.round(t),r=0>r?0:r>n-1?n-1:Math.round(r),o=0>o?0:o>i-1?i-1:Math.round(o),a=0>a?0:a>n-1?n-1:Math.round(a);var s,l,u,c,d=this.previewBitmap.data,p=this.processedBitmap.data,h=this.originalBitmap.data,f=this.mask.data;for(l=r;a>=l;l++)for(s=t;o>=s;s++)u=4*(l*i+s),c=f[l*i+s]/255,d[u]=c*p[u]+(1-c)*h[u],d[u+1]=c*p[u+1]+(1-c)*h[u+1],d[u+2]=c*p[u+2]+(1-c)*h[u+2]},t.exports=o},{"../actionlist/MoaliteActionlistGenerator":21,"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"./MoaBlur":45,"./MoaColorSplash":47,"./MoaInterpolation":56,"./MoaRedeye":58,"./MoaSelectiveBrushStroke":61,"./MoaSelectiveMask":62,"./MoaWhiten":67}],61:[function(e,t,r){"use strict";function o(e,t,r){this.radius=e,this.pointList=[],this.pointCount=0,this.lastProcessedPoint=0,this.brushMode=t,r&&(this.smartColor=r)}var a=e("./MoaBrushStroke");o.prototype=new a,o.prototype.brushModes={MoaBrushModeFree:"free",MoaBrushModeSmart:"smart",MoaBrushModeErase:"erase"},o.prototype.setSmartColor=function(e){this.brushMode==this.brushModes.MoaBrushModeSmart&&"undefined"==typeof this.smartColor&&(this.smartColor=e)},o.prototype.getBrushMode=function(){return this.brushMode},o.prototype.getSmartColor=function(){return this.smartColor},o.prototype.isSmartStroke=function(){return this.brushMode==this.brushModes.MoaBrushModeSmart},o.prototype.isEraseStroke=function(){return this.brushMode==this.brushModes.MoaBrushModeErase},o.prototype.getActionlistObject=function(e){var t={radius:this.radius,brushMode:this.brushMode,points:this.pointList};return e&&(t.color=this._getActionlistColor()),t},o.prototype._getActionlistColor=function(){var e;return e=this.brushMode==this.brushModes.MoaBrushModeSmart?this.smartColor:{r:0,g:0,b:0,a:0}},t.exports=o},{"./MoaBrushStroke":46}],62:[function(e,t,r){"use strict";function o(e){this.width=e.width,this.height=e.height,this.originalBitmap=e,e.moaGL?(this.moaGL=e.moaGL,this.texture=this.moaGL.createMask(this.width,this.height)):this.data=a.makeData(this.width*this.height)}var a=e("../core/MoaAllocAndCopy"),i=e("../processors/MoaColorConversion");o.prototype.destroy=function(){this.moaGL?(this.moaGL.destroyTexture(this.texture),this.moaGL=null):this.data=null},o.prototype.getTexture=function(){return this.texture},o.prototype.initTransparent=function(){if("undefined"!=typeof this.moaGL)return void this.moaGL.setMaskTransparent(this.texture);for(var e=0;e<this.data.length;e++)this.data[e]=0},o.prototype.initOpaque=function(){if("undefined"!=typeof this.moaGL)return void this.moaGL.setMaskOpaque(this.texture);for(var e=0;e<this.data.length;e++)this.data[e]=255},o.prototype.maskPoint=function(e,t,r,o,a){for(var i,n,s,l,u,s,c=this.width,d=(this.height,r*c),p=.5*d,h=this.width*e,f=this.height*t,m=d+p*(1-Math.sqrt(.4/255)),g=m*m,v=Math.max(0,Math.min(this.width-1,Math.round(h-m))),_=Math.max(0,Math.min(this.width-1,Math.round(h+m))),x=Math.max(0,Math.min(this.height-1,Math.round(f-m))),w=Math.max(0,Math.min(this.height-1,Math.round(f+m))),y=x;w>=y;y++)for(var b=v;_>=b;b++)if(i=4*(y*c+b),l=y*c+b,n=(b-h)*(b-h)+(y-f)*(y-f),g>n){if(d*d>n)s=1;else{var M=1-(Math.sqrt(n)-d)/p;s=M*M}s*=o,a?(u=255*(0*s+(1-s)*this.data[l]/255),u=0>u?0:u>255?255:u+.5|0,this.data[l]=u):(u=255*(1*s+(1-s)*this.data[l]/255),u=0>u?0:u>255?255:u+.5|0,this.data[l]=u)}},o.prototype.maskSimilarColors=function(e,t,r,o,a,n){var s,l,u,c=this.originalBitmap.data,d=this.width,p=(this.height,e*this.width),h=t*this.height,f=n.sigmaC,m=n.labColor,g=n.rgbColor,v=n.considerLuminosity,_=r*d,x=.5*_;u="object"!=typeof m?i.rgb2labwithcbrtmapping(g.r,g.g,g.b):m;for(var w,y,b,M,C=-2*f*f*Math.log(254.6/255),T=-2*f*f*Math.log(.4/255),S=_+x*(1-Math.sqrt(.4/255)),A=S*S,E=Math.max(0,Math.min(this.width-1,Math.round(p-S))),P=Math.max(0,Math.min(this.width-1,Math.round(p+S))),D=Math.max(0,Math.min(this.height-1,Math.round(h-S))),F=Math.max(0,Math.min(this.height-1,Math.round(h+S))),L=D;F>=L;L++)for(var R=E;P>=R;R++){var I=L*d+R,B=4*(L*d+R),O=(R-p)*(R-p)+(L-h)*(L-h);if(A>O){if(y=i.rgb2labwithcbrtmapping(c[B],c[B+1],c[B+2]),l=v?Math.pow(u[0]-y[0],2)+Math.pow(u[1]-y[1],2)+Math.pow(u[2]-y[2],2):Math.pow(u[1]-y[1],2)+Math.pow(u[2]-y[2],2),C>l)b=1;else{if(l>T){b=0;continue}b=Math.exp(-l/(2*f*f))}if(_*_>O)M=1;else{var N=1-(Math.sqrt(O)-_)/x;M=N*N}s=b*M,s*=o,a?(w=255*(0*s+(1-s)*this.data[I]/255),w=0>w?0:w>255?255:w+.5|0,this.data[I]=w):(w=255*(1*s+(1-s)*this.data[I]/255),w=0>w?0:w>255?255:w+.5|0,this.data[I]=w)}}},o.prototype.maskRadial=function(e,t,r){var o=this.width,a=this.height,i=e*o,n=t*a,s=r*o;if(this.moaGL){var l={posX:i,posY:n,sigmaR:s};return void this.moaGL.maskFillRadial(this.getTexture(),this.width,this.height,l)}var u,c,d,p,h,f;p=s*s,h=-2*p*Math.log(1-1/255),f=-2*p*Math.log(1-254/255);for(var m,g=0;a>g;g++){m=(g-n)*(g-n);for(var v=0;o>v;v++)u=g*o+v,d=(v-i)*(v-i)+m,h>d?c=0:d>f?c=255:(c=1-Math.exp(-d/(2*p)),c=255*c+.5,c=c>255?255:0>c?0:0|c),this.data[u]=c}},o.prototype.maskLinear=function(e,t,r,o){var a=this.width,i=this.height,n=e*a,s=t*i,l=r*a;if(this.moaGL){var u={posX:n,posY:s,sigmaR:l,angle:o};return void this.moaGL.maskFillLinear(this.getTexture(),this.width,this.height,u)}var c,d,p,h,f,m,g,v;p=l*l,h=Math.sqrt(-2*p*Math.log(1-1/255)),f=Math.sqrt(-2*p*Math.log(1-254/255)),m=-Math.sin(o),g=Math.cos(o);for(var _=this.data,x=0;i>x;x++)for(var w=0;a>w;w++)c=x*a+w,v=Math.abs(m*(n-w)+g*(x-s)),d=h>v?0:v>f?1:1-Math.exp(-v*v/(2*p)),d=255*d+.5,d=d>255?255:0>d?0:0|d,_[c]=d},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaColorConversion":74}],63:[function(e,t,r){"use strict";function o(e,t){this.width=e.width,this.height=e.height,this.originalBitmap=e,this.previewBitmap=t,this.processedBitmap=null,"undefined"!=typeof e.moaGL&&(this.moaGL=e.moaGL),this.mask=new a(e),this.mask.initTransparent(),this.processedBitmap=i.copy(this.originalBitmap),n.renderEffect(this.processedBitmap)}var a=e("./MoaSelectiveMask"),i=e("../core/MoaAllocAndCopy"),n=e("./MoaBlur");o.prototype.destroy=function(){this.mask.destroy(),this.processedBitmap.data=null,this.processedBitmap=null},o.prototype.renderRadialBlur=function(e,t,r){this.mask.maskRadial(e,t,r)},o.prototype.renderLinearBlur=function(e,t,r,o){this.mask.maskLinear(e,t,r,o)},o.prototype.renderPreview=function(){return this.compositeImages()},o.prototype.compositeImages=function(){if(this.moaGL)return this.moaGL.drawExistingProcessedTextureWithMaskTexture(this.processedBitmap.textureID,this.mask.getTexture()),!0;for(var e,t,r=this.width,o=this.height,a=this.previewBitmap.data,i=this.processedBitmap.data,n=this.originalBitmap.data,s=this.mask.data,l=0;o>l;l++)for(var u=0;r>u;u++)e=4*(l*r+u),t=s[l*r+u]/255,a[e]=t*i[e]+(1-t)*n[e],a[e+1]=t*i[e+1]+(1-t)*n[e+1],a[e+2]=t*i[e+2]+(1-t)*n[e+2];return!0},t.exports=o},{"../core/MoaAllocAndCopy":34,"./MoaBlur":45,"./MoaSelectiveMask":62}],64:[function(e,t,r){"use strict";function o(e,t,r){this.x=e,this.y=t,this.color=r}function a(e){for(var t=[],r=0;e>r;r++)t[r]=new o;return t}function i(e,t,r,o,a,i){this.vertex0=e,this.vertex1=t,this.vertex2=r,this.edge0=o,this.edge1=a,this.edge2=i}function n(e,t,r,a,i){var n,s=t.getSharedVertex(e);i>a&&(n=a,a=i,i=n,n=e,e=t,t=n),this.color0=s==e.vertex0?e.vertex1.color:e.vertex0.color,this.color1=s.color,this.color2=s==t.vertex0?t.vertex1.color:t.vertex0.color,n=new o,n.y=r,n.x=a,this.bterm=l.calcDistance(n,s)/e.length,this.bterm=Math.max(0,Math.min(1,this.bterm)),n.x=i,this.dterm=l.calcDistance(n,s)/t.length,this.dterm=Math.max(0,Math.min(1,this.dterm))}function s(e,t,r,o){this.x=e,this.y=t,this.t=r,this.radius=o}var l=e("./MoaDrawBrushGeometry");o.prototype.findDistance=function(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))},n.prototype.getBaryColor=function(e,t){var r=t*this.bterm,o=(1-t)*(1-this.dterm)+t*(1-this.bterm),a=(1-t)*this.dterm;e.r=r*this.color0.r+o*this.color1.r+a*this.color2.r,e.g=r*this.color0.g+o*this.color1.g+a*this.color2.g,e.b=r*this.color0.b+o*this.color1.b+a*this.color2.b,e.a=r*this.color0.a+o*this.color1.a+a*this.color2.a},s.prototype.copy=function(){return new s(this.x,this.y,this.t,this.radius)},s.prototype.getActionlistObject=function(){var e=[this.x,this.y],t={point:e,timeOffset:this.t};return t},s.prototype.scale=function(e,t,r){this.x*=e,this.y*=t,this.radius*=r},t.exports={MoaVertex:o,generateMoaVertexArray:a,MoaTriangle:i,MoaBaryInterpolator:n,MoaDrawBrushPoint:s}},{"./MoaDrawBrushGeometry":49}],65:[function(e,t,r){"use strict";function o(e){this.mask=e,this.maskData=e.data,"undefined"!=typeof e.moaGL&&(this.moaGL=e.moaGL),this.width=e.width,this.height=e.height}var a=e("../core/MoaColor"),i=(e("./MoaDrawBrushGeometry"),e("./MoaEdge")),n=e("./MoaToolDataTypes"),s=(n.MoaVertex,n.MoaTriangle),l=n.MoaBaryInterpolator,u=function(e,t){var r=e;e=t,t=r};o.prototype.drawTriangle=function(e,t){if(this.moaGL)return void this.moaGL.drawTrianglesWithColor(this.mask,e,"fan");var r=!t&&255==e[0].color.a&&e[0].color.isEqual(e[1].color)&&e[0].color.isEqual(e[2].color),o=e[0],a=e[1],n=e[2];n.y<a.y&&u(a,n),a.y<o.y&&u(o,a),n.y<a.y&&u(a,n),o.y==a.y&&o.x>a.x&&u(o,a),a.y==n.y&&a.x>n.x&&u(a,n);var l=new i(o,a),c=new i(o,n),d=new i(a,n),p=new s(o,a,n,l,c,d),h=Math.min(o.y,Math.min(a.y,n.y));h=Math.max(0,h);var f=Math.max(o.y,Math.max(a.y,n.y));f=Math.min(this.mask.height-1,f);for(var m=Math.floor(h);m<=Math.floor(f);m++)r?this.drawSingleColorScanlineWithAliasing(p,m):this.drawScanlineWithAliasing(p,m,t)},o.prototype.drawTriangleStrip=function(e,t){if(!(e.length<3)){if(this.moaGL)return void this.moaGL.drawTrianglesWithColor(this.mask,e,"strip");for(var r=2;r<e.length;r++){var o=[e[r-2],e[r-1],e[r]];this.drawTriangle(o,t)}}},o.prototype.drawTriangleFan=function(e,t){if(!(e.length<3)){if(this.moaGL)return void this.moaGL.drawTrianglesWithColor(this.mask,e,"fan");for(var r=e[0],o=2;o<e.length;o++){var a=[r,e[o-1],e[o]];this.drawTriangle(a,t)}}},o.prototype.drawScanlineWithAliasing=function(e,t,r){var o,i,n=t+.5,s=e.edge0.intersectsYVal(n),u=e.edge1.intersectsYVal(n),c=e.edge2.intersectsYVal(n),d=s?e.edge0.getXInterceptForYVal(n):-1,p=u?e.edge1.getXInterceptForYVal(n):-1,h=c?e.edge2.getXInterceptForYVal(n):-1;if(s||u||c){var f=s?d:p,m=c?h:p;f=Math.min(f,m);var g=s?d:p;m=c?h:p,g=Math.max(g,m);var v,_=new a,x=new a,w=new a;s&&u&&(v=new l(e.edge0,e.edge1,n,d,p,_,x,w),f=d,g=p),s&&c&&(v=new l(e.edge0,e.edge2,n,d,h,_,x,w),f=d,g=h),u&&c&&(v=new l(e.edge1,e.edge2,n,p,h,_,x,w),f=p,g=h),f>g&&(m=f,f=g,g=m);var y=new a;o=Math.floor(.5+Math.max(f,0)),i=Math.floor(.5+Math.min(g,this.width-1));for(var b=o;i>b;b++){var M=(b+.5-f)/(g-f);M=Math.min(1,Math.max(0,M)),v.getBaryColor(y,M),r?this.eraseFromMaskPremultipliedAlpha(y.a/255,b,t):this.drawToMaskPremultipliedAlpha(y,b,t)}}},o.prototype.drawSingleColorScanlineWithAliasing=function(e,t){var r,o,a=t+.5,i=e.edge0.intersectsYVal(a),n=e.edge1.intersectsYVal(a),s=e.edge2.intersectsYVal(a),l=i?e.edge0.getXInterceptForYVal(a):-1,u=n?e.edge1.getXInterceptForYVal(a):-1,c=s?e.edge2.getXInterceptForYVal(a):-1;if(i||n||s){var d=i?l:u,p=s?c:u;d=Math.min(d,p);var h=i?l:u;p=s?c:u,h=Math.max(h,p);var f=4*Math.floor(this.width*t),m=e.vertex0.color;r=Math.max(0,Math.round(d)),o=Math.min(this.width,Math.round(h));for(var g=r;o>g;g++){var v=4*g;this.maskData[f+v]=m.r,this.maskData[f+v+1]=m.g,this.maskData[f+v+2]=m.b,this.maskData[f+v+3]=m.a}}},o.prototype.drawToMaskPremultipliedAlpha=function(e,t,r){if(!(0>t||t>=this.width||0>r||r>=this.height)){var o=4*(r*this.width+t),a=e.a/255,i=1-a;this.maskData[o]=i*this.maskData[o]+e.r+.5|0,this.maskData[o+1]=i*this.maskData[o+1]+e.g+.5|0,this.maskData[o+2]=i*this.maskData[o+2]+e.b+.5|0,this.maskData[o+3]=i*this.maskData[o+3]+e.a+.5|0}},o.prototype.eraseFromMaskPremultipliedAlpha=function(e,t,r){if(!(0>t||t>=this.width||0>r||r>=this.height)){var o=4*(r*this.width+t);this.maskData[o]=(1-e)*this.maskData[o]+.5|0,this.maskData[o+1]=(1-e)*this.maskData[o+1]+.5|0,this.maskData[o+2]=(1-e)*this.maskData[o+2]+.5|0,this.maskData[o+3]=(1-e)*this.maskData[o+3]+.5|0}},t.exports=o},{"../core/MoaColor":36,"./MoaDrawBrushGeometry":49,"./MoaEdge":55,"./MoaToolDataTypes":64}],66:[function(e,t,r){"use strict";function o(e,t){this.width=e.width,this.height=e.height,this.originalBitmap=e,this.previewBitmap=t,this.processedBitmap=null,"undefined"!=typeof e.moaGL?this.moaGL=e.moaGL:"undefined"!=typeof t.moaGL&&(this.moaGL=t.moaGL),this.mask=new a(e),this.mask.initTransparent()}var a=e("./MoaOverlayMask"),i=e("../processors/MoaGradient"),n=e("../processors/MoaGradientFlare"),s=(e("../processors/MoaBitmapBlend"),.75),l=1e-7;o.prototype.destroy=function(){this.mask.destroy()},o.prototype.VIGNETTE_MODES={MoaVignetteToolModeBlack:"black",MoaVignetteToolModeWhite:"white"},o.prototype.applyVignetteToolWithDefaults=function(e,t,r){this.applyVignetteTool(e,t,s,r,!1)},o.prototype.applyVignetteTool=function(e,t,r,o,a){var s,u,c,d,p,h={},f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];s=2,u=2;var g=[e[0]+.5*e[2],e[1]+.5*e[3]],v=e[2],_=e[3];v=Math.max(v,l),_=Math.max(_,l),f[0]=1/v,f[5]=1/_,f[3]=.5-g[0]/v,f[7]=.5-g[1]/_;var x;switch(o){case this.VIGNETTE_MODES.MoaVignetteToolModeBlack:x=0;break;case this.VIGNETTE_MODES.MoaVignetteToolModeWhite:x=255}var w={r:x,g:x,b:x,a:255},y={color:w,location:0},b={color:w,location:100};h.colors=[y,b];var M={opacity:0,location:0+49.3*(1-r)},C={opacity:1,location:100-49.3*(1-r)};h.opacities=[M,C],c=n.GradientFlareShapeCircle,d=n.GradientFlareAspectModeStretch,p=n.GradientFlareWrapModeClamp;var T={gradientShapeType:c,gradientParams:m,gradientTransform:f,aspectMode:d,gradient:h,invertMap:!1,gradientWrapMode:p,blendMode:"normal",alpha:t,copyAlpha:a};if(this.moaGL){var S=4096,A=[];i.memoizeGradient(h,A,S),T.gradMap=A,T.alpha=t,this.moaGL.applyVignetteToolToMask(this.mask,T)}else n.gradientFlare(this.previewBitmap,T);return!0},t.exports=o},{"../processors/MoaBitmapBlend":72,"../processors/MoaGradient":84,"../processors/MoaGradientFlare":85,"./MoaOverlayMask":57}],67:[function(e,t,r){"use strict";var o={},a=e("../processors/MoaColorConversion");e("../core/MoaAllocAndCopy"),o.renderEffect=function(e){var t=e.width,r=e.height;if(e.moaGL)return e.moaGL.renderWhiten(),void(e.textureID=e.moaGL.glRenderingObjects.readTexture);for(var o=new Array,i=0;256>i;i++).04045>=i/255?o[i]=100*i/255/12.92:o[i]=100*Math.pow((i/255+.055)/1.055,2.4);var n,s,l,u,c,d,p,h;for(c=0;r>c;c++)for(u=0;t>u;u++)n=4*(u+t*c),p=a.rgb2lab(e.data[n],e.data[n+1],e.data[n+2],o),l=0,l+=Math.pow(p[1]-132,2),p[2]<127&&(l+=Math.pow(p[2]-127,2)),s=.65*Math.exp(-l/98),h=255*Math.pow(p[0]/255,1/(.5*s+1)),d=a.lab2rgb([h,p[1],(1-s)*(p[2]-127)+127]),e.data[n]=d[0],e.data[n+1]=d[1],e.data[n+2]=d[2]},t.exports=o},{"../core/MoaAllocAndCopy":34,"../processors/MoaColorConversion":74}],68:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping"),i=e("./MoaBitmapBlend"),n=e("../core/MoaAllocAndCopy"),s=function(e){e.r=[],e.g=[],e.b=[]},l=function(e){return e>255?255:0>e?0:e};o.kSaturation="saturation",o.kWarmth="warmth",o.kTint="tint",o.kFade="fade",o.kBlendMode="blendMode",o.kAlpha="alpha",o.adjustColor=function(e,t){var r,u,c=!1,d="normal",p=1;e.moaGL||"normal"==d&&1==p?u=e.data:(r=n.makeBitmap(e.width,e.height),c=!0,u=r.data);var h=t[o.kSaturation],f=t[o.kWarmth],m=t[o.kTint],g=t[o.kFade],v={},_={},x={},w={};s(v),s(_),s(x),s(w);for(var y=new Array(12),b=(new Array(12),0!=h),M=0;256>M;M++)w.r[M]=M,w.g[M]=M,w.b[M]=M;h=-100>h?-100:h>100?100:h;var C,T=1.4,S=0,A=h/100+1;A-=1,A=0>A?(1-S)*(Math.cos(Math.PI*A*.5)-1):(T-1)*(1-Math.cos(Math.PI*A*.5)),A+=1,C=1-A,y[0]=-.787*C+1,y[1]=.715*C,y[2]=.072*C,y[3]=0,y[4]=.213*C,y[5]=(.715-1)*C+1,y[6]=.072*C,y[7]=0,y[8]=.213*C,y[9]=.715*C,y[10]=-.928*C+1,y[11]=0;var A=g/100,E=!1;0>A&&(E=!0,A=-.7*A);for(var M=0;256>M;M++){var P;if(128>M){var D=.55*A;P=127.5*Math.pow(M/255*2,1+.95*A),P=(1-D)*P+.5*D*255}else{var D=.3*A;P=255-127.5*Math.pow(Math.abs(2-M/255*2),1+.35*A),P=(1-D)*P+.5*D*255}x.r[M]=l(P+.5|0),x.g[M]=l(P+.5|0),x.b[M]=l(P+.5|0)}E&&a.invertHistMap(x),a.combineMultiChannelHistMaps(w,x);var F,L,R,A=f/100;A=A>0?.7*(1-Math.cos(Math.PI*A*.5)):Math.cos(Math.PI*A*.5)-1;for(var M=0;255>=M;M++)A>0?(F=M+48*A*Math.sin(Math.PI*M/255),L=M+28*A*Math.sin(Math.PI*M/255),R=M-6*A*Math.sin(Math.PI*M/255)):(F=M+16*A*Math.sin(Math.PI*M/255),L=M+-10*A*Math.sin(Math.PI*M/255),R=M+-48*A*Math.sin(Math.PI*M/255)),v.r[M]=l(F+.5|0),v.g[M]=l(L+.5|0),v.b[M]=l(R+.5|0);a.combineMultiChannelHistMaps(w,v);var F,L,R,A=m/100;A=A>0?.7*(1-Math.cos(Math.PI*A*.5)):.5*(Math.cos(Math.PI*A*.5)-1);for(var M=0;255>=M;M++)A>0?(R=M+48*A*Math.sin(Math.PI*M/255),F=M+28*A*Math.sin(Math.PI*M/255),L=M-6*A*Math.sin(Math.PI*M/255)):(R=M+16*A*Math.sin(Math.PI*M/255),F=M+-10*A*Math.sin(Math.PI*M/255),L=M+-48*A*Math.sin(Math.PI*M/255)),_.r[M]=l(F+.5|0),_.g[M]=l(L+.5|0),_.b[M]=l(R+.5|0);if(a.combineMultiChannelHistMaps(w,_),e.moaGL)return e.moaGL.renderColorMatrixTransform(y),e.moaGL.renderColorMap(w),!0;for(var I,B,O,N,k,U,M=0;M<u.length;)I=e.data[M],B=e.data[M+1],O=e.data[M+2],b&&(N=y[0]*I+y[1]*B+y[2]*O+.5,k=y[4]*I+y[5]*B+y[6]*O+.5,U=y[8]*I+y[9]*B+y[10]*O+.5,I=0|l(N),B=0|l(k),O=0|l(U)),I=w.r[I],B=w.g[B],O=w.b[O],u[M]=I,u[M+1]=B,u[M+2]=O,u[M+3]=e.data[M+3],M+=4;return c?i.blendWithBitmap(e,e,r,t.blendMode,t.alpha):!0},t.exports=o},{"../core/MoaAllocAndCopy":34,"./MoaBitmapBlend":72,"./MoaHistogramMapping":90}],69:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping"),i=e("./MoaBitmapBlend"),n=e("../core/MoaAllocAndCopy"),s=function(e){e.r=[],e.g=[],e.b=[]},l=function(e){return e>255?255:0>e?0:e};o.kBrightness="brightness",o.kContrast="contrast",o.kHighlights="highlights",o.kShadows="shadows",o.kBlendMode="blendMode",o.kAlpha="alpha",o.adjustLighting=function(e,t){var r,u,c=!1,d="normal",p=1;e.moaGL||"normal"==d&&1==p?u=e.data:(r=n.makeBitmap(e.width,e.height),c=!0,u=r.data);var h,f=t[o.kBrightness],m=t[o.kContrast],g=t[o.kHighlights],v=t[o.kShadows],_={},x={},w={};s(_),s(x),s(w);for(var y=new Array(256),b=new Array(256),M=new Array(9),C=new Array(9),T=(new Array(9),new Array(9),new Array(3)),S=0!=f,A=0!=m,E=0>m,P=0!=g,D=0!=v,F=0;256>F;F++)w.r[F]=F,w.g[F]=F,w.b[F]=F;for(var L,f=Math.max(-100,Math.min(100,f)),R=f/100,F=0;256>F;F++){if(0>R)L=F+50*R*Math.sin(Math.PI*F/255);else{var I=F/255;L=Math.pow(I,1+.15*Math.abs(R)-Math.abs(R)*Math.pow(I,.2)),0>R&&(L=I*(1-.25*Math.abs(R))-.7*(L-I)*Math.sin(.5*Math.PI*I)),L*=255}y[F]=l(L+.5|0)}m=Math.max(-100,Math.min(100,m));var B,R=m/100;h=Math.abs(R)+1,R>0?B=110:(R=Math.cos(Math.PI*Math.pow(Math.abs(R),.8)*.5)-1,h=1/(Math.abs(R)+1),B=110);for(var F=0;256>F;F++){var O;O=B>F?B*Math.pow(F/B,h):255-(255-B)*Math.pow((255-F)/(255-B),h),0>R&&(O=F-Math.sin(Math.PI*F/255)*(F-O)),b[F]=l(O+.5|0)}var N=.3*Math.abs(R);M[0]=-.787*N+1,M[3]=.715*N,M[6]=.072*N,M[1]=.213*N,M[4]=(.715-1)*N+1,M[7]=.072*N,M[2]=.213*N,M[5]=.715*N,M[8]=-.928*N+1,g=Math.max(-100,Math.min(100,g));var R=-.75*g/100,k=!1;0>R&&(k=!0,R=-R);for(var F=0;256>F;F++){var I=F/255,L=-3.68113+4.829*(F/3+1)-.299125*Math.pow(F/3+1,2)+.006449275*Math.pow(F/3+1,3)-474531e-10*Math.pow(F/3+1,4);if(0>L&&(L=0),.25>=R)L=R*L+F;else{var U,W=(R-.25)/.75,G=34*W/255;U=.5>I?255*((1-2*G)*I+G):F,L=R*L+U}_.r[255-F]=l(255-L+.5|0),_.g[255-F]=l(255-L+.5|0),_.b[255-F]=l(255-L+.5|0)}k&&a.invertHistMap(_),a.combineMultiChannelHistMaps(w,_);var v=Math.max(-100,Math.min(100,v)),R=.5*v/100,k=!1;0>R&&(k=!0,R=-R);for(var F=0;256>F;F++){var I=F/255,L=-3.68113+4.829*(F/3+1)-.299125*Math.pow(F/3+1,2)+.006449275*Math.pow(F/3+1,3)-474531e-10*Math.pow(F/3+1,4);if(0>L&&(L=0),.25>=R){var W=R/.25;L=W*L+F}else{var U,W=(R-.25)/.75,G=34*W/255;U=.5>I?255*((1-2*G)*I+G):F,L+=U}x.r[F]=l(L+.5|0),x.g[F]=l(L+.5|0),x.b[F]=l(L+.5|0)}if(k&&a.invertHistMap(x),a.combineMultiChannelHistMaps(w,x),e.moaGL)return e.moaGL.renderLegacyAdjustments(f,m,0,0,y,b,C,T,M,"normal",1),e.moaGL.renderColorMap(w),!0;for(var j,V,z,H,X,$,Y,q,Z,K,Q,J,F=0;F<e.data.length;)j=e.data[F],V=e.data[F+1],z=e.data[F+2],S&&(j=y[j],V=y[V],z=y[z]),A&&(Y=-j+V+z,q=+j-V+z,Z=+j+V-z,H=b[j],X=b[V],$=b[z],K=-H+X+$,Q=+H-X+$,J=+H+X-$,H+=.2*(K-Y)+(K>Y?.5:-.5),X+=.2*(Q-q)+(Q>q?.5:-.5),$+=.2*(J-Z)+(J>Z?.5:-.5),H=0|H,X=0|X,$=0|$,E&&(H=M[0]*H+M[3]*X+M[6]*$,X=M[1]*H+M[4]*X+M[7]*$,$=M[2]*H+M[5]*X+M[8]*$),j=l(H+.5|0),V=l(X+.5|0),z=l($+.5|0)),(P||D)&&(j=w.r[j],V=w.g[V],z=w.b[z]),u[F]=j,u[F+1]=V,u[F+2]=z,u[F+3]=e.data[F+3],F+=4;return c?i.blendWithBitmap(e,e,r,t.blendMode,t.alpha):!0},t.exports=o},{"../core/MoaAllocAndCopy":34,"./MoaBitmapBlend":72,"./MoaHistogramMapping":90}],70:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping"),i=e("./MoaColorMap");o.brightnessToReplaceColorMatrix=function(e,t){if(1>t)var r=0,o=255*t,n=[128*(t*t+t)/2];else var s=t-1,r=0,o=255,l=255/8,u=l*s,n=[l+u,3*l+3*u,5*l+3*u,7*l+1.5*u];var c=i.createColorMapFromListOfYValues(r,o,!0,n),d=[];d.r=c,d.g=c,d.b=c,a.mapHist(e,d)},o.contrastCurve=function(e,t){var r=65*(t-1),o=63.75,n=[o-r,3*o+.85*r],s=i.createColorMapFromListOfYValues(0,255,!0,n),l=[];l.r=s,l.g=s,l.b=s,a.mapHist(e,l)},o.contrastToReplaceColorMatrix=function(e,t){t-=1;var r=0,o=255;if(0>t){r-=128*t,o+=128*t,t=-(t*t);var n=63.75,s=n*t,l=[n-s,3*n+s]}else{t=2*Math.sqrt(t/2);var s=20*t,n=255/8,l=[n-s,3*n-1.75*s,5*n+1.5*s,7*n+s]}var u=i.createColorMapFromListOfYValues(r,o,!0,l),c=[];c.r=u,c.g=u,c.b=u,a.mapHist(e,c)},o.generateContrastCurveWithSatAdjust=function(e,t,r){e=Math.max(-100,Math.min(100,e)),e/=100;var o,a=e,i=Math.abs(a)+1;a>0?o=110:(a=Math.cos(Math.PI*Math.pow(Math.abs(a),.8)*.5)-1,i=1/(Math.abs(a)+1),o=110);for(var n=0;256>n;n++){var s;s=o>n?o*Math.pow(n/o,i):255-(255-o)*Math.pow((255-n)/(255-o),i),0>a&&(s=n-Math.sin(Math.PI*n/255)*(n-s)),t[n]=Math.max(0,Math.min(255,s+.5|0))}var l=.3*Math.abs(a);r[0]=-.787*l+1,r[3]=.715*l,r[6]=.072*l,r[1]=.213*l,r[4]=(.715-1)*l+1,r[7]=.072*l,r[2]=.213*l,r[5]=.715*l,r[8]=-.928*l+1},o.generateExposureCurve=function(e,t){e=Math.max(-100,Math.min(100,e));for(var r,o,a=e/100,i=0;256>i;i++)r=i/255,o=Math.pow(r,1+.15*Math.abs(a)-Math.abs(a)*Math.pow(r,.2)),0>a&&(o=r*(1-.25*Math.abs(a))-.7*(o-r)*sin(.5*Math.PI*r)),t[i]=Math.max(0,Math.min(255,255*o+.5|0))},t.exports=o},{"./MoaColorMap":75,"./MoaHistogramMapping":90}],71:[function(e,t,r){"use strict";var o=e("./MoaColorMap"),a=e("./MoaColorMatrixTransform"),i=(e("./MoaHistogramMapping"),e("../core/MoaColor").prototype),n=(e("../core/MoaAllocAndCopy"),{}),s=150;n.runAdjustments=function(e,t){var r=t.brightness,n=t.exposure,x=t.contrast,w=t.shadows,y=t.highlights,b=t.saturation,M=t.vibrance,C=t.warmth,T=t.tint,S=t.fade,A=t.blendMode,E=t.alpha,P=255*E+.5|0,D="normal"!=A||1!=E,F=0!=r||0!=n||0!=x,L=0!=w||0!=y,R=0!=b||0!=M,I=0!=C||0!=T||0!=S,B=o.createIdentityColorMap();if(0!=r){var O=u(r);B=o.combineColorMaps(B,O)}if(0!=n){var N=l(n);B=o.combineColorMaps(B,N)}if(0!=x){var k=c(x);B=o.combineColorMaps(B,k)}var U=d(w),W=p(y),G=a.getIdentity();if(b+M>s){var j=b+M;b=s*b/j,M=s*M/j}0!=M&&g(G,M),0!=b&&v(G,b);var V={r:o.createIdentityColorMap(),g:o.createIdentityColorMap(),b:o.createIdentityColorMap()};if(0!=S){var z=m(S);V.r=o.combineColorMaps(V.r,z),V.g=o.combineColorMaps(V.g,z),V.b=o.combineColorMaps(V.b,z)}if(0!=C){var H=h(C);V.r=o.combineColorMaps(V.r,H.r),V.g=o.combineColorMaps(V.g,H.g),V.b=o.combineColorMaps(V.b,H.b)}if(0!=T){var X=f(T);V.r=o.combineColorMaps(V.r,X.r),V.g=o.combineColorMaps(V.g,X.g),V.b=o.combineColorMaps(V.b,X.b)}for(var $=0;256>$;$++)V.r[$]=V.r[$]<0?0:V.r[$]>255?255:V.r[$]+.5|0,
V.g[$]=V.g[$]<0?0:V.g[$]>255?255:V.g[$]+.5|0,V.b[$]=V.b[$]<0?0:V.b[$]>255?255:V.b[$]+.5|0;if(F&&_(B),I&&(_(V.r),_(V.g),_(V.b)),F&&(_(U),_(W)),e.moaGL)return e.moaGL.renderAdjustments(e,B,U,W,G,V,A,E),!0;for(var Y=e.data,q=e.width*e.height,$=0;q>$;$++){var Z=4*$,K=Y[Z],Q=Y[Z+1],J=Y[Z+2];if(F&&(K=B[K],Q=B[Q],J=B[J]),L){var ee=.3*K+.59*Q+.11*J,te=ee+.5|0,re=W[te]+U[te]-2*ee;K+=re,Q+=re,J+=re,K=0>K?0:K>255?255:K,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J}if(R){var oe=K,ae=Q,ie=J;K=G[0]*oe+G[1]*ae+G[2]*ie+G[3],Q=G[4]*oe+G[5]*ae+G[6]*ie+G[7],J=G[8]*oe+G[9]*ae+G[10]*ie+G[11],K=0>K?0:K>255?255:K,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J}if(I&&(K=K+.5|0,Q=Q+.5|0,J=J+.5|0,K=V.r[K],Q=V.g[Q],J=V.b[J]),K=K+.5|0,Q=Q+.5|0,J=J+.5|0,D){var ne={r:K,g:Q,b:J,a:P};i.blendEmbededAlphaFromArray(Y,Z,ne,A)}else Y[Z]=K,Y[Z+1]=Q,Y[Z+2]=J}return!0};var l=function(e){e=-100>e?-100:e>100?100:e,e=0>e?-e*e/100:e*e/100;var t=e,r=255+t;return o.createColorMapFromListOfYValues(t,r,!1)},u=function(e){e=-100>e?-100:e>100?100:e;var t=e/100,r=42.5,a=2*r*t,i=[r+.6*a,3*r+a,5*r+.5*a];return o.createColorMapFromListOfYValues(0,255,!1,i)},c=function(e){e=-100>e?-100:e>100?100:e;var t;t=0>e?e/200:e/100;var r=63.75,a=r*t,i=[r-a,3*r+a];return o.createColorMapFromListOfYValues(0,255,!1,i)},d=function(e){if(0!=e){e=-100>e?-100:e>100?100:e;var t=e/100;0>t&&(t*=1.25);var r=25.5,a=t*r,i=[r+a,3*r+.75*a,5*r,7*r,9*r],n=a;return o.createColorMapFromListOfYValues(n,255,!1,i)}return o.createIdentityColorMap()},p=function(e){if(0!=e){e=-100>e?-100:e>100?100:e;var t=e/100;t>0&&(t*=1.25);var r=25.5,a=t*r,i=[r,3*r,5*r,7*r+a,9*r+a],n=255+.75*a;return o.createColorMapFromListOfYValues(0,n,!1,i)}return o.createIdentityColorMap()},h=function(e){e=-100>e?-100:e>100?100:e;var t,r,a,i=e/100;if(-.6>i){var n=-(i+.6)/.4;t=-15*(1-n)+-90*n,r=5*(1-n)+-10*n,a=60*(1-n)+100*n}else if(0>i){var n=-i/.6;t=-15*n,r=5*n,a=60*n}else if(i>.6){var n=(i-.6)/.4;t=30*(1-n)+65*n,r=10*(1-n)+-5*n,a=-30*(1-n)+-127.5*n}else{var n=i/.6;t=30*n,r=10*n,a=-30*n}var s=127.5+t,l=127.5+r,u=127.5+a,c=.35*t,d=.35*r,p=.35*a,h=0>t?255+t:255+.5*t,f=0>r?255+r:255+.5*r,m=0>a?255+a:255+.5*a,g=o.createColorMapFromListOfYValues(c,h,!1,[s]),v=o.createColorMapFromListOfYValues(d,f,!1,[l]),_=o.createColorMapFromListOfYValues(p,m,!1,[u]);return{r:g,g:v,b:_}},f=function(e){e=-100>e?-100:e>100?100:e;var t,r,a,i=e/100;if(-.6>i){var n=-(i+.6)/.4;t=-10*(1-n)+-90*n,r=45*(1-n)+40*n,a=-20*(1-n)+-70*n}else if(0>i){var n=-i/.6;t=-10*n,r=45*n,a=-20*n}else if(i>.6){var n=(i-.6)/.4;t=15*(1-n)+45*n,r=-15*(1-n)+-75*n,a=25*(1-n)+45*n}else{var n=i/.6;t=15*n,r=-15*n,a=25*n}var s=127.5+t,l=127.5+r,u=127.5+a,c=.35*t,d=.35*r,p=.35*a,h=0>t?255+t:255+.5*t,f=0>r?255+r:255+.5*r,m=0>a?255+a:255+.5*a,g=o.createColorMapFromListOfYValues(c,h,!1,[s]),v=o.createColorMapFromListOfYValues(d,f,!1,[l]),_=o.createColorMapFromListOfYValues(p,m,!1,[u]);return{r:g,g:v,b:_}},m=function(e){e=-100>e?-100:e>100?100:e;var t,r=e/100;t=0>r?128*r:72*r;var a=255-.5*t,i=63.75,n=[i,3*i];return o.createColorMapFromListOfYValues(t,a,!1,n)},g=function(e,t){t=-100>t?-100:t>100?100:t;var r=t/100;r=0>t?1-r*r:1+1.8*r*r,a.adjustVibrance(e,r)},v=function(e,t){t=-100>t?-100:t>100?100:t;var r=t/100;r=0>t?1-r*r:1+1.5*r*r,a.adjSaturation(e,r)},_=function(e){for(var t=0;t<e.length;t++)e[t]=e[t]+.5|0};t.exports=n},{"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"./MoaColorMap":75,"./MoaColorMatrixTransform":76,"./MoaHistogramMapping":90}],72:[function(e,t,r){"use strict";var o={},a=e("../core/MoaEnums"),i=e("../core/MoaColor");o.blendWithBitmap=function(e,t,r,o,n){var s=a.getBlendModeIndex(o);t.data,r.data,-1==s&&(s=a.getBlendModeIndex("normal"));var l,u,c,d,p="normal"===o&&1===l,h=e.data.length/4,f=new i;for(u=0;h>u;u++){c=4*u;var m={r:r.data[c],g:r.data[c+1],b:r.data[c+2],a:r.data[c+3]*n|0};if(p)e.data[c]=m.r,e.data[c+1]=m.g,e.data[c+2]=m.b;else{var d=[t.data[c],t.data[c+1],t.data[c+2],t.data[c+3]];f.blendEmbededAlphaFromArray(d,0,m,o),e.data[c]=d[0],e.data[c+1]=d[1],e.data[c+2]=d[2]}e.data[u+3]+255}return!0},o.blendWithBitmapSeparate=function(e,t,r,o){if(!e.glData){var a,i,n,s,l,u,c,d=e.width,p=e.height,h=t.width,f=t.height;for(i=0;p>i&&f>i;i++)for(a=0;d>a&&h>a;a++)n=4*(a+d*i),s=4*(a+h*i),l=e.data[n]*r+t.data[s]*o|0,u=e.data[n+1]*r+t.data[s+1]*o|0,c=e.data[n+2]*r+t.data[s+2]*o|0,e.data[n]=l>255?255:0>l?0:l,e.data[n+1]=u>255?255:0>u?0:u,e.data[n+2]=c>255?255:0>c?0:c}},t.exports=o},{"../core/MoaColor":36,"../core/MoaEnums":38}],73:[function(e,t,r){"use strict";var o={},a=(e("./MoaColorMatrixTransform"),e("./MoaHistogramMapping")),i=e("../core/MoaEnums"),n=e("../core/MoaColor"),s=function(e,t,r,o,a){var i=[];i.r=[],i.g=[],i.b=[];var n=1-a;if("normal"==e)for(var s=0;256>s;s++)i.r[s]=n*s+a*t+.5|0,i.g[s]=n*s+a*r+.5|0,i.b[s]=n*s+a*o+.5|0,i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];else if("overlay"==e)for(var s=0;256>s;s++)64>=s?(i.r[s]=n*s+2*a*s*t/255+.5|0,i.g[s]=n*s+2*a*s*r/255+.5|0,i.b[s]=n*s+2*a*s*o/255+.5|0):s>=192?(i.r[s]=n*s+a*(255-(255-s)*(255-t)/127.5)+.5|0,i.g[s]=n*s+a*(255-(255-s)*(255-r)/127.5)+.5|0,i.b[s]=n*s+a*(255-(255-s)*(255-o)/127.5)+.5|0):(histmap.r[s]=n*s+a*(s*s*(510-4*t)/255/255+s*(4*t-255)/255+(255-2*t)/8),histmap.g[s]=n*s+a*(s*s*(510-4*r)/255/255+s*(4*r-255)/255+(255-2*r)/8),histmap.b[s]=n*s+a*(s*s*(510-4*o)/255/255+s*(4*o-255)/255+(255-2*o)/8)),i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];else if("multiply"==e)for(var s=0;256>s;s++)i.r[s]=n*s+a*t*s/255+.5|0,i.g[s]=n*s+a*r*s/255+.5|0,i.b[s]=n*s+a*o*s/255+.5|0,i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];else if("darken"==e)for(var s=0;256>s;s++)i.r[s]=n*s+a*(t>s?s:t)+.5|0,i.g[s]=n*s+a*(r>s?s:r)+.5|0,i.b[s]=n*s+a*(o>s?s:o)+.5|0,i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];else if("screen"==e)for(var s=0;256>s;s++)i.r[s]=n*s+a*(255-(255-s)*(255-t)/255)+.5|0,i.g[s]=n*s+a*(255-(255-s)*(255-r)/255)+.5|0,i.b[s]=n*s+a*(255-(255-s)*(255-o)/255)+.5|0,i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];else if("soft"==e)for(var l,s=0;256>s;s++)l=s*t>>8,i.r[s]=n*s+opacityOrig*(l+(s*(255-((255-s)*(255-t)>>8)-l)>>8))+.5|0,l=s*r>>8,i.g[s]=n*s+opacityOrig*(l+(s*(255-((255-s)*(255-r)>>8)-l)>>8))+.5|0,l=s*o>>8,i.b[s]=n*s+opacityOrig*(l+(s*(255-((255-s)*(255-o)>>8)-l)>>8))+.5|0,i.r[s]=i.r[s]>255?255:i.r[s]<0?0:i.r[s],i.g[s]=i.g[s]>255?255:i.g[s]<0?0:i.g[s],i.b[s]=i.b[s]>255?255:i.b[s]<0?0:i.b[s];return i};o.blendWithColor=function(e,t){var r=(e.width,e.height,[]);r.r=[],r.g=[],r.b=[];var o,s=i.getBlendModeIndex(t.blendMode),l=t.color;o=t.hasOwnProperty("alpha")?t.alpha:1;var u,c,d;u=l.r,c=l.g,d=l.b;var p,h=new n;if(2==s){var f=h.rgb2hsl(l.r,l.g,l.b);if(e.moaGL)return e.moaGL.renderColorBlendColor(f,l.a/255,o),!0;for(var m=0;m<e.data.length;m+=4)h.colorBlendColorFromArray(e.data,m,f,l.a,o)}else{var m;for(l.a=Math.floor(255*o+.5),m=0;256>m;m++)p=[m,m,m,255],h.blendEmbededAlphaFromArray(p,0,l,t.blendMode),r.r[m]=p[0],r.g[m]=p[1],r.b[m]=p[2];a.mapHist(e,r)}},o.colorOverlay=function(e,t,r,o,i){var n=s("overlay",t,r,o,i);a.mapHist(e,n)},o.colorMultiply=function(e,t,r,o,i){var n=s("multiply",t,r,o,i);a.mapHist(e,n)},o.colorDarken=function(e,t,r,o,i){var n=s("darken",t,r,o,i);a.mapHist(e,n)},o.colorSoft=function(e,t,r,o,i){var n=s("soft",t,r,o,i);a.mapHist(e,n)},o.colorColor=function(e,t,r,o,a){var i,n,s,l,u,c,d,p,h,f=e.width,m=e.height,g=1-a;d=t/255,p=r/255,h=o/255;var v,_,x=Math.max(d,p,h),w=Math.min(d,p,h),y=(x+w)/2;if(x==w)v=_=0;else{var b=x-w;switch(_=y>.5?b/(2-x-w):b/(x+w),x){case d:v=(p-h)/b+(h>p?6:0);break;case p:v=(h-d)/b+2;break;case h:v=(d-p)/b+4}v/=6}if(e.moaGL)return e.moaGL.renderColorBlendColor([v,_,y],1,a),!0;for(c=0;m>c;c++)for(u=0;f>u;u++){l=4*(c*f+u),i=e.data[l],n=e.data[l+1],s=e.data[l+2];var M=i,C=n,T=s;y=(.212671*i+.71516*n+.072169*s)/255;var S=6*v,A=y>.5?2*_*(1-y):2*_*y,E=A*(1-Math.abs(S%2-1));1>S?(i=A,n=E,s=0):2>S?(i=E,n=A,s=0):3>S?(i=0,n=A,s=E):4>S?(i=0,n=E,s=A):5>S?(i=E,n=0,s=A):6>S&&(i=A,n=0,s=E);var P=y-.5*A;i=255*(i+P)+.5|0,n=255*(n+P)+.5|0,s=255*(s+P)+.5|0,i=i>255?255:0>i?0:i,n=n>255?255:0>n?0:n,s=s>255?255:0>s?0:s,i=g*M+a*i,n=g*C+a*n,s=g*T+a*s,i=i>255?255:0>i?0:i,n=n>255?255:0>n?0:n,s=s>255?255:0>s?0:s,e.data[l]=i,e.data[l+1]=n,e.data[l+2]=s}},o.colorScreen=function(e,t,r,o,i){var n=s("screen",t,r,o,i);a.mapHist(e,n)},o.normalBlend=function(e,t,r,o,i){var n=s("normal",t,r,o,i);a.mapHist(e,n)},t.exports=o},{"../core/MoaColor":36,"../core/MoaEnums":38,"./MoaColorMatrixTransform":76,"./MoaHistogramMapping":90}],74:[function(e,t,r){"use strict";var o={};o.initalizeRGB2LABMapping=function(){for(var e=new Array,t=0;256>t;t++).04045>=t/255?e[t]=100*t/255/12.92:e[t]=100*Math.pow((t/255+.055)/1.055,2.4);return e},o.initializeCBRTMapping=function(){for(var e=new Array,t=1024,r=0;t>r;r++)e[r]=Math.pow(r/(t-1),1/3);return e},o.rgb2lab=function(e,t,r,o){"object"!=typeof o&&(o=[0,.030352698354883748,.060705396709767497,.09105809506465125,.12141079341953499,.15176349177441875,.1821161901293025,.21246888848418624,.24282158683906999,.27317428519395376,.3035269835488375,.3346535763899161,.3676507324047436,.40247170184963066,.43914420374102936,.4776953480693729,.5181516702338386,.5605391624202722,.6048833022857054,.6512090792594475,.6995410187265387,.7499032043226175,.8023192985384995,.8568125618069307,.9134058702220788,.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,2.8426039504420793,2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,7.036009569659588,7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,13.563332965520566,13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,22.32279573168085,22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,33.71636150483304,34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,48.514994005607036,49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,66.5387298282272,67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,88.79231178819663,89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100]);var a,i,n,s,l,u;return e=o[e],t=o[t],r=o[r],s=.00433891*e+.00376234915*t+.0018990604648*r,l=.002126*e+.007152*t+722e-6*r,u=177255e-9*e+.00109475308*t+.0087295537*r,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,l=l>.008856?Math.pow(l,1/3):7.787*l+16/116,u=u>.008856?Math.pow(u,1/3):7.787*u+16/116,a=116*l-16,i=500*(s-l),n=200*(l-u),[2.55*a,i+127,n+127]};var a=[0,.030352698354883748,.060705396709767497,.09105809506465125,.12141079341953499,.15176349177441875,.1821161901293025,.21246888848418624,.24282158683906999,.27317428519395376,.3035269835488375,.3346535763899161,.3676507324047436,.40247170184963066,.43914420374102936,.4776953480693729,.5181516702338386,.5605391624202722,.6048833022857054,.6512090792594475,.6995410187265387,.7499032043226175,.8023192985384995,.8568125618069307,.9134058702220788,.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,2.8426039504420793,2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,7.036009569659588,7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,13.563332965520566,13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,22.32279573168085,22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,33.71636150483304,34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,48.514994005607036,49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,66.5387298282272,67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,88.79231178819663,89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100],i=[0,.09924488254695861,.12504071661525748,.14313588920856027,.1575414309575025,.16970636198605316,.18033991980928551,.18984863055466036,.19848976509391722,.20643767470661487,.21381661776730748,.2207186428753261,.22721406110407222,.2333579349114362,.2391942859295316,.24475892765281868,.2500814332305149,.25518653946003345,.2600951718542145,.26482520821552014,.26939205754235684,.27380910584090884,.27808806426285243,.2822392443945425,.28627177841712054,.2901937969941595,.2940125743549161,.2977346476408758,.3013659158571899,.30491172251223664,.3083769250994826,.311765953881872,.315082861915005,.31833136784577337,.32151489271552486,.3246365917579799,.3276993819951494,.33070596628701154,.3336588543735265,.336560381353843,.3394127239721063,.34221791501818183,.3449778561018543,.34769432901832303,.350369005889286,.3530034582361798,.3555991651191077,.35815752045576577,.360679839618571,.3631673653946448,.36562127338186107,.3680426768844678,.37043263136354043,.37279213849048415,.3751221498457724,.3774235702999315,.3796972611093207,.38194404275540383,.38416469755287136,.3863599720490726,.38853057923469275,.3906772005834086,.39280048793632477,.3949010652453065,.39697953018783444,.3990364556647021,.40107239119071786,.4030878641875543,.40508338118698156,.40705942895191655,.4090164755220073,.41095497118983254,.41287534941322973,.41477802766875577,.41666340825083015,.41853187902070177,.4203838141090141,.4222195745754141,.42403950902835275,.4258439542079576,.42763323553461496,.4294076676256808,.4311675547825421,.43291319145006824,.43464486265033075,.43636284439232104,.43806740405925904,.439758800774965,.44143728575065216,.4431031026133969,.44475648771744863,.4463976704394558,.44802687345860653,.4496443130226092,.45125019920037296,.4528447361221874,.45442812220814444,.4560005503854936,.45756220829557587,.4591132784909362,.46065393862317483,.46218436162206117,.4637047158663982,.4652151653470947,.46671586982287233,.46820698496900803,.4696886625194857,.4711610504029096,.47262429287250746,.4740785306305335,.4755239009473612,.4769605377755387,.47838857185906314,.4798081308381152,.48121933934948075,.48262231912287346,.4840171890733601,.4854040653900775,.4867830616214213,.4881542887568748,.4895178553056373,.4908738673722041,.4922224287290381,.4935636408864699,.4948976031599528,.496224412734793,.49754416472847035,.4988569522506557,.5001628664610298,.501461996624999,.5027544301674005,.5040402527242843,.5053195481928565,.5065923987796591,.5078588850470654,.5091190859581595,.5103730789200669,.5116209398258046,.5128627430947063,.514098561711485,.5153284672639881,.516552529979695,.5177708187610112,.5189834012194042,.520190343708429,.5213917113556842,.5225875680937435,.5237779766901,.524962998776162,.5261426948753368,.5273171244302366,.5284863458290399,.5296504164310403,.530809392591412,.5319633296852224,.5331122821307175,.5342563034119088,.5353954461004848,.5365297618770742,.5376593015518806,.5387841150847137,.5399042516044376,.5410197594278565,.5421306860780567,.5432370783022257,.5443389820889641,.5454364426851102,.5465295046120907,.5476182116818177,.5487026070121426,.5497827330418863,.5508586315454556,.5519303436470633,.5529979098345615,.5540613699729042,.555120763317248,.5561761285257049,.5572275036717572,.5582749262563468,.5593184332196459,.5603580609525242,.5613938453077163,.5624258216107048,.5634540246703222,.564478488789085,.5654992477732644,.5665163349427048,.5675297831403955,.5685396247418045,.5695458916639811,.5705486153744331,.5715478268997879,.5725435568342411,.5735358353478003,.5745246921943311,.5755101567194079,.5764922578679786,.577471024191847,.5784464838569776,.5794186646506286,.5803875939883189,.5813532989206311,.582315806139859,.5832751419864992,.5842313324555962,.5851844032029409,.5861343795511286,.5870812864954806,.5880251487098322,.5889659905521902,.5899038360702656,.5908387090068827,.5917706328052692,.5926996306142294,.5936257252932051,.5945489394172259,.5954692952817516,.5963868149074115,.5973015200446405,.5982134321782173,.599122572531705,.6000289620717986,.60093262151258,.6018335713196846,.6027318317143798,.6036274226775593,.6045203639536548,.6054106750544663,.606298375262915,.6071834836367179,.6080660190119893,.6089460000067677,.6098234450244732,.6106983722572941,.6115707996895061,.6124407451007265,.613308226069102,.6141732599744346,.6150358640012467,.6158960551417848,.6167538501989651,.6176092657892629,.6184623183455441,.6193130241198446,.620161399186094,.6210074594427897,.6218512206156173,.6226926982600246,.623531907763744,.6243688643492697,.6252035830762873,.6260360788440587,.626866366393762,.6276944603107898,.6285203750270028,.6293441248229434,.6301657238300099,.6309851860325884,.6318025252701481,.6326177552392989,.63343088949581,.6342419414565944,.6350509244016576,.6358578514760097,.6366627356915467,.6374655899288959,.6382664269392303,.6390652593460512,.6398620996469384,.6406569602152721,.6414498533019224,.6422407910369122,.6430297854310497,.6438168483775332,.6446019916535295,.6453852269217243,.6461665657318468,.646946019522169,.6477235996209785,.6484993172480279,.6492731835159596,.6500452094317067,.6508154058978702,.651583783714075,.6523503535783013,.6531151260881964,.653878111742364,.6546393209416315,.6553987639902987,.6561564510973654,.6569123923777382,.6576665978534199,.6584190774546778,.6591698410211952,.6599188983032032,.660666258962595,.6614119325740231,.6621559286259783,.6628982565218523,.6636389255809841,.6643779450396892,.6651153240522729,.665851071692029,.6665851969522216,.667317708747053,.6680486159126159,.6687779272078317,.6695056513153739,.6702317968425779,.6709563723223373,.6716793862139855,.6724008469041655,.673120762707686,.6738391418683641,.6745559925598569,.675271322886479,.6759851408840097,.6766974545204868,.6774082716969896,.67811760024841,.6788254479442125,.6795318224891835,.6802367315241687,.6809401826268009,.6816421833122166,.6823427410337628,.6830418631836931,.6837395570938545,.6844358300363635,.6851306892242741,.6858241418122343,.6865161948971349,.6872068555187488,.687896130660361,.6885840272493903,.689270552158001,.6899557122037085,.6906395141499742,.6913219647067927,.6920030705312724,.6926828382282061,.6933612743506347,.6940383854004035,.6947141778287103,.6953886580366461,.6960618323757292,.6967337071484312,.6974042886086962,.6980735829624533,.6987415963681218,.6994083349371105,.7000738047343085,.7007380117785719,.7014009620432023,.7020626614564196,.7027231159018287,.7033823312188793,.7040403132033212,.7046970676076518,.7053526001415594,.7060069164723595,.7066600222254262,.7073119229846179,.7079626242926972,.7086121316517457,.7092604505235738,.7099075863301242,.7105535444538713,.7111983302382154,.7118419489878712,.7124844059692523,.71312570641085,.7137658555036082,.7144048584012926,.7150427202208567,.7156794460428013,.7163150409115315,.7169495098357082,.7175828577885948,.7182150897084011,.718846210498622,.7194762250283715,.720105138132714,.7207329546129908,.721359679237142,.721985316740026,.7226098718237337,.7232333491578999,.7238557533800104,.7244770890957053,.7250973608790793,.7257165732729777,.7263347307892896,.7269518379092367,.7275678990836596,.7281829187333003,.728796901249081,.7294098509923802,.7300217722953055,.7306326694609626,.7312425467637221,.7318514084494824,.7324592587359297,.7330661018127955,.7336719418421106,.7342767829584559,.7348806292692114,.735483484854801,.7360853537689355,.7366862400388527,.737286147665554,.7378850806240391,.7384830428635379,.7390800383077395,.7396760708550189,.7402711443786605,.7408652627270808,.741458429724046,.7420506491688895,.7426419248367259,.7432322604786622,.7438216598220084,.7444101265704832,.7449976644044198,.7455842769809682,.7461699679342954,.7467547408757834,.7473385993942256,.7479215470560205,.748503587405363,.7490847239644346,.7496649602335902,.7502442996915447,.7508227457955557,.7514003019816053,.7519769716645798,.7525527582384471,.7531276650764331,.753701695531195,.7542748529349934,.754847140599863,.7554185618177804,.7559891198608314,.7565588179813753,.7571276594122083,.757695647366725,.7582627850390781,.7588290756043364,.7593945222186415,.7599591280193618,.7605228961252469,.7610858296365782,.7616479316353195,.7622092051852651,.7627696533321872,.7633292791039805,.7638880855108077,.7644460755452401,.7650032521824002,.7655596183801003,.7661151770789814,.7666699312026493,.7672238836578102,.7677770373344053,.7683293951057427,.7688809598286291,.7694317343435,.7699817214745477,.7705309240298498,.7710793448014944,.7716269865657057,.7721738520829675,.772719944098145,.7732652653406075,.7738098185243465,.7743536063480964,.7748966314954512,.775438896634981,.7759804044203481,.7765211574904205,.7770611584693855,.7776004099668616,.7781389145780099,.778676674883643,.7792136934503352,.7797499728305293,.7802855155626435,.7808203241711775,.7813544011668172,.7818877490465378,.7824203702937074,.782952267378188,.783483442756437,.7840138988716062,.7845436381536416,.7850726630193806,.7856009758726495,.7861285791043594,.7866554750926015,.7871816662027413,.7877071547875124,.7882319431871087,.7887560337292759,.7892794287294033,.7898021304906129,.7903241413038489,.7908454634479661,.7913660991898175,.7918860507843407,.7924053204746444,.7929239104920931,.7934418230563915,.7939590603756689,.7944756246465603,.7949915180542906,.7955067427727543,.7960213009645972,.7965351947812954,.7970484263632353,.7975609978397913,.7980729113294042,.7985841689396577,.7990947727673552,.799604724898595,.8001140274088461,.8006226823630215,.8011306918155525,.8016380578104618,.8021447823814357,.8026508675518954,.8031563153350691,.8036611277340616,.8041653067419244,.8046688543417252,.8051717725066162,.8056740631999023,.8061757283751086,.8066767699760472,.8071771899368835,.8076769901822017,.8081761726270704,.8086747391771066,.8091726917285403,.8096700321682774,.8101667623739631,.810662884214044,.81115839954783,.8116533102255556,.8121476180884412,.8126413249687521,.8131344326898597,.8136269430663002,.8141188579038331,.8146101789994995,.8151009081416802,.8155910471101533,.8160805976761496,.8165695616024108,.8170579406432438,.8175457365445769,.8180329510440145,.8185195858708919,.8190056427463286,.8194911233832824,.8199760294866028,.8204603627530825,.8209441248715112,.8214273175227265,.8219099423796651,.8223920011074144,.8228734953632629,.8233544267967502,.8238347970497164,.8243146077563521,.8247938605432471,.8252725570294385,.8257506988264595,.8262282875383863,.8267053247618866,.8271818120862655,.8276577510935128,.8281331433583488,.82860799044827,.8290822939235957,.8295560553375114,.8300292762361152,.830501958158461,.830974102636603,.8314457111956398,.831916785353757,.8323873266222709,.8328573365056704,.8333268165016603,.8337957681012022,.8342641927885572,.8347320920413266,.8351994673304931,.8356663201204616,.8361326518690991,.8365984640277758,.8370637580414035,.8375285353484762,.8379927973811084,.8384565455650747,.8389197813198476,.8393825060586361,.8398447211884238,.8403064281100062,.8407676282180282,.8412283229010212,.8416885135414399,.8421482015156988,.8426073881942083,.843066074941411,.8435242631158167,.8439819540700386,.8444391491508282,.8448958496991095,.8453520570500146,.8458077725329176,.8462629974714685,.8467177331836275,.8471719809816981,.8476257421723606,.8480790180567055,.8485318099302657,.8489841190830497,.8494359467995736,.8498872943588931,.8503381630346358,.8507885540950325,.8512384688029485,.8516879084159152,.8521368741861606,.85258536736064,.8530333891810667,.8534809408839426,.8539280237005873,.8543746388571686,.854820787574732,.8552664710692298,.8557116905515508,.8561564472275487,.856600742298071,.8570445769589876,.8574879524012193,.8579308698107657,.8583733303687329,.8588153352513616,.8592568856300545,.859697982671404,.8601386275372181,.8605788213845489,.8610185653657182,.8614578606283446,.8618967083153697,.8623351095650842,.8627730655111538,.8632105772826455,.8636476460040526,.8640842727953206,.8645204587718719,.8649562050446316,.8653915127200517,.8658263829001364,.8662608166824664,.866694815160223,.8671283794222129,.8675615105528918,.8679942096323882,.8684264777365276,.8688583159368556,.8692897253006614,.8697207068910011,.8701512617667205,.8705813909824783,.8710110955887687,.871440376631944,.8718692351542368,.8722976721937826,.872725688784642,.8731532859568221,.8735804647362989,.8740072261450385,.8744335712010189,.8748595009182516,.8752850163068022,.8757101183728118,.876134808118518,.8765590865422758,.8769829546385779,.8774064133980755,.8778294638075984,.8782521068501757,.8786743435050556,.879096174747725,.87951760154993,.8799386248796953,.8803592457013438,.8807794649755161,.8811992836591893,.8816187027056972,.8820377230647484,.8824563456824455,.8828745715013043,.8832924014602719,.8837098364947455,.884126877536591,.8845435255141612,.8849597813523133,.8853756459724286,.8857911202924285,.8862062052267938,.8866209016865818,.8870352105794438,.8874491328096428,.8878626692780711,.888275820882267,.8886885885164322,.8891009730714491,.8895129754348972,.8899245964910704,.8903358371209934,.8907466982024383,.8911571806099414,.8915672852148191,.8919770128851846,.8923863644859639,.8927953408789115,.8932039429226274,.8936121714725718,.8940200273810814,.8944275114973853,.8948346246676199,.895241367734845,.8956477415390587,.8960537469172131,.896459384703229,.8968646557280114,.8972695608194643,.8976741008025054,.8980782764990811,.8984820887281812,.8988855383058536,.8992886260452183,.8996913527564827,.9000937192469548,.9004957263210588,.9008973747803478,.9012986654235191,.9016995990464275,.9021001764420992,.9025003984007458,.9029002657097783,.9032997791538201,.9036989395147207,.9040977475715697,.9044962041007096,.9048943098757493,.9052920656675773,.9056894722443748,.906086530371629,.9064832408121458,.9068796043260627,.9072756216708617,.9076712936013822,.9080666208698333,.9084616042258066,.9088562444162888,.909250542185674,.909644498275776,.9100381134258407,.9104313883725582,.9108243238500753,.9112169205900067,.911609179321448,.9120011007709872,.912392685662716,.9127839347182426,.9131748486567027,.9135654281947713,.9139556740466742,.9143455869241996,.9147351675367098,.9151244165911517,.9155133347920691,.9159019228416131,.9162901814395539,.9166781112832916,.9170657130678669,.9174529874859728,.9178399352279649,.9182265569818724,.9186128534334087,.9189988252659826,.9193844731607087,.9197697977964173,.9201547998496661,.9205394799947498,.9209238389037109,.9213078772463497,.9216915956902347,.9220749949007134,.9224580755409214,.9228408382717931,.9232232837520717,.9236054126383193,.9239872255849265,.9243687232441223,.9247499062659842,.9251307752984477,.925511330987316,.9258915739762699,.9262715049068767,.9266511244186009,.9270304331488122,.9274094317327963,.9277881208037635,.9281665009928579,.9285445729291671,.9289223372397313,.9292997945495522,.9296769454816025,.9300537906568345,.9304303306941893,.9308065662106061,.9311824978210302,.931558126138423,.9319334517737698,.9323084753360892,.9326831974324412,.9330576186679365,.9334317396457447,.9338055609671028,.934179083231324,.934552307035806,.9349252329760395,.935297861645616,.935670193636237,.936042229537722,.936413969938016,.9367854154231987,.937156566577492,.9375274239832683,.9378979882210586,.9382682598695602,.938638239505645,.9390079277043673,.9393773250389714,.9397464320808999,.9401152493998012,.9404837775635372,.9408520171381909,.9412199686880747,.9415876327757369,.9419550099619702,.9423221008058192,.9426889058645871,.943055425693844,.9434216608474337,.9437876118774816,.9441532793344015,.9445186637669033,.944883765722,.9452485857450149,.9456131243795891,.945977382167688,.9463413596496092,.9467050573639889,.9470684758478091,.9474316156364045,.9477944772634701,.9481570612610669,.9485193681596299,.948881398487974,.9492431527733017,.9496046315412092,.9499658353156932,.950326764619158,.9506874199724215,.9510478018947224,.9514079109037265,.9517677475155331,.9521273122446822,.9524866056041599,.9528456281054056,.9532043802583186,.9535628625712634,.9539210755510774,.9542790197030759,.9546366955310597,.9549941035373201,.9553512442226458,.955708118086329,.9560647256261716,.956421067338491,.9567771437181263,.9571329552584446,.9574885024513466,.9578437857872732,.9581988057552107,.9585535628426971,.9589080575358283,.9592622903192632,.9596162616762304,.9599699720885332,.9603234220365561,.9606766119992698,.9610295424542377,.9613822138776207,.9617346267441839,.9620867815273011,.9624386786989614,.962790318729774,.9631417020889744,.9634928292444291,.963843700662642,.9641943168087592,.9645446781465745,.9648947851385351,.9652446382457469,.9655942379279795,.9659435846436719,.9662926788499377,.9666415210025703,.9669901115560479,.9673384509635392,.9676865396769084,.9680343781467202,.9683819668222451,.9687293061514642,.969076396581075,.9694232385564956,.9697698325218702,.970116178920074,.9704622781927181,.970808130780155,.9711537371214826,.9714990976545498,.9718442128159609,.9721890830410812,.972533708764041,.9728780904177409,.9732222284338563,.9735661232428426,.9739097752739395,.9742531849551758,.9745963527133741,.9749392789741559,.9752819641619453,.9756244086999749,.9759666130102891,.9763085775137494,.9766503026300392,.9769917887776673,.9773330363739738,.9776740458351333,.9780148175761602,.9783553520109127,.9786956495520978,.9790357106112746,.97937553559886,.9797151249241322,.9800544789952351,.9803935982191831,.9807324830018651,.9810711337480483,.9814095508613835,.9817477347444082,.9820856857985518,.9824234044241392,.9827608910203951,.9830981459854481,.9834351697163352,.9837719626090052,.9841085250583236,.9844448574580762,.984780960200973,.985116833678653,.9854524782816871,.9857878943995831,.9861230824207893,.9864580427326981,.9867927757216505,.9871272817729397,.9874615612708154,.987795614598487,.9881294421381279,.9884630442708796,.9887964213768549,.989129573835142,.9894625020238087,.9897952063199055,.9901276870994697,.9904599447375294,.9907919796081064,.9911237920842207,.9914553825378941,.9917867513401535,.9921178988610346,.992448825469586,.9927795315338723,.9931100174209779,.9934402834970106,.9937703301271053,.9941001576754271,.9944297665051756,.9947591569785874,.9950883294569406,.9954172843005578,.9957460218688093,.9960745425201175,.996402846611959,.9967309345008691,.997058806542445,.9973864630913489,.9977139045013114,.9980411311251348,.9983681433146974,.998694941420955,.9990215257939463,.9993478967827943,.999674054735711,1];
o.rgb2labwithcbrtmapping=function(e,t,r,o,n){"object"!=typeof o&&(o=a),"object"!=typeof n&&(n=i);var s,l,u,c,d,p,h=n.length;return e=o[e],t=o[t],r=o[r],c=.00433891*e+.00376234915*t+.0018990604648*r,d=.002126*e+.007152*t+722e-6*r,p=177255e-9*e+.00109475308*t+.0087295537*r,c=c>.008856?c>=1?n[h-1]:n[c*h|0]:7.787*c+16/116,d=d>.008856?d>=1?n[h-1]:n[d*h|0]:7.787*d+16/116,p=p>.008856?p>=1?n[h-1]:n[p*h|0]:7.787*p+16/116,s=116*d-16,l=500*(c-d),u=200*(d-p),[2.55*s,l+127,u+127]},o.lab2rgb=function(e){var t=(e[0]/2.55+16)/116,r=(e[1]-127)/500+t,o=t-(e[2]-127)/200,a=t*t*t,i=r*r*r,n=o*o*o;t=a>.008856?a:(t-16/116)/7.787,r=i>.008856?i:(r-16/116)/7.787,o=n>.008856?n:(o-16/116)/7.787,r=.95047*r,t=1*t,o=1.08883*o;var s=3.2406*r+-1.5372*t+o*-.4986,l=r*-.9689+1.8758*t+.0415*o,u=.0557*r+t*-.204+1.057*o;return s=s>.0031308?1.055*Math.pow(s,.41666666666667)-.055:12.92*s,l=l>.0031308?1.055*Math.pow(l,.41666666666667)-.055:12.92*l,u=u>.0031308?1.055*Math.pow(u,.41666666666667)-.055:12.92*u,s=255*s+.5|0,l=255*l+.5|0,u=255*u+.5|0,[s,l,u]};var n;o.releaseLazyMap=function(){n=null},o.lab2rgbwithmapping=function(e,t){"object"!=typeof t&&(t=n||(n=[0,.01262952101661779,.02525904203323558,.03788856304985337,.049711876377871826,.05991457469741709,.06898447286600867,.0772092360066284,.08477358579410943,.091804259875822,.09839255413111209,.10460674144643575,.11049941567981197,.116112082049842,.12147815731101994,.12662500399558943,.13157535287823224,.1363483240840589,.1409601768441825,.14542487095720244,.14975449458714327,.15395959525747982,.1580494394769152,.16203221890462635,.16591521589126665,.16970493774704687,.17340722665014255,.1770273503750349,.18057007776923878,.18403974199157158,.18744029384710506,.19077534704588353,.1940482168277028,.19726195310091915,.20041936901604623,.20352306571797985,.2065754538818233,.20957877252746188,.21253510552056065,.21544639609752403,.21831445969536206,.2211409953214818,.2239275956609244,.22667575608780954,.22938688272237368,.2320622996539648,.2347032554328511,.2373109289190679,.2398864345642407,.24243082719196402,.24494510633355537,.24743022016856214,.2498870691130589,.25231650909335385,.25471935453807176,.25709638111758565,.2594483282563151,.2617759014404253,.26407977434087276,.2663605907694862,.26861896648381073,.27085549085472227,.2730707284093175,.2752652202602596,.2774394854315987,.27959402209005907,.2817293086898797,.28384580503848866,.2859439532895821,.2880241788695442,.29008689134257926,.2921324852194264,.2941613407140744,.296173824452494,.29817029013704466,.30015107916988515,.30211652123843086,.3040669348656343,.3060026279276311,.30792389814107823,.3098310335223196,.3117243128203384,.3136040059252957,.3154703742543138,.3173236711160275,.3191641420553126,.32099202517948666,.3228075514671829,.32461094506100485,.32640242354498716,.328182198207814,.3299504742926743,.331707451234572,.33345332288585067,.3351882777306368,.33691249908885884,.33862616531045336,.3403294499603252,.3420225219945948,.3437055459286266,.34537868199729943,.34704208630795363,.3486959109864158,.3503403043164812,.3519754108732058,.35360137165034033,.3552183241822174,.3568264026603817,.35842573804523775,.3600164581729729,.3615986878579945,.36317254899111157,.36473816063367165,.3662956391078557,.36784509808331944,.3693866486603606,.37092039944977906,.37244645664958986,.3739649241187381,.37547590344795784,.37697949402790815,.3784757931147127,.3799648958930234,.3814468955367197,.3829218832673514,.3843899484104266,.38585117844964034,.3873056590791346,.38875347425387746,.39019470623824154,.3916294356528607,.39305774151983813,.3944797013063766,.3958953909668962,.3973048849837052,.398708256406281,.4001055768892218,.40149691672892146,.40288234489901914,.4042619290846755,.40563573571572004,.40700382999871526,.4083662759479818,.409723136415623,.4110744731205898,.41242034667682187,.4137608166205015,.41509594143645334,.41642577858372254,.41775038452036234,.41906981472746097,.420384123732435,.4216933651316181,.4229975916121692,.42429685497332564,.4255912061470252,.4268806952179194,.4281653714427998,.42944528326945836,.43072047835500143,.4319910035836372,.43325690508395387,.43451822824570774,.43577501773613614,.43702731751581336,.43827517085406376,.4395186203439474,.44075770791683294,.4419924748565711,.44322296181328236,.4444492088167707,.445671255289577,.4468891400596831,.4481029013728773,.44931257690479337,.45051820377263313,.4517198185465818,.45291745726092675,.4541111554248895,.4553009480331786,.45648686957627277,.4576689540504429,.45884723496752006,.46002174536441914,.46119251781242304,.4623595844262362,.46352297687281546,.46468272637998137,.46583886374482125,.46699141934188554,.46814042313118737,.469285904666008,.47042789310051664,.47156641719720765,.4727015053341615,.4738331855121353,.47496148536148547,.47608643214893004,.4772080527841532,.47832637382625737,.479441421490067,.4805532216522879,.4816617998575264,.482767181324172,.48386939095014764,.48496845331853117,.4860643927030504,.4871572330734569,.48824699810078104,.48933371116247054,.4904173953474175,.4914980734608752,.4925757680292682,.49365050130489957,.49472229527055495,.49579117164401115,.49685715188244534,.49792025718675353,.4989805085057765,.5000379265404378,.5010925317477942,.5021443443450035,.5031933843132081,.5042396714013406,.5052832251298499,.5063240647943513,.5073622094692027,.5083976780110088,.5094304890620533,.5104606610536634,.5114882122095067,.512513160548822,.5135355238895871,.514555319851623,.5155725658596376,.5165872791462103,.5175994767547175,.518609175542202,.5196163921821871,.5206211431674361,.5216234448126594,.522623313257169,.5236207644674844,.5246158142398872,.5256084782029289,.5265987718198912,.5275867103912004,.5285723090567965,.5295555827984594,.5305365464420905,.5315152146599541,.5324916019728768,.533465722752407,.5344375912229347,.5354072214637743,.5363746274112078,.5373398228604933,.5383028214678364,.5392636367523269,.5402222820978414,.5411787707549106,.5421331158425572,.5430853303500971,.5440354271389132,.5449834189441957,.545929318376653,.5468731379241937,.5478148899535785,.5487545867120445,.5496922403289016,.550627862817102,.5515614660747821,.5524930618867796,.5534226619261247,.5543502777555052,.5552759208287091,.5561996024920415,.5571213339857184,.5580411264452384,.5589589909027302,.5598749382882796,.5607889794312336,.5617011250614838,.5626113858107291,.5635197722137174,.5644262947094677,.5653309636424726,.5662337892638817,.5671347817326651,.5680339511167598,.5689313073941972,.5698268604542126,.5707206200983378,.5716125960414764,.5725027979129619,.5733912352575995,.5742779175366926,.5751628541290517,.5760460543319896,.5769275273622997,.5778072823572206,.5786853283753848,.5795616743977544,.5804363293285412,.5813093019961135,.5821806011538895,.5830502354812169,.5839182135842398,.5847845439967515,.5856492351810363,.5865122955286974,.5873737333614738,.5882335569320437,.5890917744248176,.5899483939567188,.5908034235779529,.5916568712727662,.5925087449601928,.5933590524947909,.5942078016673694,.5950550002057023,.5959006557752352,.5967447759797787,.5975873683621958,.5984284404050756,.5992679995314003,.6001060531052015,.6009426084322078,.601777672760483,.6026112532810554,.6034433571285388,.6042739913817439,.6051031630642828,.6059308791451635,.6067571465393772,.6075819721084775,.6084053626611514,.6092273249537822,.6100478656910059,.6108669915262589,.6116847090623188,.6125010248518375,.6133159453978685,.614129477154385,.6149416265267927,.6157523998724356,.6165618035010941,.6173698436754775,.6181765266117102,.6189818584798096,.6197858454041609,.6205884934639824,.621389808693787,.6221897970838367,.6229884645805916,.6237858170871525,.6245818604636987,.6253766005279194,.6261700430554399,.6269621937802424,.627753058395081,.628542642551892,.6293309518621987,.6301179918975115,.6309037681897214,.6316882862314913,.6324715514766395,.6332535693405202,.6340343452003991,.6348138843958234,.6355921922289883,.6363692739650979,.6371451348327226,.6379197800241517,.6386932146957418,.6394654439682601,.6402364729272251,.6410063066232419,.6417749500723333,.6425424082562685,.6433086861228857,.6440737885864122,.6448377205277801,.645600486794939,.6463620922031635,.6471225415353585,.6478818395423597,.6486399909432315,.6493970004255614,.6501528726457492,.650907612229295,.6516612237710832,.6524137118356617,.6531650809575201,.6539153356413631,.6546644803623813,.6554125195665185,.6561594576707364,.6569052990632761,.6576500481039163,.6583937091242286,.6591362864278302,.6598777842906337,.6606182069610937,.6613575586604503,.6620958435829714,.6628330658961898,.6635692297411403,.664304339232592,.665038398459279,.6657714114841288,.6665033823444867,.6672343150523395,.6679642135945361,.6686930819330041,.6694209240049673,.6701477437231571,.6708735449760244,.6715983316279475,.6723221075194388,.6730448764673485,.6737666422650662,.6744874086827211,.6752071794673781,.6759259583432347,.6766437490118126,.6773605551521499,.6780763804209894,.6787912284529659,.6795051028607908,.6802180072354358,.6809299451463133,.6816409201414555,.6823509357476922,.6830599954708256,.6837681027958041,.684475261186894,.6851814740878487,.6858867449220779,.6865910770928132,.6872944739832727,.6879969389568239,.6886984753571457,.6893990865083861,.6900987757153224,.6907975462635155,.6914954014194653,.692192344430764,.6928883785262472,.6935835069161438,.6942777327922245,.694971059327949,.6956634896786107,.6963550269814812,.6970456743559527,.6977354349036788,.6984243117087141,.6991123078376528,.699799426339765,.7004856702471326,.7011710425747831,.7018555463208224,.7025391844665666,.7032219599766716,.7039038757992623,.7045849348660602,.7052651400925095,.7059444943779024,.7066230006055029,.7073006616426692,.707977480340976,.7086534595363333,.7093286020491069,.7100029106842357,.7106763882313484,.7113490374648795,.7120208611441837,.7126918620136494,.7133620428028108,.7140314062264597,.7146999549847549,.7153676917633327,.7160346192334134,.7167007400519098,.7173660568615324,.7180305722908951,.7186942889546185,.719357209453434,.720019336374285,.7206806722904288,.7213412197615364,.7220009813337923,.7226599595399918,.7233181568996399,.7239755759190464,.724632219091423,.7252880888969768,.7259431878030049,.7265975182639874,.727251082721679,.7279038836052013,.7285559233311324,.7292072043035966,.7298577289143543,.7305074995428886,.7311565185564938,.7318047883103603,.7324523111476625,.7330990893996414,.7337451253856901,.7343904214134368,.7350349797788271,.7356788027662066,.7363218926484012,.7369642516867986,.7376058821314261,.7382467862210323,.7388869661831627,.7395264242342394,.7401651625796365,.7408031834137572,.741440488920109,.7420770812713791,.7427129626295076,.7433481351457623,.7439826009608107,.744616362204793,.7452494209973932,.7458817794479106,.7465134396553299,.7471444037083915,.7477746736856601,.7484042516555937,.7490331396766116,.749661339797162,.7502888540557885,.7509156844811968,.75154183309232,.7521673018983844,.7527920928989733,.7534162080840919,.7540396494342302,.7546624189204263,.7552845185043287,.7559059501382585,.7565267157652705,.7571468173192143,.7577662567247944,.7583850358976305,.7590031567443164,.7596206211624794,.7602374310408384,.7608535882592614,.7614690946888241,.7620839521918652,.7626981626220444,.7633117278243974,.7639246496353923,.7645369298829836,.7651485703866682,.7657595729575378,.766369939398335,.7669796715035041,.7675887710592457,.7681972398435691,.768805079626343,.7694122921693485,.7700188792263292,.7706248425430432,.7712301838573123,.7718349048990725,.7724390073904231,.773042493045677,.7736453635714078,.7742476206664997,.7748492660221942,.7754503013221389,.7760507282424334,.776650548451678,.7772497636110178,.7778483753741909,.7784463853875732,.7790437952902235,.7796406067139292,.7802368212832507,.7808324406155657,.781427466321113,.7820219000030365,.7826157432574284,.7832089976733718,.7838016648329837,.7843937463114573,.7849852436771035,.7855761584913932,.7861664923089979,.7867562466778316,.7873454231390905,.787934023227294,.7885220484703245,.7891095003894674,.78969638049945,.7902826903084814,.790868431318291,.7914536050241666,.7920382129149933,.7926222564732914,.7932057371752538,.7937886564907835,.7943710158835304,.7949528168109292,.7955340607242347,.7961147490685586,.7966948832829057,.7972744648002096,.7978534950473676,.7984319754452766,.7990099074088677,.7995872923471412,.8001641316632006,.8007404267542867,.8013161790118125,.8018913898213956,.8024660605628923,.8030401926104308,.8036137873324438,.8041868460917015,.8047593702453443,.8053313611449138,.8059028201363865,.806473748560204,.8070441477513057,.8076140190391593,.808183363747792,.8087521831958219,.8093204786964877,.8098882515576799,.8104555030819705,.8110222345666428,.811588447303722,.8121541425800035,.8127193216770835,.8132839858713867,.8138481364341967,.8144117746316832,.8149749017249316,.8155375189699711,.816099627617802,.8166612289144245,.8172223241008661,.8177829144132087,.8183430010826165,.8189025853353624,.819461668392856,.8200202514716689,.8205783357835622,.821135922535513,.8216930129297397,.8222496081637287,.8228057094302597,.8233613179174317,.8239164348086886,.8244710612828438,.8250251985141056,.8255788476721027,.8261320099219078,.8266846864240632,.8272368783346047,.827788586805086,.8283398129826024,.8288905580098155,.829440823024976,.8299906091619481,.8305399175502322,.8310887493149887,.8316371055770607,.8321849874529976,.8327323960550771,.8332793324913279,.833825797865553,.8343717932773512,.8349173198221393,.835462378591175,.8360069706715774,.83655109714635,.8370947590944016,.8376379575905678,.8381806937056326,.8387229685063494,.8392647830554617,.8398061384117246,.8403470356299247,.8408874757609016,.8414274598515679,.8419669889449293,.8425060640801054,.8430446862923493,.8435828566130675,.84412057606984,.84465784568644,.8451946664828526,.8457310394752956,.8462669656762376,.8468024460944176,.8473374817348641,.8478720735989141,.8484062226842315,.8489399299848259,.8494731964910713,.8500060231897245,.8505384110639432,.8510703610933044,.8516018742538222,.8521329515179663,.852663593854679,.8531938022293939,.8537235776040522,.8542529209371217,.854781833183613,.8553103152950976,.8558383682197243,.8563659929022369,.8568931902839906,.8574199613029695,.8579463068938025,.8584722279877803,.8589977255128725,.8595228003937431,.8600474535517671,.860571685905047,.8610954983684285,.8616188918535168,.8621418672686924,.8626644255191268,.8631865675067983,.8637082941305079,.8642296062858937,.864750504865448,.8652709907585314,.8657910648513881,.8663107280271617,.8668299811659093,.8673488251446174,.867867260837216,.8683852891145937,.8689029108446124,.8694201268921217,.8699369381189732,.8704533453840357,.8709693495432085,.8714849514494362,.8720001519527227,.8725149519001453,.8730293521358685,.873543353501158,.8740569568343945,.8745701629710876,.8750829727438886,.8755953869826052,.8761074065142143,.8766190321628751,.8771302647499432,.8776411050939833,.8781515540107819,.8786616123133618,.8791712808119936,.8796805603142088,.8801894516248137,.8806979555459011,.8812060728768631,.8817138044144045,.882221150952554,.8827281132826775,.883234692193491,.8837408884710714,.8842467028988698,.8847521362577235,.8852571893258682,.8857618628789493,.8862661576900348,.8867700745296263,.8872736141656715,.8877767773635756,.8882795648862128,.8887819774939383,.8892840159445996,.8897856809935476,.8902869733936489,.8907878938952963,.8912884432464204,.8917886221925007,.8922884314765765,.8927878718392589,.8932869440187404,.8937856487508071,.8942839867688488,.8947819588038698,.8952795655845005,.8957768078370067,.8962736862853018,.8967702016509559,.8972663546532074,.8977621460089725,.8982575764328569,.8987526466371646,.899247357331909,.8997417092248232,.90023570302137,.9007293394247513,.9012226191359196,.9017155428535865,.9022081112742335,.9027003250921215,.9031921849993009,.9036836916856209,.90417484583874,.9046656481441341,.9051560992851082,.9056461999428044,.9061359507962115,.9066253525221751,.9071144057954066,.9076031112884924,.9080914696719034,.9085794816140041,.9090671477810619,.9095544688372559,.9100414454446862,.9105280782633834,.9110143679513163,.911500315164402,.9119859205565143,.9124711847794927,.9129561084831508,.9134406923152851,.9139249369216844,.9144088429461374,.9148924110304419,.915375641814413,.9158585359358921,.9163410940307543,.9168233167329184,.9173052046743536,.9177867584850888,.9182679787932209,.9187488662249219,.9192294214044485,.9197096449541494,.9201895374944735,.9206690996439783,.9211483320193369,.9216272352353475,.9221058099049397,.9225840566391834,.9230619760472966,.9235395687366524,.9240168353127874,.9244937763794097,.9249703925384051,.9254466843898465,.9259226525320003,.9263982975613347,.9268736200725265,.9273486206584685,.9278232999102779,.9282976584173026,.9287716967671293,.9292454155455901,.9297188153367703,.9301918967230154,.9306646602849383,.9311371066014265,.9316092362496491,.9320810498050639,.9325525478414245,.9330237309307874,.9334945996435183,.9339651545483003,.9344353962121393,.9349053252003717,.9353749420766716,.9358442474030564,.9363132417398943,.9367819256459111,.9372502996781967,.9377183643922115,.9381861203417932,.9386535680791633,.9391207081549341,.9395875411181145,.9400540675161166,.9405202878947628,.9409862027982911,.9414518127693627,.9419171183490671,.9423821200769295,.9428468184909163,.9433112141274416,.9437753075213736,.9442390992060405,.9447025897132368,.9451657795732294,.9456286693147632,.946091259465068,.946553550549864,.9470155430933681,.9474772376182993,.947938634645885,.9483997346958671,.9488605382865075,.9493210459345939,.9497812581554465,.9502411754629217,.9507007983694208,.9511601273858931,.9516191630218428,.9520779057853349,.9525363561829999,.9529945147200402,.9534523819002355,.9539099582259479,.9543672441981287,.9548242403163215,.9552809470786706,.9557373649819242,.9561934945214409,.9566493361911946,.9571048904837803,.957560157890419,.9580151389009636,.9584698340039032,.9589242436863693,.9593783684341407,.9598322087316485,.9602857650619817,.9607390379068922,.9611920277467992,.9616447350607958,.9620971603266527,.9625493040208236,.9630011666184514,.9634527485933709,.9639040504181161,.9643550725639237,.9648058155007385,.9652562796972185,.9657064656207391,.9661563737373994,.9666060045120247,.9670553584081741,.9675044358881427,.9679532374129683,.9684017634424352,.9688500144350788,.969297990848191,.9697456931378244,.9701931217587966,.9706402771646961,.9710871598078853,.9715337701395063,.9719801086094847,.9724261756665348,.9728719717581634,.9733174973306754,.9737627528291767,.9742077386975799,.9746524553786086,.9750969033138012,.9755410829435159,.9759849947069349,.9764286390420681,.976872016385759,.9773151271736872,.9777579718403738,.9782005508191854,.9786428645423387,.9790849134409042,.9795266979448097,.9799682184828468,.9804094754826725,.9808504693708154,.9812912005726785,.9817316695125434,.9821718766135753,.9826118222978263,.9830515069862399,.9834909310986545,.9839300950538076,.9843689992693404,.9848076441618009,.9852460301466487,.9856841576382579,.9861220270499221,.9865596387938579,.9869969932812083,.9874340909220475,.9878709321253837,.9883075172991641,.9887438468502779,.9891799211845601,.9896157407067957,.9900513058207229,.9904866169290382,.9909216744333976,.9913564787344237,.9917910302317056,.9922253293238062,.9926593764082635,.9930931718815946,.9935267161393003,.9939600095758677,.9943930525847745,.9948258455584919,.9952583888884886,.9956906829652349,.9961227281782049,.9965545249158808,.9969860735657569,.9974173745143414,.9978484281471626,.9982792348487693,.9987097950027365,.9991401089916675,.9995701771971982,1]));var r=t.length,o=(e[0]/2.55+16)/116,a=(e[1]-127)/500+o,i=o-(e[2]-127)/200,s=o*o*o,l=a*a*a,u=i*i*i;o=s>.008856?s:(o-16/116)/7.787,a=l>.008856?l:(a-16/116)/7.787,i=u>.008856?u:(i-16/116)/7.787,a=.95047*a,o=1*o,i=1.08883*i;var c=3.2406*a+-1.5372*o+i*-.4986,d=a*-.9689+1.8758*o+.0415*i,p=.0557*a+o*-.204+1.057*i;return c=0>=c?0:c>=1?1:t[c*r|0],d=0>=d?0:d>=1?1:t[d*r|0],p=0>=p?0:p>=1?1:t[p*r|0],c=255*c+.5|0,d=255*d+.5|0,p=255*p+.5|0,[c,d,p]},t.exports=o},{}],75:[function(e,t,r){"use strict";var o={},a=256;o.createColorMapFromListOfYValues=function(e,t,r,n){if("number"!=typeof e||"number"!=typeof t)return o.createIdentityColorMap();if("object"!=typeof n||n.length<1)return i(e,t,r);var s=n.length,l=[],u=(a-1)/s,c=0;if(1==s){for(var d=e,p=n[0],h=t,f=0;a-1>f;f++){var m=f/(a-1),g=1-m,v=g*g*d+2*g*m*p+m*m*h;l[f]=0>v?0:v>255?255:v}if(l[0]=0>e?0:e>255?255:e,l.push(0>t?0:t>255?255:t),r)for(var f=0;a>f;f++)l[f]=l[f]+.5|0;return l}for(var _=0,x=u,d=e,p=n[c],h=.5*(n[c]+n[c+1]),f=0;u>f&&a>f;){var m=f/u,g=1-m,v=g*g*d+2*g*m*p+m*m*h;l[f++]=0>v?0:v>255?255:v}for(;s-2>c;)for(c++,_=c*u,x+=u,d=.5*(n[c-1]+n[c]),p=n[c],h=.5*(n[c]+n[c+1]);x>=f&&a>f;){var m=(f-_)/u,g=1-m,v=g*g*d+2*g*m*p+m*m*h;l[f++]=0>v?0:v>255?255:v}for(_=(c+1)*u,d=.5*(n[c]+n[c+1]),p=n[c+1],h=t;a-1>f;){var m=(f-_)/u,g=1-m,v=g*g*d+2*g*m*p+m*m*h;l[f++]=0>v?0:v>255?255:v}if(l[0]=0>e?0:e>255?255:e,l.push(0>t?0:t>255?255:t),r)for(var f=0;a>f;f++)l[f]=l[f]+.5|0;return l},o.createIdentityColorMap=function(){for(var e=[],t=0;a>t;t++)e[t]=t;return e},o.combineColorMaps=function(e,t){for(var r=[],o=t.length-1,a=0;a<e.length;a++){var i=e[a];if(0>=i)r[a]=t[0];else if(i>=o)r[a]=t[o];else{var n=0|i,s=i-n;r[a]=(1-s)*t[n]+s*t[n+1]}}return r};var i=function(e,t,r){for(var o=[],i=0;a>i;){var n=i/a,s=1-n;o[i]=n*t+s*e,o[i]=o[i]<0?0:o[i]>255?255:o[i],r&&(o[i]=o[i]+.5|0),i++}return o};t.exports=o},{}],76:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping"),i=e("./MoaBitmapBlend"),n=e("../core/MoaAllocAndCopy"),s=e("../core/MoaColor"),l=e("../../../src/js/processors/MoaAdjustmentCurves"),u=(e("./MoaColorConversion"),e("../core/MoaTransform"));o.mulcm=function(e,t){var r=new Array(12);r[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8],r[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9],r[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10],r[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8],r[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9],r[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10],r[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8],r[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9],r[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10],r[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3],r[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7],r[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11];for(var o=0;12>o;o++)e[o]=r[o]},o.getIdentity=function(){return[1,0,0,0,0,1,0,0,0,0,1,0]},o.adjBrightnessContrast=function(e,t,r){var a=128*(1-r),i=a*t,n=r*t,s=[n,0,0,i,0,n,0,i,0,0,n,i];o.mulcm(e,s)},o.adjSaturation=function(e,t){var r=.213*(1-t),a=.715*(1-t),i=.072*(1-t),n=[r+t,a,i,0,r,a+t,i,0,r,a,i+t,0];o.mulcm(e,n)},o.adjBrightness=function(e,t){var r=[t,0,0,0,0,t,0,0,0,0,t,0];o.mulcm(e,r)},o.adjContrast=function(e,t){var r=128*(1-t),a=[t,0,0,r,0,t,0,r,0,0,t,r];o.mulcm(e,a)},o.adjustVibrance=function(e,t){var r=1+.7*(t-1),a=t,i=45*Math.PI/180,n=35.26*Math.PI/180,s=new u;s.preRotateX(i),s.preRotateY(-n),s.preScaleXY(r,a),s.preRotateY(n),s.preRotateX(-i);var l=s.transformMatrix.slice(0,12);o.mulcm(e,l)},o.adjustFade=function(e,t){var r=63.75*t,a=1-.25*t,i=[a,0,0,r,0,a,0,r,0,0,a,r];o.mulcm(e,i)},o.runOperations=function(e,t,r,a){if("string"!=typeof r&&(r="normal"),"number"!=typeof a&&(a=1),"normal"!=r){var s=n.copy(e);if(e.moaGL){var u=e.moaGL.createTexture(e.width,e.height);e.moaGL.copyLastRender(u)}}for(var c=!1,d=0;d<t.length;d++){var p=t[d],h=p.value;switch(p.operation){case"hardSet":var f=[1,0,0,0,0,1,0,0,0,0,1,0],m=p.gain,g=p.entries;if(null==m||null==g)throw new ProcessorError("invalid entries val for hardSet operation.","colorMatrixTransform");for(var v=0;v<g.length;v++)f[v]=g[v]*m;o.colorMatrixTransform(e,f,"normal",1),c=!0;break;case"saturation":var f=o.getIdentity();o.adjSaturation(f,h),o.colorMatrixTransform(e,f,"normal",1),c=!0;break;case"brightness":l.brightnessToReplaceColorMatrix(e,h),c=!0;break;case"contrast":l.contrastToReplaceColorMatrix(e,h),c=!0;break;default:throw new ProcessorError("Operation "+(null!=p?p.operation:void 0)+" not found.","colorMatrixTransform")}if(!c)return!1}if(!c)return!1;if("normal"!=r)if(e.moaGL){var _=e.moaGL.glRenderingObjects.writeTexture,x=e.moaGL.glRenderingObjects.readTexture;e.moaGL.bitmapBlendBitmap(_,u,x,r,a),e.moaGL._swapTextures(),e.moaGL.destroyTexture(u)}else i.blendWithBitmap(e,s,e,r,a),s.data=null;return c},o.colorMatrixTransform=function(e,t,r,o){if("string"!=typeof r&&(r="normal"),"number"!=typeof o&&(o=1),e.moaGL)return void("normal"==r?e.moaGL.renderColorMatrixTransform(t):e.moaGL.renderColorMatrixTransformAndBlendWithOriginal(t,r,o));o=255*o|0;var i,n,l,u=e.data,c=e.data.length,d=0,p="normal"===r&&1===o,h=new s,f=0===t[1]&&0===t[2]&&0===t[4]&&0===t[6]&&0===t[8]&&0===t[9];if(f&&"color"!==r){for(var m,g,v=[],_=[],x=[],w=0;256>w;w++)g=[w,w,w,255],m={r:t[0]*w+t[3]+.5|0,g:t[5]*w+t[7]+.5|0,b:t[10]*w+t[11]+.5|0,a:o},m.r=m.r<0?0:m.r>255?255:m.r,m.g=m.g<0?0:m.g>255?255:m.g,m.b=m.b<0?0:m.b>255?255:m.b,h.blendEmbededAlphaFromArray(g,0,m,r),v[w]=g[0],_[w]=g[1],x[w]=g[2];var y={r:v,g:_,b:x};a.mapHist(e,y)}else for(;c>d;){i=t[0]*u[d]+t[1]*u[d+1]+t[2]*u[d+2]+t[3]+.5|0,n=t[4]*u[d]+t[5]*u[d+1]+t[6]*u[d+2]+t[7]+.5|0,l=t[8]*u[d]+t[9]*u[d+1]+t[10]*u[d+2]+t[11]+.5|0;var b={r:0>i?0:i>255?255:i,g:0>n?0:n>255?255:n,b:0>l?0:l>255?255:l,a:o};p?(u[d]=b.r,u[d+1]=b.g,u[d+2]=b.b):h.blendEmbededAlphaFromArray(u,d,b,r),d+=4}},t.exports=o},{"../../../src/js/processors/MoaAdjustmentCurves":70,"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"../core/MoaTransform":40,"./MoaBitmapBlend":72,"./MoaColorConversion":74,"./MoaHistogramMapping":90}],77:[function(e,t,r){"use strict";var o={},a=e("./MoaResize"),i=(e("../core/MoaMipmap"),e("../core/MoaTransform")),n=e("../core/MoaColor"),s=e("../core/MoaAllocAndCopy");o.compositePremultipliedBitmap=function(e,t,r,o,n,s,l){var u=new i,c=(t.width,t.height,r[0]+.5*r[2]),d=r[1]+.5*r[3],p=1/r[2],h=1/r[3],f=(e.width-1)/(e.height-1);return n&&u.postScaleXY(-1,1),r[2]*e.width+.5|0,r[3]*e.height+.5|0,u.postScaleXY(p,h),u.postScaleXY(1,f),u.postRotateZ(-o*Math.PI/180),u.postScaleXY(1,1/f),u.postTranslate(.5-c,.5-d),a.transformPremultipliedOverlay(e,t,u,s,l),!0},o.compositePremultipliedBitmapWithResize=function(e,t,r,i,n,l,u){var c,d=!1,p=r[2]*e.width|0,h=r[3]*e.height|0,f=p<.5*t.width||h<.5*t.height,m=Math.min(p,t.width),g=Math.min(h,t.height);return f?(c=s.makeBitmap(m,g),a.downscalePremultipliedImage(c,t)):c=t,d=o.compositePremultipliedBitmap(e,c,r,i,n,l,u),f&&(c.data=null),d},o.compositeMipmap=function(e,t,r,o,n,s,l,u){var c=new i,d=(t.originalWidth,t.originalHeight,r[0]+.5*r[2]),p=r[1]+.5*r[3],h=1/r[2],f=1/r[3],m=(e.width-1)/(e.height-1);return n&&c.postScaleXY(-1,1),c.postScaleXY(h,f),c.postScaleXY(1,m),c.postRotateZ(-o*Math.PI/180),c.postScaleXY(1,1/m),c.postTranslate(.5-d,.5-p),a.transformOverlayUsingMipmap(e,t,c,s,l,u),!0},o.compositeBitmapWithoutScalingOrRotation=function(e,t,r,o){var a=(n.prototype.blendEmbededAlphaFromArray,e.data),i=t.data,s=e.width,l=e.height,u=t.width,c=(t.height,r[0]*s+.5|0),d=r[1]*l+.5|0,p=r[2]*s+.5|0,h=r[3]*l+.5|0;p=p>t.width?t.width:p,h=h>t.height?t.height:h;var f=c+p-1,m=d+h-1;c=0>c?0:c,d=0>d?0:d,f=f>s-1?s-1:f,m=m>l-1?l-1:m;for(var g,v,_,x,w=d;m>=w;w++)for(var y=c;f>=y;y++){var b=4*(w*s+y),M=4*((w-d)*u+(y-c));if(g=i[M],v=i[M+1],_=i[M+2],x=i[M+3],0!=x){var C=x*o/255;a[b]=(1-C)*a[b]+o*g,a[b+1]=(1-C)*a[b+1]+o*v,a[b+2]=(1-C)*a[b+2]+o*_,a[b+3]=255}}return!0},t.exports=o},{"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"../core/MoaMipmap":39,"../core/MoaTransform":40,"./MoaResize":94}],78:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogram"),i=(e("./MoaColorConversion"),e("./MoaHistogramMapping")),n=e("../core/MoaAllocAndCopy"),s=(e("./MoaSharpen"),e("./legacy/auto_colors_fade_max_color")),l=e("./MoaAdjustmentCurves"),u=e("./MoaVignette"),c=e("./MoaColorMatrixTransform");o.portrait=function(e){s.autocolorsfade(e,.125),l.contrastCurve(e,.775);var t=c.getIdentity();return c.adjustVibrance(t,1.3),c.adjSaturation(t,1.05),c.colorMatrixTransform(e,t,"normal",1),!0},o.food=function(e){s.autocolorsfade(e,.25);var t=c.getIdentity();return c.adjustVibrance(t,1.3),c.colorMatrixTransform(e,t,"normal",1),l.contrastCurve(e,1.25),u.vignette(e,.8,180,180,180,255,"multiply","normal",!0,0,0),!0},o.scenery=function(e){s.autocolorsfade(e,.25),l.contrastCurve(e,1.15);var t={},r=[0,1,2,3,4,5,6,8,9,10,11,12,13,14,16,17,18,19,20,21,23,24,25,26,27,29,30,31,32,33,35,36,37,38,39,40,42,43,44,45,46,47,49,50,51,52,53,54,56,57,58,59,60,61,62,63,65,66,67,68,69,70,71,72,73,74,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,108,109,110,111,112,113,114,115,116,117,117,118,119,120,121,122,123,124,124,125,126,127,128,129,129,130,131,132,133,134,134,135,136,137,138,138,139,140,141,142,143,143,144,145,146,147,147,148,149,150,151,151,152,153,154,155,155,156,157,158,159,159,160,161,162,163,164,164,165,166,167,168,169,169,170,171,172,173,174,175,176,177,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,218,219,220,221,222,223,224,225,226,227,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,248,249,250,251,252,253,254,255];i.setHistMap(t,r,r,r);var o={blurAmount:18,sharpenVal:.4,gain:.6};d(e,t,o);var a=c.getIdentity();return c.adjSaturation(a,1.1),c.adjustVibrance(a,1.15),c.colorMatrixTransform(e,a,"normal",1),!0},o.night=function(e){s.autocolorsfade(e,.125);var t={},r=[0,1,5,6,8,11,13,16,18,21,23,26,27,30,32,35,36,39,40,43,45,47,49,52,53,56,57,60,61,64,65,66,69,70,73,74,75,78,79,80,82,84,85,86,88,90,91,92,94,95,97,98,99,100,101,103,104,106,107,108,109,110,111,112,113,114,115,116,118,118,119,120,121,122,123,123,124,125,126,127,127,128,129,130,130,131,132,132,133,134,134,135,135,136,137,137,138,138,139,139,140,140,141,141,142,142,143,143,144,144,145,145,146,146,147,147,147,148,148,149,149,149,150,150,151,151,151,151,151,152,152,153,153,153,154,154,155,155,156,156,157,157,157,158,158,159,159,160,160,161,162,162,163,163,163,163,164,165,165,166,166,167,168,168,169,170,171,171,171,172,172,173,174,175,176,176,177,178,178,179,180,181,182,182,183,184,184,185,186,187,188,189,189,190,192,193,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,218,218,220,221,222,223,224,225,227,227,229,229,231,232,233,234,235,237,237,239,239,241,242,243,244,245,246,247,248,250,250,252,252,253,254,255];i.setHistMap(t,r,r,r);var o={blurAmount:25,sharpenVal:.7,gain:.5};return d(e,t,o),!0},o.illuminate=function(e){var t=e.width,r=e.height,o=.8,i=t*r,n=0,s=1,l=4,u=a.getHist(e),c=a.getcdf(u[0]),d=a.getcdf(u[1]),p=a.getcdf(u[2]),h=a.cdfinv(c,n),f=a.cdfinv(c,s),m=a.cdfinv(d,n),g=a.cdfinv(d,s),v=a.cdfinv(p,n),_=a.cdfinv(p,s);h=Math.pow(h,.7),m=Math.pow(m,.7),v=Math.pow(v,.7),f=255-Math.pow(255-f,.7),g=255-Math.pow(255-g,.7),_=255-Math.pow(255-_,.7);var x,w,y=255/(f-h),b=255/(g-m),M=255/(_-v),C=0,T=[];for(w=0;256>w;w++)C+=.213*u[0][w]+.715*u[1][w]+.072*u[2][w],x=C/i,x=0===w?0:255*(x/w),x>1?T[w]=Math.pow(x,.65):T[w]=1;if(T=a.smooth1D(T,l),e.moaGL)return e.moaGL.renderAutoEnhance(o,y,b,M,h,m,v,T),!0;var S,A,E,P,D;for(w=t*r;w--;)E=e.data[4*w],P=e.data[4*w+1],D=e.data[4*w+2],S=T[.213*E+.715*P+.072*D|0],A=S*P+.5|0,E=(E+(E*S-E)*o+(A-P)*(1-o)-h)*y+.5|0,D=(D+(D*S-D)*o+(A-P)*(1-o)-v)*M+.5|0,P=(A-m)*b+.5|0,E>255?E=255:0>E&&(E=0),P>255?P=255:0>P&&(P=0),D>255?D=255:0>D&&(D=0),e.data[4*w]=E,e.data[4*w+1]=P,e.data[4*w+2]=D,e.data[4*w+3]=e.data[4*w+3];return!0},o.hidef=function(e){var t,r=e.width,o=e.height,i=15,n=0,s=.33,l=a.getHist(e),u=[],c=r*o,p=0;for(t=0;256>t;t++)p+=l[1][t],u[t]=p/c,0===t?u[t]=1:u[t]=u[t]/(t/255),u[t]>1?u[t]=Math.pow(u[t],s):u[t]=1/Math.pow(1/u[t],n);for(u=a.smooth1D(u,i),t=0;256>t;t++)u[t]*=t/255,u[t]=255*u[t]+.5|0,u[t]=u[t]<0?0:u[t]>255?255:u[t];return d(e,{r:u,g:u,b:u},{blurAmount:50,sharpenVal:.3,gain:.6}),!0},o.colorfix=function(e){var t=e.width,r=e.height,o=0,i=0,n=[],s=[],l=[],u=[];for(i=0;256>i;i++)n[i]=0,s[i]=0,l[i]=0;var u=[0,.030352698354883748,.060705396709767497,.09105809506465125,.12141079341953499,.15176349177441875,.1821161901293025,.21246888848418624,.24282158683906999,.27317428519395376,.3035269835488375,.3346535763899161,.3676507324047436,.40247170184963066,.43914420374102936,.4776953480693729,.5181516702338386,.5605391624202722,.6048833022857054,.6512090792594475,.6995410187265387,.7499032043226175,.8023192985384995,.8568125618069307,.9134058702220788,.9721217320237849,1.0329823029626937,1.0960094006488246,1.1612245179743885,1.2286488356915872,1.2983032342173013,1.3702083047289686,1.4443843596092545,1.520851442291271,1.599629336550963,1.6807375752887384,1.7641954488384077,1.8500220128379696,1.9382360956935722,2.02885630566524,2.1219010376003555,2.2173884793387386,2.315336617811041,2.4157632448504756,2.518685962736163,2.6241221894849898,2.7320891639074896,2.8426039504420793,2.95568344378088,3.0713443732993633,3.1896033073011534,3.3104766570885054,3.433980680868217,3.5601314875020345,3.688945040110004,3.82043715953465,3.9546235276732835,4.091519690685319,4.231141062080967,4.3735029256973466,4.518620438567554,4.666508633688009,4.8171824226889415,4.970656598412723,5.126945837404324,5.286064702318025,5.448027644244237,5.612849004960009,5.780543019106723,5.95112381629812,6.124605423161761,6.301001765316768,6.480326669290577,6.662593864377289,6.8478169844400165,7.036009569659588,7.227185068231748,7.421356838014963,7.618538148130785,7.818742180518632,8.021982031446832,8.22827071298148,8.437621154414881,8.650046203654977,8.865558628577293,9.084171118340768,9.305896284668744,9.53074666309647,9.758734714186247,9.989872824711389,10.224173308810132,10.461648409110419,10.702310297826761,10.946171077829932,11.193242783690561,11.443537382697373,11.697066775851084,11.953842798834561,12.213877222960187,12.47718175609505,12.743768043564744,13.013647669036429,13.286832155381797,13.563332965520566,13.843161503245183,14.126329114027165,14.412847085805778,14.702726649759498,14.995978981060857,15.292615199615017,15.59264637078274,15.89608350608804,16.2029375639111,16.513219450166762,16.826940018969076,17.14411007328226,17.464740365558505,17.78884159836291,18.116424424986022,18.4474994500441,18.782077230067788,19.120168274079138,19.46178304415758,19.806931955994887,20.155625379439705,20.507873639031693,20.863687014525574,21.223075741405523,21.586050011389926,21.95261997292692,22.32279573168085,22.696587351009835,23.074004852434914,23.45505821610052,23.839757381227102,24.228112246555487,24.620132670783548,25.015828472995345,25.415209433082676,25.818285292159583,26.225065752969623,26.635560480286248,27.04977910130658,27.467731206038465,27.88942634768104,28.31487404299921,28.74408377269175,29.17706498175359,29.613827079832113,30.05437944157765,30.49873140698863,30.946892281750856,31.398871337571755,31.854677812509184,32.31432091129508,32.777809805654215,33.245153634617935,33.71636150483304,34.191442490866095,34.67040563550296,35.15325995004394,35.640014414594354,36.13067797835095,36.62525955988395,37.12376804741491,37.62621229909065,38.13260114325301,38.6429433787049,39.157247774972326,39.67552307256268,40.19777798321958,40.72402119017367,41.25426134839037,41.788507084813745,42.32676699860717,42.86904966139066,43.415363617474895,43.96571738409188,44.52011945162278,45.078578283822345,45.64110231804047,46.20769996544071,46.7783796112159,47.353149614800955,47.93201831008268,48.514994005607036,49.10208498478356,49.693299506087044,50.28864580325687,50.888132085493375,51.49176653765214,52.09955732043543,52.711512570581306,53.32764040105052,53.947948901210715,54.57244613701866,55.201140151200015,55.83403896342679,56.471150570492924,57.11248294648731,57.75804404296506,58.40784178911641,59.06188409193369,59.720178836376334,60.38273388553378,61.04955708078648,61.72065624196511,62.39603916750761,63.07571363461469,63.75968739940326,64.44796819705822,65.14056374198242,65.83748172794485,66.5387298282272,67.24431569576875,67.95424696330939,68.66853124353135,69.38717612919899,70.11018919329732,70.83757798916868,71.56935005064807,72.30551289219693,73.04607400903537,73.79104087727309,74.54042095403875,75.29422167760778,76.05245046752924,76.8151147247507,77.58222183174236,78.35377915261935,79.12979403326302,79.9102738014409,80.69522576692516,81.48465722161012,82.27857543962836,83.07698767746547,83.879901174074,84.6873231509858,85.49926081242339,86.31572134541024,87.13671191987972,87.96223968878317,88.79231178819663,89.62693533742664,90.46611743911495,91.30986517934193,92.15818562772947,93.01108583754237,93.8685728457888,94.73065367331999,95.59733532492861,96.46862478944651,97.34452903984125,98.22505503331172,99.11020971138298,100],c=[0,.09924488254695861,.12504071661525748,.14313588920856027,.1575414309575025,.16970636198605316,.18033991980928551,.18984863055466036,.19848976509391722,.20643767470661487,.21381661776730748,.2207186428753261,.22721406110407222,.2333579349114362,.2391942859295316,.24475892765281868,.2500814332305149,.25518653946003345,.2600951718542145,.26482520821552014,.26939205754235684,.27380910584090884,.27808806426285243,.2822392443945425,.28627177841712054,.2901937969941595,.2940125743549161,.2977346476408758,.3013659158571899,.30491172251223664,.3083769250994826,.311765953881872,.315082861915005,.31833136784577337,.32151489271552486,.3246365917579799,.3276993819951494,.33070596628701154,.3336588543735265,.336560381353843,.3394127239721063,.34221791501818183,.3449778561018543,.34769432901832303,.350369005889286,.3530034582361798,.3555991651191077,.35815752045576577,.360679839618571,.3631673653946448,.36562127338186107,.3680426768844678,.37043263136354043,.37279213849048415,.3751221498457724,.3774235702999315,.3796972611093207,.38194404275540383,.38416469755287136,.3863599720490726,.38853057923469275,.3906772005834086,.39280048793632477,.3949010652453065,.39697953018783444,.3990364556647021,.40107239119071786,.4030878641875543,.40508338118698156,.40705942895191655,.4090164755220073,.41095497118983254,.41287534941322973,.41477802766875577,.41666340825083015,.41853187902070177,.4203838141090141,.4222195745754141,.42403950902835275,.4258439542079576,.42763323553461496,.4294076676256808,.4311675547825421,.43291319145006824,.43464486265033075,.43636284439232104,.43806740405925904,.439758800774965,.44143728575065216,.4431031026133969,.44475648771744863,.4463976704394558,.44802687345860653,.4496443130226092,.45125019920037296,.4528447361221874,.45442812220814444,.4560005503854936,.45756220829557587,.4591132784909362,.46065393862317483,.46218436162206117,.4637047158663982,.4652151653470947,.46671586982287233,.46820698496900803,.4696886625194857,.4711610504029096,.47262429287250746,.4740785306305335,.4755239009473612,.4769605377755387,.47838857185906314,.4798081308381152,.48121933934948075,.48262231912287346,.4840171890733601,.4854040653900775,.4867830616214213,.4881542887568748,.4895178553056373,.4908738673722041,.4922224287290381,.4935636408864699,.4948976031599528,.496224412734793,.49754416472847035,.4988569522506557,.5001628664610298,.501461996624999,.5027544301674005,.5040402527242843,.5053195481928565,.5065923987796591,.5078588850470654,.5091190859581595,.5103730789200669,.5116209398258046,.5128627430947063,.514098561711485,.5153284672639881,.516552529979695,.5177708187610112,.5189834012194042,.520190343708429,.5213917113556842,.5225875680937435,.5237779766901,.524962998776162,.5261426948753368,.5273171244302366,.5284863458290399,.5296504164310403,.530809392591412,.5319633296852224,.5331122821307175,.5342563034119088,.5353954461004848,.5365297618770742,.5376593015518806,.5387841150847137,.5399042516044376,.5410197594278565,.5421306860780567,.5432370783022257,.5443389820889641,.5454364426851102,.5465295046120907,.5476182116818177,.5487026070121426,.5497827330418863,.5508586315454556,.5519303436470633,.5529979098345615,.5540613699729042,.555120763317248,.5561761285257049,.5572275036717572,.5582749262563468,.5593184332196459,.5603580609525242,.5613938453077163,.5624258216107048,.5634540246703222,.564478488789085,.5654992477732644,.5665163349427048,.5675297831403955,.5685396247418045,.5695458916639811,.5705486153744331,.5715478268997879,.5725435568342411,.5735358353478003,.5745246921943311,.5755101567194079,.5764922578679786,.577471024191847,.5784464838569776,.5794186646506286,.5803875939883189,.5813532989206311,.582315806139859,.5832751419864992,.5842313324555962,.5851844032029409,.5861343795511286,.5870812864954806,.5880251487098322,.5889659905521902,.5899038360702656,.5908387090068827,.5917706328052692,.5926996306142294,.5936257252932051,.5945489394172259,.5954692952817516,.5963868149074115,.5973015200446405,.5982134321782173,.599122572531705,.6000289620717986,.60093262151258,.6018335713196846,.6027318317143798,.6036274226775593,.6045203639536548,.6054106750544663,.606298375262915,.6071834836367179,.6080660190119893,.6089460000067677,.6098234450244732,.6106983722572941,.6115707996895061,.6124407451007265,.613308226069102,.6141732599744346,.6150358640012467,.6158960551417848,.6167538501989651,.6176092657892629,.6184623183455441,.6193130241198446,.620161399186094,.6210074594427897,.6218512206156173,.6226926982600246,.623531907763744,.6243688643492697,.6252035830762873,.6260360788440587,.626866366393762,.6276944603107898,.6285203750270028,.6293441248229434,.6301657238300099,.6309851860325884,.6318025252701481,.6326177552392989,.63343088949581,.6342419414565944,.6350509244016576,.6358578514760097,.6366627356915467,.6374655899288959,.6382664269392303,.6390652593460512,.6398620996469384,.6406569602152721,.6414498533019224,.6422407910369122,.6430297854310497,.6438168483775332,.6446019916535295,.6453852269217243,.6461665657318468,.646946019522169,.6477235996209785,.6484993172480279,.6492731835159596,.6500452094317067,.6508154058978702,.651583783714075,.6523503535783013,.6531151260881964,.653878111742364,.6546393209416315,.6553987639902987,.6561564510973654,.6569123923777382,.6576665978534199,.6584190774546778,.6591698410211952,.6599188983032032,.660666258962595,.6614119325740231,.6621559286259783,.6628982565218523,.6636389255809841,.6643779450396892,.6651153240522729,.665851071692029,.6665851969522216,.667317708747053,.6680486159126159,.6687779272078317,.6695056513153739,.6702317968425779,.6709563723223373,.6716793862139855,.6724008469041655,.673120762707686,.6738391418683641,.6745559925598569,.675271322886479,.6759851408840097,.6766974545204868,.6774082716969896,.67811760024841,.6788254479442125,.6795318224891835,.6802367315241687,.6809401826268009,.6816421833122166,.6823427410337628,.6830418631836931,.6837395570938545,.6844358300363635,.6851306892242741,.6858241418122343,.6865161948971349,.6872068555187488,.687896130660361,.6885840272493903,.689270552158001,.6899557122037085,.6906395141499742,.6913219647067927,.6920030705312724,.6926828382282061,.6933612743506347,.6940383854004035,.6947141778287103,.6953886580366461,.6960618323757292,.6967337071484312,.6974042886086962,.6980735829624533,.6987415963681218,.6994083349371105,.7000738047343085,.7007380117785719,.7014009620432023,.7020626614564196,.7027231159018287,.7033823312188793,.7040403132033212,.7046970676076518,.7053526001415594,.7060069164723595,.7066600222254262,.7073119229846179,.7079626242926972,.7086121316517457,.7092604505235738,.7099075863301242,.7105535444538713,.7111983302382154,.7118419489878712,.7124844059692523,.71312570641085,.7137658555036082,.7144048584012926,.7150427202208567,.7156794460428013,.7163150409115315,.7169495098357082,.7175828577885948,.7182150897084011,.718846210498622,.7194762250283715,.720105138132714,.7207329546129908,.721359679237142,.721985316740026,.7226098718237337,.7232333491578999,.7238557533800104,.7244770890957053,.7250973608790793,.7257165732729777,.7263347307892896,.7269518379092367,.7275678990836596,.7281829187333003,.728796901249081,.7294098509923802,.7300217722953055,.7306326694609626,.7312425467637221,.7318514084494824,.7324592587359297,.7330661018127955,.7336719418421106,.7342767829584559,.7348806292692114,.735483484854801,.7360853537689355,.7366862400388527,.737286147665554,.7378850806240391,.7384830428635379,.7390800383077395,.7396760708550189,.7402711443786605,.7408652627270808,.741458429724046,.7420506491688895,.7426419248367259,.7432322604786622,.7438216598220084,.7444101265704832,.7449976644044198,.7455842769809682,.7461699679342954,.7467547408757834,.7473385993942256,.7479215470560205,.748503587405363,.7490847239644346,.7496649602335902,.7502442996915447,.7508227457955557,.7514003019816053,.7519769716645798,.7525527582384471,.7531276650764331,.753701695531195,.7542748529349934,.754847140599863,.7554185618177804,.7559891198608314,.7565588179813753,.7571276594122083,.757695647366725,.7582627850390781,.7588290756043364,.7593945222186415,.7599591280193618,.7605228961252469,.7610858296365782,.7616479316353195,.7622092051852651,.7627696533321872,.7633292791039805,.7638880855108077,.7644460755452401,.7650032521824002,.7655596183801003,.7661151770789814,.7666699312026493,.7672238836578102,.7677770373344053,.7683293951057427,.7688809598286291,.7694317343435,.7699817214745477,.7705309240298498,.7710793448014944,.7716269865657057,.7721738520829675,.772719944098145,.7732652653406075,.7738098185243465,.7743536063480964,.7748966314954512,.775438896634981,.7759804044203481,.7765211574904205,.7770611584693855,.7776004099668616,.7781389145780099,.778676674883643,.7792136934503352,.7797499728305293,.7802855155626435,.7808203241711775,.7813544011668172,.7818877490465378,.7824203702937074,.782952267378188,.783483442756437,.7840138988716062,.7845436381536416,.7850726630193806,.7856009758726495,.7861285791043594,.7866554750926015,.7871816662027413,.7877071547875124,.7882319431871087,.7887560337292759,.7892794287294033,.7898021304906129,.7903241413038489,.7908454634479661,.7913660991898175,.7918860507843407,.7924053204746444,.7929239104920931,.7934418230563915,.7939590603756689,.7944756246465603,.7949915180542906,.7955067427727543,.7960213009645972,.7965351947812954,.7970484263632353,.7975609978397913,.7980729113294042,.7985841689396577,.7990947727673552,.799604724898595,.8001140274088461,.8006226823630215,.8011306918155525,.8016380578104618,.8021447823814357,.8026508675518954,.8031563153350691,.8036611277340616,.8041653067419244,.8046688543417252,.8051717725066162,.8056740631999023,.8061757283751086,.8066767699760472,.8071771899368835,.8076769901822017,.8081761726270704,.8086747391771066,.8091726917285403,.8096700321682774,.8101667623739631,.810662884214044,.81115839954783,.8116533102255556,.8121476180884412,.8126413249687521,.8131344326898597,.8136269430663002,.8141188579038331,.8146101789994995,.8151009081416802,.8155910471101533,.8160805976761496,.8165695616024108,.8170579406432438,.8175457365445769,.8180329510440145,.8185195858708919,.8190056427463286,.8194911233832824,.8199760294866028,.8204603627530825,.8209441248715112,.8214273175227265,.8219099423796651,.8223920011074144,.8228734953632629,.8233544267967502,.8238347970497164,.8243146077563521,.8247938605432471,.8252725570294385,.8257506988264595,.8262282875383863,.8267053247618866,.8271818120862655,.8276577510935128,.8281331433583488,.82860799044827,.8290822939235957,.8295560553375114,.8300292762361152,.830501958158461,.830974102636603,.8314457111956398,.831916785353757,.8323873266222709,.8328573365056704,.8333268165016603,.8337957681012022,.8342641927885572,.8347320920413266,.8351994673304931,.8356663201204616,.8361326518690991,.8365984640277758,.8370637580414035,.8375285353484762,.8379927973811084,.8384565455650747,.8389197813198476,.8393825060586361,.8398447211884238,.8403064281100062,.8407676282180282,.8412283229010212,.8416885135414399,.8421482015156988,.8426073881942083,.843066074941411,.8435242631158167,.8439819540700386,.8444391491508282,.8448958496991095,.8453520570500146,.8458077725329176,.8462629974714685,.8467177331836275,.8471719809816981,.8476257421723606,.8480790180567055,.8485318099302657,.8489841190830497,.8494359467995736,.8498872943588931,.8503381630346358,.8507885540950325,.8512384688029485,.8516879084159152,.8521368741861606,.85258536736064,.8530333891810667,.8534809408839426,.8539280237005873,.8543746388571686,.854820787574732,.8552664710692298,.8557116905515508,.8561564472275487,.856600742298071,.8570445769589876,.8574879524012193,.8579308698107657,.8583733303687329,.8588153352513616,.8592568856300545,.859697982671404,.8601386275372181,.8605788213845489,.8610185653657182,.8614578606283446,.8618967083153697,.8623351095650842,.8627730655111538,.8632105772826455,.8636476460040526,.8640842727953206,.8645204587718719,.8649562050446316,.8653915127200517,.8658263829001364,.8662608166824664,.866694815160223,.8671283794222129,.8675615105528918,.8679942096323882,.8684264777365276,.8688583159368556,.8692897253006614,.8697207068910011,.8701512617667205,.8705813909824783,.8710110955887687,.871440376631944,.8718692351542368,.8722976721937826,.872725688784642,.8731532859568221,.8735804647362989,.8740072261450385,.8744335712010189,.8748595009182516,.8752850163068022,.8757101183728118,.876134808118518,.8765590865422758,.8769829546385779,.8774064133980755,.8778294638075984,.8782521068501757,.8786743435050556,.879096174747725,.87951760154993,.8799386248796953,.8803592457013438,.8807794649755161,.8811992836591893,.8816187027056972,.8820377230647484,.8824563456824455,.8828745715013043,.8832924014602719,.8837098364947455,.884126877536591,.8845435255141612,.8849597813523133,.8853756459724286,.8857911202924285,.8862062052267938,.8866209016865818,.8870352105794438,.8874491328096428,.8878626692780711,.888275820882267,.8886885885164322,.8891009730714491,.8895129754348972,.8899245964910704,.8903358371209934,.8907466982024383,.8911571806099414,.8915672852148191,.8919770128851846,.8923863644859639,.8927953408789115,.8932039429226274,.8936121714725718,.8940200273810814,.8944275114973853,.8948346246676199,.895241367734845,.8956477415390587,.8960537469172131,.896459384703229,.8968646557280114,.8972695608194643,.8976741008025054,.8980782764990811,.8984820887281812,.8988855383058536,.8992886260452183,.8996913527564827,.9000937192469548,.9004957263210588,.9008973747803478,.9012986654235191,.9016995990464275,.9021001764420992,.9025003984007458,.9029002657097783,.9032997791538201,.9036989395147207,.9040977475715697,.9044962041007096,.9048943098757493,.9052920656675773,.9056894722443748,.906086530371629,.9064832408121458,.9068796043260627,.9072756216708617,.9076712936013822,.9080666208698333,.9084616042258066,.9088562444162888,.909250542185674,.909644498275776,.9100381134258407,.9104313883725582,.9108243238500753,.9112169205900067,.911609179321448,.9120011007709872,.912392685662716,.9127839347182426,.9131748486567027,.9135654281947713,.9139556740466742,.9143455869241996,.9147351675367098,.9151244165911517,.9155133347920691,.9159019228416131,.9162901814395539,.9166781112832916,.9170657130678669,.9174529874859728,.9178399352279649,.9182265569818724,.9186128534334087,.9189988252659826,.9193844731607087,.9197697977964173,.9201547998496661,.9205394799947498,.9209238389037109,.9213078772463497,.9216915956902347,.9220749949007134,.9224580755409214,.9228408382717931,.9232232837520717,.9236054126383193,.9239872255849265,.9243687232441223,.9247499062659842,.9251307752984477,.925511330987316,.9258915739762699,.9262715049068767,.9266511244186009,.9270304331488122,.9274094317327963,.9277881208037635,.9281665009928579,.9285445729291671,.9289223372397313,.9292997945495522,.9296769454816025,.9300537906568345,.9304303306941893,.9308065662106061,.9311824978210302,.931558126138423,.9319334517737698,.9323084753360892,.9326831974324412,.9330576186679365,.9334317396457447,.9338055609671028,.934179083231324,.934552307035806,.9349252329760395,.935297861645616,.935670193636237,.936042229537722,.936413969938016,.9367854154231987,.937156566577492,.9375274239832683,.9378979882210586,.9382682598695602,.938638239505645,.9390079277043673,.9393773250389714,.9397464320808999,.9401152493998012,.9404837775635372,.9408520171381909,.9412199686880747,.9415876327757369,.9419550099619702,.9423221008058192,.9426889058645871,.943055425693844,.9434216608474337,.9437876118774816,.9441532793344015,.9445186637669033,.944883765722,.9452485857450149,.9456131243795891,.945977382167688,.9463413596496092,.9467050573639889,.9470684758478091,.9474316156364045,.9477944772634701,.9481570612610669,.9485193681596299,.948881398487974,.9492431527733017,.9496046315412092,.9499658353156932,.950326764619158,.9506874199724215,.9510478018947224,.9514079109037265,.9517677475155331,.9521273122446822,.9524866056041599,.9528456281054056,.9532043802583186,.9535628625712634,.9539210755510774,.9542790197030759,.9546366955310597,.9549941035373201,.9553512442226458,.955708118086329,.9560647256261716,.956421067338491,.9567771437181263,.9571329552584446,.9574885024513466,.9578437857872732,.9581988057552107,.9585535628426971,.9589080575358283,.9592622903192632,.9596162616762304,.9599699720885332,.9603234220365561,.9606766119992698,.9610295424542377,.9613822138776207,.9617346267441839,.9620867815273011,.9624386786989614,.962790318729774,.9631417020889744,.9634928292444291,.963843700662642,.9641943168087592,.9645446781465745,.9648947851385351,.9652446382457469,.9655942379279795,.9659435846436719,.9662926788499377,.9666415210025703,.9669901115560479,.9673384509635392,.9676865396769084,.9680343781467202,.9683819668222451,.9687293061514642,.969076396581075,.9694232385564956,.9697698325218702,.970116178920074,.9704622781927181,.970808130780155,.9711537371214826,.9714990976545498,.9718442128159609,.9721890830410812,.972533708764041,.9728780904177409,.9732222284338563,.9735661232428426,.9739097752739395,.9742531849551758,.9745963527133741,.9749392789741559,.9752819641619453,.9756244086999749,.9759666130102891,.9763085775137494,.9766503026300392,.9769917887776673,.9773330363739738,.9776740458351333,.9780148175761602,.9783553520109127,.9786956495520978,.9790357106112746,.97937553559886,.9797151249241322,.9800544789952351,.9803935982191831,.9807324830018651,.9810711337480483,.9814095508613835,.9817477347444082,.9820856857985518,.9824234044241392,.9827608910203951,.9830981459854481,.9834351697163352,.9837719626090052,.9841085250583236,.9844448574580762,.984780960200973,.985116833678653,.9854524782816871,.9857878943995831,.9861230824207893,.9864580427326981,.9867927757216505,.9871272817729397,.9874615612708154,.987795614598487,.9881294421381279,.9884630442708796,.9887964213768549,.989129573835142,.9894625020238087,.9897952063199055,.9901276870994697,.9904599447375294,.9907919796081064,.9911237920842207,.9914553825378941,.9917867513401535,.9921178988610346,.992448825469586,.9927795315338723,.9931100174209779,.9934402834970106,.9937703301271053,.9941001576754271,.9944297665051756,.9947591569785874,.9950883294569406,.9954172843005578,.9957460218688093,.9960745425201175,.996402846611959,.9967309345008691,.997058806542445,.9973864630913489,.9977139045013114,.9980411311251348,.9983681433146974,.998694941420955,.9990215257939463,.9993478967827943,.999674054735711,1],d=[0,.01262952101661779,.02525904203323558,.03788856304985337,.049711876377871826,.05991457469741709,.06898447286600867,.0772092360066284,.08477358579410943,.091804259875822,.09839255413111209,.10460674144643575,.11049941567981197,.116112082049842,.12147815731101994,.12662500399558943,.13157535287823224,.1363483240840589,.1409601768441825,.14542487095720244,.14975449458714327,.15395959525747982,.1580494394769152,.16203221890462635,.16591521589126665,.16970493774704687,.17340722665014255,.1770273503750349,.18057007776923878,.18403974199157158,.18744029384710506,.19077534704588353,.1940482168277028,.19726195310091915,.20041936901604623,.20352306571797985,.2065754538818233,.20957877252746188,.21253510552056065,.21544639609752403,.21831445969536206,.2211409953214818,.2239275956609244,.22667575608780954,.22938688272237368,.2320622996539648,.2347032554328511,.2373109289190679,.2398864345642407,.24243082719196402,.24494510633355537,.24743022016856214,.2498870691130589,.25231650909335385,.25471935453807176,.25709638111758565,.2594483282563151,.2617759014404253,.26407977434087276,.2663605907694862,.26861896648381073,.27085549085472227,.2730707284093175,.2752652202602596,.2774394854315987,.27959402209005907,.2817293086898797,.28384580503848866,.2859439532895821,.2880241788695442,.29008689134257926,.2921324852194264,.2941613407140744,.296173824452494,.29817029013704466,.30015107916988515,.30211652123843086,.3040669348656343,.3060026279276311,.30792389814107823,.3098310335223196,.3117243128203384,.3136040059252957,.3154703742543138,.3173236711160275,.3191641420553126,.32099202517948666,.3228075514671829,.32461094506100485,.32640242354498716,.328182198207814,.3299504742926743,.331707451234572,.33345332288585067,.3351882777306368,.33691249908885884,.33862616531045336,.3403294499603252,.3420225219945948,.3437055459286266,.34537868199729943,.34704208630795363,.3486959109864158,.3503403043164812,.3519754108732058,.35360137165034033,.3552183241822174,.3568264026603817,.35842573804523775,.3600164581729729,.3615986878579945,.36317254899111157,.36473816063367165,.3662956391078557,.36784509808331944,.3693866486603606,.37092039944977906,.37244645664958986,.3739649241187381,.37547590344795784,.37697949402790815,.3784757931147127,.3799648958930234,.3814468955367197,.3829218832673514,.3843899484104266,.38585117844964034,.3873056590791346,.38875347425387746,.39019470623824154,.3916294356528607,.39305774151983813,.3944797013063766,.3958953909668962,.3973048849837052,.398708256406281,.4001055768892218,.40149691672892146,.40288234489901914,.4042619290846755,.40563573571572004,.40700382999871526,.4083662759479818,.409723136415623,.4110744731205898,.41242034667682187,.4137608166205015,.41509594143645334,.41642577858372254,.41775038452036234,.41906981472746097,.420384123732435,.4216933651316181,.4229975916121692,.42429685497332564,.4255912061470252,.4268806952179194,.4281653714427998,.42944528326945836,.43072047835500143,.4319910035836372,.43325690508395387,.43451822824570774,.43577501773613614,.43702731751581336,.43827517085406376,.4395186203439474,.44075770791683294,.4419924748565711,.44322296181328236,.4444492088167707,.445671255289577,.4468891400596831,.4481029013728773,.44931257690479337,.45051820377263313,.4517198185465818,.45291745726092675,.4541111554248895,.4553009480331786,.45648686957627277,.4576689540504429,.45884723496752006,.46002174536441914,.46119251781242304,.4623595844262362,.46352297687281546,.46468272637998137,.46583886374482125,.46699141934188554,.46814042313118737,.469285904666008,.47042789310051664,.47156641719720765,.4727015053341615,.4738331855121353,.47496148536148547,.47608643214893004,.4772080527841532,.47832637382625737,.479441421490067,.4805532216522879,.4816617998575264,.482767181324172,.48386939095014764,.48496845331853117,.4860643927030504,.4871572330734569,.48824699810078104,.48933371116247054,.4904173953474175,.4914980734608752,.4925757680292682,.49365050130489957,.49472229527055495,.49579117164401115,.49685715188244534,.49792025718675353,.4989805085057765,.5000379265404378,.5010925317477942,.5021443443450035,.5031933843132081,.5042396714013406,.5052832251298499,.5063240647943513,.5073622094692027,.5083976780110088,.5094304890620533,.5104606610536634,.5114882122095067,.512513160548822,.5135355238895871,.514555319851623,.5155725658596376,.5165872791462103,.5175994767547175,.518609175542202,.5196163921821871,.5206211431674361,.5216234448126594,.522623313257169,.5236207644674844,.5246158142398872,.5256084782029289,.5265987718198912,.5275867103912004,.5285723090567965,.5295555827984594,.5305365464420905,.5315152146599541,.5324916019728768,.533465722752407,.5344375912229347,.5354072214637743,.5363746274112078,.5373398228604933,.5383028214678364,.5392636367523269,.5402222820978414,.5411787707549106,.5421331158425572,.5430853303500971,.5440354271389132,.5449834189441957,.545929318376653,.5468731379241937,.5478148899535785,.5487545867120445,.5496922403289016,.550627862817102,.5515614660747821,.5524930618867796,.5534226619261247,.5543502777555052,.5552759208287091,.5561996024920415,.5571213339857184,.5580411264452384,.5589589909027302,.5598749382882796,.5607889794312336,.5617011250614838,.5626113858107291,.5635197722137174,.5644262947094677,.5653309636424726,.5662337892638817,.5671347817326651,.5680339511167598,.5689313073941972,.5698268604542126,.5707206200983378,.5716125960414764,.5725027979129619,.5733912352575995,.5742779175366926,.5751628541290517,.5760460543319896,.5769275273622997,.5778072823572206,.5786853283753848,.5795616743977544,.5804363293285412,.5813093019961135,.5821806011538895,.5830502354812169,.5839182135842398,.5847845439967515,.5856492351810363,.5865122955286974,.5873737333614738,.5882335569320437,.5890917744248176,.5899483939567188,.5908034235779529,.5916568712727662,.5925087449601928,.5933590524947909,.5942078016673694,.5950550002057023,.5959006557752352,.5967447759797787,.5975873683621958,.5984284404050756,.5992679995314003,.6001060531052015,.6009426084322078,.601777672760483,.6026112532810554,.6034433571285388,.6042739913817439,.6051031630642828,.6059308791451635,.6067571465393772,.6075819721084775,.6084053626611514,.6092273249537822,.6100478656910059,.6108669915262589,.6116847090623188,.6125010248518375,.6133159453978685,.614129477154385,.6149416265267927,.6157523998724356,.6165618035010941,.6173698436754775,.6181765266117102,.6189818584798096,.6197858454041609,.6205884934639824,.621389808693787,.6221897970838367,.6229884645805916,.6237858170871525,.6245818604636987,.6253766005279194,.6261700430554399,.6269621937802424,.627753058395081,.628542642551892,.6293309518621987,.6301179918975115,.6309037681897214,.6316882862314913,.6324715514766395,.6332535693405202,.6340343452003991,.6348138843958234,.6355921922289883,.6363692739650979,.6371451348327226,.6379197800241517,.6386932146957418,.6394654439682601,.6402364729272251,.6410063066232419,.6417749500723333,.6425424082562685,.6433086861228857,.6440737885864122,.6448377205277801,.645600486794939,.6463620922031635,.6471225415353585,.6478818395423597,.6486399909432315,.6493970004255614,.6501528726457492,.650907612229295,.6516612237710832,.6524137118356617,.6531650809575201,.6539153356413631,.6546644803623813,.6554125195665185,.6561594576707364,.6569052990632761,.6576500481039163,.6583937091242286,.6591362864278302,.6598777842906337,.6606182069610937,.6613575586604503,.6620958435829714,.6628330658961898,.6635692297411403,.664304339232592,.665038398459279,.6657714114841288,.6665033823444867,.6672343150523395,.6679642135945361,.6686930819330041,.6694209240049673,.6701477437231571,.6708735449760244,.6715983316279475,.6723221075194388,.6730448764673485,.6737666422650662,.6744874086827211,.6752071794673781,.6759259583432347,.6766437490118126,.6773605551521499,.6780763804209894,.6787912284529659,.6795051028607908,.6802180072354358,.6809299451463133,.6816409201414555,.6823509357476922,.6830599954708256,.6837681027958041,.684475261186894,.6851814740878487,.6858867449220779,.6865910770928132,.6872944739832727,.6879969389568239,.6886984753571457,.6893990865083861,.6900987757153224,.6907975462635155,.6914954014194653,.692192344430764,.6928883785262472,.6935835069161438,.6942777327922245,.694971059327949,.6956634896786107,.6963550269814812,.6970456743559527,.6977354349036788,.6984243117087141,.6991123078376528,.699799426339765,.7004856702471326,.7011710425747831,.7018555463208224,.7025391844665666,.7032219599766716,.7039038757992623,.7045849348660602,.7052651400925095,.7059444943779024,.7066230006055029,.7073006616426692,.707977480340976,.7086534595363333,.7093286020491069,.7100029106842357,.7106763882313484,.7113490374648795,.7120208611441837,.7126918620136494,.7133620428028108,.7140314062264597,.7146999549847549,.7153676917633327,.7160346192334134,.7167007400519098,.7173660568615324,.7180305722908951,.7186942889546185,.719357209453434,.720019336374285,.7206806722904288,.7213412197615364,.7220009813337923,.7226599595399918,.7233181568996399,.7239755759190464,.724632219091423,.7252880888969768,.7259431878030049,.7265975182639874,.727251082721679,.7279038836052013,.7285559233311324,.7292072043035966,.7298577289143543,.7305074995428886,.7311565185564938,.7318047883103603,.7324523111476625,.7330990893996414,.7337451253856901,.7343904214134368,.7350349797788271,.7356788027662066,.7363218926484012,.7369642516867986,.7376058821314261,.7382467862210323,.7388869661831627,.7395264242342394,.7401651625796365,.7408031834137572,.741440488920109,.7420770812713791,.7427129626295076,.7433481351457623,.7439826009608107,.744616362204793,.7452494209973932,.7458817794479106,.7465134396553299,.7471444037083915,.7477746736856601,.7484042516555937,.7490331396766116,.749661339797162,.7502888540557885,.7509156844811968,.75154183309232,.7521673018983844,.7527920928989733,.7534162080840919,.7540396494342302,.7546624189204263,.7552845185043287,.7559059501382585,.7565267157652705,.7571468173192143,.7577662567247944,.7583850358976305,.7590031567443164,.7596206211624794,.7602374310408384,.7608535882592614,.7614690946888241,.7620839521918652,.7626981626220444,.7633117278243974,.7639246496353923,.7645369298829836,.7651485703866682,.7657595729575378,.766369939398335,.7669796715035041,.7675887710592457,.7681972398435691,.768805079626343,.7694122921693485,.7700188792263292,.7706248425430432,.7712301838573123,.7718349048990725,.7724390073904231,.773042493045677,.7736453635714078,.7742476206664997,.7748492660221942,.7754503013221389,.7760507282424334,.776650548451678,.7772497636110178,.7778483753741909,.7784463853875732,.7790437952902235,.7796406067139292,.7802368212832507,.7808324406155657,.781427466321113,.7820219000030365,.7826157432574284,.7832089976733718,.7838016648329837,.7843937463114573,.7849852436771035,.7855761584913932,.7861664923089979,.7867562466778316,.7873454231390905,.787934023227294,.7885220484703245,.7891095003894674,.78969638049945,.7902826903084814,.790868431318291,.7914536050241666,.7920382129149933,.7926222564732914,.7932057371752538,.7937886564907835,.7943710158835304,.7949528168109292,.7955340607242347,.7961147490685586,.7966948832829057,.7972744648002096,.7978534950473676,.7984319754452766,.7990099074088677,.7995872923471412,.8001641316632006,.8007404267542867,.8013161790118125,.8018913898213956,.8024660605628923,.8030401926104308,.8036137873324438,.8041868460917015,.8047593702453443,.8053313611449138,.8059028201363865,.806473748560204,.8070441477513057,.8076140190391593,.808183363747792,.8087521831958219,.8093204786964877,.8098882515576799,.8104555030819705,.8110222345666428,.811588447303722,.8121541425800035,.8127193216770835,.8132839858713867,.8138481364341967,.8144117746316832,.8149749017249316,.8155375189699711,.816099627617802,.8166612289144245,.8172223241008661,.8177829144132087,.8183430010826165,.8189025853353624,.819461668392856,.8200202514716689,.8205783357835622,.821135922535513,.8216930129297397,.8222496081637287,.8228057094302597,.8233613179174317,.8239164348086886,.8244710612828438,.8250251985141056,.8255788476721027,.8261320099219078,.8266846864240632,.8272368783346047,.827788586805086,.8283398129826024,.8288905580098155,.829440823024976,.8299906091619481,.8305399175502322,.8310887493149887,.8316371055770607,.8321849874529976,.8327323960550771,.8332793324913279,.833825797865553,.8343717932773512,.8349173198221393,.835462378591175,.8360069706715774,.83655109714635,.8370947590944016,.8376379575905678,.8381806937056326,.8387229685063494,.8392647830554617,.8398061384117246,.8403470356299247,.8408874757609016,.8414274598515679,.8419669889449293,.8425060640801054,.8430446862923493,.8435828566130675,.84412057606984,.84465784568644,.8451946664828526,.8457310394752956,.8462669656762376,.8468024460944176,.8473374817348641,.8478720735989141,.8484062226842315,.8489399299848259,.8494731964910713,.8500060231897245,.8505384110639432,.8510703610933044,.8516018742538222,.8521329515179663,.852663593854679,.8531938022293939,.8537235776040522,.8542529209371217,.854781833183613,.8553103152950976,.8558383682197243,.8563659929022369,.8568931902839906,.8574199613029695,.8579463068938025,.8584722279877803,.8589977255128725,.8595228003937431,.8600474535517671,.860571685905047,.8610954983684285,.8616188918535168,.8621418672686924,.8626644255191268,.8631865675067983,.8637082941305079,.8642296062858937,.864750504865448,.8652709907585314,.8657910648513881,.8663107280271617,.8668299811659093,.8673488251446174,.867867260837216,.8683852891145937,.8689029108446124,.8694201268921217,.8699369381189732,.8704533453840357,.8709693495432085,.8714849514494362,.8720001519527227,.8725149519001453,.8730293521358685,.873543353501158,.8740569568343945,.8745701629710876,.8750829727438886,.8755953869826052,.8761074065142143,.8766190321628751,.8771302647499432,.8776411050939833,.8781515540107819,.8786616123133618,.8791712808119936,.8796805603142088,.8801894516248137,.8806979555459011,.8812060728768631,.8817138044144045,.882221150952554,.8827281132826775,.883234692193491,.8837408884710714,.8842467028988698,.8847521362577235,.8852571893258682,.8857618628789493,.8862661576900348,.8867700745296263,.8872736141656715,.8877767773635756,.8882795648862128,.8887819774939383,.8892840159445996,.8897856809935476,.8902869733936489,.8907878938952963,.8912884432464204,.8917886221925007,.8922884314765765,.8927878718392589,.8932869440187404,.8937856487508071,.8942839867688488,.8947819588038698,.8952795655845005,.8957768078370067,.8962736862853018,.8967702016509559,.8972663546532074,.8977621460089725,.8982575764328569,.8987526466371646,.899247357331909,.8997417092248232,.90023570302137,.9007293394247513,.9012226191359196,.9017155428535865,.9022081112742335,.9027003250921215,.9031921849993009,.9036836916856209,.90417484583874,.9046656481441341,.9051560992851082,.9056461999428044,.9061359507962115,.9066253525221751,.9071144057954066,.9076031112884924,.9080914696719034,.9085794816140041,.9090671477810619,.9095544688372559,.9100414454446862,.9105280782633834,.9110143679513163,.911500315164402,.9119859205565143,.9124711847794927,.9129561084831508,.9134406923152851,.9139249369216844,.9144088429461374,.9148924110304419,.915375641814413,.9158585359358921,.9163410940307543,.9168233167329184,.9173052046743536,.9177867584850888,.9182679787932209,.9187488662249219,.9192294214044485,.9197096449541494,.9201895374944735,.9206690996439783,.9211483320193369,.9216272352353475,.9221058099049397,.9225840566391834,.9230619760472966,.9235395687366524,.9240168353127874,.9244937763794097,.9249703925384051,.9254466843898465,.9259226525320003,.9263982975613347,.9268736200725265,.9273486206584685,.9278232999102779,.9282976584173026,.9287716967671293,.9292454155455901,.9297188153367703,.9301918967230154,.9306646602849383,.9311371066014265,.9316092362496491,.9320810498050639,.9325525478414245,.9330237309307874,.9334945996435183,.9339651545483003,.9344353962121393,.9349053252003717,.9353749420766716,.9358442474030564,.9363132417398943,.9367819256459111,.9372502996781967,.9377183643922115,.9381861203417932,.9386535680791633,.9391207081549341,.9395875411181145,.9400540675161166,.9405202878947628,.9409862027982911,.9414518127693627,.9419171183490671,.9423821200769295,.9428468184909163,.9433112141274416,.9437753075213736,.9442390992060405,.9447025897132368,.9451657795732294,.9456286693147632,.946091259465068,.946553550549864,.9470155430933681,.9474772376182993,.947938634645885,.9483997346958671,.9488605382865075,.9493210459345939,.9497812581554465,.9502411754629217,.9507007983694208,.9511601273858931,.9516191630218428,.9520779057853349,.9525363561829999,.9529945147200402,.9534523819002355,.9539099582259479,.9543672441981287,.9548242403163215,.9552809470786706,.9557373649819242,.9561934945214409,.9566493361911946,.9571048904837803,.957560157890419,.9580151389009636,.9584698340039032,.9589242436863693,.9593783684341407,.9598322087316485,.9602857650619817,.9607390379068922,.9611920277467992,.9616447350607958,.9620971603266527,.9625493040208236,.9630011666184514,.9634527485933709,.9639040504181161,.9643550725639237,.9648058155007385,.9652562796972185,.9657064656207391,.9661563737373994,.9666060045120247,.9670553584081741,.9675044358881427,.9679532374129683,.9684017634424352,.9688500144350788,.969297990848191,.9697456931378244,.9701931217587966,.9706402771646961,.9710871598078853,.9715337701395063,.9719801086094847,.9724261756665348,.9728719717581634,.9733174973306754,.9737627528291767,.9742077386975799,.9746524553786086,.9750969033138012,.9755410829435159,.9759849947069349,.9764286390420681,.976872016385759,.9773151271736872,.9777579718403738,.9782005508191854,.9786428645423387,.9790849134409042,.9795266979448097,.9799682184828468,.9804094754826725,.9808504693708154,.9812912005726785,.9817316695125434,.9821718766135753,.9826118222978263,.9830515069862399,.9834909310986545,.9839300950538076,.9843689992693404,.9848076441618009,.9852460301466487,.9856841576382579,.9861220270499221,.9865596387938579,.9869969932812083,.9874340909220475,.9878709321253837,.9883075172991641,.9887438468502779,.9891799211845601,.9896157407067957,.9900513058207229,.9904866169290382,.9909216744333976,.9913564787344237,.9917910302317056,.9922253293238062,.9926593764082635,.9930931718815946,.9935267161393003,.9939600095758677,.9943930525847745,.9948258455584919,.9952583888884886,.9956906829652349,.9961227281782049,.9965545249158808,.9969860735657569,.9974173745143414,.9978484281471626,.9982792348487693,.9987097950027365,.9991401089916675,.9995701771971982,1],p=[];
if(e.moaGL)e.moaGL.renderConvertRGBToLAB(),p=a.getHist(e);else{var h,f,m=[];for(h=0;r>h;h+=2)for(f=0;t>f;f+=2){o=4*f+4*h*t;var g,v,_,x,w,y,b,M,C,T=c.length;b=u[e.data[o]],M=u[e.data[o+1]],C=u[e.data[o+2]],x=.00433891*b+.00376234915*M+.0018990604648*C,w=.002126*b+.007152*M+722e-6*C,y=177255e-9*b+.00109475308*M+.0087295537*C,x=x>.008856?x>=1?c[T-1]:c[x*T|0]:7.787*x+16/116,w=w>.008856?w>=1?c[T-1]:c[w*T|0]:7.787*w+16/116,y=y>.008856?y>=1?c[T-1]:c[y*T|0]:7.787*y+16/116,g=116*w-16,v=500*(x-w),_=200*(w-y),m[0]=2.55*g,m[1]=v+127,m[2]=_+127,n[m[0]+.5|0]++,s[m[1]+.5|0]++,l[m[2]+.5|0]++}p[0]=n,p[1]=s,p[2]=l}var S,A=a.getcdf(p[1]),E=a.getcdf(p[2]),P=.1,D=.9,F=a.cdfinv(A,P),L=a.cdfinv(E,P),R=a.cdfinv(A,D),I=a.cdfinv(E,D),B=(F+R)/2-127,O=(L+I)/2-127,N=0,k=1,U=.5;S=0>B?-Math.pow(-U*B,k):Math.pow(U*B,k),N=0>O?-Math.pow(-U*O,k):Math.pow(U*O,k);var W=127/(127+S),G=127/(127+N);if(e.moaGL)return e.moaGL.renderConvertLABToRGB(W,G),!0;for(h=0;r>h;h++)for(f=0;t>f;f++){o=4*f+4*h*t;var g,v,_,x,w,y,b,M,C,T=c.length;b=u[e.data[o]],M=u[e.data[o+1]],C=u[e.data[o+2]],x=.00433891*b+.00376234915*M+.0018990604648*C,w=.002126*b+.007152*M+722e-6*C,y=177255e-9*b+.00109475308*M+.0087295537*C,x=x>.008856?x>=1?c[T-1]:c[x*T|0]:7.787*x+16/116,w=w>.008856?w>=1?c[T-1]:c[w*T|0]:7.787*w+16/116,y=y>.008856?y>=1?c[T-1]:c[y*T|0]:7.787*y+16/116,g=116*w-16,v=500*(x-w),_=200*(w-y),m[0]=2.55*g,m[1]=v+127,m[2]=_+127,m[1]*=W,m[2]*=G;var j=d.length,V=(m[0]/2.55+16)/116,z=(m[1]-127)/500+V,H=V-(m[2]-127)/200,X=V*V*V,$=z*z*z,Y=H*H*H;V=X>.008856?X:(V-16/116)/7.787,z=$>.008856?$:(z-16/116)/7.787,H=Y>.008856?Y:(H-16/116)/7.787,z=.95047*z,V=1*V,H=1.08883*H;var q=3.2406*z+-1.5372*V+H*-.4986,Z=z*-.9689+1.8758*V+.0415*H,K=.0557*z+V*-.204+1.057*H;q=0>=q?0:q>=1?1:d[q*j|0],Z=0>=Z?0:Z>=1?1:d[Z*j|0],K=0>=K?0:K>=1?1:d[K*j|0],q=255*q+.5|0,Z=255*Z+.5|0,K=255*K+.5|0;var Q,J,ee;Q=q+.5|0,J=Z+.5|0,ee=K+.5|0,Q>255?Q=255:0>Q&&(Q=0),J>255?J=255:0>J&&(J=0),ee>255?ee=255:0>ee&&(ee=0),e.data[o]=Q,e.data[o+1]=J,e.data[o+2]=ee}return!0};var d=function(e,t,r){var o=e.width,a=e.height,s=r.blurAmount;s*=(o+a)/1600;var l=r.gain,u=r.sharpenVal,c=Math.round(s/5/2);if(e.moaGL)return void e.moaGL.renderClarity(t,c,l,u);var d=[];h(e,d);var f=n.copy(e),m=[];i.mapHist(f,t),h(f,m);var g,v,_,x,w,y,b,M,C,T,S,A,E,P,D,F;for(T=0;a>T;T++)for(C=0;o>C;C++)g=4*(o*T+C),S=e.data[g],A=e.data[g+1],E=e.data[g+2],w=C-c,y=T-c,b=C+c,M=T+c,w=0>w?0:w>o-1?o-1:w,y=0>y?0:y>a-1?a-1:y,b=0>b?0:b>o-1?o-1:b,M=0>M?0:M>a-1?a-1:M,F=(M-y+1)*(b-w+1),_=p(d,o,a,w,y,b,M)/F,x=p(m,o,a,w,y,b,M)/F,D=x-_,P=0===_?x:x/_,v=.2*S+.7*A+.1*E+.5|0,S+=u*(v-_),A+=u*(v-_),E+=u*(v-_),S=l*(S*P)+(1-l)*(S+D),A=l*(A*P)+(1-l)*(A+D),E=l*(E*P)+(1-l)*(E+D),e.data[g]=S>255?255:0>S?0:S+.5|0,e.data[g+1]=A>255?255:0>A?0:A+.5|0,e.data[g+2]=E>255?255:0>E?0:E+.5|0},p=function(e,t,r,o,a,i,n){return 0!=o&&0!=a?(o-=1,a-=1,e[n*t+i]-e[n*t+o]+e[a*t+o]-e[a*t+i]):0==o&&0==a?e[n*t+i]:0==o?(a-=1,e[n*t+i]-e[a*t+i]):(o-=1,e[n*t+i]-e[n*t+o])},h=function(e,t){var r,o,a,i,n,s,l=e.width,u=e.height;for(o=0;u>o;o++)for(r=0;l>r;r++)a=l*o+r,i=e.data[4*a],n=e.data[4*a+1],s=e.data[4*a+2],t[a]=.2*i+.7*n+.1*s+.5|0,r>0&&(t[a]+=t[l*o+r-1]),o>0&&(t[a]+=t[l*(o-1)+r]),o>0&&r>0&&(t[a]-=t[l*(o-1)+r-1])};t.exports=o},{"../core/MoaAllocAndCopy":34,"./MoaAdjustmentCurves":70,"./MoaColorConversion":74,"./MoaColorMatrixTransform":76,"./MoaHistogram":89,"./MoaHistogramMapping":90,"./MoaSharpen":96,"./MoaVignette":98,"./legacy/auto_colors_fade_max_color":100}],79:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping");o.exposure=function(e,t){"undefined"==typeof t&&(t=0),t/=100;var r,o=[],i=[];for(r=0;256>r;r++){var n=r/255,s=Math.pow(n,1+.15*Math.abs(t)-Math.abs(t)*Math.pow(n,.2));0>t&&(s=n*(1-.25*Math.abs(t))-.7*(s-n)*Math.sin(.5*Math.PI*n)),o[r]=255*s+.5|0}i.r=o,i.g=o,i.b=o,a.mapHist(e,i)},t.exports=o},{"./MoaHistogramMapping":90}],80:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping");o.fade=function(e,t){"undefined"==typeof t&&(t=0),t/=100;var r,o=[],i=[];for(r=0;256>r;r++){var n=1;if(128>r){var s=.55*t;n=127.5*Math.pow(r/255*2,1+.95*t),n=(1-s)*n+.5*s*255}else{var s=.3*t;n=255-127.5*Math.pow(Math.abs(2-r/255*2),1+.35*t),n=(1-s)*n+.5*s*255}o[r]=n+.5|0}i.r=o,i.g=o,i.b=o,a.mapHist(e,i)},t.exports=o},{"./MoaHistogramMapping":90}],81:[function(e,t,r){"use strict";var o={};o.flare=function(e,t,r,o,a,i,n,s,l,u,c,d,p){var h=e.width,f=e.height;"undefined"==typeof s&&(s=0),"undefined"==typeof l&&(l=0),"undefined"==typeof u&&(u=1),"undefined"==typeof c&&(c=1),"undefined"==typeof r?r=0:0>r?r=0:r>255&&(r=255),"undefined"==typeof o?o=0:0>o?o=0:o>255&&(o=255),"undefined"==typeof a?a=0:0>a?a=0:a>255&&(a=255),"undefined"==typeof i&&(i=1);var m="sinc"===n,g="gaussianThing"===n,v="gaussianThing2"===n,_="gaussianThing3"===n,x="gaussianThing4"===n,w="angleGaussian"===n,y="stardom"===n,b="lobes"===n,M="stripe"===n,C="stripe2"===n,T="dimondFlare"===n,S="crossFlare"===n,A="cornerFlares"===n,E="fingerFlare"===n,P="blobFlare"===n,D="blah"===n,F="blob"===n,L="blob2"===n;if(0!=u&&0!=c&&0!=t&&0!=i){var R=!1,I=!1;if("overlay"===d?I=!0:R=!0,e.moaGL)return void e.moaGL.renderFlare(d,n,t,{r:r,g:o,b:a,a:255*i},s,l,u,c,p);var B,O,N,k,U,W,G,j,V,z,H=(h-1)/2,X=(f-1)/2,$=Math.log(1/255/i),Y=0;s*=H,l*=X;var q=1/t/H/u,Z=1/t/X/c;for(m&&(q=2/t/(H+X),Z=q),G=0;f>G;G++)for(O=4*G*h,V=Z*(G-X-l),W=0;h>W;W++)if(B=O+4*W,z=q*(W-H-s),k=1,m?(U=80*(z*z+V*V),k=0===U?1:1-.4*i*(Math.sin(U)/Math.sqrt(U))):g?(N=2*-(z*z+V*V)-16*(V+.5)*(V+.5)*(z+.5)*(z+.5),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):v?(N=2*-(z*z+V*V)-16*(V+1)*(V+1)*(z-.5)*(z-.5),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):_?(U=z*z+V*V,N=2*-U-1*(V+1.7)*(V+1.7)*(z-.6)*(z-.6),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):x?(U=z*z+V*V,N=-.5*(V-1.7)*(V-1.7)*(z+.6)*(z+.6)-.5*(V+1.7)*(V+1.7)*(z-.6)*(z-.6),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):w?(N=2*-(z*z+V*V)-5*(z+.2)*(V+.2)*z*z,k=$>N?1:N>Y?1-.5*i:1-.5*i*Math.exp(N)):y?(U=z*z+V*V,j=Math.atan2(V,z),k=1-.2*i*(1-U*U*Math.sin(10*j))):b?(U=z*z+V*V,j=Math.atan2(V,z),k=1-.5*i*Math.exp(2*-U)*(.5+.5*Math.sin(4*j+1))):M?(N=-(z*z)-V*V/64,k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):C?(N=-(V*V)-z*z/64,k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):T?(U=z*z+V*V,k=1-i*Math.exp(2*-(U*U)+-8*(V+.5)*(V-.5)*(z+.5)*(z-.5))):S?(U=z*z+V*V,N=2*-(U/180)-16*(V+.5)*(V+.5)*(z+.5)*(z+.5),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):A?(U=z*z+V*V,k=1-i*Math.exp(2*-(U/180))*Math.exp(-8*(V+1)*(V-1)*(z+1)*(z-1))):E?(V=Z*(G-X-l)-1,z=q*(W-H-s)-1,U=(z+1)*z+V*V,k=i*Math.exp(V/z+-U*Math.exp(Math.exp(V)*z)),k=1-p*(1-k)):P?(U=z*z+V*V,k=1-i*Math.exp(-Math.pow(U,2)+-.9*(V-1.7)*(V+.5)*(z-1.5)*(z+.5))):D?(U=z*z+V*V,j=Math.atan2(V,z),k=$>N?1:N>Y?1-i:1-.2*i*(1-Math.sin(U)*Math.sin(10*U)*Math.sin(10*j))):L?(N=-10*(V*V+z*z)*(V*V+z*z),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)):F&&(N=100*-Math.pow(V*V+z*z,4),k=$>N?1:N>Y?1-i:1-i*Math.exp(N)),k=0>k?0:k>1?1:k,I){var K=e.data[B],Q=e.data[B+1],J=e.data[B+2];K=64>=K?k*K+(1-k)*(2*K*r/255):K>=192?k*K+(1-k)*(65025-2*(255-K)*(255-r))/255:k*K+(1-k)*(K*K*(510-4*r)/255/255+K*(4*r-255)/255+(255-2*r)/8),Q=64>=Q?k*Q+(1-k)*(2*Q*o/255):Q>=192?k*Q+(1-k)*(65025-2*(255-Q)*(255-o))/255:k*Q+(1-k)*(Q*Q*(510-4*o)/255/255+Q*(4*o-255)/255+(255-2*o)/8),J=64>=J?k*J+(1-k)*(2*J*a/255):J>=192?k*J+(1-k)*(65025-2*(255-J)*(255-a))/255:k*J+(1-k)*(J*J*(510-4*a)/255/255+J*(4*a-255)/255+(255-2*a)/8),e.data[B]=K,e.data[B+1]=Q,e.data[B+2]=J}else e.data[B]=e.data[B]*k+r*(1-k)+.5|0,e.data[B+1]=e.data[B+1]*k+o*(1-k)+.5|0,e.data[B+2]=e.data[B+2]*k+a*(1-k)+.5|0}},t.exports=o},{}],82:[function(e,t,r){"use strict";function o(e){this.left=e.l,this.right=e.r,this.top=e.t,this.bottom=e.b,this.topLeft=e.tl,this.topRight=e.tr,this.bottomLeft=e.bl,this.bottomRight=e.br}function a(){for(var e={},t=["top","bottom","left","right","topLeft","bottomLeft","topRight","bottomRight"],r=0;r<t.length;r++)e[t[r]]={x:0,y:0,width:0,height:0,numTilesX:0,numTilesY:0};return e}function i(e,t,r,o){var a={},i=Math.min(e.width,e.height),n=.25*(t.top.height+t.bottom.height+t.left.width+t.right.width);a.leftWidthPixels=r*i*t.left.width/n,a.rightWidthPixels=r*i*t.right.width/n,a.topHeightPixels=r*i*t.top.height/n,a.bottomHeightPixels=r*i*t.bottom.height/n,a.sideTileAreaHeightPixels=e.height-a.topHeightPixels-a.bottomHeightPixels,a.topTileAreaWidthPixels=e.width-a.leftWidthPixels-a.rightWidthPixels;var s=a.leftWidthPixels*t.left.height/t.left.width,l=a.rightWidthPixels*t.right.height/t.right.width,u=a.topHeightPixels*t.top.width/t.top.height,c=a.bottomHeightPixels*t.bottom.width/t.bottom.height,d=a.sideTileAreaHeightPixels/s,p=a.sideTileAreaHeightPixels/l,h=a.topTileAreaWidthPixels/u,m=a.topTileAreaWidthPixels/c;if(a.numLeftTiles=Math.round(d),a.numRightTiles=Math.round(p),a.numTopTiles=Math.round(h),a.numBottomTiles=Math.round(m),a.error=(d-a.numLeftTiles)*(d-a.numLeftTiles)+(p-a.numRightTiles)*(p-a.numRightTiles)+(h-a.numTopTiles)*(h-a.numTopTiles)+(m-a.numBottomTiles)*(m-a.numBottomTiles),0==a.numLeftTiles||0==a.numTopTiles||0==a.numBottomTiles||0==a.numRightTiles){if(a.error=1,0==a.numLeftTiles||0==a.numRightTiles){var g=a.topHeightPixels/(a.topHeightPixels+a.bottomHeightPixels);a.topHeightPixels=g*e.height,a.bottomHeightPixels=e.height-a.topHeightPixels,a.sideTileAreaHeightPixels=0,a.numLeftTiles=0,a.numRightTiles=0}if(0==a.numTopTiles||0==a.numBottomTiles){var v=a.leftWidthPixels/(a.leftWidthPixels+a.rightWidthPixels);a.leftWidthPixels=v*e.width,a.rightWidthPixels=e.width-a.leftWidthPixels,a.topTileAreaWidthPixels=0,a.numTopTiles=0,a.numBottomTiles=0}}return a.error+=(r-o)*(r-o)*f,a}var n=e("./MoaComposite"),s=e("../core/MoaDataTypes"),l=(s.MoaPoint,e("../core/MoaMipmap"),e("./MoaResize")),u=e("../core/MoaAllocAndCopy"),c=.03,d=.5,p=.04,h=100,f=16,m={};m.applyFrame=function(e,t,r,a,i){if(!m.validateFrameSegments(t))return!1;var n=new o(t),s=m.getSegmentAttributes(e,n,r,a);return m.applySegment(e,n.topLeft,s.topLeft,i),m.applySegment(e,n.top,s.top,i),m.applySegment(e,n.topRight,s.topRight,i),m.applySegment(e,n.left,s.left,i),m.applySegment(e,n.right,s.right,i),m.applySegment(e,n.bottomLeft,s.bottomLeft,i),m.applySegment(e,n.bottom,s.bottom,i),m.applySegment(e,n.bottomRight,s.bottomRight,i),!0},m.getOptimalWidth=function(e,t,r){if(0==t.left.width||0==t.right.width||0==t.top.height||0==t.bottom.height)return r();for(var o,a,n=r,s=(d-c)/h,a=i(e,t,r,r),l=c;d>=l;l+=s){var o=i(e,t,l,r);o.error<a.error&&(a=o,n=l)}var u=Math.max(c,n-p),f=Math.min(d,n+p);s=(f-u)/h;for(var l=u;f>=l;l+=s){var o=i(e,t,l,r);o.error<a.error&&(a=o,n=l)}return n},m.validateFrameSegments=function(e){for(var t=0;t<e.length;t++){var r=e[t];if("object"!=typeof r.data||"number"!=typeof r.width||"number"!=typeof r.height)return!1}return!0},m.getSegmentAttributes=function(e,t,r,o){if(0==t.left.width||0==t.right.width||0==t.top.height||0==t.bottom.height)return a();var n={width:e.width,height:e.height},s=r;o.width>0&&o.height>0&&(s=m.getOptimalWidth(o,t,r),n=o);var l=i(n,t,s),u=l.topHeightPixels/n.height,c=l.bottomHeightPixels/n.height,d=l.leftWidthPixels/n.width,p=l.rightWidthPixels/n.width,h=l.sideTileAreaHeightPixels/n.height,f=l.topTileAreaWidthPixels/n.width,g={};return g.left={x:0,y:u,width:d,height:h,numTilesX:1,numTilesY:l.numLeftTiles},g.right={x:1-p,y:u,width:p,height:h,numTilesX:1,numTilesY:l.numRightTiles},g.top={x:d,y:0,width:f,height:u,numTilesX:l.numTopTiles,numTilesY:1},g.bottom={x:d,y:1-c,width:f,height:c,numTilesX:l.numBottomTiles,numTilesY:1},g.topLeft={x:0,y:0,width:d,height:u,numTilesX:1,numTilesY:1},g.topRight={x:1-p,y:0,width:p,height:u,numTilesX:1,numTilesY:1},g.bottomLeft={x:0,y:1-c,width:d,height:c,numTilesX:1,numTilesY:1},g.bottomRight={x:1-p,y:1-c,width:p,height:c,numTilesX:1,numTilesY:1},g},m.applySegment=function(e,t,r,o){if(0!=r.numTilesY&&0!=r.numTilesY&&0!=r.height&&0!=r.width){var a,i=r.numTilesX,s=r.numTilesY,c=r.width/i,d=r.height/s,p=c*e.width|0,h=d*e.height|0,f=p<.5*t.width||h<.5*t.height;if(f){var m=Math.min(p,t.width),g=Math.min(h,t.height);a=u.makeBitmap(m,g),l.downscalePremultipliedImage(a,t)}else a=t;for(var v=0;s>v;v++)for(var _=r.y+v*d,x=0;i>x;x++){var w=r.x+x*c,y=[w,_,c,d];n.compositePremultipliedBitmap(e,a,y,0,!1,o,1)}f&&(a.data=null)}},t.exports=m},{"../core/MoaAllocAndCopy":34,"../core/MoaDataTypes":37,"../core/MoaMipmap":39,"./MoaComposite":77,"./MoaResize":94}],83:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping");o.gamma=function(e,t){"undefined"==typeof t&&(t=1);var r,o=[],i=[];for(r=0;256>r;r++)o[r]=255*Math.pow(r/255,t)+.5|0;i.r=o,i.g=o,i.b=o,a.mapHist(e,i)},t.exports=o},{"./MoaHistogramMapping":90}],84:[function(e,t,r){"use strict";var o={},a=e("../core/MoaColor");o.memoizeGradient=function(e,t,r){var o,a,i,n,s,l,u,c,d,p,h=r/4;if(e.colors.length<1)for(o=0;h>o;o++)t[4*o]=255,t[4*o+1]=255,t[4*o+2]=255;else if(1===e.colors.length)for(o=0;h>o;o++)t[4*o]=e.colors[0].color.r,t[4*o+1]=e.colors[0].color.g,t[4*o+2]=e.colors[0].color.b;else for(u=0,c=1,o=0;h>o;o++){for(n=1-(h-1-o)/(h-1);e.colors[c].location<=100*n&&"object"==typeof e.colors[c+1];)c++,u++;e.colors[u].location==e.colors[c].location?a=1:(a=(100*n-e.colors[u].location)/(e.colors[c].location-e.colors[u].location),a=Math.max(0,Math.min(1,a))),a+=12*(1+1.5*Math.abs(a-.5))*Math.sin(2*Math.PI*(a-.5))/255,a=Math.max(0,Math.min(1,a)),s=e.colors[u].color,l=e.colors[c].color,i=1-a,t[4*o]=Math.max(0,Math.min(255,Math.round(s.r*i+a*l.r))),t[4*o+1]=Math.max(0,Math.min(255,Math.round(s.g*i+a*l.g))),t[4*o+2]=Math.max(0,Math.min(255,Math.round(s.b*i+a*l.b)))}if(e.opacities.length<1)for(o=0;h>o;o++)t[4*o+3]=255;else if(1===e.opacities.length)for(o=0;h>o;o++)t[4*o+3]=255*e.opacities[0].opacity+.5|0;else for(u=0,c=1,o=0;h>o;o++){for(n=1-(h-1-o)/(h-1);e.opacities[c].location<=100*n&&c+1<e.opacities.length;)c++,u++;e.opacities[u].location==e.opacities[c].location?a=1:(a=(100*n-e.opacities[u].location)/(e.opacities[c].location-e.opacities[u].location),a=Math.max(0,Math.min(1,a))),a+=12*(1+1.5*Math.abs(a-.5))*Math.sin(2*Math.PI*(a-.5))/255,a=Math.max(0,Math.min(1,a)),i=1-a,d=e.opacities[u].opacity,p=e.opacities[c].opacity,t[4*o+3]=0|Math.max(0,Math.min(255,255*(d*i+p*a)))}},o.applyGradient=function(e,t,r,i,n,s,l,u,c,d){if("string"!=typeof c&&(c="normal"),"number"!=typeof d&&(c=1),0!=i){var p=e.width,h=e.height,f=[],m=1024,g=4*m;o.memoizeGradient(t,f,g);var v,_,x,w,y,b=u.shapeMode,M="sharp"===b,C="ultraSharp"===b,T="mediumSharp"===b,S=("undefined"==typeof u.stretch?!0:u.stretch,u.dx),A=u.dy,E=u.vignetteScale,P=1.15,D=Math.pow(E,2)/P,F=1/D,L=(p-1)/2,R=(h-1)/2;S*=L,A*=R;var I,B,O,N,k,U,W,G,j,V,z=5/3,H=34/45,X=13/63,$=514/14175,Y=d,q="linear"===r,Z="linearVignette"===r,K="radial"===r;W=G=j=0;var Q=new a,J=Math.sin(l),ee=Math.cos(l);if(e.moaGL)return u.gradientShape=r,u.xCenter=n,u.yCenter=s,u.scale=i,void e.moaGL.renderGradient(u,f,c,d,J,ee,F);for(U=0;h>U;U++)for(I=(U/h-s)/i,k=0;p>k;k++){O=4*(U*p+k),B=(k/p-n)/i,q?N=ee*B-J*I:K?N=Math.sqrt(B*B+I*I):Z&&(N=ee*B-J*I,v=((k-L-S)*(k-L-S)/p/p+(U-R-A)*(U-R-A)/h/h)*F,M&&(v*=v),C&&(v*=v,v*=v),T&&(v=Math.pow(v,1.5)),v>P?d=Y:.04>v?d=0:(_=v*v,x=_*_,w=x*_,y=w*_,d=Y*(1-(1-2*_+z*x-H*w+X*y-$*y*_)))),N=0>N?0:N>1?1:N,V=Math.floor(N*(m-1)+.5);var te={r:f[4*V],g:f[4*V+1],b:f[4*V+2],a:f[4*V+3]*d|0};Q.blendEmbededAlphaFromArray(e.data,O,te,c)}}},t.exports=o},{"../core/MoaColor":36}],85:[function(e,t,r){"use strict";function o(e,t){var r=[];return r[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],r[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],r[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],r[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],r[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],r[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],r[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],r[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],r[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],r[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],r[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],r[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],r[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],r[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],r[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],r[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],r}function a(e){var t=[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]];return t}function i(e,t,r,i){var n=a(e);"number"!=typeof i&&(i=0);var s=[1,0,0,t,0,1,0,r,0,0,1,i,0,0,0,1];return n=o(n,s)}function n(e,t,r){var a=i(e,.5,.5),n=[t,0,0,0,0,r,0,0,0,0,1,0,0,0,0,1];return a=o(a,n),a=i(a,-.5,-.5)}var s={},l=e("./MoaGradient"),u=(e("./MoaBitmapBlend"),e("../core/MoaEnums")),c=e("../core/MoaColor");s.GradientFlareShapeLine="line",s.GradientFlareShapeCircle="circle",s.GradientFlareShapeGaussian="gaussian",s.GradientFlareShapeSquare="square",s.GradientFlareShapeSquareRound="squareRound",s.GradientFlareShapeStardom="stardom",s.GradientFlareShapeLobes="lobes",s.GradientFlareShapeRingLobes="ringLobes",s.GradientFlareShapeHeart="heart",s.GradientFlareShapeStar="star",s.GradientFlareShapeCrescent="crescent",s.GradientFlareShapeSquiggly="squiggly",s.GradientFlareShapeZigzag="zigzag",s.GradientFlareShapeSpiral="spiral",s.GradientFlareAspectModeStretch="stretch",s.GradientFlareAspectModeAverage="average",s.GradientFlareAspectModeFite="fit",s.GradientFlareAspectModeFill="fill",s.GradientFlareWrapModeClamp="clamp",s.GradientFlareWrapModeRepeat="repeat",s.GradientFlareWrapModeMirroredRepeat="mirroredRepeat",s.gradientFlare=function(t,r){var o,a=(e("../core/MoaAllocAndCopy"),4096),i=[];if(!t.moaGL){var n;for(n=0;n<r.gradient.opacities.length;n++)r.gradient.opacities[n].opacity*=r.alpha}l.memoizeGradient(r.gradient,i,a);var u="true"===r.invertGradient;o=t;var c={gradientTransform:r.gradientTransform.slice(0),gradientShapeType:r.gradientShapeType,gradientParams:r.gradientParams.slice(0),aspectMode:r.aspectMode,gradientWrapMode:r.gradientWrapMode};return c.gradMapLength=a,c.gradMap=i,c.blendMode=r.blendMode,c.alpha=r.alpha,c.invertGradient=u,t.moaGL?void t.moaGL.renderGradientFlare(c):void s.renderShape(o,c)},s.copyAlpha=function(e,t){var r,o=e.data.length;for(r=0;o>r;r+=4)e.data[r+3]=t.data[r+3]},s.renderShape=function(e,t){var r,o,i,s,l,d,p,h=e.width,f=e.height,m=t.gradMapLength,g=(t.isMask,t.gradMap);p=u.getShapeModeIndex(t.gradientShapeType),l=a(t.gradientTransform),d=t.gradientParams;var i,s,v,_,x,w,y,b,M,C,T,S,A,E,P,D,F="repeat"==t.gradientWrapMode,L="mirroredRepeat"==t.gradientWrapMode,R=new c;if("stretch"==t.aspectMode)l[3]-=.5,l[7]-=.5;else if("average"==t.aspectMode){l[3]-=.5,l[7]-=.5;var I=(h+f)/2;l=n(l,h/I,f/I)}else if("fill"==t.aspectMode){l[3]-=.5,l[7]-=.5;var B=Math.max(h,f);l=n(l,h/B,f/B)}else if("fit"==t.aspectMode){l[3]-=.5,l[7]-=.5;var O=Math.min(h,f);l=n(l,h/O,f/O)}if(6==p||7==p||8==p)var N=Math.floor(d[0]),k=d[1],U=d[2];if(10==p)var N=Math.max(1,Math.floor(d[0]));if(14==p)var W=Math.round(d[1]);for(o=0;f>o;o++)for(s=o/(f-1),v=l[1]*s+l[3],_=l[5]*s+l[7],b=4*h*o,r=0;h>r;r++){if(M=b+4*r,i=r/(h-1),x=v+l[0]*i,w=_+l[4]*i,12==p)y=.5+.5*Math.sin(x+2*d[0]*Math.sin(w));else if(1==p)y=.5+.5*x;else if(5==p){var G=d[0];y=0==G?Math.max(x,w):Math.pow(Math.pow(Math.abs(x),G)+Math.pow(Math.abs(w),G),1/G)}else if(2==p)y=Math.sqrt(x*x+w*w);else if(3==p){var j=d[0]*((w-d[2])*(w-d[2])+(x-d[3])*(x-d[3]))+d[1]*(w-d[4])*(w-d[4])*(x-d[5])*(x-d[5]);y=Math.exp(j)}else if(4==p)y=Math.max(Math.abs(x),Math.abs(w));else if(6==p){var V=x*x+w*w,z=Math.atan2(w,x);y=V*V*Math.sin(N*z/2)}else if(7==p){var V=x*x+w*w,z=Math.atan2(w,x);y=1-.5*Math.exp(-V)*(1+Math.sin(z*N))}else if(8==p){var V=x*x+w*w,z=Math.atan2(w,x);y=1-(1-Math.sin(k*V+Math.PI/2)*Math.sin(U*V+Math.PI/2)*Math.sin(N*z/2+Math.PI/2))}else if(9==p){var V=x*x+w*w,H=Math.sqrt(V),X=-w/H,$=x/H,Y=$;0>$&&(Y=-$);var q=2-2*X+d[0]*X*Math.sqrt(Y)/(X+d[1]);y=H-q}else if(10==p){var V=x*x+w*w,H=Math.sqrt(V),Z=Math.PI/N,z=2*Math.PI-Math.atan2(w,x)-Math.PI/2,K=1,Q=d[2],J=0,T=z/Z-(z/Z|0);if((z/Z|0)%2==0)var ee=Z/2,te=Math.PI-T-ee,re=K*Math.sin(ee)/Math.sin(te);else{T=1-T;var ee=Z/2,te=Math.PI-T-ee,re=K*Math.sin(ee)/Math.sin(te)}var J=Q+(K-Q)*((1-d[1])*re+d[1]*(1-T));y=H-J}else if(11==p){var oe=1,ae=d[1],ie=d[0]*(oe+ae),H=Math.sqrt(x*x+w*w),ne=Math.sqrt((x-ie)*(x-ie)+w*w),y=1;if(ne>=ae&&H>=oe)y=1;else if(ae>=ne&&oe>=H)y=1;else if(ae>=ne&&H>oe)y=1;else{y=H/oe;var se=1-H/oe,le=ne/ae-1;y=1-Math.min(se,le)}}else if(0==p)y=1;else if(13==p){var z=2*(x-Math.floor(d[0]+x));y=0>z?w+z/d[0]:w-z/(1-d[0])}else if(14==p){var ue=x*x+w*w,ce=Math.atan2(w,x);y=Math.sqrt(ue)+ce*W/2/Math.PI}else y=0;y=t.invertGradient?1-y:y,F?y-=Math.floor(y):L&&(Math.floor(y)%2!=0?(y-=Math.floor(y),y=1-y):y-=Math.floor(y)),y=0>y?0:y>1?1:y,C=(m/4-1)*y,T=C-(0|C),S=1-T,C=4*(0|C),0!=T?(A=S*g[0+C]+T*g[4+C],E=S*g[1+C]+T*g[5+C],P=S*g[2+C]+T*g[6+C],D=S*g[3+C]+T*g[7+C]):(A=g[0+C],E=g[1+C],P=g[2+C],D=g[3+C]);var de={r:A,g:E,b:P,a:D};R.blendEmbededAlphaFromArray(e.data,M,de,t.blendMode)}},t.exports=s},{"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"../core/MoaEnums":38,"./MoaBitmapBlend":72,"./MoaGradient":84}],86:[function(e,t,r){"use strict";var o={},a=e("./MoaGradient"),i=(e("./MoaBitmapBlend"),e("../core/MoaColor"));o.gradientMap=function(e,t){var r=1024,i=[];if(a.memoizeGradient(t.gradient,i,r),e.moaGL){var n={transformGradient:t.gradientTransform,invertGradient:"true"===t.invertGradient?1:0,gradientParams:t.gradientParams,gradientVariable:t.gradientVariable,blendMode:t.blendMode,aspectMode:t.aspectMode,alpha:t.alpha,gradMap:i};return void e.moaGL.renderGradientMap(n)}o.applyGradientMap(e,t,r,i,t.blendMode,t.alpha)},o.applyGradientMap=function(e,t,r,o,a,n){for(var s=(e.width,e.height,e.data),l=e.data,u=t.gradientVariable,c="true"===t.invertGradient,d=0,p=new i;d<s.length;){var h,f=s[d],m=s[d+1],g=s[d+2];h="intensity"==u?.2*f+.7*m+.1*g:"chroma"==u?Math.max(f,m,g)-Math.min(f,m,g):"redChannel"==u?f:"greenChannel"==u?m:"blueChannel"==u?g:"maxChannel"==u?Math.max(f,m,g):"minChannel"==u?Math.min(f,m,g):0,h=0>h?0:h>255?255:h,c&&(h=255-h),h=(r/4-1)*(h/255);var v=h-(0|h),_=4*(0|h);if(_==r-4)var x=o[_],w=o[_+1],y=o[_+2],b=o[_+3];else var x=(1-v)*o[_]+v*o[_+4],w=(1-v)*o[_+1]+v*o[_+5],y=(1-v)*o[_+2]+v*o[_+6],b=(1-v)*o[_+3]+v*o[_+7];var M={r:x,g:w,b:y,a:b},C=[f,m,g,255];p.blendEmbededAlphaFromArray(C,0,M,"normal"),M={r:C[0],g:C[1],b:C[2],a:255*n},p.blendEmbededAlphaFromArray(l,d,M,a),d+=4}},o.copyAlpha=function(e,t){var r,o=e.data.length;for(r=0;o>r;r+=4)e.data[r+3]=t.data[r+3]},t.exports=o},{"../core/MoaColor":36,"./MoaBitmapBlend":72,"./MoaGradient":84}],87:[function(e,t,r){"use strict";function o(e,t,r,o){var a,i,n,s=30,l=500,u=1,c=40,d=[],p=[];for(i=n=[],b=0;l>b;b++)a=4*(Math.floor(Math.random()*t*1/2+1*t/4)+t*Math.floor(Math.random()*r*1/2+1*r/4)),n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],p[b]=n,s>b&&(d[b]=p[b]);for(var h,f,m,g,v=!0,_=1,x=[],w=[],y=0;v&&c>_;){_++,v=!1;for(var b=0;l>b;b++){for(g=195075e6,h=0,M=0;s>M;M++)m=Math.abs(Math.abs(p[b][1]-d[M][1])),g>m&&(g=m,h=M);"undefined"==typeof x[h]&&(x[h]=[]),x[h].push(b),d[h][3]=x[h].length}for(var M=0;s>M;M++)if(w=[0,0,0,d[M][3]],"undefined"!=typeof x[M]&&0!=x[M].length){for(var C=0;C<x[M].length;C++)f=p[x[M][C]],w[0]+=f[0],w[1]+=f[1],w[2]+=f[2];x[M].length&&(w[0]/=x[M].length,w[1]/=x[M].length,w[2]/=x[M].length),y=w,Math.pow(d[M][0]-y[0],2)>u&&Math.pow(d[M][1]-y[1],2)>u&&Math.pow(d[M][2]-y[2],2)>u&&(v=!0),d[M]=w}else x[M]=[]}}var a={};e("../core/MoaAllocAndCopy"),e("../core/MoaEnums"),e("./MoaBitmapBlend"),e("./MoaBlendWithColor"),e("./MoaColorMatrixTransform"),e("./MoaSharpen"),a.halftone=function(e,t,r,o){return e.moaGL?!0:void a.dotsOnePass(e,t,r,o)},a.magazine=function(e,t,r,o){return e.moaGL?!0:void a.dotsOnePass(e,t,r,o)},a.dotsOnePass=function(e,t,r,a){return void o(e,t,r,a)},t.exports=a},{"../core/MoaAllocAndCopy":34,"../core/MoaEnums":38,"./MoaBitmapBlend":72,"./MoaBlendWithColor":73,"./MoaColorMatrixTransform":76,"./MoaSharpen":96}],88:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping");o.highlights=function(e,t){"undefined"==typeof t&&(t=0),t/=100;var r,o=[],i=[];for(r=0;256>r;r++){var n=r/255,s=-3.68113+4.829*(r/3+1)-.299125*Math.pow(r/3+1,2)+.006449275*Math.pow(r/3+1,3)-474531e-10*Math.pow(r/3+1,4);if(0>s&&(s=0),.25>=t){var l=t;s=l*s+r}else{var u,l=(t-.25)/.75,c=34*l/255;u=.5>n?255*((1-2*c)*n+c):r,s=t*s+u}o[255-r]=255-(s+.5|0),o[255-r]=o[255-r]<0?0:o[255-r]>255?255:o[255-r]}i.r=o,i.g=o,i.b=o,a.mapHist(e,i)},t.exports=o},{"./MoaHistogramMapping":90}],89:[function(e,t,r){var o={};o.getHist=function(e){var t,r,o,a=[],i=[],n=[],s=[];for(t=e.moaGL?e.moaGL.getImageDataFromTexture(e.moaGL.glRenderingObjects.readTexture):e.data,r=0;256>r;r++)i[r]=0,n[r]=0,s[r]=0;for(r=0,o=t.length;o>r;r+=4)i[t[r]]++,n[t[r+1]]++,s[t[r+2]]++;return a[0]=i,a[1]=n,a[2]=s,a},o.getcdf=function(e){for(var t=0,r=0;256>r;r++)t+=e[r];var o=new Array(256);o[0]=e[0]/t;for(var a=1;256>a;a++)o[a]=e[a]/t+o[a-1];return o},o.cdfinv=function(e,t){if(0>=t)return 0;if(t>=1)return 255;for(var r=0;t>e[r];)r++;if(0===r)return t/e[r];var o=r-1+(t-e[r-1])/(e[r]-e[r-1]);return o},o.smooth1D=function(e,t){for(var r=[],o=e.length,a=0;o>a;a++){for(var i=0,n=0,s=0;o>s;s++){var l=Math.exp(-(s-a)*(s-a)/(2*t*t));i+=l*e[s],n+=l}i/=n,r[a]=i}return r},o.getpdfSingleChannel=function(e){for(var t,r=new Array(256),o=0;o<r.length;o++)r[o]=0;for(var o=0;o<e.length;o++)t=e[o],r[t]=r[t]+1;for(var o=0;o<r.length;o++)r[o]=r[o]/e.length;return r},o.getcdfSingleChannel=function(e,t){var r=new Array(256);r[0]=t[0];for(var o=1;o<r.length;o++)r[o]=t[o]+r[o-1];return r},o.getinvcdfSingleChannel=function(e,t){for(var r=0;t>e[r];)r++;return r},o.equalizeSingleChannel=function(e){for(var t,r=[],a=o.getpdfSingleChannel(e),i=o.getcdfSingleChannel(e,a),n=0;n<e.length;n++)t=255*i[e[n]],r[n]=t>255?255:Math.round(t);return r},t.exports=o},{}],90:[function(e,t,r){"use strict";var o={};o.fadeMapping=function(e,t){for(var r=0;256>r;r++)e.r[r]=r*(1-t)+e.r[r]*t+.5|0,e.g[r]=r*(1-t)+e.g[r]*t+.5|0,e.b[r]=r*(1-t)+e.b[r]*t+.5|0,e.r[r]=e.r[r]<0?0:e.r[r]>255?255:e.r[r],e.g[r]=e.g[r]<0?0:e.g[r]>255?255:e.g[r],e.b[r]=e.b[r]<0?0:e.b[r]>255?255:e.b[r]},o.mapHist=function(e,t){if(e.moaGL)return void e.moaGL.renderColorMap(t);for(var r=e.data.length,o=0;r>o;)e.data[o]=t.r[e.data[o]],e.data[o+1]=t.g[e.data[o+1]],e.data[o+2]=t.b[e.data[o+2]],o+=4},o.combineSingleChannelHistMaps=function(e,t){for(var r=0;256>r;r++)e[r]=t[e[r]]},o.combineMultiChannelHistMaps=function(e,t){for(var r=0;256>r;r++)e.r[r]=t.r[e.r[r]],e.g[r]=t.g[e.g[r]],e.b[r]=t.b[e.b[r]]},o.copyHistMap=function(e,t){e.r=new Array(256),e.g=new Array(256),e.b=new Array(256);for(var r=0;256>r;r++)e.r[r]=t.r[r],e.g[r]=t.g[r],e.b[r]=t.b[r]},o.invertHistMap=function(e){var t={};o.copyHistMap(t,e);for(var r=0,a=0,i=0,n=0;256>n;n++){for(;t.r[r]<n&&255>r;)r++;for(;t.g[a]<n&&255>a;)a++;for(;t.b[i]<n&&255>i;)i++;e.r[n]=r,e.g[n]=a,e.b[n]=i}},o.setHistMapToIdentity=function(e){for(var t=0;256>t;t++)e.r[t]=t,e.g[t]=t,e.b[t]=t},o.setHistMap=function(e,t,r,o){e.r=t,e.g=r,e.b=o},t.exports=o},{}],91:[function(e,t,r){"use strict";var o={};o.mapIntensity=function(e,t,r,o){if(e.moaGL)return void e.moaGL.renderIntensityMap(t,r,o);for(var a,i,n,s,l,u,c=e.data.length,d=0,p=o,h=1-o,f="overlay"===r,m="multiply"===r;c>d;){var g=.212671*e.data[d]+.71516*e.data[d+1]+.072169*e.data[d+2],v=0|g,_=g-v;255==g?(s=t.r[g],l=t.g[g],u=t.b[g]):(s=(1-_)*t.r[v]+_*t.r[v+1]+.5|0,l=(1-_)*t.g[v]+_*t.g[v+1]+.5|0,u=(1-_)*t.b[v]+_*t.b[v+1]+.5|0),f?(a=e.data[d],i=e.data[d+1],n=e.data[d+2],a=64>=a?h*a+p*(2*a*s/255):a>=192?h*a+p*(65025-2*(255-a)*(255-s))/255:h*a+p*(a*a*(510-4*s)/255/255+a*(4*s-255)/255+(255-2*s)/8),i=64>=i?h*i+p*(2*i*l/255):i>=192?h*i+p*(65025-2*(255-i)*(255-l))/255:h*i+p*(i*i*(510-4*l)/255/255+i*(4*l-255)/255+(255-2*l)/8),n=64>=n?h*n+p*(2*n*u/255):n>=192?h*n+p*(65025-2*(255-n)*(255-u))/255:h*n+p*(n*n*(510-4*u)/255/255+n*(4*u-255)/255+(255-2*u)/8),a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,e.data[d]=a,e.data[d+1]=i,e.data[d+2]=n):m?(a=e.data[d],i=e.data[d+1],n=e.data[d+2],a=h*a+p*a*s/255+.5|0,i=h*i+p*i*l/255+.5|0,n=h*n+p*n*u/255+.5|0,a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,e.data[d]=a,e.data[d+1]=i,e.data[d+2]=n):(e.data[d]=h*e.data[d]+p*s,e.data[d+1]=h*e.data[d+1]+p*l,e.data[d+2]=h*e.data[d+2]+p*u),d+=4}},t.exports=o},{}],92:[function(e,t,r){"use strict";var o=e("../core/rng"),a=e("./MoaFlare"),i=1e-9,n=e("./MoaVignette"),s=e("./legacy/auto_colors_fade_max_color"),l=e("./legacy/soft_focus"),u={},c={};c.maxpow2=function(e){for(var t=1;e>=2*t;)t*=2;return t},c.getMPDRNG=function(e,t,r,o,a,i,n){"undefined"==typeof i&&(i="uniform");var s=t+c.maxpow2(r-t);return e[s]=e[r],"uniform"===i?c.getMPDU(e,t,s,o,a,n):"normal"===i?c.getMPDN(e,t,s,o,a,n):"laplacian"===i&&c.getMPDL(e,t,s,o,a,n),c.scaleLine(e,s,r),e},c.scaleLine=function(e,t,r){if(!(t>=r)){var o,a,i,n=r/t;for(o=r;o>=0;o--)a=o/n,i=a-(0|a),i?e[o]=(1-i)*e[0|a]+i*e[(0|a)+1]:e[o]=e[a]}},c.getMPDU=function(e,t,r,o,a,i){for(var n,s=r-t,l=(r-t)/2;s>=2;){for(var u=t;r>u;u+=s)n=u+l,e[n]=(e[u]+e[u+s])/2+o*(i.nextFloat()-.5);o*=Math.pow(2,-a),s=l,l/=2}},c.getMPDN=function(e,t,r,o,a,i){for(var n,s=r-t,l=(r-t)/2;s>=2;){for(var u=t;r>u;u+=s)n=u+l,e[n]=(e[u]+e[u+s])/2+o*i.nextFloatNormal();o*=Math.pow(2,-a),s=l,l/=2}},c.getMPDL=function(e,t,r,o,a,i){for(var n,s=r-t,l=(r-t)/2;s>=2;){for(var u=t;r>u;u+=s)n=u+l,e[n]=(e[u]+e[u+s])/2+o*i.nextFloatLaplace();o*=Math.pow(2,-a),s=l,l/=2}},c.getMPD=function(e,t,r,a,i,n,s){var l=new o.RNG(s);return c.getMPDRNG(e,t,r,a,i,n,l),l.getState()};var d=function(e,t,r,a){"undefined"==typeof r&&(r="");var i,n,s,l,u,c,d,p,h,f,m,g,v,_,x,w,y,b,M,C,T,S,A,E,P,D,F,L,R=e.width,I=e.height,B=1;S=A=E=P=D=F=L=!1,n=(R+I)/30,s=0;var O=!0,N=0,k=I/2|0,U=R/2|0,W=t[0],G=t[1],j=t[2],V=255*t[3];if("halftone"===r)S=!0,n=(R+I)/30,s=a[0],m=1e3/(R+I),"number"==typeof a[1]&&(0===a[1]?m=0:m/=a[1]);else if("smooth"===r)E=!0,n=a[0]*(R+I)/30,"undefined"!=typeof a[1]&&(s=a[1]/n);else if("rough"===r)F=!0,n=a[0]*(R+I)/30,"undefined"!=typeof a[1]&&(s=a[1]/n),"undefined"!=typeof a[2]&&(N=a[2]),T=new o.RNG(N);else if("viewfinder"===r)L=!0,n=(R+I)/60,_=x=y=w=0,"undefined"!=typeof a[0]&&(y=a[0]),"undefined"!=typeof a[1]&&(w=a[1]),"undefined"!=typeof a[2]&&(_=a[2]),"undefined"!=typeof a[3]&&(x=a[3]),"undefined"!=typeof a[4]&&(N=a[4]),T=new o.RNG(N);else if("lines"===r)A=!0,n=a[0]*(R+I)/30,C=a[1];else if("shadow"===r){P=!0,n=a[0]*(R+I)/80,s=.3;var z=Math.PI/180*a[1],H=Math.sin(z),X=Math.cos(z);g=.5*X*n,v=.5*H*n}else"fade"===r&&(D=!0,n=(R+I)/80,"number"==typeof a[0]&&(n*=a[0]),s="number"==typeof a[1]?a[1]:1,"number"==typeof a[2]&&(B=a[2]));if(s*=n,L||(_=x=y=w=s),e.moaGL){var $={r:t[0],g:t[1],b:t[2],a:255*t[3]};return void e.moaGL.renderThetaBorder($,r,n,B,_,x,y,w,g,v,C,m)}for(u=0;I>u;u++)for(d=k>u?u-y:I-1-u-w,l=0;R>l;l++)if(i=4*(R*u+l),c=U>l?l-_:R-1-l-x,h=O&&d<Math.SQRT2*B*n&&c<Math.SQRT2*B*n?Math.SQRT2*B*n-Math.sqrt((d-Math.SQRT2*B*n)*(d-Math.SQRT2*B*n)+(c-Math.SQRT2*B*n)*(c-Math.SQRT2*B*n)):c>d?d:c,0>d||0>c)S?(f=Math.cos((u-k)*m)*Math.cos((l-U)*m)+1,p=1-2*f,p=0>p?0:p>1?1:p,e.data[i]=e.data[i]*p+W*(1-p)+.5|0,e.data[i+1]=e.data[i+1]*p+G*(1-p)+.5|0,e.data[i+2]=e.data[i+2]*p+j*(1-p)+.5|0,e.data[i+3]=e.data[i+3]*p+V*(1-p)+.5|0):P?(b=k>u?u-s-v:I-1-u-s+v,M=U>l?l-s-g:R-1-l-s+g,h=b<Math.SQRT2*B*n&&M<Math.SQRT2*B*n?Math.SQRT2*B*n-Math.pow(Math.pow(b-Math.SQRT2*B*n,4)+Math.pow(M-Math.SQRT2*B*n,4),.25):M>b?b:M,-n>h&&(h=-n),p=.6*Math.pow((h/n+1)/2,4),p=0>p?0:p>1?1:p,e.data[i]=W*(1-p)+.5|0,e.data[i+1]=G*(1-p)+.5|0,e.data[i+2]=j*(1-p)+.5|0,e.data[i+3]=V*(1-p)+p*e.data[i+3]+.5|0):(e.data[i]=W,e.data[i+1]=G,e.data[i+2]=j,e.data[i+3]=V);else if(n>h){if(S)f=Math.cos((u-k)*m)*Math.cos((l-U)*m)+1,p=0>=h?1-2*f:1-2*f*Math.pow(1-h/n,4);else{if(P){if(b=k>u?u-s-v:I-1-u-s+v,M=U>l?l-s-g:R-1-l-s+g,h=b<Math.SQRT2*B*n&&M<Math.SQRT2*B*n?Math.SQRT2*B*n-Math.pow(Math.pow(b-Math.SQRT2*B*n,4)+Math.pow(M-Math.SQRT2*B*n,4),.25):M>b?b:M,c>=n&&d>=n)continue;-n>h&&(h=-n),h>n&&(h=Math.sqrt(h/n)*n),p=.6*Math.pow((h/n+1)/2,4),p=0>p?0:p>1?1:p,e.data[i]=W*(1-p)+.5|0,e.data[i+1]=G*(1-p)+.5|0,e.data[i+2]=j*(1-p)+.5|0,e.data[i+3]=255;continue}if(D)h=0>h?0:h,p=Math.pow(h/n,2);else if(E)p=1-2*Math.pow(1-h/n,4);else if(F)p=1-2*(.4*T.nextFloat()+.6)*Math.pow(1-h/n,4);else if(L)p=1-2*(.4*T.nextFloat()+.6)*Math.pow(1-h/n,4);else if(A){var Y=(.4*Math.random()+.6)*(Math.cos(140*Math.PI*((u-k)/I)/C)+1);p=1-2*Y*Math.pow(1-h/n,4)}}p=0>p?0:p>1?1:p,e.data[i]=e.data[i]*p+W*(1-p)+.5|0,
e.data[i+1]=e.data[i+1]*p+G*(1-p)+.5|0,e.data[i+2]=e.data[i+2]*p+j*(1-p)+.5|0,e.data[i+3]=e.data[i+3]*p+V*(1-p)+.5|0}},p=function(e,t,r,a){"undefined"==typeof r&&(r="");var i,n,s,l,u=e.width,d=e.height;i=n=s=l=!1;var p,h,f,m,g,v,_,x,w,y,b,M,C,T,S,A,E,P,D=t[0],F=t[1],L=t[2],R=t[3],I=1!==R,B=1+(u+d)/2/1024,O=new o.RNG;"torn"===r?(n=!0,h=a[0]*(u+d)/2,p=a[1]*(u+d)/2,g=a[2],m="uniform","string"==typeof a[3]&&(m=a[3]),f=a[4],v="onlyout"===a[5],O=new o.RNG(f)):"bulge"===r?(i=!0,p=a[0]*(u+d)/2,_=a[1]*p,x=a[2]*p):"rect"===r?(s=!0,p=a[0]*(u+d)/2,1===a[1]&&(B=0)):"round"===r&&(l=!0,p=a[0]*Math.min(u,d),y=a[1]*p,b=a[2]*p,M=a[3]*p,C=a[4]*p,w=p,"number"==typeof a[5]&&(w*=a[5]));var N,k,U,W,G,j,V,z,H,X=Math.max(u,d),$=[],Y=[d,u,u,d],q=[u,d,d,u],Z=[1,1,-1,-1],K=[0,0,d-1,u-1];if(e.moaGL){var Q={r:t[0],g:t[1],b:t[2],a:255*t[3]};e.moaGL.beginSideBorder(Q)}for(var J=0;4>J;J++){if(j=Y[J],V=q[J],z=Z[J],H=K[J],X=j,n){if($[X-1]=H+z*p,$[0]=H+z*p,c.getMPD($,0,X-1,h,g,m,O.nextInt()),v)for(N=0;X>N;N++)$[N]=z*Math.min(z*(H+z*p),z*$[N])}else if(i)for(N=0;X>N;N++)$[N]=H-z*(_*Math.sin(N*Math.PI/X)-x);else if(s)for(N=0;X>N;N++)$[N]=H+z*p;else if(l)for(P=w*(1-1/Math.SQRT2),0===J&&(A=b,S=y,E=M),1===J&&(A=y,S=b,E=C),2===J&&(A=M,S=b,E=C),3===J&&(A=C,S=y,E=M),A-=B/2,N=0;X>N;N++)T=N,S+P>T?$[N]=H+z*(A+P):S+w>T?$[N]=H+z*(A+w-Math.sqrt(w*w-Math.pow(T-S-w,2))):j-1-E-w>T?$[N]=H+z*A:j-1-E-P>=T?$[N]=H+z*(A+w-Math.sqrt(w*w-Math.pow(j-1-T-E-w,2))):$[N]=H+z*(A+P);if(e.moaGL)e.moaGL.addSideBorder($,B,J);else for(N=0;j>N;N++)for(U=$[N],k=H;z*(U+z*B)>z*k;k+=z)W=0===J||3===J?4*(N*u+k):4*(k*u+N),z*(U-z*B)>z*k?I?(e.data[W]=R*D+(1-R)*e.data[W]+.5|0,e.data[W+1]=R*F+(1-R)*e.data[W+1]+.5|0,e.data[W+2]=R*L+(1-R)*e.data[W+2]+.5|0,e.data[W+3]=255*R+(1-R)*e.data[W+3]+.5|0):(e.data[W]=D,e.data[W+1]=F,e.data[W+2]=L,e.data[W+3]=255):(G=R*(1-(z*(k-U)+B)/(2*B)),e.data[W]=G*D+(1-G)*e.data[W]+.5|0,e.data[W+1]=G*F+(1-G)*e.data[W+1]+.5|0,e.data[W+2]=G*L+(1-G)*e.data[W+2]+.5|0,e.data[W+3]=255*G+(1-G)*e.data[W+3]+.5|0)}e.moaGL&&e.moaGL.endSideBorder()},h=function(e,t,r,a){"undefined"==typeof r&&(r="");var i;i=!1;var n,s,l,u,d,p=e.width,h=e.height;"torn"===r&&(i=!0,n=a[0]*(p+h)/2,s=a[1]*(p+h)/2,l=a[2],u="uniform","string"==typeof a[3]&&(u=a[3]),d=a[4]);var f,m,g,v,_,x,w,y,b,M,C=t[0],T=t[1],S=t[2],A=t[3],E=1!==A,P=Math.max(p,h),D=[],F=[],L=Math.max(1,.001*(p+h)),R=[h,p,p,h],I=[p,h,h,p],B=[1,1,-1,-1],O=[0,0,h-1,p-1],N=new o.RNG(d);if(e.moaGL){var k={r:t[0],g:t[1],b:t[2],a:255*t[3]};e.moaGL.beginSideBorder(k)}for(var U=0;4>U;U++)if(w=R[U],y=I[U],b=B[U],M=O[U],P=w,D[P-1]=M+b*s,D[0]=M+b*s,c.getMPD(D,0,P-1,n,l,u,N.nextInt()),F[P-1]=M+b*s,F[0]=M+b*s,c.getMPD(F,0,P-1,n,l,u,N.nextInt()),e.moaGL)e.moaGL.addBorderDoubleSide(D,F,L,U);else for(f=0;w>f;f++)for(g=D[f],v=F[f],m=M;b*(g+b*L)>b*m;m+=b)_=0===U||3===U?4*(f*p+m):4*(m*p+f),b*(g-b*L)>b*m&&b*m>b*(v+b*L)?E?(e.data[_]=A*C+(1-A)*e.data[_]+.5|0,e.data[_+1]=A*T+(1-A)*e.data[_+1]+.5|0,e.data[_+2]=A*S+(1-A)*e.data[_+2]+.5|0):(e.data[_]=C,e.data[_+1]=T,e.data[_+2]=S):b*(g+b*L)>b*m&&b*m>b*(v-b*L)&&(x=A*Math.min(b*(g-m)/L,b*(m-v)/L),x>1?x=1:0>x&&(x=0),e.data[_]=x*C+(1-x)*e.data[_]+.5|0,e.data[_+1]=x*T+(1-x)*e.data[_+1]+.5|0,e.data[_+2]=x*S+(1-x)*e.data[_+2]+.5|0);e.moaGL&&e.moaGL.endSideBorder()},f=function(e,t){"undefined"==typeof t.offset&&(t.offset=0),"undefined"==typeof t.corner&&(t.corner=0),"undefined"==typeof t.scale&&(t.scale=1),"undefined"==typeof t.seed&&(t.seed=0),"undefined"==typeof t.alpha&&(t.alpha=1),"undefined"==typeof t.color&&(t.color=[0,0,0,1]);var r=e.width,a=e.height,i=t.offset,n=t.corner,s=t.scale,l=t.seed,u=t.color,d=t.alpha,p=new o.RNG(l),h=u[0],f=u[1],m=u[2],g=u[3],v=new Array(a),_=new Array(a),x=new Array(r),w=new Array(r);v[a-1]=n,v[0]=0,_[a-1]=0,_[0]=0,x[r-1]=0,x[0]=0,w[r-1]=0,w[0]=n,c.getMPD(v,0,a-1,.03*r*d,.7,"uniform",p.nextInt()),c.getMPD(_,0,a-1,.03*r*d,.7,"uniform",p.nextInt()),c.getMPD(x,0,r-1,.03*a*d,.7,"uniform",p.nextInt()),c.getMPD(w,0,r-1,.03*a*d,.7,"uniform",p.nextInt());var y,b,M,C,T,S,A,E,P,D=a/2|0,F=r/2|0,L=(r+a)/30;if(e.moaGL){var R={r:u[0],g:u[1],b:u[2],a:255*u[3]+.5|0};return void e.moaGL.renderHardRandBorder(R,L,s,i,l,F,D,v,_,x,w)}for(P=0;a>P;P++)for(E=0;r>E;E++)C=4*(P*r+E),S=D>P?P-x[E]-i:a-1-P-w[E]-i,T=F>E?E-v[P]-i:r-1-E-_[P]-i,0>S||0>T?(y=1-g,e.data[C]=e.data[C]*y+h*(1-y)|0,e.data[C+1]=e.data[C+1]*y+f*(1-y)|0,e.data[C+2]=e.data[C+2]*y+m*(1-y)|0,e.data[C+3]=e.data[C+3]):(b=S<Math.SQRT2*L&&T<Math.SQRT2*L?Math.SQRT2*L-Math.sqrt(Math.pow(S-Math.SQRT2*L,2)+Math.pow(T-Math.SQRT2*L,2)):S>T?T:S,L>b&&(A=2*Math.pow(1-b/L,4*s),A>1/255&&(M=.4*p.nextFloat()+.6,y=1-M*A,y>1?y=1:0>y&&(y=0),y=1-g+g*y,e.data[C]=e.data[C]*y+h*(1-y)+.5|0,e.data[C+1]=e.data[C+1]*y+f*(1-y)+.5|0,e.data[C+2]=e.data[C+2]*y+m*(1-y)+.5|0,e.data[C+3]=e.data[C+3])))},m={};m.drawDot=function(e,t,r,o,a,i,n,s,l,u,c,d,p){var h=e.width,f=e.height,m=h/2|0,g=f/2|0;d*=m,p*=g,i*=m,n*=m,i+=d,n+=p,l=1;for(var v,_,x,w,y,b,M=1/l/m/u,C=1/l/m/c,T=s*s,S=Math.PI/(2*T),A=Math.round(Math.min(f-1,Math.max(0,g+n-5*s/C))),E=Math.round(Math.max(0,Math.min(f-1,g+n+5*s/C))),P=Math.round(Math.min(h-1,Math.max(0,m+i-5*s/M))),D=Math.round(Math.max(0,Math.min(h-1,m+i+5*s/M))),F=A;E>=F;F++){v=4*F*h,_=C*(F-g-n);for(var L=P;D>=L;L++)x=v+4*L,w=M*(L-m-i),y=w*w+_*_,y>5*T?b=1:(b=2.25>y*S?1-a*Math.max(Math.cos(y*S),Math.cos(Math.sqrt(y*S)/1.8)/2):1-a*Math.cos(Math.sqrt(y*S)/1.8)/2,b>1&&(b=1),e.data[x]=e.data[x]*b+t*(1-b)|0,e.data[x+1]=e.data[x+1]*b+r*(1-b)|0,e.data[x+2]=e.data[x+2]*b+o*(1-b)|0)}},m.drawChar=function(e,t,r,o,a,i,n,s,l,u,c,d){d||(d=0),u||(u=0),c||(c=1.3);var p=e.width,h=e.height;c*=r;var f=[],g=[[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0]],v=[[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,0,1,1,1,0,0],[0,0,0,0,0,0,0]],_=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],x=[[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0],[0,1,0,1,0,1,0]],w=[[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[1,0,1,0,1,0,1],[0,1,1,1,1,1,1],[0,1,1,1,1,1,1],[0,1,1,1,1,1,1]],y=[[0,1,1,1,0,1,0],[0,1,1,1,0,1,0],[0,1,1,1,0,1,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0],[0,1,0,1,0,0,0]],b=[[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0],[0,1,1,1,1,1,0],[0,1,1,1,1,1,0],[1,1,1,1,1,1,1],[0,0,0,0,0,0,0]],M=[[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0],[0,0,1,1,1,0,0]],C=[[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0]],T=[[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]],S=[[0,0,0,0,0,0,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,1,0,0],[0,1,0,0,0,1,0],[0,0,0,0,0,0,0]],A=[[0,1,0,0,0,0,0],[0,1,1,0,0,0,0],[0,1,1,1,0,0,0],[0,1,1,1,1,0,0],[0,1,1,1,0,0,0],[0,1,1,0,0,0,0],[0,1,0,0,0,0,0]],E=[[0,0,0,0,0,1,0],[0,0,0,0,1,1,0],[0,0,0,1,1,1,0],[0,0,1,1,1,1,0],[0,0,0,1,1,1,0],[0,0,0,0,1,1,0],[0,0,0,0,0,1,0]],P=[[0,0,0,0,0,0,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,0,0,0],[0,1,0,0,0,0,0],[0,0,0,0,0,0,0]],D=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,0,0,0],[0,0,1,1,0,0,0]],F=[[0,0,1,1,0,0,0],[0,1,0,0,1,0,0],[0,1,0,0,1,0,0],[0,0,1,1,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],L=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],R=[[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,1,0,0,0],[0,0,0,0,0,0,0]],I=[[0,0,0,0,0,0,0],[0,0,0,1,1,1,0],[0,0,1,0,0,0,0],[0,0,1,0,0,0,0],[0,0,1,1,1,0,0],[0,0,1,0,0,0,0],[0,0,1,0,0,0,0]],B=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,1,1,1,0,0],[0,1,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,1,0],[0,0,1,1,1,0,0]],O=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],N=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0]],k=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],U=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0]],W=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]],G=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0]],j=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,1,1,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],V=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],z=[[0,0,1,1,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,1,1,1,0,0]],H=[[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],X=[[0,1,0,0,0,1,0],[0,1,0,0,1,0,0],[0,1,0,1,0,0,0],[0,1,1,0,0,0,0],[0,1,0,1,0,0,0],[0,1,0,0,1,0,0],[0,1,0,0,0,1,0]],$=[[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]],Y=[[0,1,0,0,0,1,0],[0,1,1,0,1,1,0],[0,1,0,1,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],q=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],Z=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],K=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0]],Q=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,1,0,1,0],[0,1,0,0,1,1,0],[0,0,1,1,1,1,0]],J=[[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],ee=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,0,0],[0,0,1,1,1,0,0],[0,0,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],te=[[0,1,1,1,1,1,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]],re=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]],oe=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0]],ae=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,1,0,1,0],[0,1,1,0,1,1,0],[0,1,0,0,0,1,0]],ie=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0]],ne=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,0,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]],se=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,1,0,0,0],[0,0,1,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]],le=[[0,0,0,1,0,0,0],[0,0,1,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]],ue=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0]],ce=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]],de=[[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0]],pe=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]],he=[[0,1,1,1,1,1,0],[0,1,0,0,0,0,0],[0,1,0,0,0,0,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0]],fe=[[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,0,0,0,1,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0]],me=[[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0]],ge=[[0,1,1,1,1,1,0],[0,1,0,0,0,1,0],[0,1,0,0,0,1,0],[0,1,1,1,1,1,0],[0,0,0,0,0,1,0],[0,0,0,0,0,1,0],[0,1,1,1,1,1,0]],ve=[[0,0,1,1,1,0,0],[0,1,0,0,0,1,0],[0,1,0,0,1,1,0],[0,1,0,1,0,1,0],[0,1,1,0,0,1,0],[0,1,0,0,0,1,0],[0,0,1,1,1,0,0]];f[" "]=_,f["%"]=v,f["&"]=g,f["~"]=x,f["{"]=w,f["}"]=y,f["^"]=b,f[">"]=A,f["<"]=E,f[":"]=R,f["-"]=L,f["+"]=C,f["."]=D,f["/"]=P,f["?"]=F,f["*"]=S,f["|"]=T,f["@"]=M,f.A=O,f.B=N,f.C=k,f.D=U,f.E=W,f.F=G,f.G=j,f.H=V,f.I=z,f.J=H,f.K=X,f.L=$,f.M=Y,f.N=q,f.O=Z,f.P=K,f.Q=Q,f.R=J,f.S=ee,f.T=te,f.U=re,f.V=oe,f.W=ae,f.X=ie,f.Y=ne,f.Z=se,f.f=I,f.s=B,f[1]=le,f[2]=ue,f[3]=ce,f[4]=de,f[5]=pe,f[6]=he,f[7]=fe,f[8]=me,f[9]=ge,f[0]=ve;for(var _e,xe,we=[],ye=[],be=0,Me=0,Ce=0;Ce<t.length;Ce++)for(var Te=0;7>Te;Te++)for(var Se=0;7>Se;Se++)f[t[Ce]]&&f[t[Ce]][Se][Te]&&(xe=(7*(Ce+u)+Te)*c*Math.cos(d)-Se*c*Math.sin(d),_e=(7*(Ce+u)+Te)*c*Math.sin(d)+Se*c*Math.cos(d),"undefined"==typeof e.moaGL?m.drawDot(e,i,n,s,l,xe,_e,r,1,1,1,o,a):(we[be++]=o+xe,we[be++]=a+_e*p/h,ye[Me++]=p*r));if(e.moaGL){var Ae={r:i,g:n,b:s,a:255*l+.5|0};e.moaGL.renderDotMatrix(Ae,we,r)}},m.drawLine=function(e,t,r,o,a,i,n){for(var s=e.width,l=e.height,u=0;u<i.length-1;u++){var c,d,p,h,f,m,g,v,_,x,w,y=i[u][0],b=i[u][1],M=i[u+1][0],C=i[u+1][1],T=[b-C,M-y],S=Math.sqrt(T[0]*T[0]+T[1]*T[1]);T[0]/=S,T[1]/=S;var A=[M-y,C-b],E=A[0]*A[0]+A[1]*A[1],P=n*n,D=2,F=(n+D)*(n+D),L=Math.round(Math.min(l-1,Math.max(0,Math.min(b,C)-n-D))),R=Math.round(Math.max(0,Math.min(l-1,Math.max(b,C)+n+D))),I=Math.round(Math.min(s-1,Math.max(0,Math.min(y,M)-n-D))),B=Math.round(Math.max(0,Math.min(s-1,Math.max(y,M)+n+D)));if(e.moaGL){var O={r:t,g:r,b:o,a:255*a+.5|0};e.moaGL.renderLine(O,T[0],T[1],y,M,b,C,n,P,D,a,F,E,I,L,B,R)}else for(var N=L;R>=N;N++){m=4*N*s;for(var k=I;B>=k;k++)g=m+4*k,c=Math.abs(T[0]*(k-y)+T[1]*(N-b)),d=(k-y)*(k-y)+(N-b)*(N-b),p=(k-M)*(k-M)+(N-C)*(N-C),p>d?(h=p,f=d):(h=d,f=p),w=c>n+D?1:h>f+E?P>d||P>p?1-a:F>d||F>p?1-a+a*(Math.sqrt(f)-n)/D:1:c>n?1-a+a*(c-n)/D:1-a,.995>w&&(v=e.data[g]*w+t*(1-w)+.5|0,_=e.data[g+1]*w+r*(1-w)+.5|0,x=e.data[g+2]*w+o*(1-w)+.5|0,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,x=0>x?0:x>255?255:x,e.data[g]=v,e.data[g+1]=_,e.data[g+2]=x,e.data[g+3]=e.data[g+3])}}},m.ringFlare=function(e,t,r,o,a,i,n,s,l){var u,c,d,p,h,f,m,g,v,_=e.width,x=e.height,w=(_+x)/2,y=.01*a,b=a*a,M=o*o,C=Math.min(x,Math.max(0,Math.round(r-a*w-4))),T=Math.min(x,Math.max(0,Math.round(r+a*w+4))),S=Math.min(_,Math.max(0,Math.round(t-a*w-4))),A=Math.min(_,Math.max(0,Math.round(t+a*w+4)));if(e.moaGL){var E={r:i,g:n,b:s,a:l};return void e.moaGL.renderRingFlare(E,t,r,b,M,y,w,l)}for(var P=C;T>P;P++){d=4*P*_,u=(P-r)/w;for(var D=S;A>D;D++)p=d+4*D,c=(D-t)/w,h=c*c+u*u,f=h>b+y?0:h>b?(b+y-h)/y:h>M?1:h>M-y?1-(M-h)/y:0,f=1-f*f*l,.995>f&&(m=e.data[p]*f+i*(1-f)+.5|0,g=e.data[p+1]*f+n*(1-f)+.5|0,v=e.data[p+2]*f+s*(1-f)+.5|0,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,e.data[p]=m,e.data[p+1]=g,e.data[p+2]=v,e.data[p+3]=e.data[p+3])}},m.drawBasicDot=function(e,t,r,o,a,i,n,s){var l=e.width,u=e.height,c=s*s,d=2;d>2*s&&(d=2*s);var p,h,f,m,g=Math.pow(s+d,2);if(e.moaGL){var v={r:t,g:r,b:o,a:255*aC},_=[i,n];e.moaGL.renderBasicDots(v,_,s,s,d)}for(var x=Math.round(Math.min(u-1,Math.max(0,n-s-d))),w=Math.round(Math.max(0,Math.min(u-1,n+s+d))),y=Math.round(Math.min(l-1,Math.max(0,i-s-d))),b=Math.round(Math.max(0,Math.min(l-1,i+s+d))),M=x;w>=M;M++){p=4*M*l;for(var C=y;b>=C;C++)h=p+4*C,f=(i-C)*(i-C)+(n-M)*(n-M),f>g?m=1:f>c?(m=1-a+a*(Math.sqrt(f)-s)/d,e.data[h]=e.data[h]*m+t*(1-m),e.data[h+1]=e.data[h+1]*m+r*(1-m),e.data[h+2]=e.data[h+2]*m+o*(1-m)):(m=1-a,e.data[h]=e.data[h]*m+t*(1-m),e.data[h+1]=e.data[h+1]*m+r*(1-m),e.data[h+2]=e.data[h+2]*m+o*(1-m))}},m.dirtspec=function(e,t,r,a,i,n){var s=e.width,l=e.height,u=new o.RNG(n),c=[],d=[t,r],p=[a];c[0]=[t,r,a];for(var h=1;a>.2;){a*=.97;var f=u.nextFloat()*(h-1)|0,g=c[f][0],v=c[f][1],_=c[f][2],x=2*u.nextFloat()*Math.PI;t=g+.5*(_+a)*Math.cos(x),r=v+.5*(_+a)*Math.sin(x),"undefined"==typeof e.moaGL&&m.drawBasicDot(e,i[0],i[1],i[2],i[3],t,r,a),c[h]=[t,r,a],d[2*h-2]=2*t/(s-1)-1,d[2*h-1]=2*r/(l-1)-1,p[h-1]=4*a,h++}if(e.moaGL){var w={r:i[0],g:i[1],b:i[2],a:255*i[3]+.5|0},y=2;y>2*a&&(y=2*a),e.moaGL.renderBasicDots(w,d,p,p[0],y)}},u.purpleBorder=function(e,t){var r=t.intensity,o=[0,0,0,1];p(e,o,"torn",[.02*r,.02,.5,"uniform",t.seed]),p(e,o,"round",[.02,1,1,1,1,1.5])},u.san_carmenBorder=function(e,t){var r,a=225,i=225,n=200,s=new o.RNG(t.seed),l=t.intensity;for(p(e,[a,i,n,1],"round",[.025,1,1,1,1,1.5]),r=4;10>r;r++)h(e,[a,i,n,.2],"torn",[.06*l*(10-r)/10,.005*r+.01,.4,"uniform",s.nextInt()])},u.san_carmenAutoColors=function(e,t){s.autocolorsfade(e,t.intensity,251,233,194)},u.threshBorder=function(e,t){p(e,[0,0,0,1],"round",[.025,1,1,1,1,1.5])},u.brownieBorder=function(e,t){var r=e.width,a=e.height,i=t.intensity,n=t.seed,s=new o.RNG(n);p(e,[0,0,0,.2],"torn",[.03*i,.02,.2,"uniform",s.nextInt()]),p(e,[0,0,0,.8],"torn",[.02*i,.01,.5,"uniform",s.nextInt()]),f(e,{color:[0,0,0,1],offset:-(r+a)/150,corner:0,scale:.5,seed:s.nextInt(),alpha:i})},u.maya_unicornBorder=function(e,t){var r=e.width,a=e.height,i=t.intensity,n=t.seed,s=new o.RNG(n);p(e,[0,0,0,1],"torn",[0,.04*a/Math.min(r,a),.2,"uniform",s.nextInt()]);var l=["Abercrave","Abilene","Aith","Banff","Blean","Caarnduncan","Corrievorrie","Cotterstock","Dalrymple","Draffan","Dubuque","Epsom","Frolesworth","Glassel","Golant","Harpenden","Hassop","Hove","Popcastle","Winkley"],u="&  >| "+l[s.nextFloat()*l.length|0].toUpperCase()+" |<  &",c=.8,d=.935,h=.003*Math.min(r,a)/r;m.drawChar(e,u,h,c,d,255,255,0,.3,-u.length),c=-.8,d=-.957,m.drawChar(e,u,h,c,d,255,255,0,.3,0,0,0);var f=[255,255,255,1];p(e,f,"torn",[0,.01*a/Math.min(r,a),.2,"uniform",s.nextInt()]),p(e,f,"torn",[.02*i,.01*a/Math.min(r,a),.5,"uniform",s.nextInt()]),p(e,f,"torn",[.008*i,.01*a/Math.min(r,a),.3,"normal",s.nextInt()])},u.old_threshBorder=function(e,t){var r=t.intensity,a=t.seed,i=new o.RNG(a);p(e,[255,255,255,1],"round",[.025,1,1,1,1,1.5]);for(var n=4;10>n;n++)h(e,[255,255,255,.2],"torn",[.06*r*(10-n)/10,.005*n+.01,.4,"uniform",i.nextInt()])},u.bordeauxBorder=function(e,t){var r=t.seed,a=new o.RNG(r),i=e.width,n=e.height,s=(i+n)/2,l=i/s;m.drawLine(e,255,255,255,.3,[[.46*i,.5*n-.05*i],[.54*i,.5*n-.05*i]],0),m.ringFlare(e,i/2,n/2-.05*i,.08*l,.081*l,255,255,255,.3),m.drawLine(e,255,255,255,.3,[[.5*i,.5*n-.18*i-.05*i],[.5*i,.5*n-.25*i-.05*i]],0),m.drawLine(e,255,255,255,.3,[[.5*i,.5*n+.18*i-.05*i],[.5*i,.5*n+.25*i-.05*i]],0),m.drawLine(e,255,255,255,.3,[[.5*i-.18*i,.5*n-.05*i],[.5*i-.25*i,.5*n-.05*i]],0),m.drawLine(e,255,255,255,.3,[[.5*i+.18*i,.5*n-.05*i],[.5*i+.25*i,.5*n-.05*i]],0),m.drawLine(e,255,255,255,1,[[-i,n-.1*i],[2*i,n-.1*i]],0),m.drawLine(e,0,0,0,1,[[-i,n],[2*i,n]],.1*i);var u="               ",c=u.length*a.nextFloat()|0;c=Math.min(u.length-1,Math.max(0,c)),u=u.substr(0,c)+"@"+u.substr(c+1);var d=[255,255,255,.6],p=.005,h=.5*(1-3*.1*i/n)+.5;m.drawChar(e,"+2..1..0..1..2-",p/1.2,-.5,h,d[0],d[1],d[2],d[3],-7.5),m.drawChar(e,u,p/1.2,-.5,h+7*p*1.3*i/n,d[0],d[1],d[2],d[3],-7.5);var f=.005*i,g=.8*i,v=n-8*f;m.drawLine(e,255,255,255,1,[[g,v],[g+10*f,v]],f/4),m.drawLine(e,255,255,255,1,[[g,v-6*f],[g+10*f,v-6*f]],f/4),m.drawLine(e,255,255,255,1,[[g,v],[g,v-6*f]],f/4),m.drawLine(e,255,255,255,1,[[g+10*f,v],[g+10*f,v-6*f]],f/4),m.drawLine(e,255,255,255,1,[[g-f,v-2*f],[g-f,v-4*f]],f/4);var _=4*a.nextFloat();_>0&&m.drawLine(e,255,255,255,1,[[g+8*f,v-2*f],[g+8*f,v-4*f]],f/4),_>1&&m.drawLine(e,255,255,255,1,[[g+6*f,v-2*f],[g+6*f,v-4*f]],f/4),_>2&&m.drawLine(e,255,255,255,1,[[g+4*f,v-2*f],[g+4*f,v-4*f]],f/4),_>3&&m.drawLine(e,255,255,255,1,[[g+2*f,v-2*f],[g+2*f,v-4*f]],f/4)},u.covertBorder=function(e,t){var r=t.seed,a=new o.RNG(r);a.nextInt(),a.nextInt();for(var i=e.width,n=e.height,s=.5,l=["1.4","2","2.8","4","5.6","8","11","16","22","32"],u=l[a.nextFloat()*l.length|0];u.length<3;)u+=" ";for(var c=["100","200","400","800","1600"],p=c[a.nextFloat()*c.length|0];p.length<4;)p+=" ";for(var h=.015625,f=["1","2","4","8","15","30","60","125","250","500","1000"],g=f[0],v=s*parseFloat(p)/(parseFloat(u)*parseFloat(u)*h),_=1;_<f.length;_++)Math.abs(parseInt(f[_])-v)<Math.abs(parseInt(g)-v)&&(g=f[_]);for(;g.length<4;)g=" "+g;var x="               ",w=x.length*a.nextFloat();w=Math.min(x.length-1,Math.max(0,w)),x=x.substr(0,w)+"@"+x.substr(w+1);var y=new Date,b="dfasdfsdf";b=y.toDateString(),b=b.toUpperCase();var M=[90,250,20,.6];d(e,[0,0,0,1],"smooth",[.5,Math.max(i,n)/15*.6]);for(var C=.0043*Math.min(i,n)/i,T=0;T<f.length;T++){var S=1.1/f.length,A=-S*T+.5;(g==f[T]||g==" "+f[T]||g=="  "+f[T]||g=="   "+f[T])&&m.drawLine(e,90,250,20,.6,[[.97*i,(A+S/2+1)*n/2],[2*i,(A+1)*n/2]],C*i*.7),m.drawChar(e,f[T],.7*C,1,A,M[0],M[1],M[2],M[3],-2-f[T].length/2)}m.drawLine(e,0,0,0,.1,[[0,n/3],[i,n/3]],0),m.drawLine(e,0,0,0,.1,[[0,2*n/3],[i,2*n/3]],0),m.drawLine(e,0,0,0,.1,[[i/3,0],[i/3,n]],0),m.drawLine(e,0,0,0,.1,[[2*i/3,0],[2*i/3,n]],0),m.drawChar(e,"+2..1..0..1..2-",C/1.2,-.5,.915,M[0],M[1],M[2],M[3],-7.5),m.drawChar(e,x,C/1.2,-.5,.918+7*C*1.3*i/n,M[0],M[1],M[2],M[3],-7.5),m.drawChar(e,b,C,.75,.92,M[0],M[1],M[2],M[3],-b.length)},u.orcaBorder=function(e,t){var r=t.seed,a=new o.RNG(r),i=e.width,n=e.height,s=["1.4","2","2.8","4","5.6","8","11","16","22","32"],l=s[a.nextFloat()*s.length|0],u=[216,193,163,.6];d(e,[0,0,0,1],"rough",[1,(i+n)/30*.6,r]);for(var c=.0043*Math.min(i,n)/i,p=0;p<s.length;p++){var h=1.1/s.length*p-.5;(l==s[p]||l==s[p]+" "||l==s[p]+"  ")&&m.drawLine(e,230,50,40,.7,[[.95*i,(h+1)*n/2],[2*i,.5*n]],c*i*.7),m.drawChar(e,s[p],.7*c,1,h,u[0],u[1],u[2],u[3],-2-s[p].length/2)}m.drawLine(e,0,0,0,.1,[[i/4,0],[i/4,n/3]],0),m.drawLine(e,0,0,0,.1,[[0,n/4],[i/3,n/4]],0),m.drawLine(e,0,0,0,.1,[[0,3*n/4],[i/3,3*n/4]],0),m.drawLine(e,0,0,0,.1,[[i/4,n],[i/4,2*n/3]],0),m.drawLine(e,0,0,0,.1,[[3*i/4,0],[3*i/4,n/3]],0),m.drawLine(e,0,0,0,.1,[[i,n/4],[2*i/3,n/4]],0),m.drawLine(e,0,0,0,.1,[[3*i/4,n],[3*i/4,2*n/3]],0),m.drawLine(e,0,0,0,.1,[[i,3*n/4],[2*i/3,3*n/4]],0),m.drawLine(e,0,0,0,.1,[[0,n/2],[i/4,n/2]],0),m.drawLine(e,0,0,0,.1,[[i/2,0],[i/2,n/4]],0),m.drawLine(e,0,0,0,.1,[[i/2,n],[i/2,3*n/4]],0),m.drawLine(e,0,0,0,.1,[[i,n/2],[3*i/4,n/2]],0),m.ringFlare(e,i/2,n/2,.08,.22,255,255,255,.28)},u.titanBorder=function(e,t){var r=t.seed,a=new o.RNG(r),i=e.width,n=e.height,s=["1.4","2","2.8","4","5.6","8","11","16","22","32"],l=s[a.nextFloat()*s.length|0],u=["1","2","4","8","15","30","60","125","250","500","1000"],c=.005*(i+n)/i/2;d(e,[0,0,0,1],"viewfinder",[.005*(i+n),.035*(i+n),.005*(i+n),.035*(i+n),r]),m.drawLine(e,0,0,0,1,[[i-.03*(i+n),.8*n-.035*(i+n)],[i-.03*(i+n),.2*n]],(i+n)/50);var p=.035*(i+n),h=.5*(1-p/n*2.5)+.5;m.drawLine(e,255,255,255,.2,[[.4*i,n-p/2],[.45*i,n-p/2]],(i+n)/100),m.drawChar(e,l,c,-.15,h,255,255,255,1,-l.length/2);for(var f=[230,230,255,.8],g=0;g<u.length;g++){var v=1.1/u.length,_=-v*g+.4;m.drawChar(e,u[g],.7*c,1,_,f[0],f[1],f[2],f[3],-3.5-u[g].length/2)}},u.andyBorder=function(e,t){var r=t.seed,a=new Date,i=a.toDateString();i=i.toUpperCase();for(var n=e.width,s=e.height,l=.5,u=new o.RNG(r),c=["1.4","2","2.8","4","5.6","8","11","16","22","32"],d=c[u.nextFloat()*c.length|0];d.length<3;)d+=" ";for(var h=["100","200","400","800","1600"],f=h[u.nextFloat()*h.length|0];f.length<4;)f+=" ";for(var g=.015625,v=["1","2","4","8","15","30","60","125","250","500","1000"],_=v[0],x=l*parseFloat(f)/(parseFloat(d)*parseFloat(d)*g),w=1;w<v.length;w++)Math.abs(parseInt(v[w],10)-x)<Math.abs(parseInt(_,10)-x)&&(_=v[w]);for(;_.length<4;)_=" "+_;var y="               ",b=y.length*u.nextFloat();b=Math.min(y.length-1,Math.max(0,b)),y=y.substr(0,b)+"@"+y.substr(b+1);var M=_+"/s f"+d+"  > |",C="  | <     ISO:"+f;p(e,[0,0,0,1],"round",[.008,6,4,4,4,1.5]);var T=.0043*Math.min(n,s)/n;m.drawChar(e,M,T,-.9,-.978,180,120,0,1),m.drawChar(e,C,T,.9,-.978,180,120,0,1,-C.length),m.drawChar(e,"+2..1..0..1..2-",T/1.7,0,-.985,180,120,0,1,-7.5),m.drawChar(e,y,T/1.7,0,-.988+7*T*1.3*n/s,180,120,0,1,-7.5),m.drawChar(e,i,T,.85,.86,230,50,40,1,-i.length)},u.aquaBorder=function(e,t){p(e,[255,255,255,1],"round",[.025,1,1,1,1,1.5])},u.edgewoodBorder=function(e,t){var r,a=new o.RNG(t.seed),i=[255,255,255,1];for(p(e,i,"round",[.025,1,1,1,1,1.5]),r=4;10>r;r++)h(e,i,"torn",[.03*t.intensity*(10-r)/10,.005*r+.01,.4,"uniform",a.nextInt()])},u.joe_coolBorder=function(e,t){p(e,[255,255,255,1],"bulge",[.05,.28,.5])},u.singeBorder=function(e,t){d(e,[0,0,0,1],"fade",1)},u.solarBorder=function(e,t){for(var r,a,i=e.width,n=e.height,s=t.seed,l=new o.RNG(s),u=(i+n)/2/50,c=[[141,88,46,.1],[70,48,26,.1]],d=.02,p=0;2>p;p++)for(var h=7;10>h;h++)for(var g=h;10>g;g+=.4)r=i*d*l.nextFloatNormal(),a=n*l.nextFloat(),m.dirtspec(e,r,a,u/3*h/15,c[p],l.nextInt()),r=i+i*d*l.nextFloatNormal(),a=n*l.nextFloat(),m.dirtspec(e,r,a,u/3*h/15,c[p],l.nextInt()),r=i*l.nextFloat(),a=n*d*l.nextFloatNormal(),m.dirtspec(e,r,a,u/3*h/15,c[p],l.nextInt()),r=i*l.nextFloat(),a=n+n*d*l.nextFloatNormal(),m.dirtspec(e,r,a,u/3*h/15,c[p],l.nextInt());f(e,{color:[200,140,80,.3],offset:(i+n)/80,corner:(i+n)/40,seed:l.nextInt()}),f(e,{color:[113,77,40,.7],offset:(i+n)/200,corner:(i+n)/60,seed:l.nextInt()}),f(e,{color:[0,0,0,.9],offset:0,corner:(i+n)/80,seed:l.nextInt()})},u.earthyBorder=function(e,t){var r=t.seed,a=new o.RNG(r),i=[0,15,0,1],n=t.intensity;p(e,i,"torn",[.02*n,.02,.5,"uniform",a.nextInt()]),p(e,i,"torn",[.01*n,.02,0,"uniform",a.nextInt()]),f(e,{color:i,seed:a.nextInt(),alpha:n})},u.ithacaFlare=function(e,t){var r=t.intensity,i=new o.RNG(t.seed),n=.3*(i.nextFloat()-.5),s=.3*(i.nextFloat()-.5),l=.4*i.nextFloat();a.flare(e,1+l,255,255,255,.6*r,"angleGaussian",n,s)},u.ithacaBorder=function(e,t){d(e,[255,255,255,1],"smooth",[1])},u.cherryBorder=function(e,t){var r=e.width,a=e.height,i=new o.RNG(t.seed);p(e,[255,255,255,1],"round",[.03,1,1,1,1,1.5]);var n=.03*Math.min(r,a)/r,s=["ABERCRAVE","ABILENE","AITH","BANFF","BLEAN","CAARNDUNCAN","CORRIEVORRIE","COTTERSTOCK","DALRYMPLE","DRAFFAN","DUBUQUE","EPSOM","FROLESWORTH","GLASSEL","GOLANT","HARPENDEN","HASSOP","HOVE","POPCASTLE","WINKLEY"],l="<> <> "+s[i.nextFloat()*s.length|0].toUpperCase()+" <> <>",u=1-1.4*n,c=.85,d=.003*Math.min(r,a)/r,h=-Math.PI/2;m.drawChar(e,l,d,u,c,230,50,40,.4,0,0,h),u=-1+.6*n,m.drawChar(e,l,d,u,c,230,50,40,.4,0,0,h),u=1-1.4*n,c=-.85,m.drawChar(e,l,d,u,c,230,50,40,.4,-l.length,0,h),u=-1+.6*n,m.drawChar(e,l,d,u,c,230,50,40,.4,-l.length,0,h)},u.cross_processBorder=function(e,t){p(e,[255,255,255,1],"torn",[.015*t.intensity,.02,.5,"uniform",t.seed])},u.sunburnFlare=function(e,t){var r=t.intensity,i=new o.RNG(t.seed),n=.1*(i.nextFloat()-.5),s=.1*(i.nextFloat()-.5),l=.1*(i.nextFloat()-.5);a.flare(e,1+l,255,255,255,1*r,"gaussianThing2",n,s)},u.sunburnBorder=function(e,t){d(e,[0,0,0,1],"fade",[1,0,2.222])},u.fadedBorder=function(e,t){var r=t.intensity,a=new o.RNG(t.seed);p(e,[255,255,255,1],"round",[.025,1,1,1,1,1.5]);var i;for(i=4;10>i;i++)h(e,[255,255,255,1],"torn",[.03*r,.005*i+.01,8,"uniform",a.nextInt()])},u.chronoBorder=function(e,t){var r=e.width,a=e.height,s=t.intensity,l=new o.RNG(t.seed);m.drawLine(e,255,255,0,.2,[[.35*r,a/8],[.65*r,a/8]],(r+a)/250),m.drawLine(e,255,255,0,.2,[[.35*r,7*a/8],[.65*r,7*a/8]],(r+a)/250),m.drawLine(e,255,255,0,.2,[[.11*r,.2*a],[.11*r,.8*a]],(r+a)/250),m.drawLine(e,110,110,0,.85,[[.965*r,0],[.965*r,a]],.07*r),m.drawLine(e,110,0,0,.85,[[.947*r,.04*a],[1.2*r,.3*a]],.05*r),m.drawLine(e,110,0,0,.85,[[.947*r,.96*a],[1.2*r,.7*a]],.05*r),m.drawLine(e,0,0,0,.5,[[.895*r,0],[.895*r,a]],0);for(var u=["1.4","2","2.8","4","5.6","8","11","16","22","32"],c=l.nextFloat()*u.length|0,d=(u[c],.004),h=[0,0,0,.8],g=0;g<u.length;g++){var v=2/u.length,_=.9-v*g;c==g&&m.drawLine(e,255,255,0,.2,[[.86*r,(_/2-v/10+.5)*a],[.86*r,(_/2+v/10+.5)*a]],(r+a)/250),m.drawChar(e,u[g],d,.95,_,h[0],h[1],h[2],h[3],-2-u[g].length/2),m.drawChar(e,"%",d,.95,_+v/2,h[0],h[1],h[2],h[3],-2.5)}var x=l.nextInt();f(e,{color:[0,0,0,1],seed:x,alpha:1,scale:.5}),n.vignette(e,(r+a)/2*1.1/(s+i),0,0,150),p(e,[0,0,0,1],"bulge",[.05,.28,.5])},u.cabanaBorder=function(e,t){var r=e.width,o=e.height,a=.0053*Math.min(r,o)/r;m.drawLine(e,255,255,255,.5,[[0,.1*o],[.08*r,.1*o]],0),m.drawChar(e,"0.5",a,-.8,-.8-2*a,255,255,255,.5),m.drawLine(e,255,255,255,.5,[[0,.3*o],[.08*r,.3*o]],0),m.drawChar(e,"1.0",a,-.8,-.4-2*a,255,255,255,.5),m.drawLine(e,255,255,255,.5,[[0,.5*o],[.08*r,.5*o]],0),m.drawChar(e,"1.5",a,-.8,-2*a,255,255,255,.5),m.drawLine(e,255,255,255,.5,[[0,.7*o],[.08*r,.7*o]],0),m.drawChar(e,"2.0",a,-.8,.4-2*a,255,255,255,.5),m.drawLine(e,255,255,255,.5,[[0,.9*o],[.08*r,.9*o]],0),m.drawChar(e,"2.5",a,-.8,.8-2*a,255,255,255,.5),p(e,[0,0,0,1],"round",[.025,1,1,1,1,1.5])},u.soft_focus=function(e,t){var r=t.intensity,o=.4*r,a=1+.25*r;l.softFocusConvolution(e,o,a)},t.exports=u},{"../core/rng":42,"./MoaFlare":81,"./MoaVignette":98,"./legacy/auto_colors_fade_max_color":100,"./legacy/soft_focus":101}],93:[function(e,t,r){"use strict";var o={},a=e("../core/rng");o.noise=function(e,t,r){var o,i,n,s,l,u,c=new a.RNG(r);if(e.moaGL)return void e.moaGL.renderNoise(t,r);var d=e.width,p=e.height;for(t*=255,u=0;d*p>u;u++)o=4*u,l=t*(2*c.nextFloat()-1),i=e.data[o]+l+.5|0,n=e.data[o+1]+l+.5|0,s=e.data[o+2]+l+.5|0,i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,s=0>s?0:s>255?255:s,e.data[o]=i,e.data[o+1]=n,e.data[o+2]=s},t.exports=o},{"../core/rng":42}],94:[function(e,t,r){"use strict";var o={},a=e("../core/MoaColor"),i=e("../core/MoaMipmap"),n=e("../core/MoaTransform"),s=e("../core/MoaDataTypes"),l=(s.MoaPoint,e("../core/MoaAllocAndCopy")),u=function(e,t,r){if(0==r)return[e,t];for(r=Math.abs(r);r>Math.PI/2;)r-=Math.PI/2;var o=Math.atan2(t,e),a=.5*e,i=.5*t,n=Math.sqrt(a*a+i*i),s=o-r,l=Math.PI-o-r,u=Math.cos(s),c=-Math.cos(l),d=Math.sin(s),p=Math.sin(l),h=u>0?a/u:n,f=c>0?a/c:n,m=d>0?i/d:n,g=p>0?i/p:n,v=Math.min(h,Math.min(f,Math.min(m,g))),_=v/n,x=_*e,w=_*t;return[x,w]};o.renderOrientation=function(e,t,r,a,i,s){var c=new n,d=e.width,p=e.height;Math.abs(a)%180==90&&(d=e.height,p=e.width),c.postRotateZ(-a*Math.PI/180);var h,f;t&&c.postScaleXY(1,-1),r&&c.postScaleXY(-1,1);var m=u(d,p,i*Math.PI/180);h=m[0],f=m[1];var g=d/h,v=d/p;if(c.postScaleXY(1,v),c.postRotateZ(-i*Math.PI/180),c.postScaleXY(1,1/v),c.postScaleXY(1/g,1/g),h=Math.floor(h),f=Math.floor(f),"undefined"!=typeof s&&null!=s&&s(h,f),e.moaGL){var _=e.moaGL.createTexture(e.width,e.height);return e.moaGL.copyLastRender(_),e.moaGL.transformAndResizeImage(e,_,c,h,f,"linear"),e.width=h,e.height=f,e.moaGL.destroyTexture(_),!0}var x=l.makeBitmap(h,f);return o.transformImage(x,e,c,"linear","normal",1),e.data=x.data,e.width=h,e.height=f,!0},o.cropImage=function(e,t,r,a,i){var s=e.width,u=e.height,c=r*e.width|0,d=c/a+.5|0,p=t[0]*s+.5|0,h=t[1]*u+.5|0,f=p+c-1|0,m=h+d-1|0;p=Math.max(0,Math.min(s-1,p)),f=Math.max(0,Math.min(s-1,f)),h=Math.max(0,Math.min(u-1,h)),m=Math.max(0,Math.min(u-1,m));var g=p/(s-1),v=h/(u-1),_=f/(s-1),x=m/(u-1),w=.5*(_-g)+g,y=.5*(x-v)+v;c=f-p+1|0,d=m-h+1|0,c=Math.min(s,Math.max(1,c)),d=Math.min(u,Math.max(1,d));var b=new n;if("undefined"!=typeof i&&null!=i&&i(c,d),e.moaGL){var M=c/s,C=d/u;b.postTranslate(-(.5-w),-(.5-y)),b.postScaleXY(M,C);var T=e.moaGL.createTexture(e.width,e.height);return e.moaGL.copyLastRender(T),e.moaGL.transformAndResizeImage(e,T,b,c,d,"nearest"),e.width=c,e.height=d,e.moaGL.destroyTexture(T),!0}var M=(c-1)/(s-1),C=(d-1)/(u-1);b.postTranslate(-(.5-w),-(.5-y)),b.postScaleXY(M,C);var S=l.makeBitmap(c,d);return o.transformImage(S,e,b,"nearest","normal",1),e.data=S.data,e.width=c,e.height=d,!0},o.resizeImage=function(e,t,r){if(t=Math.floor(t),r=Math.floor(r),e.moaGL){var a=new n;if(t>=.5*e.width&&r>=.5*e.height){var i=e.moaGL.createTexture(e.width,e.height);return e.moaGL.copyLastRender(i),e.moaGL.transformAndResizeImage(e,i,a,t,r,"linear"),e.width=t,e.height=r,e.moaGL.destroyTexture(i),!0}var s=e.moaGL.glRenderingObjects.readTexture,u={width:e.width,height:e.height,data:e.moaGL.getImageDataFromTexture(s)},c=Math.min(t,e.width),d=Math.min(r,e.height),p=l.makeBitmap(c,d);o.downscalePremultipliedImage(p,u);var h=e.moaGL.createTextureFromBitmap(p);return e.moaGL.transformAndResizeImage(e,h,a,t,r,"linear"),e.width=t,e.height=r,e.moaGL.destroyTexture(h),!0}var p=l.makeBitmap(t,r);if(t>=.5*e.width&&r>=.5*e.height){var a=new n;o.transformImage(p,e,a,"linear","normal",1)}else if(t<.5*e.width&&r<.5*e.height)o.downscalePremultipliedImage(p,e);else{var f=Math.min(t,e.width),m=Math.min(r,e.height),g=l.makeBitmap(f,m);
o.downscalePremultipliedImage(g,e);var a=new n;o.transformImage(p,g,a,"linear","normal",1),g.data=null}return e.data=p.data,e.width=t,e.height=r,!0};var c=[0,.0003035269835,.0006070539671,.0009105809506,.001214107934,.001517634918,.001821161901,.002124688885,.002428215868,.002731742852,.003035269835,.003346535764,.003676507324,.004024717018,.004391442037,.004776953481,.005181516702,.005605391624,.006048833023,.006512090793,.006995410187,.007499032043,.008023192985,.008568125618,.009134058702,.00972121732,.01032982303,.01096009401,.01161224518,.01228648836,.01298303234,.01370208305,.0144438436,.01520851442,.01599629337,.01680737575,.01764195449,.01850022013,.01938236096,.02028856306,.02121901038,.02217388479,.02315336618,.02415763245,.02518685963,.02624122189,.02732089164,.0284260395,.02955683444,.03071344373,.03189603307,.03310476657,.03433980681,.03560131488,.0368894504,.0382043716,.03954623528,.04091519691,.04231141062,.04373502926,.04518620439,.04666508634,.04817182423,.04970656598,.05126945837,.05286064702,.05448027644,.05612849005,.05780543019,.05951123816,.06124605423,.06301001765,.06480326669,.06662593864,.06847816984,.0703600957,.07227185068,.07421356838,.07618538148,.07818742181,.08021982031,.08228270713,.08437621154,.08650046204,.08865558629,.09084171118,.09305896285,.09530746663,.09758734714,.09989872825,.1022417331,.1046164841,.107023103,.1094617108,.1119324278,.1144353738,.1169706678,.119538428,.1221387722,.1247718176,.1274376804,.1301364767,.1328683216,.1356333297,.138431615,.1412632911,.1441284709,.1470272665,.1499597898,.152926152,.1559264637,.1589608351,.1620293756,.1651321945,.1682694002,.1714411007,.1746474037,.177888416,.1811642442,.1844749945,.1878207723,.1912016827,.1946178304,.1980693196,.2015562538,.2050787364,.2086368701,.2122307574,.2158605001,.2195261997,.2232279573,.2269658735,.2307400485,.2345505822,.2383975738,.2422811225,.2462013267,.2501582847,.2541520943,.2581828529,.2622506575,.2663556048,.270497791,.2746773121,.2788942635,.2831487404,.2874408377,.2917706498,.2961382708,.3005437944,.3049873141,.3094689228,.3139887134,.3185467781,.3231432091,.3277780981,.3324515363,.337163615,.3419144249,.3467040564,.3515325995,.3564001441,.3613067798,.3662525956,.3712376805,.376262123,.3813260114,.3864294338,.3915724777,.3967552307,.4019777798,.4072402119,.4125426135,.4178850708,.42326767,.4286904966,.4341536362,.4396571738,.4452011945,.4507857828,.4564110232,.4620769997,.4677837961,.4735314961,.4793201831,.4851499401,.4910208498,.4969329951,.502886458,.5088813209,.5149176654,.5209955732,.5271151257,.533276404,.539479489,.5457244614,.5520114015,.5583403896,.5647115057,.5711248295,.5775804404,.5840784179,.5906188409,.5972017884,.6038273389,.6104955708,.6172065624,.6239603917,.6307571363,.637596874,.644479682,.6514056374,.6583748173,.6653872983,.672443157,.6795424696,.6866853124,.6938717613,.7011018919,.7083757799,.7156935005,.7230551289,.7304607401,.7379104088,.7454042095,.7529422168,.7605245047,.7681511472,.7758222183,.7835377915,.7912979403,.799102738,.8069522577,.8148465722,.8227857544,.8307698768,.8387990117,.8468732315,.8549926081,.8631572135,.8713671192,.8796223969,.8879231179,.8962693534,.9046611744,.9130986518,.9215818563,.9301108584,.9386857285,.9473065367,.9559733532,.9646862479,.9734452904,.9822505503,.9911020971,1],d=[0,1,2,2,3,4,5,6,6,7,8,9,10,10,11,12,13,13,14,15,15,16,16,17,18,18,19,19,20,20,21,21,22,22,23,23,23,24,24,25,25,25,26,26,27,27,27,28,28,29,29,29,30,30,30,31,31,31,32,32,32,33,33,33,34,34,34,34,35,35,35,36,36,36,37,37,37,37,38,38,38,38,39,39,39,40,40,40,40,41,41,41,41,42,42,42,42,43,43,43,43,43,44,44,44,44,45,45,45,45,46,46,46,46,46,47,47,47,47,48,48,48,48,48,49,49,49,49,49,50,50,50,50,50,51,51,51,51,51,52,52,52,52,52,53,53,53,53,53,54,54,54,54,54,55,55,55,55,55,55,56,56,56,56,56,57,57,57,57,57,57,58,58,58,58,58,58,59,59,59,59,59,59,60,60,60,60,60,60,61,61,61,61,61,61,62,62,62,62,62,62,63,63,63,63,63,63,64,64,64,64,64,64,64,65,65,65,65,65,65,66,66,66,66,66,66,66,67,67,67,67,67,67,67,68,68,68,68,68,68,68,69,69,69,69,69,69,69,70,70,70,70,70,70,70,71,71,71,71,71,71,71,72,72,72,72,72,72,72,72,73,73,73,73,73,73,73,74,74,74,74,74,74,74,74,75,75,75,75,75,75,75,75,76,76,76,76,76,76,76,77,77,77,77,77,77,77,77,78,78,78,78,78,78,78,78,78,79,79,79,79,79,79,79,79,80,80,80,80,80,80,80,80,81,81,81,81,81,81,81,81,81,82,82,82,82,82,82,82,82,83,83,83,83,83,83,83,83,83,84,84,84,84,84,84,84,84,84,85,85,85,85,85,85,85,85,85,86,86,86,86,86,86,86,86,86,87,87,87,87,87,87,87,87,87,88,88,88,88,88,88,88,88,88,88,89,89,89,89,89,89,89,89,89,90,90,90,90,90,90,90,90,90,90,91,91,91,91,91,91,91,91,91,91,92,92,92,92,92,92,92,92,92,92,93,93,93,93,93,93,93,93,93,93,94,94,94,94,94,94,94,94,94,94,95,95,95,95,95,95,95,95,95,95,96,96,96,96,96,96,96,96,96,96,96,97,97,97,97,97,97,97,97,97,97,98,98,98,98,98,98,98,98,98,98,98,99,99,99,99,99,99,99,99,99,99,99,100,100,100,100,100,100,100,100,100,100,100,101,101,101,101,101,101,101,101,101,101,101,102,102,102,102,102,102,102,102,102,102,102,103,103,103,103,103,103,103,103,103,103,103,103,104,104,104,104,104,104,104,104,104,104,104,105,105,105,105,105,105,105,105,105,105,105,105,106,106,106,106,106,106,106,106,106,106,106,106,107,107,107,107,107,107,107,107,107,107,107,107,108,108,108,108,108,108,108,108,108,108,108,108,109,109,109,109,109,109,109,109,109,109,109,109,110,110,110,110,110,110,110,110,110,110,110,110,111,111,111,111,111,111,111,111,111,111,111,111,111,112,112,112,112,112,112,112,112,112,112,112,112,113,113,113,113,113,113,113,113,113,113,113,113,113,114,114,114,114,114,114,114,114,114,114,114,114,114,115,115,115,115,115,115,115,115,115,115,115,115,115,116,116,116,116,116,116,116,116,116,116,116,116,116,117,117,117,117,117,117,117,117,117,117,117,117,117,117,118,118,118,118,118,118,118,118,118,118,118,118,118,119,119,119,119,119,119,119,119,119,119,119,119,119,119,120,120,120,120,120,120,120,120,120,120,120,120,120,120,121,121,121,121,121,121,121,121,121,121,121,121,121,122,122,122,122,122,122,122,122,122,122,122,122,122,122,122,123,123,123,123,123,123,123,123,123,123,123,123,123,123,124,124,124,124,124,124,124,124,124,124,124,124,124,124,125,125,125,125,125,125,125,125,125,125,125,125,125,125,125,126,126,126,126,126,126,126,126,126,126,126,126,126,126,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,129,129,129,129,129,129,129,129,129,129,129,129,129,129,130,130,130,130,130,130,130,130,130,130,130,130,130,130,130,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,131,132,132,132,132,132,132,132,132,132,132,132,132,132,132,132,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,133,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,134,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,135,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,136,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,137,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,138,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,139,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,141,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,142,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,143,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,144,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,145,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,147,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,148,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,149,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,150,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,151,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,152,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,153,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,155,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,156,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,157,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,158,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,159,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,160,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,161,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,162,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,163,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,164,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,165,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,166,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,167,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,168,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,169,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,172,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,173,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,174,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,175,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,176,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,177,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,178,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,179,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,180,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,182,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,184,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,185,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,186,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,187,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,188,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,189,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,190,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,191,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,193,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,194,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,196,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,197,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,198,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,199,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,200,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,201,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,202,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,203,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,205,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,206,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,207,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,208,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,209,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,210,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,211,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,212,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,213,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,214,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,215,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,216,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,217,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,218,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,219,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,220,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,221,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,222,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,223,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,224,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,225,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,226,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,227,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,228,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,230,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,231,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,232,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,233,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,234,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,235,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,236,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,237,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,238,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,239,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,240,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,241,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,242,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,243,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,244,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,245,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,247,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,248,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,250,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,251,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,252,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],p=function(e,t,r,o,a){var i=0,n=0,s=0,l=0;t=Math.min(e.width-1,t),o=Math.min(e.height-1,o),r=Math.min(e.width-1,r),a=Math.min(e.height-1,a);for(var u=e.data,p=o;a>=p;p++)for(var h=t;r>=h;h++){var f=4*(p*e.width+h);i+=c[u[f]],n+=c[u[f+1]],s+=c[u[f+2]],l+=c[u[f+3]]}var m=(a-o+1)*(r-t+1),g=4095*i/m+.5|0,v=4095*n/m+.5|0,_=4095*s/m+.5|0,x=4095*l/m+.5|0,w=d[g],y=d[v],b=d[_],M=d[x],C={r:w,g:y,b:b,a:M};return C};o.downscalePremultipliedImage=function(e,t){var r,o,a,i,n,s,l,u=e.data,c=e.width,d=e.height,h=(t.data,t.width),f=t.height,m=(h-1)/c,g=(f-1)/d;for(s=0;d>s;s++)for(n=0;c>n;n++){r=n*m+.5|0,o=(n+1)*m+.5|0,a=s*g+.5|0,i=(s+1)*g+.5|0;var v=p(t,r,o,a,i);l=4*(s*c+n),u[l]=v.r,u[l+1]=v.g,u[l+2]=v.b,u[l+3]=v.a}},o.transformImage=function(e,t,r,o,n,s){if(e.moaGL)return void e.moaGL.transformOverlay(e,t,r,o,n,s);var l,u=i.prototype.getBitmapSamplingFuncForSamplingMode(o),c=(a.prototype.blendEmbededAlphaFromArray,e.width),d=e.height,p=t.width,h=t.height,f=Math.max(1,c-1),m=Math.max(1,d-1);r.preTranslate(.5,.5),r.postTranslate(-.5,-.5);for(var g=[],l={r:0,g:0,b:0,a:0},v=0;d>v;v++)for(var _=0;c>_;_++){var x=4*(v*c+_),w=_/f,y=v/m;g[0]=w,g[1]=y,r.postTransformPoint(g);var b=g[0]*(p-1),M=g[1]*(h-1);u(t,b,M,l),l.a*=s,a.prototype.blendEmbededAlphaFromArray(e.data,x,l,n),e.data[x+3]=255}},o.transformPremultipliedOverlay=function(e,t,r,o,a){if(e.moaGL)return void e.moaGL.transformPremultipliedOverlay(e,t,r,o,"normal",a);var s,l,u,c=i.prototype.interpolateBilinearPremultiplied,d=e.width,p=e.height,h=e.data,f=t.width,m=t.height,g=t.data,v=Math.max(1,d),_=Math.max(1,p),x=new n(r.transformMatrix);x.invert();var w={x:-.5,y:-.5,z:0,w:1},y={x:1,y:0,z:0,w:0},b={x:0,y:1,z:0,w:0};x.rightMultiplyVector(w),x.rightMultiplyVector(y),x.rightMultiplyVector(b),w.x+=.5,w.y+=.5,w.x*=d,w.y*=p,y.x*=d,y.y*=p,b.x*=d,b.y*=p;var M,C,T,S,A={x:w.x+y.x+b.x,y:w.y+y.y+b.y};y.x+=w.x,y.y+=w.y,b.x+=w.x,b.y+=w.y,M=Math.min(w.x,Math.min(A.x,Math.min(y.x,b.x)))-1,T=Math.min(w.y,Math.min(A.y,Math.min(y.y,b.y)))-1,C=Math.max(w.x,Math.max(A.x,Math.max(y.x,b.x)))+1,S=Math.max(w.y,Math.max(A.y,Math.max(y.y,b.y)))+1,M=Math.max(0,0|M),T=Math.max(0,0|T),C=Math.min(d-1,C+.5|0),S=Math.min(p-1,S+.5|0);var E=new n(r.transformMatrix);E.preTranslate(.5,.5),E.preScaleXY(f,m),E.preTranslate(-.5,-.5),E.postTranslate(-.5,-.5),E.postScaleXY(1/v,1/_),E.postTranslate(.5,.5);for(var P,D,F,L,R=E.transformMatrix,I={r:0,g:0,b:0,a:0},B=T;S>=B;B++){s=4*(B*d);for(var O=M;C>=O;O++)if(l=s+4*O,P=R[0]*O+R[1]*B+R[3],D=R[4]*O+R[5]*B+R[7],!(-.5>P||P>f-.5||-.5>D||D>m-.5)){var N=h[l],k=h[l+1],U=h[l+2];if(h[l+3],"nearest"==o){F=P+.5|0,L=D+.5|0,F=F>f-1?f-1:F,L=L>m-1?m-1:L,u=4*(L*f+F);var W=g[u],G=g[u+1],j=g[u+2],V=g[u+3];if(0==V)continue;var z=V*a/255;h[l]=(1-z)*N+a*W,h[l+1]=(1-z)*k+a*G,h[l+2]=(1-z)*U+a*j,h[l+3]=255}else{if(c(t,P,D,I),0==I.a)continue;var z=I.a*a/255;h[l]=(1-z)*N+a*I.r,h[l+1]=(1-z)*k+a*I.g,h[l+2]=(1-z)*U+a*I.b,h[l+3]=255}}}},o.transformOverlay=function(e,t,r,o,s,l){if(e.moaGL)return void e.moaGL.transformOverlay(e,t,r,s,l);var u,c=i.prototype.getBitmapSamplingFuncForSamplingMode(o),d=a.prototype.blendEmbededAlphaFromArray,p=e.width,h=e.height,f=t.width,m=t.height,g=Math.max(1,p),v=Math.max(1,h),_=new n(r.transformMatrix);_.invert();var x={x:-.5,y:-.5,z:0,w:1},w={x:1,y:0,z:0,w:0},y={x:0,y:1,z:0,w:0};_.rightMultiplyVector(x),_.rightMultiplyVector(w),_.rightMultiplyVector(y),x.x+=.5,x.y+=.5,x.x*=p,x.y*=h,w.x*=p,w.y*=h,y.x*=p,y.y*=h;var b,M,C,T,S={x:x.x+w.x+y.x,y:x.y+w.y+y.y};w.x+=x.x,w.y+=x.y,y.x+=x.x,y.y+=x.y,b=Math.min(x.x,Math.min(S.x,Math.min(w.x,y.x)))-1,C=Math.min(x.y,Math.min(S.y,Math.min(w.y,y.y)))-1,M=Math.max(x.x,Math.max(S.x,Math.max(w.x,y.x)))+1,T=Math.max(x.y,Math.max(S.y,Math.max(w.y,y.y)))+1,b=Math.max(0,0|b),C=Math.max(0,0|C),M=Math.min(p-1,M+.5|0),T=Math.min(h-1,T+.5|0),r.preTranslate(.5,.5),r.postTranslate(-.5,-.5);for(var A="nearest"==o?0:.5,E="nearest"==o?0:.5,P=[],u={r:0,g:0,b:0,a:0},D=C;T>=D;D++)for(var F=b;M>=F;F++){var L=4*(D*p+F),R=(F+A)/g,I=(D+E)/v;P[0]=R,P[1]=I,r.postTransformPoint(P);var B=P[0]*f-A,O=P[1]*m-E;c(t,B,O,u),u.a*=l,d(e.data,L,u,s),e.data[L+3]=255}},o.transformOverlayUsingMipmap=function(e,t,r,o,i,s){if(e.moaGL)return void e.moaGL.transformOverlayUsingMipmap(e,t,r,o,i,s);t.setOverlaySamplingFuncForSamplingMode(o);var l,u=a.prototype.blendEmbededAlphaFromArray,c=e.width,d=e.height,p=t.bitmapLevels[0].width,h=t.bitmapLevels[0].height,f=Math.max(1,c),m=Math.max(1,d),g=new n(r.transformMatrix);g.invert();var v={x:-.5,y:-.5,z:0,w:1},_={x:1,y:0,z:0,w:0},x={x:0,y:1,z:0,w:0};g.rightMultiplyVector(v),g.rightMultiplyVector(_),g.rightMultiplyVector(x),v.x+=.5,v.y+=.5,v.x*=c,v.y*=d,_.x*=c,_.y*=d,x.x*=c,x.y*=d;var w=Math.sqrt(_.x*_.x+_.y*_.y),y=Math.sqrt(x.x*x.x+x.y*x.y),b=w/p,M=y/h,C=Math.min(b,M),T=C>1?0:Math.log(1/C)/Math.log(2),S=t.numLevels-1;T=Math.min(T,S);var A,E,P,D;if(t.wrapMode==t.WRAP_MODES.TransparentOutsideBounds){var F={x:v.x+_.x+x.x,y:v.y+_.y+x.y};_.x+=v.x,_.y+=v.y,x.x+=v.x,x.y+=v.y,A=Math.min(v.x,Math.min(F.x,Math.min(_.x,x.x))),P=Math.min(v.y,Math.min(F.y,Math.min(_.y,x.y))),E=Math.max(v.x,Math.max(F.x,Math.max(_.x,x.x))),D=Math.max(v.y,Math.max(F.y,Math.max(_.y,x.y))),A=Math.max(0,0|A),P=Math.max(0,0|P),E=Math.min(c-1,E+.5|0),D=Math.min(d-1,D+.5|0)}else A=0,E=e.width-1,P=0,D=e.height-1;r.preTranslate(.5,.5),r.postTranslate(-.5,-.5),t.setSamplingLevel(w,y);for(var L="nearestNearest"==o?0:.5,R="nearestNearest"==o?0:.5,I=[],l={r:0,g:0,b:0,a:0},B=P;D>=B;B++)for(var O=A;E>=O;O++){var N=4*(B*c+O),k=(O+L)/f,U=(B+R)/m;I[0]=k,I[1]=U,r.postTransformPoint(I),t.sampleOverlay(I[0],I[1],l),l.a*=s,u(e.data,N,l,i),e.data[N+3]=255}},t.exports=o},{"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"../core/MoaDataTypes":37,"../core/MoaMipmap":39,"../core/MoaTransform":40}],95:[function(e,t,r){"use strict";var o={},a=e("./MoaHistogramMapping");o.shadows=function(e,t){"undefined"==typeof t&&(t=0),t/=100;var r,o=[],i=[];for(r=0;256>r;r++){var n=r/255,s=-3.68113+4.829*(r/3+1)-.299125*Math.pow(r/3+1,2)+.006449275*Math.pow(r/3+1,3)-474531e-10*Math.pow(r/3+1,4);if(0>s&&(s=0),.25>=t){var l=t/.25;s=l*s+r}else{var u,l=(t-.25)/.75,c=34*l/255;u=.5>n?255*((1-2*c)*n+c):r,s+=u}o[r]=s+.5|0,o[r]=o[r]<0?0:o[r]>255?255:o[r]}i.r=o,i.g=o,i.b=o,a.mapHist(e,i)},t.exports=o},{"./MoaHistogramMapping":90}],96:[function(e,t,r){"use strict";var o={},a=e("../core/MoaAllocAndCopy"),i=e("./MoaBitmapBlend");o.kAmount="amount",o.kAlpha="alpha",o.kBlendMode="blendMode";var n=5,s=65536;o.sharpen=function(e,t,r,o){"undefined"==typeof r&&(r=1),"undefined"==typeof o&&(o="normal");var n,s=!1,u=0!=t,d=1!=r||"normal"!=o;if(0==r)return!0;if(t>0?s=!0:(s=!1,t=-t),null!=e.moaGL){var p,h,f;if(d||s){var f=e.moaGL.createTexture(e.width,e.height);e.moaGL.copyLastRender(f)}}else(d||s)&&(n=a.copy(e));if(u&&(l(e,t),c(e,t)),null!=e.moaGL){if(s){var m=-.5;h=e.moaGL.glRenderingObjects.writeTexture,p=e.moaGL.glRenderingObjects.readTexture,e.moaGL.bitmapBlendBitmap(h,f,p,"normal",m),e.moaGL._swapTextures()}d&&(h=e.moaGL.glRenderingObjects.writeTexture,p=e.moaGL.glRenderingObjects.readTexture,e.moaGL.bitmapBlendBitmap(h,f,p,o,r),e.moaGL._swapTextures()),(s||d)&&e.moaGL.destroyTexture(f)}else s&&i.blendWithBitmapSeparate(e,n,-.5,1.5),d&&(i.blendWithBitmap(e,n,e,o,r),n.data=null);return!0};var l=function(e,t){if(e.moaGL)return void p(e,t);var r,o=[],a=[],i=e.width,l=e.height,c=4*t/100*(i+l)/1600;if(0!=c){0>c&&(c=-c);var d=Math.floor(2*c)+1,h=1;d>n&&(h=2*Math.ceil(d/n/2)+1,d=n),o[0]=1,r=o[0]*h;for(var f=c*c/h/h,m=1;d>m;m++)o[m]=Math.exp(-(m*m)/(2*f)),r+=2*o[m]*h;for(var m=0;d>m;m++)o[m]/=r;for(var m=0;d>m;m++)a[m]=Math.floor(s*o[m]+.5);for(var m=0;d-1>m;m++)a[m]-=a[m+1];u(e,a,h)}},u=function(e,t,r){for(var o,a,i,n,l,u,c,d,p,h,m,g,v,_=e.width,x=e.height,w=_-1,y=Math.floor(r/2),b=t.length,M=[],C=0;x>C;C++){f(e,C,M),v=4*C*_;for(var T=0;_>T;T++){o=s/2,a=s/2,i=s/2;for(var S=0;b>S;S++){if(l=T+S*r+y,n=l-r*(2*S+1),u=t[S],0>n?(c=(n+1)*M[0],d=(n+1)*M[1],p=(n+1)*M[2]):(c=M[4*n],d=M[4*n+1],p=M[4*n+2]),l>w){var A=l-w;h=M[4*w]+A*(M[4*w]-M[4*(w-1)]),m=M[4*w+1]+A*(M[4*w+1]-M[4*(w-1)+1]),g=M[4*w+2]+A*(M[4*w+2]-M[4*(w-1)+2])}else h=M[4*l],m=M[4*l+1],g=M[4*l+2];o+=u*(h-c),a+=u*(m-d),i+=u*(g-p)}o/=s,a/=s,i/=s,e.data[v+4*T]=o>255?255:0>o?0:0|o,e.data[v+4*T+1]=a>255?255:0>a?0:0|a,e.data[v+4*T+2]=i>255?255:0>i?0:0|i}}},c=function(e,t){if(e.moaGL)return void h(e,t);var r,o=[],a=[],i=e.width,l=e.height,u=4*t/100*(i+l)/1600;if(0!=u){0>u&&(u=-u);var c=Math.floor(2*u)+1,p=1;c>n&&(p=2*Math.ceil(c/n/2)+1,c=n),o[0]=1,r=o[0]*p;for(var f=u*u/p/p,m=1;c>m;m++)o[m]=Math.exp(-(m*m)/(2*f)),r+=2*o[m]*p;for(var m=0;c>m;m++)o[m]/=r;for(var m=0;c>m;m++)a[m]=Math.floor(s*o[m]+.5);for(var m=0;c-1>m;m++)a[m]-=a[m+1];d(e,a,p)}},d=function(e,t,r){for(var o,a,i,n,l,u,c,d,p,h,f,g,v,_=e.width,x=e.height,w=x-1,y=Math.floor(r/2),b=t.length,M=[],C=0;_>C;C++){m(e,C,M);for(var T=0;x>T;T++){v=4*(T*_+C),o=s/2,a=s/2,i=s/2;for(var S=0;b>S;S++){if(l=T+S*r+y,n=l-r*(2*S+1),u=t[S],0>n?(c=(n+1)*M[0],d=(n+1)*M[1],p=(n+1)*M[2]):(c=M[4*n],d=M[4*n+1],p=M[4*n+2]),l>w){var A=l-w;h=M[4*w]+A*(M[4*w]-M[4*(w-1)]),f=M[4*w+1]+A*(M[4*w+1]-M[4*(w-1)+1]),g=M[4*w+2]+A*(M[4*w+2]-M[4*(w-1)+2])}else h=M[4*l],f=M[4*l+1],g=M[4*l+2];o+=u*(h-c),a+=u*(f-d),i+=u*(g-p)}o/=s,a/=s,i/=s,e.data[v]=o>255?255:0>o?0:0|o,e.data[v+1]=a>255?255:0>a?0:0|a,e.data[v+2]=i>255?255:0>i?0:0|i}}},p=function(e,t){if(e.moaGL){var r,o,a,i,n,s,l,u,c,d,p,h=e.width,f=e.height,m=4096;if(r=4,a=4*t/100*(h+f)/1600,i=!0,0>a&&(a=-a,i=!1),0==a)return;for(n=Math.floor(1.5*a)+1,l=0,n>r&&(l=Math.floor((n/r-1)/2)+1,n=Math.floor(n/(2*l+1))+1),p=0,c=2*l+1,s=2*n+1,u=[],d=0,o=0;s>o;o++)d+=c*(_(o+.5-n,a/c)-_(o-.5-n,a/c));for(p=0,o=0;s>o;o++)u[o]=1/d*m*(_(o+.5-n,a/c)-_(o-.5-n,a/c)),p+=u[o];var g=[],v=4-((s-1)/2|0),x=4+((s-1)/2|0);for(o=0;9>o;o++)v>o||o>x?g[o]=0:g[o]=u[o-v]/p;return void e.moaGL.addConvolution(g,c,"horizontal")}},h=function(e,t){if(e.moaGL){var r,o,a,i,n,s,l,u,c,d,p,h=e.width,f=e.height,m=4096;if(r=4,a=4*t/100*(h+f)/1600,i=!0,0>a&&(a=-a,i=!1),0==a)return;for(n=Math.floor(1.5*a)+1,l=0,n>r&&(l=Math.floor((n/r-1)/2)+1,n=Math.floor(n/(2*l+1))+1),p=0,c=2*l+1,s=2*n+1,u=[],d=0,o=0;s>o;o++)d+=c*(_(o+.5-n,a/c)-_(o-.5-n,a/c));for(p=0,o=0;s>o;o++)u[o]=.5+1/d*m*(_(o+.5-n,a/c)-_(o-.5-n,a/c)),p+=u[o];var g=[],v=4-((s-1)/2|0),x=4+((s-1)/2|0);for(o=0;9>o;o++)v>o||o>x?g[o]=0:g[o]=u[o-v]/p;return void e.moaGL.addConvolution(g,c,"vertical")}},f=function(e,t,r){var o,a,i,n,s,l=e.width;for(o=0;l>o;o++)a=l*t+o,i=e.data[4*a],n=e.data[4*a+1],s=e.data[4*a+2],r[4*o]=i,r[4*o+1]=n,r[4*o+2]=s,r[4*o+3]=0,o>0&&(r[4*o]+=r[4*(o-1)],r[4*o+1]+=r[4*(o-1)+1],r[4*o+2]+=r[4*(o-1)+2])},m=function(e,t,r){var o,a,i,n,s,l=e.width,u=e.height;for(o=0;u>o;o++)a=l*o+t,i=e.data[4*a],n=e.data[4*a+1],s=e.data[4*a+2],r[4*o]=i,r[4*o+1]=n,r[4*o+2]=s,r[4*o+3]=0,o>0&&(r[4*o]+=r[4*(o-1)],r[4*o+1]+=r[4*(o-1)+1],r[4*o+2]+=r[4*(o-1)+2])},g=function(e){var t,r,o,a,i,n,s=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,9.6467911e-11,2.394038e-12,-6.886027e-12,8.94487e-13,3.13092e-13,-1.12708e-13,3.81e-16,7.106e-15,-1.523e-15,-9.4e-17,1.21e-16,-2.8e-17];if(0>e)return 0;for(o=0,a=0,i=2/(2+e),n=4*i-2,t=27;t>0;t--)r=o,o=n*o-a+s[t],a=r;return i*Math.exp(-e*e+.5*(s[0]+n*o)-a)},v=function(e){return e>=0?1-g(e):g(-e)-1},_=function(e,t){return(1+v(e/Math.SQRT2/t))/2};t.exports=o},{"../core/MoaAllocAndCopy":34,"./MoaBitmapBlend":72}],97:[function(e,t,r){"use strict";var o={},a=e("../core/rng"),i=e("../core/MoaColor"),n=e("./MoaHistogram"),s=1.5;o.runSketch=function(e,t,r,o,a,s,p){if(r=Math.floor(r),e.moaGL)return void e.moaGL.renderSketch(t,r,o,a,s,p);var h=new i,f=h.rgb2graySingleChannel(e),m=n.equalizeSingleChannel(f),g=l(e),v=e.width,_=e.height,x=u(m,r),w=Math.floor(a/100*f.length);t=Math.min(v,_)*t/1e3;for(var y=r-1;y>=0;y--)d(m,g,v,_,w,y,o,x[y],t);c(g,e,s,p)};var l=function(e){for(var t,r=e.width,o=e.height,a=[],i=0;o>i;i++)for(var n=0;r>n;n++)t=i*r+n,a[t]=255;return a},u=function(e,t){for(var r=[],o=0;t>o;o++)r[o]=25*(o+1);return r},c=function(e,t,r,o){for(var a,i,n=t.width,s=t.height,l=0;s>l;l++)for(var u=0;n>u;u++){a=4*(l*n+u),i=l*n+u;var c=e[i]/255;t.data[a]=(1-c)*o.r+c*r.r,t.data[a+1]=(1-c)*o.g+c*r.g,t.data[a+2]=(1-c)*o.b+c*r.b,t.data[a+3]=255}},d=function(e,t,r,o,i,n,s,l,u){for(var c,d=new a.RNG(n),h=0;i>h;h++){var f=d.nextFloat()*r,m=d.nextFloat()*o;f=f>r-1?r-1:0>f?0:f,m=m>o-1?o-1:0>m?0:m,c=(m+.5|0)*r+(f+.5|0),e[c]<=l&&p(e,t,f,m,r,o,n,s,l,u)}},p=function(e,t,r,o,a,i,n,l,u,c){var d=o-l+.5|0,p=o+l-.5|0;d=0>d?0:d>i-1?i-1:d,p=0>p?0:p>i-1?i-1:p;for(var h=d;p>=h;h++){var f=r+(h-o),m=f-c-s|0,g=f+c+s|0;m=0>m?0:m>a-1?a-1:m,g=0>g?0:g>a-1?a-1:g;for(var v,_,x,w=1+c/s,y=m;g>=y;y++)_=Math.abs(y-(f+c)),x=w-_/s,x=x>1?1:0>x?0:x,v=h*a+y,e[v]<=u&&(t[v]=(1-x)*t[v]+x*u);
}};t.exports=o},{"../core/MoaColor":36,"../core/rng":42,"./MoaHistogram":89}],98:[function(e,t,r){"use strict";var o={},a=(e("./MoaBitmapBlend"),e("../core/MoaAllocAndCopy"),e("../core/MoaColor"));o.vignette=function(e,t,r,o,i,n,s,l,u,c,d){if(e.moaGL)return void e.moaGL.renderVignette({blendMode:s,shapeMode:l,vignetteScale:t,color:{r:r,g:o,b:i,a:n},dx:c||0,dy:d||0,stretch:u});var p=e.width,h=e.height;"string"!=typeof s&&(s="normal");var f="sharp"===l,m="ultraSharp"===l,g="mediumSharp"===l;"boolean"!=typeof u&&(u=!1),"number"!=typeof n&&(n=255),"number"!=typeof c&&(c=0),"number"!=typeof d&&(d=0);var v,_,x,w,y,b,M,C,T,S=1.15,A=Math.pow(t,2)/S,E=1/A,P=(p-1)/2,D=(h-1)/2,F=5/3,L=34/45,R=13/63,I=514/14175;c*=P,d*=D;var B,O,N=new a,k={r:r,g:o,b:i,a:n};for(O=0;h>O;O++)for(_=4*O*p,x=(O-D-d)*(O-D-d),B=0;p>B;B++){if(v=_+4*B,y=u?((B-P-c)*(B-P-c)/p/p+(O-D-d)*(O-D-d)/h/h)*E:((B-P-c)*(B-P-c)+x)*E,f&&(y*=y),m&&(y*=y,y*=y),g&&(y=Math.pow(y,1.5)),y>S)k.a=n;else{if(.04>y)continue;b=y*y,M=b*b,C=M*b,T=C*b,w=1-2*b+F*M-L*C+R*T-I*T*b,k.a=n*(1-w)}N.blendEmbededAlphaFromArray(e.data,v,k,s)}},t.exports=o},{"../core/MoaAllocAndCopy":34,"../core/MoaColor":36,"./MoaBitmapBlend":72}],99:[function(e,t,r){"use strict";var o={},a=(e("../MoaAdjustmentCurves"),e("../MoaGamma"),e("../MoaSharpen"),e("../MoaBitmapBlend"),e("../../core/MoaAllocAndCopy"),e("../../core/MoaColor")),i=e("../MoaColorMap");e("../MoaColorMatrixTransform"),e("../MoaHistogramMapping"),o.kBrightness="brightness",o.kContrast="contrast",o.kWarmth="warmth",o.kSaturation="saturation",o.kBlendMode="blendMode",o.kAlpha="alpha",o.adjustments=function(e,t){var r={},n=t[o.kBlendMode],s=t[o.kAlpha],l=e.data,r="normal"===n&&1===s,u=t[o.kBrightness],c=t[o.kContrast],d=t[o.kWarmth],p=t[o.kSaturation],h=0!=u,f=0!=c,m=0>c,g=0!=d,v=0!=p,_=[],x=[],w=[],y=[],b=[],M=[],C=[],T=[],S=new a,A=Math.max(-100,Math.min(100,u)),E=A/100;E=0>E?.75*E:E;var P=65*E,D=42.5,F=[D+.6*P,3*D+P,5*D+.5*P],_=i.createColorMapFromListOfYValues(0,255,!0,F),L=Math.max(-100,Math.min(100,c)),E=L/100;Math.abs(E)+1,0>E&&(E=.55*(Math.cos(Math.PI*Math.pow(Math.abs(E),.8)*.5)-1));var P=35*E,R=255/8,I=[R-P,3*R-.75*P,5*R+.75*P,7*R+P],x=i.createColorMapFromListOfYValues(0,255,!0,I),B=.3*Math.abs(E);M[0]=-.787*B+1,M[3]=.715*B,M[6]=.072*B,M[1]=.213*B,M[4]=(.715-1)*B+1,M[7]=.072*B,M[2]=.213*B,M[5]=.715*B,M[8]=-.928*B+1;var O,N,k,U=Math.max(-100,Math.min(100,d)),E=U/100;E=E>0?.7*(1-Math.cos(Math.PI*E*.5)):Math.cos(Math.PI*E*.5)-1,E>0?(T[0]=48/255*E,T[1]=28/255*E,T[2]=-6/255*E):(T[0]=16/255*E,T[1]=-10/255*E,T[2]=-48/255*E);for(var W=0;255>=W;W++)E>0?(O=W+48*E*Math.sin(Math.PI*W/255),N=W+28*E*Math.sin(Math.PI*W/255),k=W-6*E*Math.sin(Math.PI*W/255)):(O=W+16*E*Math.sin(Math.PI*W/255),N=W-10*E*Math.sin(Math.PI*W/255),k=W-48*E*Math.sin(Math.PI*W/255)),w[W]=O>255?255:0>O?0:O,y[W]=N>255?255:0>N?0:N,b[W]=k>255?255:0>k?0:k;var B,G=Math.max(-100,Math.min(100,p)),j=1.4,V=0,E=G/100+1;if(E-=1,E=0>E?(1-V)*(Math.cos(Math.PI*E*.5)-1):(j-1)*(1-Math.cos(Math.PI*E*.5)),E+=1,B=1-E,C[0]=-.787*B+1,C[3]=.715*B,C[6]=.072*B,C[1]=.213*B,C[4]=(.715-1)*B+1,C[7]=.072*B,C[2]=.213*B,C[5]=.715*B,C[8]=-.928*B+1,e.moaGL)return e.moaGL.renderLegacyAdjustments(u,c,p,d,_,x,C,T,M,t.blendMode,t.alpha),!0;for(var z,H,X,$,Y,q,Z,K,Q,J,ee,te,W=0;W<l.length;){z=l[W],H=l[W+1],X=l[W+2],h&&(z=_[z],H=_[H],X=_[X]),f&&(Z=-z+H+X,K=z-H+X,Q=z+H-X,$=x[z],Y=x[H],q=x[X],J=-$+Y+q,ee=$-Y+q,te=$+Y-q,$+=.2*(J-Z)+(J>Z?.5:-.5),Y+=.2*(ee-K)+(ee>K?.5:-.5),q+=.2*(te-Q)+(te>Q?.5:-.5),$=$+.5|0,Y=Y+.5|0,q=q+.5|0,m&&($=M[0]*$+M[3]*Y+M[6]*q,Y=M[1]*$+M[4]*Y+M[7]*q,q=M[2]*$+M[5]*Y+M[8]*q),$=$+.5|0,Y=Y+.5|0,q=q+.5|0,z=$>255?255:0>$?0:$,H=Y>255?255:0>Y?0:Y,X=q>255?255:0>q?0:q),g&&(z=w[z],H=y[H],X=b[X]),v&&($=C[0]*z+C[3]*H+C[6]*X+.5,Y=C[1]*z+C[4]*H+C[7]*X+.5,q=C[2]*z+C[5]*H+C[8]*X+.5,z=$>255?255:0>$?0:$+.5|0,H=Y>255?255:0>Y?0:Y+.5|0,X=q>255?255:0>q?0:q+.5|0);var re={r:z+.5|0,g:H+.5|0,b:X+.5|0,a:255*s|0};r?(l[W]=re.r,l[W+1]=re.g,l[W+2]=re.b):S.blendEmbededAlphaFromArray(l,W,re,t.blendMode),l[W+3]=255,W+=4}return!0},t.exports=o},{"../../core/MoaAllocAndCopy":34,"../../core/MoaColor":36,"../MoaAdjustmentCurves":70,"../MoaBitmapBlend":72,"../MoaColorMap":75,"../MoaColorMatrixTransform":76,"../MoaGamma":83,"../MoaHistogramMapping":90,"../MoaSharpen":96}],100:[function(e,t,r){"use strict";var o=e("../MoaColorMatrixTransform"),a={};a.getcdf=function(e){for(var t=0,r=0;256>r;r++)t+=e[r];var o=new Array(256);o[0]=e[0]/t;for(var a=1;256>a;a++)o[a]=e[a]/t+o[a-1];return o},a.cdfinv=function(e,t){if(0>=t)return 0;if(t>=1)return 255;for(var r=0;t>e[r];)r++;if(0===r)return t/e[r];var o=r-1+(t-e[r-1])/(e[r]-e[r-1]);return o},a.getHist=function(e){var t,r=new Array(256),o=new Array(256),a=new Array(256);t=e.moaGL?e.moaGL.getImageDataFromFramebuffer():e.data;for(var i=0;256>i;i++)r[i]=0,o[i]=0,a[i]=0;for(var i=0;i<t.length;i+=4)r[t[i]]++,o[t[i+1]]++,a[t[i+2]]++;return{r:r,g:o,b:a}},a.autocolorsfade=function(e,t,r,i,n){"undefined"==typeof t&&(t=1);var s,l,u,c=.005,d=.995;if(e.moaGL){var p=e.moaGL.histogramBuild();s=a.getcdf(p.r),l=a.getcdf(p.g),u=a.getcdf(p.b)}else{var p=a.getHist(e);s=a.getcdf(p.r),l=a.getcdf(p.g),u=a.getcdf(p.b)}var h=t*a.cdfinv(s,c),f=t*a.cdfinv(l,c),m=t*a.cdfinv(u,c),g=255*(1-t)+t*a.cdfinv(s,d),v=255*(1-t)+t*a.cdfinv(l,d),_=255*(1-t)+t*a.cdfinv(u,d);"undefined"!=typeof r&&(g=Math.max(r,g)*t+g*(1-t)),"undefined"!=typeof i&&(v=Math.max(i,v)*t+v*(1-t)),"undefined"!=typeof n&&(_=Math.max(n,_)*t+_*(1-t));var x=[1,0,0,-h,0,1,0,-f,0,0,1,-m],w=255/(g-h),y=255/(v-f),b=255/(_-m),M=[w,0,0,0,0,y,0,0,0,0,b,0];o.colorMatrixTransform(e,x),o.colorMatrixTransform(e,M)},t.exports=a},{"../MoaColorMatrixTransform":76}],101:[function(e,t,r){"use strict";var o={},a=e("../../core/MoaAllocAndCopy"),i=e("../MoaSharpen"),n=(e("../MoaHistogramMapping"),e("../MoaBitmapBlend"));o.softFocusConvolution=function(e,t,r){"undefined"==typeof t&&(t=.4),"undefined"==typeof r&&(r=1.25);var o,s,l,u,c=1-t,d=r*t;return null!=e.moaGL?(u=e.moaGL.createTexture(e.width,e.height),e.moaGL.copyLastRender(u)):o=a.copy(e),i.sharpen(e,-100,1,"normal"),null!=e.moaGL?(l=e.moaGL.glRenderingObjects.writeTexture,s=e.moaGL.glRenderingObjects.readTexture,e.moaGL.bitmapBlendBitmapSeparate(l,u,s,d,c),e.moaGL._swapTextures(),e.moaGL.destroyTexture(u)):(n.blendWithBitmapSeparate(e,o,d,c),o.data=null),!0},t.exports=o},{"../../core/MoaAllocAndCopy":34,"../MoaBitmapBlend":72,"../MoaHistogramMapping":90,"../MoaSharpen":96}],102:[function(e,t,r){t.exports={major:3,minor:1,patch:5}},{}]},{},[4]),e.Actions=function(){this.actionList=[],this.index=-1},e.Actions.prototype.setPreventUndoCheckpoint=function(){this.preventUndoCheckpoint=this.index},e.Actions.prototype.canUndo=function(){return"undefined"!=typeof this.preventUndoCheckpoint&&this.index<=this.preventUndoCheckpoint?!1:this.index>=0},e.Actions.prototype.undo=function(e){var t,r,o;this.index<0||(t=this.actionList[this.index],!e&&t&&(r=t.undoHandler,r.call(t.context,t)),this.index>0?(o=this.actionList[this.index].dimensions,o&&(o=o.beforeDimensions,this.setDims(o.hiresWidth||o.width,o.hiresHeight||o.height))):this.setDims(this._origHiresWidth,this._origHiresHeight),this.index--,this.evaluateUndoRedo())},e.Actions.prototype.evaluateUndoRedo=function(){e.controlsWidgetInstance&&e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"updateUndoRedo",[this.canUndo(),this.canRedo()])},e.Actions.prototype.undoFake=function(){this.undo(!0)},e.Actions.prototype.canRedo=function(){return this.index<this.actionList.length-1},e.Actions.prototype.redo=function(e,t){var r,o,a;this.index>=this.actionList.length-1||(this.index++,r=this.actionList[this.index],!e&&r&&(o=r.redoHandler,o.call(r.context,r),t&&r.context.commit(),a=this.actionList[this.index].dimensions,a&&(a=a.afterDimensions,this.setDims(a.hiresWidth||a.width,a.hiresHeight||a.height))),this.evaluateUndoRedo())},e.Actions.prototype.redoFake=function(){this.redo(!0)},e.Actions.prototype.push=function(e){this.truncate(!0),this.actionList.push(e)},e.Actions.prototype.truncate=function(t){this.actionList.length=this.index+1,!t&&e.controlsWidgetInstance&&e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"updateUndoRedo",[this.canUndo(),this.canRedo()])},e.Actions.prototype.getDims=function(){var t=null;return e.paintWidgetInstance&&(t=t||{},t.width=e.paintWidgetInstance.width,t.height=e.paintWidgetInstance.height),this.hiresWidth&&this.hiresHeight&&(t=t||{},t.hiresWidth=this.hiresWidth,t.hiresHeight=this.hiresHeight),t},e.Actions.prototype.setDims=function(t,r){(this.hiresWidth!==t||this.hiresHeight!==r)&&(this.hiresWidth=t,this.hiresHeight=r,e.controlsWidgetInstance&&e.controlsWidgetInstance.imageSizeTracker.setImageScaledIndicator())},e.Actions.prototype.setOrigSize=function(e,t){this._origHiresWidth=e,this._origHiresHeight=t,this.setDims(e,t)},e.Actions.prototype.exportJSON=function(){var t;e.util.moaLite.Version&&(t=e.util.moaLite.Version.getVersion());var r,o,a,i,n={actions:[],version:t},s=[];for(a=0;a<this.index+1;a++)if(r=this.actionList[a],o=r.action)if(o instanceof Array)for(i=0;i<o.length;i++)s.push(o[i]);else s.push(o);return n.actions=s,e.JSON.stringify(n)},e.Actions.prototype.getPreviousActionParameters=function(){if(this.actionList&&this.actionList.length>0){var e=this.actionList[this.index];return e}},e.Actions.prototype.replayAllActions=function(){var t,r=this.index;for(this.index=-1;this.index<r;)t=this.actionList[this.index+1],t&&t.backingReference&&(t.backingReference={beforeBacking:e.paintWidgetInstance.getCanvasBacking(),afterBacking:null}),this.redo(!1,!0)},e.Actions.prototype.hasMadeChanges=function(){return this.actionList.length&&this.index>-1?!0:!1},e.FilterManager=function(){var t={},r={},o=this,a=[],i={};o.getPacksById=function(){return i},o.getPacksInOrder=function(){return a};var n=function(e,o){var n,s,l,u;if(o)for(n=0;n<o.length;n++)if(s=o[n],a.push(s),i[s.identifier]=s,s){if(l=s.items){r[e]=l,u=l.length;for(var c=0;u>c;c++)t[l[c].identifier]=l[c],t[l[c].identifier].packIdentifier=o[n].identifier}break}};return o.getEffectById=function(e){return t[e]},o.getClickableFiltersForPack=function(e){return r[e]},o.loadPack=function(t,r,o,a){e.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_get_assets"+a,action:r,method:"GET",dataType:"json",announcer:e.build.asyncFeatherTargetAnnounce,origin:e.build.asyncImgrecvBase,callback:function(e){n(t,[e]),o&&o.call(this)}})},o},function(e){e.AV=e.AV||{};var t=e.AV;return t.ImageBorderManager=function(){var e={},r={},o=this,a=[],i={};o.getPacksById=function(){return i},o.getPacksInOrder=function(){return a};var n=function(o,n){var s,l,u,c;if(n){for(s=0;s<n.length;s++)for(i[n[s].identifier]=n[s],a.push(n[s]),r[o]=n[s],u=n[s].items.length,l=0;u>l;l++)c=n[s].items[l],e[c.identifier]=c,e[c.identifier].packIdentifier=n[s].identifier,e[c.identifier].safeAssetsBaseURL=t.util.getSafeAssetBaseURL(n[s].assetsBaseURL);n.splice(0,s+1)}};return o.getEffectById=function(t){return e[t]},o.getClickableFiltersForPack=function(e){return r[e]},o.loadFrameResources=function(e,r,a){t.controlsWidgetInstance.showWaitThrobber(!0);for(var i=o.getEffectById(e),n=i.images,s=new Image,l=new Image,u=new Image,c=new Image,d=new Image,p=new Image,h=new Image,f=new Image,m=["tl","tr","br","bl","l","t","r","b"],g=[s,l,u,c,d,p,h,f],v=[],_={},x=0;x<m.length;x++){var w=m[x];_[w]={w:512,h:512,img:g[x]},v.push({img:g[x],src:i.safeAssetsBaseURL+n[w],mappingObject:_[w]})}t.util.loadImagesSync(v,function(){for(var e={},o=0,a=m.length;a>o;o++)e[m[o]]=t.cnvs.convertToPremultipliedAlpha(t.cnvs.getBitmapForImage(_[m[o]].img));r&&r.apply(this,[e]),t.controlsWidgetInstance.showWaitThrobber(!1)},a)},o.loadPack=function(e,r,o,a){t.controlsWidgetInstance.serverMessaging.sendMessage({id:"avpw_get_assets"+a,action:r,method:"GET",dataType:"json",announcer:t.build.asyncFeatherTargetAnnounce,origin:t.build.asyncImgrecvBase,callback:function(t){n(e,[t]),o&&o.call(this)}})},o},e}(this),e.OverlayRegistry=function(){var t={},o=function(t,o){var i=t,n=r.createElement("img");n.fullimageurl=i;var s=function(e){avpw$(n).unbind("load",s),a.addElement(t,n),o&&o.apply(this,[e])};avpw$(n).load(s),e.util.doesSupportImageCORS()?(n.crossOrigin="Anonymous",avpw$(n).attr("src",t)):avpw$.ajax({type:"GET",dataType:"json",url:e.build.jsonp_imgserver+"?callback=?",data:{url:escape(t)},success:function(e){avpw$(n).attr("src",e.data)}})},a=this;return a.add=function(e,r,o){t[e]||(t[e]={}),r&&(t[e].hiresurl=r),o&&(t[e].asset=o)},a.addElement=function(e,r){t[e]||a.add(e),t[e].element=r},a.getElement=function(e,r){var a=null;return t[e]&&t[e].element?(a=t[e].element,r&&r.apply(this,[a])):r&&o(e,r),a},a.getHiRes=function(e){return t[e].hiresurl},a.getAsset=function(e){return t[e].asset},a};var c=e.Events;e.ModeManager=function(){var e=this,t=function(t){if(null!==e.active&&void 0!==e.active.deactivate&&e.active.deactivate(),null!==t&&void 0!==t&&""!==t){var r=e.module[t];void 0!==r&&(e.active=r,void 0!==e.active.activate&&e.active.activate(e))}else e.active=null},r=function(r){r&&(e=r),c.on("canvas:activate",t)},o=function(){c.off("canvas:activate",t)},a={};return a.init=r,a.shutdown=o,a},function(e,t,r){e.AV=e.AV||{};var o=e.AV,a=o.Events;return function(e){e.support.touch=e.support.touch||"ontouchend"in r}(avpw_jQuery),o.PaintUI=function(e,r){var i,n=avpw$(e),s=avpw$(r),l={},u=["mouseOutEvent","mouseMoveEvent","mouseDownEvent","mouseUpEvent"],c=!0,d=30,p=!0,h=!1,f=this,m=function(){},g=function(e){i=i||n.offset();var t,r,a,s,l,u;return"internal"==e.type?(t=e.x,r=e.y):(l=o.util.getTouch(e),l?(t=l.pageX,r=l.pageY):(t=e.pageX,r=e.pageY)),a=t-i.left,s=r-i.top,canvasControlsX=a,canvasControlsY=s,u=f.viewport.getRatio(),a*=u,s*=u,{x:0|t,y:0|r,canvasX:0|a,canvasY:0|s,canvasControlsX:canvasControlsX,canvasControlsY:canvasControlsY}},v=function(e,t){var r=f.viewport.getRatio(),o=n.offset(),a=o.left,i=a+n.width()/r,s=o.top,l=s+n.height()/r;return e>a&&i>e&&t>s&&l>t};f.enablePan=function(){p=!0,f.viewport.clearAvailablePanDirections(),f.viewport.pan()},f.disablePan=function(){p=!1,f.hidePan()},f.showPan=function(){p&&f.addCanvasClass("avpw_can_pan")},f.hidePan=function(){f.removeCanvasClass("avpw_can_pan")};var _,x=20,w=null,y=!1,b=function(e,r){y=!0;var o=e-_.x,a=r-_.y;f.viewport.pan(o,a);var i={x:e,y:r};t.clearTimeout(w),w=t.setTimeout(function(){y=!1,_=i},x)},M=20,C=null,T=!1,S=function(e){T=!0,f.viewport.gestureZoomUpdate(e),t.clearTimeout(C),C=t.setTimeout(function(){T=!1},M)},A=function(e){return e.scale&&!T&&S(e.scale),!1},E=function(e){f.setMouseCursor(),avpw$.support.touch&&(null==e?s.bind("gesturechange",A).bind("gestureend",f.viewport.gestureZoomFinish):s.unbind("gesturechange").unbind("gestureend"))},P=function(e){l.mouseOutEvent&&l.mouseOutEvent.apply(f,[{},e])},D=function(e){var r;if(c){if(c=!1,t.setTimeout(function(){c=!0},d),l.mouseMoveEvent)return r=g(e),l.mouseMoveEvent.apply(f,[r,e]);p&&h&&(r=g(e),e.preventDefault(),_=_||r,y||b(r.x,r.y))}},F=function(e){if(l.mouseDownEvent){var t=g(e);return l.mouseDownEvent.apply(f,[t,e,v(t.x,t.y)])}p&&(_=void 0,h=!0,f.canvasHasClass("avpw_can_pan")&&f.addCanvasClass("avpw_is_panning"))},L=function(e){if(l.mouseUpEvent){var t=g(e);l.mouseUpEvent.apply(f,[t,e])}else p&&(h=!1,f.viewport.isZoomed()&&f.viewport.bounceBack(),f.removeCanvasClass("avpw_is_panning"))};return f.resetOffset=function(){i=void 0},f.getCoordinatesFromEventWithinCanvasBounds=function(e){var t=g(e);return v(t.x,t.y)?t:null},f.getCoordinatesFromEvent=function(e){return g(e)},f.getViewportCenter=function(){var e,t,r,a;return t=o.controlsWidgetInstance.layoutNotify(o.launchData.openType,"getEmbedElement"),t?(t=avpw$(t),r=t.width(),a=t.height(),e=t.offset(),g({type:"internal",x:r/2+e.left,y:a/2+e.top})):null},f.subscribe=function(e){for(var t=0;t<u.length;t++)e[u[t]]&&(l[u[t]]=e[u[t]].AV_bindInst(e));f.disablePan()},f.unsubscribe=function(e){l={},f.enablePan()},f.shutdown=function(){a.off("layout:resize",f.resetOffset),s.unbind("mouseleave").unbind("mousedown"),avpw$(t).unbind("mousemove",D).unbind("mouseup",L).unbind("scroll",f.resetOffset),avpw$.support.touch&&(s.unbind("touchmove").unbind("touchstart").unbind("touchend").unbind("gesturechange").unbind("gestureend"),avpw$(t).unbind("touchmove",m)),f.resetOffset(),f.viewport.shutdown(),l={},h=!1},f.setMouseCursor=function(t){void 0===t&&(t=""),e.style.cursor=t},f.addCanvasClass=function(e){n.addClass(e)},f.removeCanvasClass=function(e){n.removeClass(e)},f.canvasHasClass=function(e){return n.hasClass(e)},a.on("tool:open",E),a.on("layout:resize",f.resetOffset),s.bind("mouseleave",P).bind("mousedown",F),avpw$(t).bind("mouseup",L).bind("mousemove",D).bind("scroll",f.resetOffset),avpw$.support.touch&&(avpw$(t).bind("touchmove",m),s.bind("touchstart",function(e){return avpw$(t).unbind("mousemove",D),s.bind("touchmove",D),F(e)}).bind("touchend",function(e){return s.unbind("touchmove",D),avpw$(t).bind("mousemove",D),L(e),!1}),s.bind("gesturechange",A).bind("gestureend",f.viewport.gestureZoomFinish)),f.viewport.setCanvas.apply(f,[e]),f},o.PaintUI.prototype.viewport=function(){var e,t,r,i,n,s={},l=null,u=null,c=0,d=1,p=function(){var t=u.x0+u.w,r=u.y0+u.h,o=!1,a=!1;return(t>l.w||u.x0<l.x0)&&(o=!0),(u.y0<l.y0||r>l.h)&&(a=!0),o||a?e.showPan():e.hidePan(),{x:o,y:a}},h=o.support.getVendorProperty("transform"),f=function(e){if(!h||"mobile"!=o.launchData.openType&&"aviary"!=o.launchData.openType)t.style.width=u.w+"px",t.style.height=u.h+"px",t.style.marginLeft="-"+(u.w/2+.5|0)+"px",t.style.marginTop="-"+(u.h/2+.5|0)+"px";else{var r=e&&e.scale?e.scale:1/s.getRatio(),a=.5*(1*u.w/r-u.w)+.5|0,i=.5*(1*u.h/r-u.h)+.5|0,n=u.x0-a,l=u.y0-i,c=new o.TransformStyle(t.style[h]);c.set({translate:n+"px, "+l+"px",scale:r}),t.style[h]=c.serialize()}};s.setCanvas=function(r){t=r,e=this,h&&e.addCanvasClass("avpw_position_by_transform")},s.shutdown=function(){r=i=void 0,l=u=null};var m=function(){i=Math.abs((r-u.w)/2)+.5|0},g=function(e){if(e){var r=u.w+i*e,o=r*t.height/t.width+.5|0;if(0>o||0>r)return!1;u.w=r,u.h=o,M(),y()}},v=1,_=!!o.support.getVendorProperty("transformStyle");s.gestureZoomUpdate=function(e){v=e,e=1*e/s.getRatio(),f({scale:e})},s.gestureZoomFinish=function(){if(v){var e=u.w*v+.5|0,t=u.h*v+.5|0,r=e/t;e<l.w&&t<l.h?e>r*t?(u.w=l.w,u.h=l.w*t/e+.5|0):(u.h=l.h,u.w=l.h*r+.5|0):(u.w=e,u.h=t),f()}},s.setPadding=function(e){c=e};var x=function(e,a,i){var n,s=t.width,l=t.height;e=e||s,a=a||l,e-=c,a-=c,r=s,i&&(n=o.util.getScaledDims(s,l,e,a),e=n.width,a=n.height),u=new o.Bbox(0,0,e,a),m(),y()},w=function(e,t,r){n=n||p();var o=!1;return(r||n.x)&&(u.x0+=e,o=!0),(r||n.y)&&(u.y0+=t,o=!0),o},y=function(){n=void 0},b=function(){var e,t=u.x0+u.w,r=u.y0+u.h;return t>l.w&&u.x0>l.x0?(e=l.w-u.w,u.x0=e>0?e:0):u.x0<l.x0&&t<l.w&&(e=l.w-u.w,u.x0=0>e?e:0),r>l.h&&u.y0>l.y0?(e=l.h-u.h,u.y0=e>0?e:0):u.y0<l.x0&&r<l.h&&(e=l.h-u.h,u.y0=0>e?e:0),w(0,0)},M=function(){if(l){var e=(l.w-u.w)/2+.5|0,t=(l.h-u.h)/2+.5|0;u.x0=u.y0=0,w(e,t,!0)}},C=function(e){if(e%180&&!(e%90)){var t=u.w;return u.w=u.h,u.h=t,M(),!0}return!1},T=function(){var e=s.getRatio();a.trigger("canvas:resize",u,e,d),d=e};return s.isZoomed=function(){return 1!==s.getRatio()},s.getRatio=function(){return u?r/u.w:1},s.zoomIn=function(){return u||x(),g(1),f(),e.resetOffset(),T(),!1},s.zoomOut=function(){return u||x(),g(-1),f(),e.resetOffset(),T(),!1},s.zoomByRatio=function(r){var o=t.width*r,a=t.height*r,i=u.w,s=u.h,c=0,d=0;return u.w=o+.5|0,u.h=a+.5|0,n=p(),n.x?c=-((o-i)/2+.5|0):(c=(l.w-u.w)/2+.5|0,u.x0=0),n.y?d=-((a-s)/2+.5|0):(d=(l.h-u.h)/2+.5|0,u.y0=0),w(c,d,!0),b(),f(),e.resetOffset(),y(),T(),!1},s.fitLayout=function(t,r){l=new o.Bbox(0,0,t,r),x(t,r,!0),M(),f(),e.resetOffset(),T()},s.resize=function(t,r){return x(t,r,!0),M(),f(),e.resetOffset(),T(),!1},s.resizeFake=function(t,r){return x(t,r),M(),f(),e.resetOffset(),!1},s.pan=function(t,r,o){w(t,r,o)&&(f(),e.resetOffset())},s.clearAvailablePanDirections=function(){y()},s.bounceBack=function(){b()&&(f(),e.resetOffset()),T()},s.rotate=function(e,r,a){e=e?e+"deg":"0",r=r?r+"deg":"0",a=a?a+"deg":"0";var i=new o.TransformStyle(t.style[h]);_?i.set({rotateX:e,rotateY:r,rotateZ:a}):i.set({rotate:e}),t.style[h]=i.serialize()},s.rotateBoundsBy90=function(e){return C(e)?(T(),!0):!1},s}(),e}(this,"undefined"!=typeof t?t:{},"undefined"!=typeof r?r:{}),avpw$="undefined"!=typeof avpw$?avpw$:{},e.CropController=function(t,r,o){var a,i,n,s,l,u,c,d,p,h=this,f=null,m={},g=!1,v=1,_=-1,x=function(){i=new e.Bbox(0,0,r.width,r.height)},w=function(){i=null},y=function(){v=a?Math.abs((a.x1-a.x0)/(a.y1-a.y0)):0},b=function(t,r){var o,n;if(0!=v){var s=1/v;g&&(Math.abs((a.x1-a.x0)/(a.y1-a.y0))>v?(o=e.math.sign(a.y1-a.y0)*Math.abs(a.x1-a.x0)*s+.5|0,"y1"===r?a[r]=a.y0+o:a[r]=a.y1-o):(o=e.math.sign(a.x1-a.x0)*Math.abs(a.y1-a.y0)*v+.5|0,"x1"===t?a[t]=a.x0+o:a[t]=a.x1-o)),n=i.constrain(a[t],a[r]),a[t]=n.x,a[r]=n.y,g&&n.dirty&&(Math.abs((a.x1-a.x0)/(a.y1-a.y0))>v?(o=e.math.sign(a.x1-a.x0)*Math.abs(a.y1-a.y0)*v+.5|0,"x1"===t?a[t]=a.x0+o:a[t]=a.x1-o):(o=e.math.sign(a.y1-a.y0)*Math.abs(a.x1-a.x0)*s+.5|0,"y1"===r?a[r]=a.y0+o:a[r]=a.y1-o))}},M=function(e,t){switch(_){case 1:a.x1=e+m.x,a.y0=t-m.y,b("x1","y0");break;case 2:a.x0=e-m.x,a.y1=t+m.y,b("x0","y1");break;case 3:a.x1=e+m.x,a.y1=t+m.y,b("x1","y1");break;case 0:default:a.x0=e-m.x,a.y0=t-m.y,b("x0","y0")}},C=function(e,t){var r,o;a.x0+=e,a.x1+=e,a.y0+=t,a.y1+=t,r=a.x1-a.x0,o=a.y1-a.y0;var n=i.constrain(a.x0,a.y0);n.dirty&&(a.x0=n.x,a.y0=n.y,a.x1=a.x0+r,a.y1=a.y0+o);var s=i.constrain(a.x1,a.y1);s.dirty&&(a.x1=s.x,a.y1=s.y,a.x0=a.x1-r,a.y0=a.y1-o)},T=function(){n=avpw$(e.template[e.launchData.layout].cropLayer()),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").append(n),c=n.find("#avpw_crop_tooltip"),c&&!o&&c.hide(),d=c.find("#avpw_crop_tooltip_w"),p=c.find("#avpw_crop_tooltip_h")};h.setToolTipValues=function(e,t){d&&p&&(d.html(e),p.html(t))};var S,A=function(){n.remove(),n=null,c=d=p=null},E=function(e,r){var o,a,i,s,l=t.canvasUI.viewport.getRatio();e.x0<e.x1?(o=e.x0,i=e.x1-e.x0):(o=e.x1,i=e.x0-e.x1),e.y0<e.y1?(a=e.y0,s=e.y1-e.y0):(a=e.y1,s=e.y0-e.y1),S.trigger("tool:crop:change",i,s),o=o/l+.5|0,a=a/l+.5|0,i=i/l+.5|0,s=s/l+.5|0;var u={left:o+"px",top:a+"px",width:i+"px",height:s+"px"};n.css(u)};h.activate=function(o){a=new e.Bbox,x(),s=new e.OverlaySelectionModule(r),g=!1,T(),S=o,t.layoutNotify(e.launchData.openType,"showCanvasControlsElement")},h.deactivate=function(){a=null,w(),s=null,t.layoutNotify(e.launchData.openType,"hideCanvasControlsElement"),A()};var P=60,D=60;return h.updateUIDown=function(r,i){if(s){c&&o&&c.show();var n,l=99999999,u=1;u=t.canvasUI.viewport.getRatio();var d=s.getHandleImageWidth(),p=u*(d/2)*(d/2)|0;switch(f=null,_=-1,n=e.math.sqrDist(a.x0,a.y0,r,i),l>n&&p>n&&(_=0,l=n,c.css({top:-D,left:-P,right:"auto",bottom:"auto"})),n=e.math.sqrDist(a.x1,a.y0,r,i),l>n&&p>n&&(_=1,l=n,c.css({top:-D,left:"auto",right:-P,bottom:"auto"})),n=e.math.sqrDist(a.x0,a.y1,r,i),l>n&&p>n&&(_=2,l=n,c.css({top:"auto",left:-P,right:"auto",bottom:-D})),n=e.math.sqrDist(a.x1,a.y1,r,i),l>n&&p>n&&(_=3,l=n,c.css({top:"auto",left:"auto",right:-P,bottom:-D})),_){case 0:m={x:r-a.x0,y:i-a.y0};break;case 3:m={x:a.x1-r,y:a.y1-i};break;case 1:m={x:a.x1-r,y:i-a.y0};break;case 2:m={x:r-a.x0,y:a.y1-i};break;default:if(c.hide(),!a.contains(r,i))return!1;f={x:r,y:i}}return!0}},h.updateUIMove=function(e,t){var r,o;null!=f?(r=e-f.x,o=t-f.y,C(r,o),f.x=e,f.y=t):M(e,t),E(a)},h.apply=function(e,t){c.hide();var r;a.x0>a.x1&&(r=a.x0,a.x0=a.x1,a.x1=r),a.y0>a.y1&&(r=a.y0,a.y0=a.y1,a.y1=r)},h.flipIt=function(){h.setInitialSelectionByRatio(u/l)},h.setInitialSelectionTo=function(e,t){a&&(l=e,u=t,a.x0=(r.canvas.width-e)/2+.5|0,a.x1=a.x0+e+.5|0,a.y0=(r.canvas.height-t)/2+.5|0,a.y1=a.y0+t+.5|0,E(a,!0))},h.setInitialSelectionByRatio=function(e){var t,o,a=0,i=r.canvas.width,n=r.canvas.height,s=a,l=a,u=i-2*l,c=n-2*s;return t=c*e,o=c,t>u&&(t=u,o=u/e),h.setInitialSelectionTo(t,o)},h.setInitialSelection=function(){if(a){var e,t,o,i;g?e=o=.12:(e=.09,o=.18),t=1-e,i=1-o,a.x0=r.canvas.width*e+.5|0,a.x1=r.canvas.width*t+.5|0,a.y0=r.canvas.height*o+.5|0,a.y1=r.canvas.height*i+.5|0,E(a)}},h.forceAspect=function(e){e&&y(),g=e},h.isValidCrop=function(){return 0===Math.abs(a.x0-a.x1)||0===Math.abs(a.y0-a.y1)?!1:!0},h.crop=function(){return a},h.getCropSettings=function(){var e=r.width,t=r.height,o=a.x1-a.x0,i=a.y1-a.y0,n=a.x0,s=a.y0;return{topLeft:[n/e,s/t],normWidth:o/e,aspectRatio:o/i}},h};var c=e.Events;avpw$="undefined"!=typeof avpw$?avpw$:{},e.OverlayController=function(t,r,o){var a,i,n,s,l=o.modes||{OFF_STATE:0},u=o.handlePosition||e.OverlayController.HANDLE_POSITION.BOTTOM_LEFT,d=5,p=o.minimumOverlaySize||20,h=o.maximumOverlaySize||99999999,f=o.enableFreeAspectRatioMode||!1,m=10,g="avpw_selection_overlay_selected avpw_selection_overlay_editing",v="avpw_selection_overlay_selected avpw_selection_overlay_dragonly",_=e.support.getVendorProperty("transform"),x=o.disableRotation||!1,w=null,y=!1,b=!1,M=!1,C=!1,T=!1,S=o.forceDragMode||!1,A=function(e){e&&n===e||(n=null);for(var t in a)a.hasOwnProperty(t)&&a[t]!=e&&L(a[t],l.OFF_STATE)},E=function(e,t,r){var o,i,n;if(t!==r){t=1/t,r=1/r,o=t/r;for(i in a)n=a[i],O(n,{x:n.topLeftX*o,y:n.topLeftY*o}),W(n,o)}},P=function(){i++,n&&n.element&&(n.zIndex=i,n.element.css("z-index",i))},D=function(e){A(a[e]),n=a[e],P()},F=function(t){var r,i,n=o.aspectRatio,s=a[t.id];r=t?parseInt(t.style.width,10):0,i=t?avpw$(t).height():0;var l=t?parseInt(t.style.left,10):0,u=t?parseInt(t.style.top,10):0,c=l+m+r/2,d=u+m+i/2;f?n=i/r:n||(n=0!==r&&0!==i?i/r:1),s&&e.util.extend(s,{width:r,aspectRatio:n,topLeftX:parseInt(t.style.left||0,10),topLeftY:parseInt(t.style.top||0,10),centerX:c,centerY:d})},L=function(e,r){e.mode=r,e.element.removeClass(v),e.element.removeClass(g),r===l.DRAG_STATE?e.element.addClass(v):r===l.EDIT_STATE?e.element.addClass(g):n&&n==e&&(n=null),o.onModeChange&&o.onModeChange.apply(t,[e,r])},R=function(e,t){e&&(e.mode&&e.mode!==l.OFF_STATE?e.mode===l.DRAG_STATE?t?l.EDIT_STATE&&L(e,l.EDIT_STATE):L(e,l.OFF_STATE):e.mode===l.EDIT_STATE&&(t||(l.DRAG_STATE?L(e,l.DRAG_STATE):L(e,l.OFF_STATE))):t&&l.DRAG_STATE&&L(e,l.DRAG_STATE))},I=function(e){e&&e.element&&(e.element.remove(),delete a[e.id])},B=function(){avpw$.each(a,function(e){I(a[e])})},O=function(e,t){e.element.css({left:(t.x+.5|0)+"px",top:(t.y+.5|0)+"px"}),e.topLeftX=t.x,e.topLeftY=t.y},N=function(e,t){var r,o,a,i,n=!1;return r=e.initialCoordsX,o=e.initialCoordsY,a=t.x-r,i=t.y-o,(Math.abs(a)>d||Math.abs(i)>d)&&(n=!0),n&&e.element.css({left:(e.topLeftX+a+.5|0)+"px",top:(e.topLeftY+i+.5|0)+"px"}),n},k=function(){n&&n.element&&n.element.show()},U=function(){n&&n.element&&n.element.hide()},W=function(e,t){var r=e.width*t+.5|0,o=r*e.aspectRatio+.5|0;e.element.css({width:r+"px",height:o+"px"}),e.width=r+.5|0},G=function(r,o,a){var i,n,s,l,u,c,d,f,g,v,_,x,w,y,b,M,C;c=r.topLeftX,d=r.topLeftY,i=r.initialCoordsX,n=r.initialCoordsY,y=t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").offset(),i-=y.left,n-=y.top,o.x-=y.left,o.y-=y.top,u=r.aspectRatio,s=r.width,l=s*u,a==e.OverlayController.SCALE_TYPE.HORIZONTAL?(v=c+s+m,_=d+l/2+m):a==e.OverlayController.SCALE_TYPE.VERTICAL&&(v=c+s/2+m,_=d),f=r.centerX,g=r.centerY,x=o.x,w=o.y,b=Math.sqrt(Math.pow(x-f,2)+Math.pow(w-g,2))/Math.sqrt(Math.pow(v-f,2)+Math.pow(_-g,2)),M=p/s,C=h/s,b=b>M?b:M,b=C>b?b:C;var T,S;if(a==e.OverlayController.SCALE_TYPE.VERTICAL){T=c,S=d-.5*l*(b-1)+.5|0;var A=l*b+.5|0;r.element.css({left:T+"px",top:S+"px",height:A+"px"})}else if(a==e.OverlayController.SCALE_TYPE.HORIZONTAL){T=c-.5*s*(b-1)+.5|0,S=d;var E=s*b+.5|0;r.element.css({left:T+"px",top:S+"px",width:E+"px"})}},j=function(r,o){var a,i,n,s,l,c,d,f,g,v,w,y,b,M,C,T,S,A,E,P,D;return c=r.topLeftX,d=r.topLeftY,a=r.initialCoordsX,i=r.initialCoordsY,M=t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").offset(),a-=M.left,i-=M.top,o.x-=M.left,o.y-=M.top,l=r.aspectRatio,n=r.width,s=n*l,u==e.OverlayController.HANDLE_POSITION.BOTTOM_LEFT?(v=c,w=d+s+m/2):u==e.OverlayController.HANDLE_POSITION.BOTTOM_CENTER?(v=c+n/2+m,w=d+s+m):u==e.OverlayController.HANDLE_POSITION.BOTTOM_RIGHT&&(v=c+n+2*m,w=d+s+2*m),f=r.centerX,g=r.centerY,y=o.x,b=o.y,A=Math.sqrt(Math.pow(y-f,2)+Math.pow(b-g,2))/Math.sqrt(Math.pow(v-f,2)+Math.pow(w-g,2)),E=p/n,P=h/n,A=A>E?A:E,A=P>A?A:P,x||(C=r.rotation||0,T=Math.atan2(w-g,v-f),C&&(T=C-(2*Math.PI-T)),S=Math.atan2(b-g,y-f),D=S-T+C,r.rotation=D),r.element[0].style[_]="rotate("+D+"rad)",r.element.css({left:(c-.5*n*(A-1)+.5|0)+"px",top:(d-.5*s*(A-1)+.5|0)+"px",width:(n*A+.5|0)+"px",height:(s*A+.5|0)+"px"}),A},V=function(e,r){var o,i;e.length&&(o=e[0].id,i=a[o],i&&(r&&r.apply(t,[i]),I(i)))},z=function(e,r){var o=a[e.attr("id")],i=!1;return o===n&&(i=!0,b=!0),r&&r.apply(t,[o,i]),i},H=function(e){n&&(M=!0,s=n.rotation,e&&e.apply(t,[n]))},X=function(e){e&&(F(e[0]),D(e.attr("id")))},$=function(e,r){e&&e.element&&(F(e.element[0]),r&&r.apply(t,[e]))},Y=function(e){var t,r=i+1,o=new Array(r);for(avpw$.each(a,function(e){o[a[e].zIndex]=a[e]}),t=0;r>t;t++)o[t]&&$(o[t],e)},q=this;return q.activate=function(){i=1,a={},w=null,t.layoutNotify(e.launchData.openType,"showCanvasControlsElement"),c.on("canvas:resize",E)},q.deactivate=function(){B(),a={},t.layoutNotify(e.launchData.openType,"hideCanvasControlsElement"),c.off("canvas:resize",E)},q.updateUIDown=function(t,r,o,a,i,s){var l=!1,u=avpw$(r.target),c=u.closest(".avpw_selection_overlay"),d=u.closest(".avpw_selection_overlay_size_handle"),p=u.closest(".avpw_selection_overlay_close_button");if(p&&p.length)return V(c,i),r.preventDefault(),!1;c&&c.length&&(y=!0,l=z(c,o)),d&&d.length&&H(a);var h=u.closest(".avpw_skew_vertical");h&&h.length&&(C=!0);var f=u.closest(".avpw_skew_horizontal");f&&f.length&&(T=!0),l?(e.util.extend(n,{initialCoordsX:t.x,initialCoordsY:t.y}),F(c[0])):n&&n.element&&(S||R(n,!1),s&&s())},q.updateUIMove=function(r,o,a,i,s){return b&&n&&n.element&&(y&&a&&a.apply(t,[n]),M?(scale=j(n,r),i&&i.apply(t,[n,scale]),y=!1):C?(G(n,r,e.OverlayController.SCALE_TYPE.VERTICAL),i&&i.apply(t,[n])):T?(G(n,r,e.OverlayController.SCALE_TYPE.HORIZONTAL),i&&i.apply(t,[n])):n.mode===l.DRAG_STATE&&(y=!N(n,r),s&&s())),!1},q.apply=function(e,r,o){var i,s=!1,l=avpw$(r.target),u=l.closest(".avpw_selection_overlay");u&&u.length&&(X(u),s=!0,i=a[u.attr("id")]),o&&o.apply(t,[i,s,M]),y&&(y=!1,n&&n.element&&!S&&R(n,!0)),b=!1,M=!1,C=!1,T=!1},q.newOverlay=function(r){var o=r.element;A(),t.layoutNotify(e.launchData.openType,"getCanvasControlsElement").append(o),R(r,!0),a[r.id]=r,F(o[0]),n=r,w=r.id,P()},q.commit=function(e){Y(e)},q.currentOverlay=function(){return n},q.showCurrentOverlay=function(){k()},q.hideCurrentOverlay=function(){U()},q.saveDimensions=function(e){e=e||n,F(e.element[0])},q.isLastOverlayAdded=function(e){return w&&a[w]===e},q.setHandlePosition=function(e){u=e},q.setRotation=function(e,t){e.rotation=t,t=180*t/Math.PI+.5|0,e.element[0].style[_]="rotate("+t+"deg)"},q},e.OverlayController.SCALE_TYPE={HORIZONTAL:0,VERTICAL:1},e.OverlayController.HANDLE_POSITION={BOTTOM_LEFT:0,BOTTOM_CENTER:1,BOTTOM_RIGHT:2,TOP_CENTER:3};var c=e.Events;avpw$="undefined"!=typeof avpw$?avpw$:{},e.math={sign:function(e){return 0>e?-1:1},sqrDist:function(e,t,r,o){var a=r-e,i=o-t;return a*a+i*i},solveQuadratic:function(e,t,r){var o=-t,a=t*t-4*e*r,i=2*e;return 0>a?[0,0]:[(o-Math.sqrt(a))/i,(o+Math.sqrt(a))/i]},lowestPositiveQuadratic:function(t,r,o){var a=e.math.solveQuadratic(t,r,o),i=a[0],n=a[1];return 0>=n&&i>0?i:0>=i&&n>0?n:Math.max(Math.min(i,n),0)},lineSegmentIntersection:function(e,t,r,o,a,i,n,s,l){var u,c,d,p,h,f,m;return e==r&&t==o||a==n&&i==s?null:e==a&&t==i||r==a&&o==i||e==n&&t==s||r==n&&o==s?null:(r-=e,o-=t,a-=e,i-=t,n-=e,s-=t,d=Math.sqrt(r*r+o*o),p=r/d,h=o/d,f=a*p+i*h,i=i*p-a*h,a=f,f=n*p+s*h,s=s*p-n*h,n=f,0>i&&0>s||i>=0&&s>=0?null:(m=n+(a-n)*s/(s-i),0>m||m>d?null:(u=e+m*p,c=t+m*h,l.x=u,l.y=c,!0)))}},e.cnvs=Aviary.util.cnvs,e.Bbox=function(e,t,r,o,a){void 0!==o?(this.x0=e,this.y0=t,this.x1=r,this.y1=o,this.w=this.x1-this.x0,this.h=this.y1-this.y0,void 0!==a?this.margin=a:this.margin=0):this.reset()},e.Bbox.prototype.include=function(e,t){var r=e-this.margin,o=t-this.margin,a=e+this.margin,i=t+this.margin;
this.x0>r&&(this.x0=r),this.y0>o&&(this.y0=o),this.x1<a&&(this.x1=a),this.y1<i&&(this.y1=i),this.w=this.x1-this.x0,this.h=this.y1-this.y0},e.Bbox.prototype.reset=function(){this.x0=999999999,this.y0=999999999,this.x1=-999999999,this.y1=-999999999,this.w=0,this.h=0,this.margin=0},e.Bbox.prototype.contains=function(e,t){var r=e>=this.x0&&e<=this.x1,o=t>=this.y0&&t<=this.y1;return r&&o},e.Bbox.prototype.constrain=function(e,t){var r=!1;return e<this.x0&&(e=this.x0,r=!0),e>this.x1&&(e=this.x1,r=!0),t<this.y0&&(t=this.y0,r=!0),t>this.y1&&(t=this.y1,r=!0),{x:e,y:t,dirty:r}},e.OverlaySelectionModule=function(t){var o=t,a=r.createElement("img");a.width=a.height=50;var i=r.createElement("img");i.width=i.height=50;var n=this;return n.getHandleImageWidth=function(){return i.width},n.drawCropSelection=function(t){if(t){var r,a,n,s,l,u,c=1;e.controlsWidgetInstance&&e.controlsWidgetInstance.canvasUI&&(c=e.controlsWidgetInstance.canvasUI.viewport.getRatio());var d=o.getLayerByName("_ui");t.x0<t.x1?(r=t.x0,n=t.x1):(r=t.x1,n=t.x0),t.y0<t.y1?(a=t.y0,s=t.y1):(a=t.y1,s=t.y0),l=n-r,u=s-a;var p=d.canvas.getContext("2d");p.globalCompositeOperation="copy",p.clearRect(0,0,d.canvas.width,d.canvas.height),p.globalCompositeOperation="source-over",p.fillStyle="#000000",p.globalAlpha=.6,p.fillRect(0,0,r,d.canvas.height),p.fillRect(n,0,d.canvas.width,d.canvas.height),p.fillRect(r,0,n-r,a-0),p.fillRect(r,s,n-r,d.canvas.height-s),p.strokeStyle="#f4f4f4",p.globalAlpha=1,p.lineWidth=c,p.lineCap="square",p.strokeRect(r,a,l,u),p.beginPath(),p.moveTo(r,a+.33*u+.5|0),p.lineTo(n,a+.33*u+.5|0),p.moveTo(r,a+.67*u+.5|0),p.lineTo(n,a+.67*u+.5|0),p.moveTo(r+.33*l+.5|0,a),p.lineTo(r+.33*l+.5|0,s),p.moveTo(r+.67*l+.5|0,a),p.lineTo(r+.67*l+.5|0,s),p.stroke(),p.closePath(),p.globalAlpha=1;for(var h=[{x:r,y:a},{x:n,y:a},{x:r,y:s},{x:n,y:s}],f=0;f<h.length;f++){var m=h[f];p.setTransform(1,0,0,1,0,0),d.localToWorld(m),p.translate(m.x,m.y),p.translate(-1*(c*i.width/2+.5|0),-1*(c*i.height/2+.5|0)),p.scale(c,c),p.drawImage(i,0,0),p.scale(1,1),p.setTransform(1,0,0,1,0,0)}}},n.drawCropSelectionBackground=function(e){if(e){var t,r,a,i,n,s,l=o.getLayerByName("_ui");e.x0<e.x1?(t=e.x0,a=e.x1):(t=e.x1,a=e.x0),e.y0<e.y1?(r=e.y0,i=e.y1):(r=e.y1,i=e.y0),n=a-t,s=i-r;var u=l.canvas.getContext("2d");u.globalCompositeOperation="copy",u.clearRect(0,0,l.canvas.width,l.canvas.height),u.globalCompositeOperation="source-over",u.fillStyle="#000000",u.globalAlpha=.6,u.fillRect(0,0,t,l.canvas.height),u.fillRect(a,0,l.canvas.width,l.canvas.height),u.fillRect(t,0,a-t,r-0),u.fillRect(t,i,a-t,l.canvas.height-i)}},n},e.BrushCursor=function(){var t,o={},a=function(){t=r.createElement("div"),t.className="avpw_draw_cursor",t.style.display="none",e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"getCanvasControlsElement").append(t)};o.show=function(){t||a(),avpw$(t).fadeIn()},o.hide=function(){t&&avpw$(t).hide()},o.shutdown=function(){t=null};var i,n=e.support.getVendorProperty("transform");return i=n&&n.length?function(r,o){t||a();var i=e.controlsWidgetInstance.canvasUI.viewport.getRatio();t.style[n]="translate("+(r/i+.5|0)+"px,"+(o/i+.5|0)+"px)"}:function(r,o){t||a();var i=e.controlsWidgetInstance.canvasUI.viewport.getRatio();t.style.top=(o/i+.5|0)+"px",t.style.left=(r/i+.5|0)+"px"},o.setSize=function(e){t||a(),t.style.width=2*e+"px",t.style.height=2*e+"px",t.style.marginLeft=-e+"px",t.style.marginTop=-e+"px"},c.on("canvas:showBrushCursor",o.show),c.on("canvas:hideBrushCursor",o.hide),c.on("canvas:shutdownBrushCursor",o.shutdown),c.on("canvas:setBrushPosition",i),c.on("canvas:setBrushSize",o.setSize),o}(),e.PaintWidget=function(t,o,a,i,n,s,l){this.imgElementClean=null,this.busy=!1,this.moduleLoadedCallback={},this.canvasReadyCallback=avpw$.Deferred?new avpw$.Deferred:null,this.active=null,this.layers=[],this.dirtyRect={bbox:new e.Bbox,dirty:!1},this.canvas=r.createElement("canvas"),this.setDimensions(t,o),this.canvas.id="avpw_canvas_element",this.dirty=!1,this.actions=a,i&&i.init&&(i.init(this),this.modeManager=i),this.filterManager=n,this.overlayRegistry=s,this.imageBorderManager=l,this.resourceProvider=new Aviary.util.resourceProvider,e.featherGLEnabled||(this.resourceProvider.renderQuality="fastest"),this.resourceProvider.updateViewDimensions=this.setDimensions.AV_bindInst(this)},e.PaintWidget.prototype.restoreStateToCurrentAction=function(){c.trigger("tool:close"),e.resetImageControls(),this.actions.replayAllActions()},e.PaintWidget.prototype.setBackground=function(t){var o,a;if(this.imgElementClean=t,e.featherGLEnabled){var i=new e.util.moaLite.moaGL.MoaGL;this.moaGL=i;var n=r.createElement("canvas");n.width=this.width,n.height=this.height,n.getContext("2d").drawImage(t,0,0,this.width,this.height),this.canvas.width=this.width,this.canvas.height=this.height;var s=this.canvas.getContext("webgl",{preserveDrawingBuffer:!0}),l=this;this.canvas.addEventListener("webglcontextlost",function(e){e.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",function(e){e.preventDefault(),l.restoreStateToCurrentAction()},!1),i.setup(s),i.setImage(n),i.createEffect(),i.renderIdentity(),i.finalizeEffect(),i.commit(),a=!0}else this.canvas.width=this.width,this.canvas.height=this.height,o=this.canvas.getContext("2d"),o.drawImage(t,0,0,this.width,this.height),a=e.cnvs.isOriginClean(o);return this.canvasReadyCallback&&this.canvasReadyCallback.resolve(),c.trigger("layout:resize"),a},e.PaintWidget.prototype.setOrigSize=function(e,t){this._origWidth=e+.5|0,this._origHeight=t+.5|0},e.PaintWidget.prototype.getOrigSize=function(){return{width:this._origWidth,height:this._origHeight}},e.PaintWidget.prototype.c2a=function(e,t,r){var o,a,i,n=this.getScaledSize();return n.hiresWidth&&n.hiresHeight?e!=n.width||t!=n.height?(o=n.hiresWidth/n.width,a=e*o,r&&(a=a+.5|0),o=n.hiresHeight/n.height,i=t*o,r&&(i=i+.5|0),{width:e,height:t,hiresWidth:a,hiresHeight:i}):n:{width:e,height:t}},e.PaintWidget.prototype.a2c=function(e,t,r){var o,a,i,n=this.getScaledSize();return n.hiresWidth&&n.hiresHeight?e!=n.width||t!=n.height?(o=n.width/n.hiresWidth,a=e*o,r&&(a=a+.5|0),o=n.height/n.hiresHeight,i=t*o,r&&(i=i+.5|0),{width:a,height:i,hiresWidth:e,hiresHeight:t}):n:{width:e,height:t}},e.PaintWidget.prototype.shutdown=function(){this.setMode(null),this.modeManager&&(this.modeManager.shutdown(),this.modeManager=null),this.actions=null,this.layers=null,this.currentLayer=null,this.canvas=null,this.moduleLoadedCallback=null,this.canvasReadyCallback=null,this.waitThrobberShow=null},e.PaintWidget.prototype.moduleLoaded=function(t,r){var o,a=this,i=[],n=function(){o.done(function(){r&&r.apply(this,[t])}),a.moduleLoadedCallback[t]=o},s=function(t,r){var s,l;for(s=0;s<t.length;s++)l=e.controlsWidgetInstance.assetManager.getContentURLByVersionKey(t[s].versionKey),l&&!function(){var o=new avpw$.Deferred;r===e.controlsWidgetInstance.assetManager.types.EFFECT?a.filterManager.loadPack(t[s].identifier,l,function(){o.resolve()},r):r===e.controlsWidgetInstance.assetManager.types.IMAGEBORDER?a.imageBorderManager.loadPack(t[s].identifier,l,o.resolve,r):o.resolve(),i.push(o)}();i.push(a.canvasReadyCallback),o=avpw$.when.apply(a,i),n()};return a.moduleLoadedCallback&&(o=a.moduleLoadedCallback[t]),o?n():"effects"===t?e.controlsWidgetInstance.assetManager&&e.controlsWidgetInstance.assetManager.getAssets("EFFECT",s):"frames"===t?e.controlsWidgetInstance.assetManager&&e.controlsWidgetInstance.assetManager.getAssets("IMAGEBORDER",s):(o=avpw$.when(a.canvasReadyCallback),n()),o?o.isResolved():!1},e.PaintWidget.prototype.setDimensions=function(t,r){this.canvas.width=this.width=t,this.canvas.height=this.height=r,e.controlsWidgetInstance&&(e.controlsWidgetInstance.canvasUI&&e.controlsWidgetInstance.canvasUI.resetOffset(),e.controlsWidgetInstance.layoutNotify(e.launchData.openType,"scaleCanvas"))},e.PaintWidget.prototype.getScaledSize=function(){return this.actions?this.actions.getDims():{width:this.width,height:this.height}},e.PaintWidget.prototype.showWaitThrobber=function(e,t){t&&setTimeout(t,5)},e.PaintWidget.prototype.uiLayerDrawCircleSelection=function(t,r,o,a){var i=this.getLayerByName("_ui"),n=i.canvas.getContext("2d"),s=1;a||(n.globalCompositeOperation="copy",n.clearRect(0,0,i.canvas.width,i.canvas.height));var l=1;e.controlsWidgetInstance.canvasUI&&(l=e.controlsWidgetInstance.canvasUI.viewport.getRatio()),s=s*l+.5|0,n.globalCompositeOperation="source-over",n.lineWidth=s,n.globalAlpha=1,n.beginPath(),n.strokeStyle="#ffffff",n.arc(t,r,o,0,2*Math.PI,!1),n.closePath(),n.stroke();var u=o-s;u>0&&(n.beginPath(),n.strokeStyle="#000000",n.arc(t,r,u,0,2*Math.PI,!1),n.closePath(),n.stroke())},e.PaintWidget.prototype.dirtyRectEnable=function(e){this.dirtyRect.dirty=e},e.PaintWidget.prototype.makeThumbFlat=function(e,t,r){r||(r=this.canvas);var o=e.width,a=e.height,i=e.getContext("2d");i.globalCompositeOperation="copy",i.clearRect(0,0,e.width,e.height),i.globalCompositeOperation="source-over";var n=o/r.width,s=a/r.height;if(t)if(n>s){var l=r.width*s,u=(o-l)/2;i.drawImage(r,0,0,r.width,r.height,u,0,l,a)}else{var c=r.height*n,d=(a-c)/2;i.drawImage(r,0,0,r.width,r.height,0,d,o,c)}else if(s>n){var l=r.width*s,u=-(l-o)/2;i.drawImage(r,0,0,r.width,r.height,u,0,l,a)}else{var c=r.height*n,d=-(c-a)/2;i.drawImage(r,0,0,r.width,r.height,0,d,o,c)}return e},e.PaintWidget.prototype.exportImage=function(t,o){t=t||"image/png";var a,i=function(){var e=r.createElement("canvas"),t=e.toDataURL("image/png");return 0==t.indexOf("data:image/png")};("image/jpg"===t||"image/jpeg"===t)&&(t="image/jpeg",a=e.launchData.jpgQuality),a&&"number"==typeof a?a>0&&100>a?a/=100:a=.9:a=null;var n;return i()&&(n=this.canvas.toDataURL(t,a)),o&&"function"==typeof o&&o.apply(this,[n]),!0},e.PaintWidget.prototype.setMode=function(e){if(null!==this.active&&void 0!==this.active.deactivate&&this.active.deactivate(),null!==e&&void 0!==e&&""!==e){var t=this.module[e];void 0!==t&&(this.active=t,void 0!==this.active.activate&&this.active.activate(this))}else this.active=null},e.PaintWidget.prototype.getCanvasBacking=function(){var t;return e.featherGLEnabled?(this.moaGL.createEffect(),this.moaGL.renderIdentity(),this.moaGL.finalizeEffect(),this.moaGL.commit(),t=this.moaGL.createTexture(this.width,this.height),this.moaGL.copyLastRender(t)):t=e.cnvs.copyCanvas(this.canvas),t},e.PaintWidget.prototype.undo=function(){this.active&&void 0!==this.active.userUndo&&this.active.userUndo(),this.actions.undo(),this.active&&void 0!==this.active.userPostUndo&&this.active.userPostUndo()},e.PaintWidget.prototype.redo=function(){this.active&&void 0!==this.active.userRedo&&this.active.userRedo(),this.actions.redo(),this.active&&void 0!==this.active.userPostRedo&&this.active.userPostRedo()},e.PaintWidget.prototype.module={},e.PaintModule=function(){},e.PaintModule.prototype.activate=function(t,r){this.paintWidget=t,this.isDirty=!1,this.origBacking=this.getPreviousActionBacking()||t.getCanvasBacking(),this.initialDims=r||this.paintWidget.getScaledSize(),e.paintWidgetInstance.hasUncommittedChanges=!1,this.onActivate&&this.onActivate.call(this)},e.PaintModule.prototype.deactivate=function(){this.isDirty=!1,this.backingReference=null,this.origBacking=null,this.onDeactivate&&this.onDeactivate.call(this)},e.PaintModule.prototype.backingReference=null,e.PaintModule.prototype.applyBackingToImage=function(t){if(e.featherGLEnabled)this.paintWidget.moaGL.setTextureAsSourceImage(t),this.paintWidget.moaGL.createEffect(),this.paintWidget.moaGL.renderIdentity(),this.paintWidget.moaGL.finalizeEffect(),this.paintWidget.moaGL.commit();else{var r=this.paintWidget.canvas.getContext("2d");r.drawImage(t,0,0)}},e.PaintModule.prototype.applyBackingToImageWithSizeChange=function(t,r){var o=r.width,a=r.height;if(this.paintWidget.resourceProvider.updateViewDimensions(o,a),e.featherGLEnabled)this.paintWidget.moaGL.setTextureAsSourceImage(t,o,a),this.paintWidget.moaGL.createEffect(),this.paintWidget.moaGL.renderIdentity(),this.paintWidget.moaGL.finalizeEffect(),this.paintWidget.moaGL.commit();else{var i=this.paintWidget.canvas.getContext("2d");i.drawImage(t,0,0)}},e.PaintModule.prototype.setUpSources=function(){e.featherGLEnabled?this.src=this.dst={moaGL:this.paintWidget.moaGL,width:this.paintWidget.canvas.width,height:this.paintWidget.canvas.height}:(this.src=e.cnvs.getCanvasPixelData(this.paintWidget.canvas),this.dst=e.cnvs.getCanvasPixelData(this.paintWidget.canvas))},e.PaintModule.prototype.shouldSkipUndoBeforePreview=!1,e.PaintModule.prototype.applyPreviewAction=function(t,r,o){this.shouldSkipUndoBeforePreview||e.paintWidgetInstance.hasUncommittedChanges&&this.paintWidget.actions.undo(),this.backingReference={beforeBacking:this.origBacking,afterBacking:null};var a,i;this.getWidthHeightToUseForAction&&(this.initialDims&&(i=this.initialDims),a={beforeDimensions:i,afterDimensions:this.getWidthHeightToUseForAction(t)}),this.paintWidget.actions.push({undoHandler:this.undoHandler,redoHandler:this.redoHandler,redoMethod:r,context:this,action:t,backingReference:this.backingReference,dimensions:a}),o?this.paintWidget.actions.redoFake():this.paintWidget.actions.redo()},e.PaintModule.prototype.isDirty=!1,e.PaintModule.prototype.undoHandler=function(t){var r=t.backingReference,o=t.dimensions;r.beforeBacking&&(o&&o.beforeDimensions?this.applyBackingToImageWithSizeChange(r.beforeBacking,o.beforeDimensions):this.applyBackingToImage(r.beforeBacking)),e.paintWidgetInstance.hasUncommittedChanges=!1},e.PaintModule.prototype.redoHandler=function(t){var r=t.backingReference,o=t.redoMethod,a=t.action;r.afterBacking?this.applyBackingToImage(r.afterBacking):o.call(this,a,r),e.paintWidgetInstance.hasUncommittedChanges=!0},e.PaintModule.prototype.commit=function(){this.onPreCommit&&this.onPreCommit.call(this),e.featherGLEnabled&&this.paintWidget.moaGL.commit(),!this.shouldAvoidGeneratingAfterBacking&&this.backingReference&&(this.backingReference.afterBacking=this.paintWidget.getCanvasBacking()),e.paintWidgetInstance.hasUncommittedChanges=!1},e.PaintModule.prototype.getPreviousActionBacking=function(){if(this.paintWidget&&this.paintWidget.actions){var t=this.paintWidget.actions.getPreviousActionParameters();if(t&&t.backingReference&&t.backingReference.afterBacking){var r=t.backingReference;if(e.featherGLEnabled&&r.afterBacking instanceof WebGLTexture)return r.afterBacking}}},e.PaintModuleActionlist=function(e){e||(e={}),this.shouldSkipUndoBeforePreview=e.shouldSkipUndoBeforePreview||this.shouldSkipUndoBeforePreview||!1,this.actionGenerator=e.actionGenerator},e.PaintModuleActionlist.prototype=new e.PaintModule,e.PaintModuleActionlist.prototype._filterGL=function(t){var r={moaGL:this.paintWidget.moaGL,width:this.paintWidget.width,height:this.paintWidget.height};t=f(t),e.util.moaLite.MoaliteActionlistManager.MLPLRunAction(t,r,this.paintWidget.resourceProvider)},e.PaintModuleActionlist.prototype._filter=function(r,o){var a=this.paintWidget.canvas,i=a.getContext("2d"),n=e.cnvs.getCanvasPixelData(o),s={data:n.data,width:n.width,height:n.height};r=f(r),e.util.moaLite.MoaliteActionlistManager.MLPLRunAction(r,s,this.paintWidget.resourceProvider),n=i.createImageData(s.width,s.height),t.ImageData&&n.data.set?n.data.set(s.data):e.util.moaLite.copyProcessor.copyTo(n,s),i.fillRect(0,0,n.width,n.height),i.putImageData(n,0,0,0,0,n.width,n.height)},e.PaintModuleActionlist.prototype._filterRedo=function(t,r){e.featherGLEnabled?this._filterGL(t):this._filter(t,r.beforeBacking)},e.PaintModuleActionlist.prototype.reset=function(){e.featherGLEnabled&&(this.paintWidget.moaGL.createEffect(),this.paintWidget.moaGL.renderIdentity(),this.paintWidget.moaGL.commit())},e.PaintModuleActionlist.prototype.applyPreview=function(){var e=this.actionGenerator.apply(this,arguments);e&&this.applyPreviewAction(e,this._filterRedo)},e.PaintModuleActionlist.prototype.generateAction=function(){return this.actionGenerator.apply(this,arguments)},e.PaintModuleActionlist.prototype.applyMultiple=function(t,r){var o=e.util.moaLite.MoaliteActionlistGenerator.MLPLActionGroup(t,r);o&&this.applyPreviewAction(o,this._filterRedo)};var f=function(t){if("resize"===t.name&&(t.parameters.size[0]>e.launchData.maxSize||t.parameters.size[1]>e.launchData.maxSize)){var r,o;t.parameters.size[1]<t.parameters.size[0]?(r=e.launchData.maxSize,o=Math.round(e.launchData.maxSize*t.parameters.size[1]/t.parameters.size[0])):(o=e.launchData.maxSize,r=Math.round(e.launchData.maxSize*t.parameters.size[0]/t.parameters.size[1])),t=e.util.moaLite.MoaliteActionlistGenerator.MLPLActionResize([r,o])}return t};i.prototype=new e.PaintModuleActionlist,i.prototype.makeThumb=function(t,r){this.paintWidget.makeThumbFlat(r);var o=this.paintWidget.filterManager.getEffectById(t),a=r.getContext("2d"),i=e.cnvs.getCanvasPixelData(r),n=e.util.moaLite.MoaliteActionlistGenerator.MLPLActionEffectJSON(o.processors,1);e.util.moaLite.MoaliteActionlistManager.MLPLRunAction(n,i,this.paintWidget.resourceProvider),a.putImageData(i,0,0)},e.PaintWidget.prototype.module.effects=new i({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionEffectIdentifier}),n.prototype=new e.PaintModule,n.prototype.shouldSkipUndoBeforePreview=!0,n.prototype.src=void 0,n.prototype.dst=void 0,n.prototype.brushInstance=void 0,n.prototype.onActivate=function(){this.setUpSources(),this.brushInstance=new e.util.moaLite.MoaDrawBrushState(this.src,this.dst)},n.prototype.createStroke=function(e,t,r,o){this.brushInstance.startNewStroke(e/this.dst.width,t,r,o)},n.prototype.addPoints=function(e,t){this.brushInstance.addPointsToCurrentStroke([[e/this.dst.width,t/this.dst.height,(new Date).getTime()]])},n.prototype.finishStroke=function(){this.brushInstance.endCurrentStroke(),this.brushInstance.renderPreview()},n.prototype.preview=function(){if(e.featherGLEnabled)this.paintWidget.moaGL.createEffect(),this.brushInstance.renderPreview(),this.paintWidget.moaGL.finalizeEffect();else{var t=this.paintWidget.canvas,r=t.getContext("2d");this.brushInstance.renderPreview(),r.putImageData(this.dst,0,0)}},n.prototype.setRadius=function(e){this.radius=e},n.prototype.getRadius=function(){return this.radius},n.prototype.reset=function(){if(e.featherGLEnabled)this.paintWidget.moaGL.createEffect(),this.paintWidget.moaGL.renderIdentity(),this.paintWidget.moaGL.finalizeEffect();else{var t=this.paintWidget.canvas,r=t.getContext("2d");r.putImageData(this.src,0,0)}},n.prototype.getColorAtPosition=function(e,t){if(this.brushInstance){var r=this.brushInstance.findColorAtPoint([e/this.src.width,t/this.src.height]);return[r.r,r.g,r.b,r.a]}},n.prototype.mindTheGap=function(t,r,o,a){if(null!=t){var i=Math.sqrt(Math.pow(t.x-r,2)+Math.pow(t.y-o,2));if(.6*a>i)return;for(var n,s,l=e.util.generatePointList([[t.x,t.y],[r,o]],a),u=0;u<l.length;u++)n=l[u][0]+.5|0,s=l[u][1]+.5|0,this.addPoints(r,o);this.preview()}},n.prototype.commitDrawState=function(){var e=this.brushInstance.getActionlistObject();return this.shouldAllowEmptyStrokes||e&&e.parameters.strokes.length?(this.applyPreviewAction(e,null,!0),void this.commit()):void this.reset()},s.prototype=new n,s.prototype.onActivate=function(){this.setUpSources(),this.brushInstance=new e.util.moaLite.MoaSelectiveBrushState(this.src,this.dst,this.module)},s.prototype.createStroke=function(e,t){this.brushInstance.startNewStroke(e/this.dst.width,t)},s.prototype.addPoints=function(e,t){this.brushInstance.addPointsToCurrentStroke([[e/this.dst.width,t/this.dst.height]])},l.prototype=new e.PaintModuleActionlist,l.prototype.shouldSkipUndoBeforePreview=!0,l.prototype.shouldAvoidGeneratingAfterBacking=!0,e.PaintWidget.prototype.module.crop=new l({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionCrop}),e.PaintWidget.prototype.module.crop.getWidthHeightToUseForAction=u,e.PaintWidget.prototype.module.crop.applyCropAndResize=function(){var t=this.getWidthHeightToUseForAction;this.getWidthHeightToUseForAction=e.PaintWidget.prototype.module.resize.getWidthHeightToUseForAction;var r=this.actionGenerator;this.actionGenerator=e.util.moaLite.MoaliteActionlistGenerator.MLPLActionCropAndResize,this.applyPreview.apply(this,arguments),this.getWidthHeightToUseForAction=t,this.actionGenerator=r},e.PaintWidget.prototype.module.overlays=new l({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionOverlay}),e.PaintWidget.prototype.module.overlays.getWidthHeightToUseForAction=u,e.PaintWidget.prototype.module.resize=new l({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionResize}),e.PaintWidget.prototype.module.resize.getWidthHeightToUseForAction=function(e){var t=this.paintWidget.getScaledSize(),r=e.parameters.size,o={width:r[0],height:r[1]};return t.hiresWidth&&t.hiresHeight&&(o.hiresWidth=r[0],o.hiresHeight=r[1]),o};var m=new l({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionOrientation});m.set=function(t,r,o){var a=r,i=o,n=a/2,s=i/2,l=0,u=a,c=0,d=i,p=new e.Bbox(l,c,u,d,0);if(t){var h,f=Math.cos(t),m=Math.sin(t),g=Math.cos(-t),v=Math.sin(-t),_=n+f*(l-n)+m*(c-s),x=n+f*(l-n)+m*(d-s),w=n+f*(u-n)+m*(c-s),y=n+f*(u-n)+m*(d-s),b=s+m*-(l-n)+f*(c-s),M=s+m*-(l-n)+f*(d-s),C=s+m*-(u-n)+f*(c-s),T=s+m*-(u-n)+f*(d-s),S=[[_,b,w,C],[w,C,y,T],[y,T,x,M],[x,M,_,b]],A=[0,0,a,i],E=[a,0,0,i],P=[],D=function(e){var t=n+g*(e.x-n)+v*(e.y-s),r=s+v*-(e.x-n)+g*(e.y-s);t=0|t,r=0|r,p.contains(t,r)&&P.push({x:e.x,y:e.y})};for(h=0;h<S.length;h++){var F=S[h],L={};e.math.lineSegmentIntersection(F[0],F[1],F[2],F[3],A[0],A[1],A[2],A[3],L)&&D(L),e.math.lineSegmentIntersection(F[0],F[1],F[2],F[3],E[0],E[1],E[2],E[3],L)&&D(L)}for(h=0;h<P.length;h++){var L=P[h];L.y>s?L.y<p.y1&&(p.y1=L.y):L.y>p.y0&&(p.y0=L.y),L.x>n?L.x<p.x1&&(p.x1=L.x):L.x>p.x0&&(p.x0=L.x)}}var R=p.x1-p.x0;return R?r/R:1},m.getWidthHeightToUseForAction=function(e){var t=this.paintWidget.getScaledSize(),r=e.parameters.imageRotation,o=!1;(90===r||270===r)&&(o=!0);var a={};if(o?(a.width=t.height,a.height=t.width,a.hiresWidth=t.hiresHeight,a.hiresHeight=t.hiresWidth):(a.width=t.width,a.height=t.height,a.hiresWidth=t.hiresWidth,a.hiresHeight=t.hiresHeight),0!==e.parameters.straightenRotation){var i=this.set(e.parameters.straightenRotation,a.width,a.height);a.width=Math.ceil(t.width/i),a.height=Math.ceil(t.height/i),a.hiresWidth=Math.ceil(t.hiresWidth/i),a.hiresHeight=Math.ceil(t.hiresHeight/i)}return a},e.PaintWidget.prototype.module.orientation=m,e.PaintWidget.prototype.module.vignette=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionVignette}),e.PaintWidget.prototype.module.focus=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionTiltShift}),e.PaintWidget.prototype.module.enhance=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionEnhance}),e.PaintWidget.prototype.module.frames=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionFrame}),e.PaintWidget.prototype.module.adjust=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionAdjust}),e.PaintWidget.prototype.module.sharpness=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionSharpness}),e.PaintWidget.prototype.module.overlay=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionSticker}),e.PaintWidget.prototype.module.textwithfont=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionText}),e.PaintWidget.prototype.module.meme=new e.PaintModuleActionlist({actionGenerator:e.util.moaLite.MoaliteActionlistGenerator.MLPLActionMeme}),e.PaintWidget.prototype.module.drawing=new n;var g=e.util.moaLite.MoaSelectiveBrushState.prototype.toolTypes;e.PaintWidget.prototype.module.colorsplash=new s({module:g.SelectiveBrushToolTypeColorSplash,shouldAllowEmptyStrokes:!0}),e.PaintWidget.prototype.module.blemish=new s({module:g.SelectiveBrushToolTypeBlur}),e.PaintWidget.prototype.module.whiten=new s({module:g.SelectiveBrushToolTypeWhiten}),e.PaintWidget.prototype.module.redeye=new s({module:g.SelectiveBrushToolTypeRedeye})}(window.AV||(window.AV={}),window,document);